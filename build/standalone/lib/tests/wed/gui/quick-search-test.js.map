{"version":3,"file":"quick-search-test.js","sourceRoot":"","sources":["../../../../../../lib/tests/wed/gui/quick-search-test.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @author Louis-Dominique Dubeau\n * @license MPL 2.0\n * @copyright Mangalam Research Center for Buddhist Languages\n */\nimport { CaretManager } from \"wed/caret-manager\";\nimport { DLoc, DLocRange } from \"wed/dloc\";\nimport { Editor, WedEventTarget } from \"wed/editor\";\nimport { Direction, QuickSearch } from \"wed/gui/quick-search\";\nimport { Key } from \"wed/key\";\nimport { ESCAPE, QUICKSEARCH_BACKWARDS,\n         QUICKSEARCH_FORWARD } from \"wed/key-constants\";\n\nimport * as globalConfig from \"../../base-config\";\n\nimport { EditorSetup } from \"../../wed-test-util\";\n\nconst expect = chai.expect;\n\ndescribe(\"quick-search\", () => {\n  let setup: EditorSetup;\n  let editor: Editor;\n  let guiRoot: HTMLElement;\n  let dataRoot: Document;\n  let docScope: DLocRange;\n  let caretManager: CaretManager;\n\n  let ps: Element[];\n  let firstBodyP: Element;\n  let firstBodyPLocation: DLoc;\n  let pFiveFirstThree: DLocRange;\n  let pFiveFirstFour: DLocRange;\n  let pSevenFirstThree: DLocRange;\n  let firstABCText: DLocRange;\n  let firstABCDText: DLocRange;\n  let firstABCAttribute: DLocRange;\n  let firstABCDAttribute: DLocRange;\n  let secondABCAttribute: DLocRange;\n  let titleBCD: DLocRange;\n  let titleABCD: DLocRange;\n\n  before(() => {\n    setup = new EditorSetup(\n      \"/base/build/standalone/lib/tests/search_test_data/source_converted.xml\",\n      globalConfig.config,\n      document);\n    ({ editor } = setup);\n    return setup.init();\n  });\n\n  beforeEach(() => {\n    guiRoot = editor.guiRoot;\n    dataRoot = editor.dataRoot;\n    caretManager = editor.caretManager;\n    docScope = editor.caretManager.docDLocRange;\n\n    const title = dataRoot.querySelector(\"title\")!;\n    titleBCD = new DLocRange(\n      caretManager.mustFromDataLocation(title.firstChild!, 1),\n      caretManager.mustFromDataLocation(title.firstChild!, 4));\n    titleABCD = new DLocRange(\n      caretManager.mustFromDataLocation(title.firstChild!, 0),\n      caretManager.mustFromDataLocation(title.firstChild!, 4));\n\n    ps = Array.from(dataRoot.querySelectorAll(\"body p\"));\n    firstBodyP = ps[0];\n    firstBodyPLocation = caretManager.mustFromDataLocation(\n      DLoc.mustMakeDLoc(dataRoot, firstBodyP, 0));\n    caretManager.setCaret(firstBodyPLocation);\n\n    // First 3 text characters in the 5th paragraph (at index 4).\n    const pFiveStart = DLoc.mustMakeDLoc(dataRoot, ps[4].firstChild, 0);\n    pFiveFirstThree = new DLocRange(\n      caretManager.mustFromDataLocation(pFiveStart),\n      caretManager.mustFromDataLocation(pFiveStart.makeWithOffset(3)));\n    expect(pFiveFirstThree.mustMakeDOMRange().toString()).to.equal(\"abc\");\n\n    pFiveFirstFour = new DLocRange(\n      caretManager.mustFromDataLocation(pFiveStart),\n      caretManager.mustFromDataLocation(pFiveStart.makeWithOffset(4)));\n    expect(pFiveFirstFour.mustMakeDOMRange().toString()).to.equal(\"abcd\");\n\n    const pSevenStart = DLoc.mustMakeDLoc(dataRoot, ps[6].firstChild, 0);\n    pSevenFirstThree = new DLocRange(\n      caretManager.mustFromDataLocation(pSevenStart),\n      caretManager.mustFromDataLocation(pSevenStart.makeWithOffset(3)));\n    expect(pSevenFirstThree.mustMakeDOMRange().toString()).to.equal(\"abc\");\n\n    // This is the first \"abc\" found when doing a TEXT search.\n    firstABCText = new DLocRange(\n      caretManager.mustFromDataLocation(ps[3].firstChild!.firstChild!, 0),\n      caretManager.mustFromDataLocation(ps[3].lastChild!, 1));\n\n    // This is the first \"abcd\" found when doing a TEXT search.\n    firstABCDText = new DLocRange(\n      caretManager.mustFromDataLocation(ps[3].firstChild!.firstChild!, 0),\n      caretManager.mustFromDataLocation(ps[3].lastChild!, 2));\n\n    const rend = ps[7].getAttributeNode(\"rend\");\n    firstABCAttribute = new DLocRange(\n      caretManager.mustFromDataLocation(rend, 0),\n      caretManager.mustFromDataLocation(rend, 3));\n\n    firstABCDAttribute = new DLocRange(\n      caretManager.mustFromDataLocation(rend, 0),\n      caretManager.mustFromDataLocation(rend, 4));\n\n    secondABCAttribute = new DLocRange(\n      caretManager.mustFromDataLocation(rend, 4),\n      caretManager.mustFromDataLocation(rend, 7));\n  });\n\n  afterEach(() => {\n    // Make sure the minibuffer is off after each test.\n    expect(editor).to.have.deep.property(\"minibuffer.enabled\").false;\n    setup.reset();\n  });\n\n  after(() => {\n    setup.restore();\n    // tslint:disable-next-line:no-any\n    (editor as any) = undefined;\n  });\n\n  function makeQuickSearch(direction: Direction): QuickSearch {\n    // tslint:disable-next-line:no-any\n    return new QuickSearch(editor, (editor as any).scroller, direction);\n  }\n\n  function checkHighlightRanges(range: DLocRange): void {\n    const highlights = document.querySelectorAll(\"._wed_highlight\")!;\n    expect(highlights).to.have.property(\"length\").greaterThan(0);\n    let highlightRect = highlights[0].getBoundingClientRect();\n    const rangeRect =\n      firstABCText.mustMakeDOMRange().getBoundingClientRect();\n\n    // The highlights are built as a series of rectangles. Checking each and\n    // every rectangle would be onerous. We check the start and end of the\n    // range.\n\n    // Rounding can make the boundaries vary a bit.\n    expect(highlightRect).to.have.deep.property(\"top\")\n      .closeTo(rangeRect.top, 3);\n    expect(highlightRect).to.have.deep.property(\"left\")\n      .closeTo(rangeRect.left, 3);\n\n    highlightRect = highlights[highlights.length - 1].getBoundingClientRect();\n    expect(highlightRect).to.have.deep.property(\"bottom\")\n      .closeTo(rangeRect.bottom, 3);\n    expect(highlightRect).to.have.deep.property(\"right\")\n      .closeTo(rangeRect.right, 3);\n  }\n\n  function checkNoHighlight(): void {\n      expect(document.querySelector(\"._wed_highlight\")).to.be.null;\n  }\n\n  describe(\"QuickSearch\", () => {\n\n    beforeEach(() => {\n      checkNoHighlight();\n    });\n\n    it(\"can be built\", () => {\n      makeQuickSearch(Direction.FORWARD);\n      editor.minibuffer.uninstallClient();\n    });\n\n    it(\"prompts forward\", () => {\n      editor.type(QUICKSEARCH_FORWARD);\n      expect(editor).to.have.deep.property(\"minibuffer.prompt\")\n        .equal(\"Search forward:\");\n      editor.type(ESCAPE, WedEventTarget.MINIBUFFER);\n    });\n\n    it(\"prompts backwards\", () => {\n      editor.type(QUICKSEARCH_BACKWARDS);\n      expect(editor).to.have.deep.property(\"minibuffer.prompt\")\n        .equal(\"Search backwards:\");\n      editor.type(ESCAPE, WedEventTarget.MINIBUFFER);\n    });\n\n    it(\"updates the highlight when the user types\", () => {\n      editor.type(QUICKSEARCH_FORWARD);\n      editor.type(\"abc\", WedEventTarget.MINIBUFFER);\n      checkHighlightRanges(firstABCText);\n      editor.type(ESCAPE, WedEventTarget.MINIBUFFER);\n    });\n\n    it(\"searches forward\", () => {\n      editor.type(QUICKSEARCH_FORWARD);\n      editor.type(\"abc\", WedEventTarget.MINIBUFFER);\n      checkHighlightRanges(firstABCText);\n      editor.type(QUICKSEARCH_FORWARD);\n      checkHighlightRanges(pFiveFirstThree);\n      editor.type(ESCAPE, WedEventTarget.MINIBUFFER);\n    });\n\n    it(\"searches backwards\", () => {\n      editor.type(QUICKSEARCH_FORWARD);\n      editor.type(\"abc\", WedEventTarget.MINIBUFFER);\n      checkHighlightRanges(firstABCText);\n      editor.type(QUICKSEARCH_FORWARD);\n      checkHighlightRanges(pFiveFirstThree);\n      editor.type(QUICKSEARCH_BACKWARDS);\n      checkHighlightRanges(firstABCText);\n      editor.type(ESCAPE, WedEventTarget.MINIBUFFER);\n    });\n\n    it(\"removes the highlight when there is no match\", () => {\n      editor.type(QUICKSEARCH_FORWARD);\n      editor.type(\"abcNO MATCH\", WedEventTarget.MINIBUFFER);\n      checkNoHighlight();\n      editor.type(ESCAPE, WedEventTarget.MINIBUFFER);\n    });\n\n    function rollTest(key: Key): void {\n      editor.type(key);\n      editor.type(\"abc\", WedEventTarget.MINIBUFFER);\n      let count = 0;\n      while (document.querySelector(\"._wed_highlight\") !== null) {\n        count++;\n        editor.type(key, WedEventTarget.MINIBUFFER);\n      }\n      expect(count).to.be.greaterThan(0);\n\n      let count2 = 0;\n      editor.type(key, WedEventTarget.MINIBUFFER);\n      while (document.querySelector(\"._wed_highlight\") !== null) {\n        count2++;\n        editor.type(key, WedEventTarget.MINIBUFFER);\n      }\n\n      expect(count2).to.equal(count);\n      editor.type(ESCAPE, WedEventTarget.MINIBUFFER);\n    }\n\n    it(\"rolls over forward\", () => {\n      editor.caretManager.setCaret(editor.caretManager.minCaret);\n      rollTest(QUICKSEARCH_FORWARD);\n    });\n\n    it(\"rolls over backwards\", () => {\n      editor.caretManager.setCaret(editor.caretManager.maxCaret);\n      rollTest(QUICKSEARCH_BACKWARDS);\n    });\n  });\n});\n"]}