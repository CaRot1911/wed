{"version":3,"file":"ajax-test.js","sourceRoot":"","sources":["../../../../../../lib/tests/wed/savers/ajax-test.ts"],"names":[],"mappings":"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","sourcesContent":["// tslint:disable-next-line:missing-jsdoc\nimport \"chai\";\nimport * as $ from \"jquery\";\nimport * as sinon from \"sinon\";\n\nconst expect = chai.expect;\n\nimport { DLocRoot } from \"wed/dloc\";\nimport { Runtime } from \"wed/runtime\";\nimport { Saver } from \"wed/savers/ajax\";\nimport { TreeUpdater } from \"wed/tree-updater\";\n\ndescribe(\"ajax\", () => {\n  let sandbox: sinon.SinonSandbox;\n  let rt: Runtime;\n  let server: sinon.SinonFakeServer;\n\n  before(() => {\n    sandbox = sinon.sandbox.create({ useFakeServer: true });\n    // We use any here to cheat a bit.\n    // tslint:disable-next-line:no-any\n    rt = new Runtime({} as any);\n    new DLocRoot(document);\n    server = sandbox.server;\n    server.respondImmediately = true;\n  });\n\n  afterEach(() => {\n    sandbox.reset();\n  });\n\n  after(() => {\n    sandbox.restore();\n  });\n\n  it(\"can be created\", () => {\n    new Saver(rt, \"0.30.0\", new TreeUpdater(document), document, {\n      url: \"/moo\",\n    });\n  });\n\n  describe(\"#init\", () => {\n    it(\"sends a check command with the editor version\", async () => {\n      const saver = new Saver(rt, \"0.30.0\", new TreeUpdater(document),\n                              document, {\n                                url: \"/moo\",\n                              });\n      server.respondWith(\"POST\", \"/moo\",\n                         [200, { \"Content-Type\": \"application/json\" },\n                          JSON.stringify({messages: []})]);\n      await saver.init();\n      expect(server).to.have.property(\"requests\").have.lengthOf(1);\n      expect(server).to.have.deep.property(\"requests[0].requestBody\")\n        .equal($.param({ command: \"check\", version: \"0.30.0\" }));\n    });\n\n    it(\"sets no If-Match if there is no etag set in the options\", async () => {\n      const saver = new Saver(rt, \"0.30.0\", new TreeUpdater(document),\n                              document, {\n                                url: \"/moo\",\n                              });\n      server.respondWith(\"POST\", \"/moo\",\n                         [200, { \"Content-Type\": \"application/json\" },\n                          JSON.stringify({messages: []})]);\n      await saver.init();\n      expect(server).to.have.property(\"requests\").have.lengthOf(1);\n      expect(server).to.not.have.deep\n        .property(\"requests[0].requestHeaders.If-Match\");\n    });\n\n    it(\"sets If-Match if there an etag set in the options\", async () => {\n      const saver = new Saver(rt, \"0.30.0\", new TreeUpdater(document),\n                              document, {\n                                url: \"/moo\",\n                                initial_etag: \"abc\",\n                              });\n      server.respondWith(\"POST\", \"/moo\",\n                         [200, { \"Content-Type\": \"application/json\" },\n                          JSON.stringify({messages: []})]);\n      await saver.init();\n      expect(server).to.have.property(\"requests\").have.lengthOf(1);\n      expect(server).to.have.deep\n        .property(\"requests[0].requestHeaders.If-Match\").equal(\"\\\"abc\\\"\");\n    });\n  });\n});\n"]}