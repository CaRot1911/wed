{"version":3,"file":"action-context-menu.js","sourceRoot":"","sources":["../../../../../lib/wed/gui/action-context-menu.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Context menus meant to hold actions.\n * @author Louis-Dominique Dubeau\n * @license MPL 2.0\n * @copyright Mangalam Research Center for Buddhist Languages\n */\nimport $ from \"jquery\";\n\nimport { Action } from \"../action\";\nimport * as browsers from \"../browsers\";\nimport * as keyMod from \"../key\";\nimport * as keyConstants from \"../key-constants\";\nimport { Transformation, TransformationData } from \"../transformation\";\nimport { ContextMenu as Base, DismissCallback } from \"./context-menu\";\nimport * as icon from \"./icon\";\n\nconst KINDS = [\"transform\", \"add\", \"delete\", \"wrap\", \"unwrap\"];\n// ``undefined`` is \"other kinds\".\nconst KIND_FILTERS = (KINDS as (string | undefined)[]).concat(undefined);\n// Sort order.\nconst KIND_ORDER = ([undefined] as (string | undefined)[]).concat(KINDS);\n\nconst TYPES = [\"element\", \"attribute\"];\nconst TYPE_FILTERS = (TYPES as (string | undefined)[]).concat(undefined);\n\nconst ITEM_SELECTOR = \"li:not(.divider):visible a\";\n\nconst plus = keyMod.makeKey(\"+\");\nconst minus = keyMod.makeKey(\"-\");\nconst period = keyMod.makeKey(\".\");\nconst comma = keyMod.makeKey(\",\");\nconst question = keyMod.makeKey(\"?\");\nconst less = keyMod.makeKey(\"<\");\nconst at = keyMod.makeKey(\"@\");\nconst exclamation = keyMod.makeKey(\"!\");\n\nconst KEY_TO_FILTER: {\n  key: keyMod.Key;\n  filter: \"add\" | \"delete\" | \"wrap\" | \"unwrap\" | \"element\" | \"attribute\" |\n    undefined;\n  which: \"kind\" | \"type\";\n}[] = [\n  { key: plus, filter: \"add\", which: \"kind\" },\n  { key: minus, filter: \"delete\", which: \"kind\" },\n  { key: comma, filter: \"wrap\", which: \"kind\" },\n  { key: period, filter: \"unwrap\", which: \"kind\" },\n  { key: question, filter: undefined, which: \"kind\" },\n  { key: less, filter: \"element\", which: \"type\" },\n  { key: at, filter: \"attribute\", which: \"type\" },\n  { key: exclamation, filter: undefined, which: \"type\" },\n];\n\nexport interface Item {\n  action: Action<{}> | null;\n  item: Element;\n  data: TransformationData | null;\n}\n\nfunction compareItems(a: Item, b: Item): number {\n  const aKind = (a.action !== null && (a.action instanceof Transformation)) ?\n    a.action.kind : undefined;\n  const bKind = (b.action !== null && (b.action instanceof Transformation)) ?\n    b.action.kind : undefined;\n\n  if (aKind !== bKind) {\n    const aOrder = KIND_ORDER.indexOf(aKind);\n    const bOrder = KIND_ORDER.indexOf(bKind);\n\n    return aOrder - bOrder;\n  }\n\n  const aText = a.item.textContent!;\n  const bText = b.item.textContent!;\n  if (aText === bText) {\n    return 0;\n  }\n\n  if (aText < bText) {\n    return -1;\n  }\n\n  return 1;\n}\n\ninterface Filters {\n  kind: string | undefined | null;\n  // tslint:disable-next-line:no-reserved-keywords\n  type: string | undefined | null;\n}\n\n/**\n * A context menu for displaying actions. This class is designed to know how to\n * sort [[\"wed/action\".Action]] objects and\n * [[\"wed/transformation\".Transformation]] objects and how to filter them. Even\n * though the names used here suggest that ``Action`` objects are the focus of\n * this class, the fact is that it is really performing its work on\n * ``Transformation`` objects. It does accept ``Action`` as a kind of lame\n * ``Transformation``. So the following description will focus on\n * ``Transformation`` objects rather than ``Action`` objects.\n *\n * Sorting is performed first by the ``kind`` of the ``Transformation`` and then\n * by the text associated with the ``Transformation``. The kinds, in order, are:\n *\n * - other kinds than those listed below\n *\n * - undefined ``kind``\n *\n * - ``\"add\"``\n *\n * - ``\"delete\"``\n *\n * - ``\"wrap\"``\n *\n * - ``\"unwrap\"``\n *\n * The text associated with the transformation is the text value of the DOM\n * ``Element`` object stored in the ``item`` field of the object given in the\n * ``items`` array passed to the constructor. ``Actions`` are considered to have\n * an undefined ``kind``.\n *\n * Filtering is performed by ``kind`` and on the text of the **element name**\n * associated with a transformation. This class presents to the user a row of\n * buttons that represent graphically the possible filters. Clicking on a button\n * will reduce the list of displayed items only to those elements that\n * correspond to the ``kind`` to which the button corresponds.\n *\n * Typing text (e.g. \"foo\") will narrow the list of items to the text that the\n * user typed. Let's suppose that ``item`` is successively taking the values in\n * the ``items`` array. The filtering algorithm first checks whether there is an\n * ``item.data.name`` field. If there is, the match is performed against this\n * field. If not, the match is performed against the text of ``item.item``.\n *\n * If the text typed begins with a caret (^), the text will be interpreted as a\n * regular expression.\n *\n * Typing ESCAPE will reset filtering.\n *\n * When no option is focused, typing ENTER will select the first option of the\n * menu.\n */\nexport class ActionContextMenu extends Base {\n  private readonly actionItems: Item[];\n  private readonly actionFilterItem: Element;\n  private readonly actionFilterInput: HTMLInputElement;\n\n  private filters: Filters = {\n    kind: null,\n    type: null,\n  };\n\n  private actionTextFilter: string = \"\";\n\n  /**\n   * @param document The DOM document for which to make this context menu.\n   *\n   * @param x Position of the menu. The context menu may ignore this position if\n   * the menu would appear off-screen.\n   *\n   * @param y Position of the menu.\n   *\n   * @param items An array of action information in the form of anonymous\n   * objects. It is valid to have some items in the array be of the form\n   * ``{action: null, item: some_element, data: null}`` to insert arbitrary menu\n   * items.\n   *\n   * @param dismissCallback Function to call when the menu is dismissed.\n   */\n  constructor(document: Document, x: number, y: number, items: Item[],\n              dismissCallback?: DismissCallback) {\n    super(document, x, y, [], dismissCallback, false);\n\n    // Sort the items once and for all.\n    items.sort(compareItems);\n\n    this.actionItems = items;\n\n    // Create the filtering GUI...\n\n    // <li><div><button>... allows us to have this button group inserted in the\n    // menu and yet be ignored by Bootstrap's Dropdown class.\n    const li = document.createElement(\"li\");\n    li.className = \"wed-menu-filter\";\n    li.style.whiteSpace = \"nowrap\";\n    const groupGroup = document.createElement(\"div\");\n    const kindGroup = this.makeKindGroup(document);\n    const typeGroup = this.makeTypeGroup(document);\n\n    // Prevent clicks in the group from closing the context menu.\n    $(li).on(\"click\", false);\n    li.appendChild(groupGroup);\n    groupGroup.appendChild(kindGroup);\n    groupGroup.appendChild(document.createTextNode(\"\\u00a0\"));\n    groupGroup.appendChild(typeGroup);\n\n    const textInput = document.createElement(\"input\");\n    textInput.className = \"form-control input-sm\";\n    textInput.setAttribute(\"placeholder\", \"Filter choices by text.\");\n    const textDiv = document.createElement(\"div\");\n    textDiv.appendChild(textInput);\n    li.appendChild(textDiv);\n\n    const $textInput = $(textInput);\n    $textInput.on(\"input\", this.inputChangeHandler.bind(this));\n    $textInput.on(\"keydown\", this.inputKeydownHandler.bind(this));\n    this.actionFilterItem = li;\n    this.actionFilterInput = textInput;\n\n    const $menu = this.$menu;\n    $menu.parent().on(\"hidden.bs.dropdown\",\n                      () => {\n                        // Manually destroy the tooltips so that they are not\n                        // left behind.\n                        $(textInput).tooltip(\"destroy\");\n                        $(kindGroup).children().tooltip(\"destroy\");\n                      });\n    $menu.on(\"keydown\", this.actionKeydownHandler.bind(this));\n    $menu.on(\"keypress\", this.actionKeypressHandler.bind(this));\n    this.display([]);\n    textInput.focus();\n  }\n\n  private makeKindGroup(document: Document): Element {\n    const kindGroup = document.createElement(\"div\");\n    kindGroup.className = \"btn-group btn-group-xs\";\n    for (const kind of KIND_FILTERS) {\n      const child = document.createElement(\"button\");\n      child.className = \"btn btn-default\";\n      let title;\n      if (kind !== undefined) {\n        // tslint:disable-next-line:no-inner-html\n        child.innerHTML = icon.makeHTML(kind);\n        title = `Show only ${kind} operations.`;\n      }\n      else {\n        // tslint:disable-next-line:no-inner-html\n        child.innerHTML = icon.makeHTML(\"other\");\n        title = \"Show operations not covered by other filter buttons.\";\n      }\n      $(child).tooltip({\n        title: title,\n        // If we don't set it to be on the body, then the tooltip will be\n        // clipped by the dropdown. However, we then run into the problem that\n        // when the dropdown menu is removed, the tooltip may remain displayed.\n        container: \"body\",\n        placement: \"auto top\",\n        trigger: \"hover\",\n      });\n      $(child).on(\"click\", this.makeKindHandler(kind));\n      kindGroup.appendChild(child);\n    }\n\n    return kindGroup;\n  }\n\n  private makeTypeGroup(document: Document): Element {\n    const typeGroup = document.createElement(\"div\");\n    typeGroup.className = \"btn-group btn-group-xs\";\n    for (const actionType of TYPE_FILTERS) {\n      const child = document.createElement(\"button\");\n      child.className = \"btn btn-default\";\n      let title;\n      if (actionType !== undefined) {\n        // tslint:disable-next-line:no-inner-html\n        child.innerHTML = icon.makeHTML(actionType);\n        title = `Show only ${actionType} operations.`;\n      }\n      else {\n        // tslint:disable-next-line:no-inner-html\n        child.innerHTML = icon.makeHTML(\"other\");\n        title = \"Show operations not covered by other filter buttons.\";\n      }\n      $(child).tooltip({\n        title: title,\n        // If we don't set it to be on the body, then the tooltip will be\n        // clipped by the dropdown. However, we then run into the problem that\n        // when the dropdown menu is removed, the tooltip may remain displayed.\n        container: \"body\",\n        placement: \"auto top\",\n        trigger: \"hover\",\n      });\n      $(child).on(\"click\", this.makeTypeHandler(actionType));\n      typeGroup.appendChild(child);\n    }\n\n    return typeGroup;\n  }\n\n  private makeKindHandler(kind: string | undefined): () => void {\n    return () => {\n      this.filters.kind = kind;\n      this.render();\n    };\n  }\n\n  private makeTypeHandler(actionType: string | undefined): () => void {\n    return () => {\n      this.filters.type = actionType;\n      this.render();\n    };\n  }\n\n  handleToggleFocus(): void {\n    this.actionFilterInput.focus();\n  }\n\n  private actionKeydownHandler(ev: JQueryKeyEventObject): boolean {\n    if (keyConstants.ESCAPE.matchesEvent(ev) &&\n        (this.filters.kind !== null ||\n         this.filters.type !== null ||\n         this.actionTextFilter !== \"\")) {\n      this.filters.kind = null;\n      this.filters.type = null;\n      this.actionTextFilter = \"\";\n      // For some reason, on FF 24, stopping propagation and\n      // preventing the default is not enough.\n      if (!browsers.FIREFOX_24) {\n        this.actionFilterInput.value = \"\";\n        this.render();\n      }\n      else {\n        setTimeout(() => {\n          this.actionFilterInput.value = \"\";\n          this.render();\n        },\n                   0);\n      }\n      ev.stopPropagation();\n      ev.preventDefault();\n      return false;\n    }\n    return true;\n  }\n\n  private actionKeypressHandler(ev: JQueryKeyEventObject): boolean {\n    // If the user has started filtering on text, we don't interpret\n    // the key as setting a kind or type filter.\n    if (this.actionTextFilter !== \"\") {\n      return true;\n    }\n\n    for (const spec of KEY_TO_FILTER) {\n      const key = spec.key;\n      if (key.matchesEvent(ev)) {\n        const whichFilter = spec.which;\n        // Don't treat the key specially if the filter is already set.\n        if (this.filters[whichFilter] !== null) {\n          continue;\n        }\n        this.filters[whichFilter] = spec.filter;\n        this.render();\n        ev.stopPropagation();\n        ev.preventDefault();\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  private inputChangeHandler(ev: KeyboardEvent): void {\n    const previous = this.actionTextFilter;\n    const newval = (ev.target as HTMLInputElement).value;\n    // IE11 generates input events when focus is lost/gained. These\n    // events do not change anything to the contents of the field so\n    // we protect against unnecessary renders a bit of logic here.\n    if (previous !== newval) {\n      this.actionTextFilter = newval;\n      this.render();\n    }\n  }\n\n  private inputKeydownHandler(ev: KeyboardEvent): boolean {\n    if (keyConstants.ENTER.matchesEvent(ev)) {\n      this.$menu.find(ITEM_SELECTOR).first().focus().click();\n      ev.stopPropagation();\n      ev.preventDefault();\n      return false;\n    }\n\n    // Bootstrap 3.3.2 (and probably some versions before this one) introduces a\n    // change that prevents these events from being processed by the dropdown\n    // menu. We have to manually forward them. See bug report:\n    //\n    // https://github.com/twbs/bootstrap/issues/15757\n    //\n    let matches;\n    for (const check of [\"UP_ARROW\", \"DOWN_ARROW\", \"ESCAPE\"]) {\n      // tslint:disable-next-line:no-any\n      const key = (keyConstants as any)[check] as keyMod.Key;\n      if (key.matchesEvent(ev)) {\n        matches = key;\n        break;\n      }\n    }\n\n    if (matches !== undefined) {\n      const fakeEv = new $.Event(\"keydown\");\n      matches.setEventToMatch(fakeEv);\n      // We have to pass the event to ``actionKeypressHandler`` so that it can\n      // act in the same way as if the event had been directly on the menu. If\n      // ``actionKeypressHandler`` does not handle it, then pass it on to the\n      // toggle. We forward to the toggle because that's how Bootstrap normally\n      // works.\n      if (this.actionKeydownHandler(fakeEv) !== false) {\n        this.$toggle.trigger(fakeEv);\n      }\n      // We have to return `false` to make sure it is not mishandled.\n      return false;\n    }\n\n    return true;\n  }\n\n  render(): void {\n    const menu = this.menu;\n    const actionFilterItem = this.actionFilterItem;\n    const actionKindFilter = this.filters.kind;\n    const actionTypeFilter = this.filters.type;\n    // On IE 10, we don't want to remove and then add back this.actionFilterItem\n    // on each render because that makes this.actionFilterInput lose the\n    // focus. Yes, even with the call at the end of _render, IE 10 inexplicably\n    // makes the field lose focus **later**.\n    while (menu.lastChild !== null && menu.lastChild !== actionFilterItem) {\n      menu.removeChild(menu.lastChild);\n    }\n\n    let child = actionFilterItem\n          .firstElementChild!.firstElementChild!.firstElementChild!;\n    for (const kind of KIND_FILTERS) {\n      const cl = child.classList;\n      const method = (actionKindFilter === kind) ? cl.add : cl.remove;\n      method.call(cl, \"active\");\n      child = child.nextElementSibling!;\n    }\n\n    child = actionFilterItem\n      .firstElementChild!.lastElementChild!.firstElementChild!;\n    for (const actionType of TYPE_FILTERS) {\n      const cl = child.classList;\n      const method = (actionTypeFilter === actionType) ? cl.add : cl.remove;\n      method.call(cl, \"active\");\n      child = child.nextElementSibling!;\n    }\n\n    if (actionFilterItem.parentNode === null) {\n      menu.appendChild(actionFilterItem);\n    }\n    const items = this.computeActionItemsToDisplay(this.actionItems);\n    super.render(items);\n  }\n\n  private computeActionItemsToDisplay(items: Item[]): Element[] {\n    const kindFilter = this.filters.kind;\n    const typeFilter = this.filters.type;\n    const textFilter = this.actionTextFilter;\n\n    let kindMatch;\n    switch (kindFilter) {\n    case null:\n      kindMatch = () => true;\n      break;\n    case undefined:\n      kindMatch = (item: Item) => !(item.action instanceof Transformation) ||\n        KINDS.indexOf(item.action.kind) === -1;\n      break;\n    default:\n      kindMatch = (item: Item) => (item.action instanceof Transformation) &&\n        item.action.kind === kindFilter;\n    }\n\n    let typeMatch;\n    switch (typeFilter) {\n    case null:\n      typeMatch = () => true;\n      break;\n    case undefined:\n      typeMatch = (item: Item) => !(item.action instanceof Transformation) ||\n        TYPES.indexOf(item.action.nodeType) === -1;\n      break;\n    default:\n      typeMatch = (item: Item) => (item.action instanceof Transformation) &&\n        item.action.nodeType === typeFilter;\n    }\n\n    let textMatch;\n    if (textFilter !== \"\") {\n      if (textFilter[0] === \"^\") {\n        const textFilterRe = RegExp(textFilter);\n        textMatch = (item: Item) => {\n          const text = (item.data !== null && item.data.name !== undefined) ?\n            item.data.name : item.item.textContent!;\n          return textFilterRe.test(text);\n        };\n      }\n      else {\n          textMatch = (item: Item) => {\n            const text = (item.data !== null && item.data.name !== undefined) ?\n              item.data.name : item.item.textContent!;\n            return text.indexOf(textFilter) !== -1;\n          };\n      }\n    }\n    else {\n      textMatch = () => true;\n    }\n\n    const ret = [];\n    for (const item of items) {\n      if (kindMatch(item) && typeMatch(item) && textMatch(item)) {\n        ret.push(item.item);\n      }\n    }\n\n    return ret;\n  }\n}\n\n//  LocalWords:  MPL li Dropdown nowrap sm keydown tooltips keypress btn xs\n//  LocalWords:  tooltip dropdown actionType actionFilterItem actionFilterInput\n//  LocalWords:  actionKeypressHandler\n"]}