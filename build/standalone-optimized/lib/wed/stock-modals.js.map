{"version":3,"file":"stock-modals.js","sourceRoot":"","sources":["../../../../lib/wed/stock-modals.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * A collection of stock modals for an editor instance.\n * @author Louis-Dominique Dubeau\n * @license MPL 2.0\n * @copyright Mangalam Research Center for Buddhist Languages\n */\n\nimport { OSX } from \"./browsers\";\nimport * as buildInfo from \"./build-info\";\nimport { Modal } from \"./gui/modal\";\n\nexport interface ModalMaker {\n  makeModal(): Modal;\n  docURL: string;\n}\n\nexport type ModalNames = \"limitation\" | \"paste\" | \"straddling\" | \"help\" |\n  \"disconnect\" | \"editedByOther\" | \"tooOld\";\n\n/**\n * A collection of stock modals.\n */\nexport class StockModals {\n  private readonly modals: Map<string, Modal> = new Map();\n\n  constructor(private readonly maker: ModalMaker) {}\n\n  getModal(name: ModalNames): Modal {\n    let modal = this.modals.get(name);\n    if (modal === undefined) {\n      modal = this.make(name);\n      this.modals.set(name, modal);\n    }\n\n    return modal;\n  }\n\n  private make(name: ModalNames): Modal {\n    const modal = this.maker.makeModal();\n    switch (name) {\n    case \"limitation\":\n      modal.setTitle(\"Cannot proceed\");\n      break;\n    case \"paste\":\n      modal.setTitle(\"Invalid structure\");\n      modal.setBody(\"<p>The data you are trying to paste appears to be \\\nXML. However, pasting it here will result in a structurally invalid document. \\\nDo you want to paste it as text instead? (If you answer negatively, the data \\\nwon't be pasted at all.)<p>\");\n      modal.addYesNo();\n      break;\n    case \"straddling\":\n      modal.setTitle(\"Invalid modification\");\n      modal.setBody(\"<p>The text selected straddles disparate \\\nelements of the document. You may be able to achieve what you want to do by \\\nselecting smaller sections.<p>\");\n      modal.addButton(\"Ok\", true);\n      break;\n    case \"help\":\n      const docURL = this.maker.docURL;\n      // These are different on browsers running in OSX. So we later edit the\n      // list as needed.\n      const otherKeys = `\\\n  <li>Ctrl-s: Save</li>\n  <li>Ctrl-x: Cut</li>\n  <li>Ctrl-v: Paste</li>\n  <li>Ctrl-c: Copy</li>\n  <li>Ctrl-z: Undo</li>\n  <li>Ctrl-y: Redo</li>\n  <li>Ctrl-/: Bring up a contextual menu.</li>\n  <li>Ctrl-?: Bring up a replacement menu.</li>\n  <li>Ctrl-f: Quick search forward.</li>\n  <li>Ctrl-b: Quick search backwards.</li>\n  <li>Ctrl-Shift-f: Search forward.</li>\n  <li>Ctrl-Shift-b: Search backwards.</li>\n`;\n      // These combinations don't exist on OSX.\n      const visibility = `\\\n  <li>Ctrl-[: Decrease the label visibility level.</li>\n  <li>Ctrl-]: Increase the label visibility level.</li>\n`;\n      modal.setTitle(\"Help\");\n      modal.setBody(`\n<p>Click <a href='${docURL}' target='_blank'>this link</a> to see\nwed's generic help. The link by default will open in a new tab.</p>\n<ul>\n  <li>Clicking the right mouse button on the document contents brings up a\ncontextual menu.</li>\n  <li>F1: help</li>\n  ${OSX ? otherKeys.replace(/Ctrl-/g, \"Cmd-\") : visibility + otherKeys}\n</ul>\n<p class='wed-build-info'>Build descriptor: ${buildInfo.desc}<br/>\nBuild date: ${buildInfo.date}</p>`);\n      modal.addButton(\"Close\", true);\n      break;\n    case \"disconnect\":\n      modal.setTitle(\"Disconnected from server!\");\n      modal.setBody(\n        \"It appears your browser is disconnected from the server. Editing is \\\nfrozen until the connection is reestablished. Dismissing this dialog will \\\nretry saving. If the operation is successful, you'll be able to continue \\\nediting. If not, this message will reappear.\");\n      modal.addButton(\"Retry\", true);\n      break;\n    case \"editedByOther\":\n      modal.setTitle(\"Edited by another!\");\n      modal.setBody(\n      \"Your document was edited by someone else since you last loaded or \\\nsaved it. You must reload it before trying to edit further.\");\n      modal.addButton(\"Reload\", true);\n      break;\n    case \"tooOld\":\n      modal.setTitle(\"Newer version!\");\n      modal.setBody(\n      \"There is a newer version of the editor. You must reload it before \\\ntrying to edit further.\");\n      modal.addButton(\"Reload\", true);\n      break;\n    default:\n      // This will err at compilation time if we forget a case above.\n      const badName: never = name;\n      // If we do get here by mistake, we get a runtime error.\n      throw new Error(`cannot handle name ${badName}`);\n    }\n\n    return modal;\n  }\n}\n\n//  LocalWords:  MPL editedByOther tooOld href docUrl wed's Ctrl ul li runtime\n//  LocalWords:  badName Cmd OSX\n"]}