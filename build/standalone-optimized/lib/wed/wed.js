/**
 * Classes that model RNG patterns.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Validation errors.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Implements a name resolver for handling namespace changes in XML.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Class for XML Expanded Names.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Errors that can be raised during parsing of types.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Common tools for salve.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Implementations of some simple collections. This module is meant for salve's
 * internal purposes only. It may be yanked at any time. Do not use in your own
 * code.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 * @private
 */

/**
 * Classes that model datatypes used in RNG schemas.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 *
 */

/**
 * Collection of constants that model the way XML refers to various
 * characters and groups of characters. This module is essentially private to
 * salve.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Naive set implementation.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 * @private
 */

/**
 * This module contains data and utilities to work with the schema format that
 * salve uses natively.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Implementation of the builtin Relax NG datatype library.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Implementation of the XMLSchema datatypes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Pattern and walker for RNG's ``attribute`` elements.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Pattern and walker for RNG's ``choice`` elements.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Pattern and walker for RNG's ``data`` elements.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Pattern and walker for RNG's ``element`` elements.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Pattern and walker for RNG's ``group`` elements.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Pattern and walker for RNG's ``list`` elements.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Pattern for RNG's ``param`` element.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * A mock implementation of Node's util package. This module implements only
 * what is actually used in salve.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * RNG-based validator.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/*!
 * XRegExp.build 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2012-2016 MIT License
 * Inspired by Lea Verou's RegExp.create <lea.verou.me>
 */

/*!
 * XRegExp.matchRecursive 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2009-2016 MIT License
 */

/*!
 * XRegExp Unicode Base 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2008-2016 MIT License
 */

/*!
 * XRegExp Unicode Blocks 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2010-2016 MIT License
 * Unicode data by Mathias Bynens <mathiasbynens.be>
 */

/*!
 * XRegExp Unicode Categories 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2010-2016 MIT License
 * Unicode data by Mathias Bynens <mathiasbynens.be>
 */

/*!
 * XRegExp Unicode Properties 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2012-2016 MIT License
 * Unicode data by Mathias Bynens <mathiasbynens.be>
 */

/*!
 * XRegExp Unicode Scripts 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2010-2016 MIT License
 * Unicode data by Mathias Bynens <mathiasbynens.be>
 */

/*!
 * XRegExp 3.1.1
 * <xregexp.com>
 * Steven Levithan (c) 2007-2016 MIT License
 */

/**
 * A listener class.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Main module of salve-dom.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Editing actions.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Rangy, a cross-browser JavaScript range and selection library
 * https://github.com/timdown/rangy
 *
 * Copyright 2017, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3.1-dev
 * Build date: 11 October 2017
 */

/**
 * Text range module for Rangy.
 * Text-based manipulation and searching of ranges and selections.
 *
 * Features
 *
 * - Ability to move range boundaries by character or word offsets
 * - Customizable word tokenizer
 * - Ignores text nodes inside <script> or <style> elements or those hidden by CSS display and visibility properties
 * - Range findText method to search for text or regex within the page or within a range. Flags for whole words and case
 *   sensitivity
 * - Selection and range save/restore as text offsets within a node
 * - Methods to return visible text within a range or selection
 * - innerText method for elements
 *
 * References
 *
 * https://www.w3.org/Bugs/Public/show_bug.cgi?id=13145
 * http://aryeh.name/spec/innertext/innertext.html
 * http://dvcs.w3.org/hg/editing/raw-file/tip/editing.html
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * https://github.com/timdown/rangy
 *
 * Depends on Rangy core.
 *
 * Copyright 2017, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3.1-dev
 * Build date: 11 October 2017
 */

/**
  @license
                                 Apache License
                         Version 2.0, January 2004
                      http://www.apache.org/licenses/

 TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

 1. Definitions.

    "License" shall mean the terms and conditions for use, reproduction,
    and distribution as defined by Sections 1 through 9 of this document.

    "Licensor" shall mean the copyright owner or entity authorized by
    the copyright owner that is granting the License.

    "Legal Entity" shall mean the union of the acting entity and all
    other entities that control, are controlled by, or are under common
    control with that entity. For the purposes of this definition,
    "control" means (i) the power, direct or indirect, to cause the
    direction or management of such entity, whether by contract or
    otherwise, or (ii) ownership of fifty percent (50%) or more of the
    outstanding shares, or (iii) beneficial ownership of such entity.

    "You" (or "Your") shall mean an individual or Legal Entity
    exercising permissions granted by this License.

    "Source" form shall mean the preferred form for making modifications,
    including but not limited to software source code, documentation
    source, and configuration files.

    "Object" form shall mean any form resulting from mechanical
    transformation or translation of a Source form, including but
    not limited to compiled object code, generated documentation,
    and conversions to other media types.

    "Work" shall mean the work of authorship, whether in Source or
    Object form, made available under the License, as indicated by a
    copyright notice that is included in or attached to the work
    (an example is provided in the Appendix below).

    "Derivative Works" shall mean any work, whether in Source or Object
    form, that is based on (or derived from) the Work and for which the
    editorial revisions, annotations, elaborations, or other modifications
    represent, as a whole, an original work of authorship. For the purposes
    of this License, Derivative Works shall not include works that remain
    separable from, or merely link (or bind by name) to the interfaces of,
    the Work and Derivative Works thereof.

    "Contribution" shall mean any work of authorship, including
    the original version of the Work and any modifications or additions
    to that Work or Derivative Works thereof, that is intentionally
    submitted to Licensor for inclusion in the Work by the copyright owner
    or by an individual or Legal Entity authorized to submit on behalf of
    the copyright owner. For the purposes of this definition, "submitted"
    means any form of electronic, verbal, or written communication sent
    to the Licensor or its representatives, including but not limited to
    communication on electronic mailing lists, source code control systems,
    and issue tracking systems that are managed by, or on behalf of, the
    Licensor for the purpose of discussing and improving the Work, but
    excluding communication that is conspicuously marked or otherwise
    designated in writing by the copyright owner as "Not a Contribution."

    "Contributor" shall mean Licensor and any individual or Legal Entity
    on behalf of whom a Contribution has been received by Licensor and
    subsequently incorporated within the Work.

 2. Grant of Copyright License. Subject to the terms and conditions of
    this License, each Contributor hereby grants to You a perpetual,
    worldwide, non-exclusive, no-charge, royalty-free, irrevocable
    copyright license to reproduce, prepare Derivative Works of,
    publicly display, publicly perform, sublicense, and distribute the
    Work and such Derivative Works in Source or Object form.

 3. Grant of Patent License. Subject to the terms and conditions of
    this License, each Contributor hereby grants to You a perpetual,
    worldwide, non-exclusive, no-charge, royalty-free, irrevocable
    (except as stated in this section) patent license to make, have made,
    use, offer to sell, sell, import, and otherwise transfer the Work,
    where such license applies only to those patent claims licensable
    by such Contributor that are necessarily infringed by their
    Contribution(s) alone or by combination of their Contribution(s)
    with the Work to which such Contribution(s) was submitted. If You
    institute patent litigation against any entity (including a
    cross-claim or counterclaim in a lawsuit) alleging that the Work
    or a Contribution incorporated within the Work constitutes direct
    or contributory patent infringement, then any patent licenses
    granted to You under this License for that Work shall terminate
    as of the date such litigation is filed.

 4. Redistribution. You may reproduce and distribute copies of the
    Work or Derivative Works thereof in any medium, with or without
    modifications, and in Source or Object form, provided that You
    meet the following conditions:

    (a) You must give any other recipients of the Work or
        Derivative Works a copy of this License; and

    (b) You must cause any modified files to carry prominent notices
        stating that You changed the files; and

    (c) You must retain, in the Source form of any Derivative Works
        that You distribute, all copyright, patent, trademark, and
        attribution notices from the Source form of the Work,
        excluding those notices that do not pertain to any part of
        the Derivative Works; and

    (d) If the Work includes a "NOTICE" text file as part of its
        distribution, then any Derivative Works that You distribute must
        include a readable copy of the attribution notices contained
        within such NOTICE file, excluding those notices that do not
        pertain to any part of the Derivative Works, in at least one
        of the following places: within a NOTICE text file distributed
        as part of the Derivative Works; within the Source form or
        documentation, if provided along with the Derivative Works; or,
        within a display generated by the Derivative Works, if and
        wherever such third-party notices normally appear. The contents
        of the NOTICE file are for informational purposes only and
        do not modify the License. You may add Your own attribution
        notices within Derivative Works that You distribute, alongside
        or as an addendum to the NOTICE text from the Work, provided
        that such additional attribution notices cannot be construed
        as modifying the License.

    You may add Your own copyright statement to Your modifications and
    may provide additional or different license terms and conditions
    for use, reproduction, or distribution of Your modifications, or
    for any such Derivative Works as a whole, provided Your use,
    reproduction, and distribution of the Work otherwise complies with
    the conditions stated in this License.

 5. Submission of Contributions. Unless You explicitly state otherwise,
    any Contribution intentionally submitted for inclusion in the Work
    by You to the Licensor shall be under the terms and conditions of
    this License, without any additional terms or conditions.
    Notwithstanding the above, nothing herein shall supersede or modify
    the terms of any separate license agreement you may have executed
    with Licensor regarding such Contributions.

 6. Trademarks. This License does not grant permission to use the trade
    names, trademarks, service marks, or product names of the Licensor,
    except as required for reasonable and customary use in describing the
    origin of the Work and reproducing the content of the NOTICE file.

 7. Disclaimer of Warranty. Unless required by applicable law or
    agreed to in writing, Licensor provides the Work (and each
    Contributor provides its Contributions) on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
    implied, including, without limitation, any warranties or conditions
    of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
    PARTICULAR PURPOSE. You are solely responsible for determining the
    appropriateness of using or redistributing the Work and assume any
    risks associated with Your exercise of permissions under this License.

 8. Limitation of Liability. In no event and under no legal theory,
    whether in tort (including negligence), contract, or otherwise,
    unless required by applicable law (such as deliberate and grossly
    negligent acts) or agreed to in writing, shall any Contributor be
    liable to You for damages, including any direct, indirect, special,
    incidental, or consequential damages of any character arising as a
    result of this License or out of the use or inability to use the
    Work (including but not limited to damages for loss of goodwill,
    work stoppage, computer failure or malfunction, or any and all
    other commercial damages or losses), even if such Contributor
    has been advised of the possibility of such damages.

 9. Accepting Warranty or Additional Liability. While redistributing
    the Work or Derivative Works thereof, You may choose to offer,
    and charge a fee for, acceptance of support, warranty, indemnity,
    or other liability obligations and/or rights consistent with this
    License. However, in accepting such obligations, You may act only
    on Your own behalf and on Your sole responsibility, not on behalf
    of any other Contributor, and only if You agree to indemnify,
    defend, and hold each Contributor harmless for any liability
    incurred by, or claims asserted against, such Contributor by reason
    of your accepting any such warranty or additional liability.

 END OF TERMS AND CONDITIONS

 APPENDIX: How to apply the Apache License to your work.

    To apply the Apache License to your work, attach the following
    boilerplate notice, with the fields enclosed by brackets "[]"
    replaced with your own identifying information. (Don't include
    the brackets!)  The text should be enclosed in the appropriate
    comment syntax for the file format. We also recommend that a
    file or class name and description of purpose be included on the
    same "printed page" as the copyright notice for easier
    identification within third-party archives.

 Copyright 2015-2016 Netflix, Inc., Microsoft Corp. and contributors

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 **/

/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */

/**
 * Browser detection. Extremely ad hoc and meant for wed's internal purposes
 * only.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Typeguards to facilitate working with TypeScript and the DOM.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Various utilities for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Utilities that manipulate or query the DOM tree.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Model for a GUI root.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * This module implements the "caret mark". The "caret mark" is the graphical
 * indicator showing the position of the caret.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Library of caret movement computations.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Checks whether an object conforms to a template.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Listener for DOM tree changes.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Exceptions for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Conversion from XML to HTML.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Facility for updating a DOM tree and issue synchronous events on changes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Listens to changes on a tree and updates the GUI tree in response to changes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
     * The icons used by the user interface.
     * @author Louis-Dominique Dubeau
     * @license MPL 2.0
     * @copyright Mangalam Research Center for Buddhist Languages
     */

/**
 * Transformation framework.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Module implementing an class that describes keyboard keys.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Keys that wed uses, as constants.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Context menus.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Layers over the editing area.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Specialized layer for error markers.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Content scroller.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Tooltips for elements that appear in the editor pane.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Load and initialize modes.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * @license RequireJS text 2.0.12 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/**
     * The onbeforeunload handler for wed.
     * @author Louis-Dominique Dubeau
     * @license MPL 2.0
     * @copyright Mangalam Research Center for Buddhist Languages
     */

/**
 * @module onerror
 * @desc The error handler for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * An execution runtime for editors.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * An XML serializer for platforms that produce erratic results.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Base class for savers.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * A collection of stock modals for an editor instance.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Task abstraction for wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
     * Basic undo/redo framework.
     * @author Louis-Dominique Dubeau
     * @license MPL 2.0
     * @copyright Mangalam Research Center for Buddhist Languages
     */

/**
 * Listens to changes on a tree and records undo operations corresponding to
 * these changes.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Controller managing the validation logic of a wed editor.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * This module is responsible for validating the document being edited in wed.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Wed-specific undo functionality.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
     * The base types for modes.
     *
     * @author Louis-Dominique Dubeau
     * @license MPL 2.0
     * @copyright Mangalam Research Center for Buddhist Languages
     */

/**
 * Basic decoration facilities.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
     * Transformation registry for the generic mode.
     * @author Louis-Dominique Dubeau
     * @license MPL 2.0
     * @copyright Mangalam Research Center for Buddhist Languages
     */

/**
 * Reading facilities common to all readers that read specific versions.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Facilities for interpreting the patterns passed in dochtml in
 * metadata files.
 *
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * Reading facilities that allow reading different versions of a metadata file.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

/**
 * The main module for the generic mode.
 * @author Louis-Dominique Dubeau
 * @license MPL 2.0
 * @copyright Mangalam Research Center for Buddhist Languages
 */

!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("ajv",[],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Ajv=e()}(function(){return function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=r[a]={exports:{}};t[a][0].call(c.exports,function(e){var r=t[a][1][e];return i(r||e)},c,c.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,r){"use strict";var n=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"];t.exports=function(e,t){for(var r=0;r<t.length;r++){e=JSON.parse(JSON.stringify(e));var i,o=t[r].split("/"),a=e;for(i=1;i<o.length;i++)a=a[o[i]];for(i=0;i<n.length;i++){var s=n[i],l=a[s];l&&(a[s]={anyOf:[l,{$ref:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/$data.json#"}]})}}return e}},{}],2:[function(e,t,r){"use strict";var n=t.exports=function(){this._cache={}};n.prototype.put=function(e,t){this._cache[e]=t},n.prototype.get=function(e){return this._cache[e]},n.prototype.del=function(e){delete this._cache[e]},n.prototype.clear=function(){this._cache={}}},{}],3:[function(e,t,r){"use strict";t.exports={$ref:e("../dotjs/ref"),allOf:e("../dotjs/allOf"),anyOf:e("../dotjs/anyOf"),const:e("../dotjs/const"),contains:e("../dotjs/contains"),dependencies:e("../dotjs/dependencies"),enum:e("../dotjs/enum"),format:e("../dotjs/format"),items:e("../dotjs/items"),maximum:e("../dotjs/_limit"),minimum:e("../dotjs/_limit"),maxItems:e("../dotjs/_limitItems"),minItems:e("../dotjs/_limitItems"),maxLength:e("../dotjs/_limitLength"),minLength:e("../dotjs/_limitLength"),maxProperties:e("../dotjs/_limitProperties"),minProperties:e("../dotjs/_limitProperties"),multipleOf:e("../dotjs/multipleOf"),not:e("../dotjs/not"),oneOf:e("../dotjs/oneOf"),pattern:e("../dotjs/pattern"),properties:e("../dotjs/properties"),propertyNames:e("../dotjs/propertyNames"),required:e("../dotjs/required"),uniqueItems:e("../dotjs/uniqueItems"),validate:e("../dotjs/validate")}},{"../dotjs/_limit":14,"../dotjs/_limitItems":15,"../dotjs/_limitLength":16,"../dotjs/_limitProperties":17,"../dotjs/allOf":18,"../dotjs/anyOf":19,"../dotjs/const":20,"../dotjs/contains":21,"../dotjs/dependencies":23,"../dotjs/enum":24,"../dotjs/format":25,"../dotjs/items":26,"../dotjs/multipleOf":27,"../dotjs/not":28,"../dotjs/oneOf":29,"../dotjs/pattern":30,"../dotjs/properties":31,"../dotjs/propertyNames":32,"../dotjs/ref":33,"../dotjs/required":34,"../dotjs/uniqueItems":35,"../dotjs/validate":36}],4:[function(e,t,r){"use strict";function n(e,t,r){function o(e){var t=e.$schema;return t&&!s.getSchema(t)?n.call(s,{$ref:t},!0):Promise.resolve()}function a(e){try{return s._compile(e)}catch(r){if(r instanceof i)return function(r){function n(){delete s._loadingSchemas[l]}function i(e){return s._refs[e]||s._schemas[e]}var l=r.missingSchema;if(i(l))throw new Error("Schema "+l+" is loaded but "+r.missingRef+" cannot be resolved");var u=s._loadingSchemas[l];return u||(u=s._loadingSchemas[l]=s._opts.loadSchema(l)).then(n,n),u.then(function(e){if(!i(l))return o(e).then(function(){i(l)||s.addSchema(e,l,void 0,t)})}).then(function(){return a(e)})}(r);throw r}}var s=this;if("function"!=typeof this._opts.loadSchema)throw new Error("options.loadSchema should be a function");"function"==typeof t&&(r=t,t=void 0);var l=o(e).then(function(){var r=s._addSchema(e,void 0,t);return r.validate||a(r)});return r&&l.then(function(e){r(null,e)},r),l}var i=e("./error_classes").MissingRef;t.exports=n},{"./error_classes":6}],5:[function(e,t,r){"use strict";t.exports=function e(t,r){if(t===r)return!0;var n,i=Array.isArray(t),o=Array.isArray(r);if(i&&o){if(t.length!=r.length)return!1;for(n=0;n<t.length;n++)if(!e(t[n],r[n]))return!1;return!0}if(i!=o)return!1;if(t&&r&&"object"==typeof t&&"object"==typeof r){var a=Object.keys(t);if(a.length!==Object.keys(r).length)return!1;var s=t instanceof Date,l=r instanceof Date;if(s&&l)return t.getTime()==r.getTime();if(s!=l)return!1;var u=t instanceof RegExp,c=r instanceof RegExp;if(u&&c)return t.toString()==r.toString();if(u!=c)return!1;for(n=0;n<a.length;n++)if(!Object.prototype.hasOwnProperty.call(r,a[n]))return!1;for(n=0;n<a.length;n++)if(!e(t[a[n]],r[a[n]]))return!1;return!0}return!1}},{}],6:[function(e,t,r){"use strict";function n(e){this.message="validation failed",this.errors=e,this.ajv=this.validation=!0}function i(e,t,r){this.message=r||i.message(e,t),this.missingRef=a.url(e,t),this.missingSchema=a.normalizeId(a.fullPath(this.missingRef))}function o(e){return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var a=e("./resolve");t.exports={Validation:o(n),MissingRef:o(i)},i.message=function(e,t){return"can't resolve reference "+t+" from id "+e}},{"./resolve":9}],7:[function(e,t,r){"use strict";function n(e){return e="full"==e?"full":"fast",c.copy(n[e])}function i(e){var t=e.match(h);if(!t)return!1;var r=+t[1],n=+t[2];return r>=1&&r<=12&&n>=1&&n<=d[r]}function o(e,t){var r=e.match(p);if(!r)return!1;var n=r[1],i=r[2],o=r[3],a=r[5];return n<=23&&i<=59&&o<=59&&(!t||a)}function a(e){var t=e.split(E);return 2==t.length&&i(t[0])&&o(t[1],!0)}function s(e){return e.length<=255&&f.test(e)}function l(e){return x.test(e)&&m.test(e)}function u(e){if(S.test(e))return!1;try{return new RegExp(e),!0}catch(e){return!1}}var c=e("./util"),h=/^\d\d\d\d-(\d\d)-(\d\d)$/,d=[0,31,29,31,30,31,30,31,31,30,31,30,31],p=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d:\d\d)?$/i,f=/^[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*$/i,m=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9a-f]{2})*)?(?:\#(?:[a-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9a-f]{2})*)?$/i,v=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@\/?]|%[0-9a-f]{2})*)?(?:\#(?:[a-z0-9\-._~!$&'"()*+,;=:@\/?]|%[0-9a-f]{2})*)?$/i,y=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#.\/;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?:\:[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?:\:[1-9][0-9]{0,3}|\*)?)*\})*$/i,g=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+\-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+\-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,b=/^(?:urn\:uuid\:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,w=/^(?:\/(?:[^~\/]|~0|~1)*)*$|^\#(?:\/(?:[a-z0-9_\-\.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,_=/^(?:0|[1-9][0-9]*)(?:\#|(?:\/(?:[^~\/]|~0|~1)*)*)$/;t.exports=n,n.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^[0-2]\d:[0-5]\d:[0-5]\d(?:\.\d+)?(?:z|[+-]\d\d:\d\d)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s][0-2]\d:[0-5]\d:[0-5]\d(?:\.\d+)?(?:z|[+-]\d\d:\d\d)$/i,uri:/^(?:[a-z][a-z0-9+-.]*)(?:\:|\/)\/?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+-.]*:)?\/\/)?[^\s]*$/i,"uri-template":y,url:g,email:/^[a-z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:f,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:u,uuid:b,"json-pointer":w,"relative-json-pointer":_},n.full={date:i,time:o,"date-time":a,uri:l,"uri-reference":v,"uri-template":y,url:g,email:/^[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&''*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:s,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:u,uuid:b,"json-pointer":w,"relative-json-pointer":_};var E=/t|\s/i,x=/\/|\:/,S=/[^\\]\\Z/},{"./util":13}],8:[function(e,t,r){"use strict";function n(e,t,r,a){function _(){var e=V.validate,t=e.apply(null,arguments);return _.errors=e.errors,t}function E(e,r,i,o){var a=!r||r&&r.schema==e;if(r.schema!=t.schema)return n.call(A,e,r,i,o);var m=!0===e.$async,_=v({isTop:!0,schema:e,isRoot:a,baseId:o,root:r,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:f.MissingRef,RULES:W,validate:v,util:p,resolve:d,resolveRef:x,usePattern:T,useDefault:P,useCustomRule:k,opts:R,formats:H,self:A});_=h(O,u)+h(D,s)+h(L,l)+h(F,c)+_,R.processCode&&(_=R.processCode(_));var E;try{E=new Function("self","RULES","formats","root","refVal","defaults","customRules","co","equal","ucs2length","ValidationError",_)(A,W,H,t,O,L,F,y,b,g,w),O[0]=E}catch(e){throw console.error("Error compiling schema, function code:",_),e}return E.schema=e,E.errors=null,E.refs=I,E.refVal=O,E.root=a?E:r,m&&(E.$async=!0),!0===R.sourceCode&&(E.source={code:_,patterns:D,defaults:L}),E}function x(e,i,o){i=d.url(e,i);var a,s,l=I[i];if(void 0!==l)return a=O[l],s="refVal["+l+"]",C(a,s);if(!o&&t.refs){var u=t.refs[i];if(void 0!==u)return a=t.refVal[u],s=S(i,a),C(a,s)}s=S(i);var c=d.call(A,E,t,i);if(void 0===c){var h=r&&r[i];h&&(c=d.inlineRef(h,R.inlineRefs)?h:n.call(A,h,t,r,e))}return void 0!==c?(N(i,c),C(c,s)):void 0}function S(e,t){var r=O.length;return O[r]=t,I[e]=r,"refVal"+r}function N(e,t){O[I[e]]=t}function C(e,t){return"object"==typeof e||"boolean"==typeof e?{code:t,schema:e,inline:!0}:{code:t,$async:e&&e.$async}}function T(e){var t=M[e];return void 0===t&&(t=M[e]=D.length,D[t]=e),"pattern"+t}function P(e){switch(typeof e){case"boolean":case"number":return""+e;case"string":return p.toQuotedString(e);case"object":if(null===e)return"null";var t=m(e),r=j[t];return void 0===r&&(r=j[t]=L.length,L[r]=e),"default"+r}}function k(e,t,r,n){var i=e.definition.validateSchema;if(i&&!1!==A._opts.validateSchema&&!i(t)){var o="keyword schema is invalid: "+A.errorsText(i.errors);if("log"!=A._opts.validateSchema)throw new Error(o);console.error(o)}var a,s=e.definition.compile,l=e.definition.inline,u=e.definition.macro;if(s)a=s.call(A,t,r,n);else if(u)a=u.call(A,t,r,n),!1!==R.validateSchema&&A.validateSchema(a,!0);else if(l)a=l.call(A,n,e.keyword,t,r);else if(!(a=e.definition.validate))return;if(void 0===a)throw new Error('custom keyword "'+e.keyword+'"failed to compile');var c=F.length;return F[c]=a,{code:"customRule"+c,validate:a}}var A=this,R=this._opts,O=[void 0],I={},D=[],M={},L=[],j={},F=[];t=t||{schema:e,refVal:O,refs:I};var B=i.call(this,e,t,a),V=this._compilations[B.index];if(B.compiling)return V.callValidate=_;var H=this._formats,W=this.RULES;try{var $=E(e,t,r,a);V.validate=$;var U=V.callValidate;return U&&(U.schema=$.schema,U.errors=null,U.refs=$.refs,U.refVal=$.refVal,U.root=$.root,U.$async=$.$async,R.sourceCode&&(U.source=$.source)),$}finally{o.call(this,e,t,a)}}function i(e,t,r){var n=a.call(this,e,t,r);return n>=0?{index:n,compiling:!0}:(n=this._compilations.length,this._compilations[n]={schema:e,root:t,baseId:r},{index:n,compiling:!1})}function o(e,t,r){var n=a.call(this,e,t,r);n>=0&&this._compilations.splice(n,1)}function a(e,t,r){for(var n=0;n<this._compilations.length;n++){var i=this._compilations[n];if(i.schema==e&&i.root==t&&i.baseId==r)return n}return-1}function s(e,t){return"var pattern"+e+" = new RegExp("+p.toQuotedString(t[e])+");"}function l(e){return"var default"+e+" = defaults["+e+"];"}function u(e,t){return void 0===t[e]?"":"var refVal"+e+" = refVal["+e+"];"}function c(e){return"var customRule"+e+" = customRules["+e+"];"}function h(e,t){if(!e.length)return"";for(var r="",n=0;n<e.length;n++)r+=t(n,e);return r}var d=e("./resolve"),p=e("./util"),f=e("./error_classes"),m=e("json-stable-stringify"),v=e("../dotjs/validate"),y=e("co"),g=p.ucs2length,b=e("./equal"),w=f.Validation;t.exports=n},{"../dotjs/validate":36,"./equal":5,"./error_classes":6,"./resolve":9,"./util":13,co:47,"json-stable-stringify":48}],9:[function(e,t,r){"use strict";function n(e,t,r){var o=this._refs[r];if("string"==typeof o){if(!this._refs[o])return n.call(this,e,t,o);o=this._refs[o]}if((o=o||this._schemas[r])instanceof g)return s(o.schema,this._opts.inlineRefs)?o.schema:o.validate||this._compile(o);var a,l,u,c=i.call(this,t,r);return c&&(a=c.schema,t=c.root,u=c.baseId),a instanceof g?l=a.validate||e.call(this,a.schema,t,void 0,u):void 0!==a&&(l=s(a,this._opts.inlineRefs)?a:e.call(this,a,t,void 0,u)),l}function i(e,t){var r=m.parse(t,!1,!0),n=h(r),i=c(this._getId(e.schema));if(n!==i){var s=d(n),l=this._refs[s];if("string"==typeof l)return o.call(this,e,l,r);if(l instanceof g)l.validate||this._compile(l),e=l;else{if(!((l=this._schemas[s])instanceof g))return;if(l.validate||this._compile(l),s==d(t))return{schema:l,root:e,baseId:i};e=l}if(!e.schema)return;i=c(this._getId(e.schema))}return a.call(this,r,i,e.schema,e)}function o(e,t,r){var n=i.call(this,e,t);if(n){var o=n.schema,s=n.baseId;e=n.root;var l=this._getId(o);return l&&(s=p(s,l)),a.call(this,r,s,o,e)}}function a(e,t,r,n){if("#/"==(e.hash=e.hash||"").slice(0,2)){for(var o=e.hash.split("/"),a=1;a<o.length;a++){var s=o[a];if(s){if(s=y.unescapeFragment(s),void 0===(r=r[s]))break;var l;if(!b[s]&&((l=this._getId(r))&&(t=p(t,l)),r.$ref)){var u=p(t,r.$ref),c=i.call(this,n,u);c&&(r=c.schema,n=c.root,t=c.baseId)}}}return void 0!==r&&r!==n.schema?{schema:r,root:n,baseId:t}:void 0}}function s(e,t){return!1!==t&&(void 0===t||!0===t?l(e):t?u(e)<=t:void 0)}function l(e){var t;if(Array.isArray(e)){for(var r=0;r<e.length;r++)if("object"==typeof(t=e[r])&&!l(t))return!1}else for(var n in e){if("$ref"==n)return!1;if("object"==typeof(t=e[n])&&!l(t))return!1}return!0}function u(e){var t,r=0;if(Array.isArray(e)){for(var n=0;n<e.length;n++)if("object"==typeof(t=e[n])&&(r+=u(t)),r==1/0)return 1/0}else for(var i in e){if("$ref"==i)return 1/0;if(w[i])r++;else if("object"==typeof(t=e[i])&&(r+=u(t)+1),r==1/0)return 1/0}return r}function c(e,t){return!1!==t&&(e=d(e)),h(m.parse(e,!1,!0))}function h(e){var t=e.protocol||"//"==e.href.slice(0,2)?"//":"";return(e.protocol||"")+t+(e.host||"")+(e.path||"")+"#"}function d(e){return e?e.replace(_,""):""}function p(e,t){return t=d(t),m.resolve(e,t)}function f(e){function t(e,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)t.call(this,e[o],r+"/"+o,i);else if(e&&"object"==typeof e){var a=this._getId(e);if("string"==typeof a){a=i=d(i?m.resolve(i,a):a);var s=this._refs[a];if("string"==typeof s&&(s=this._refs[s]),s&&s.schema){if(!v(e,s.schema))throw new Error('id "'+a+'" resolves to more than one schema')}else if(a!=d(r))if("#"==a[0]){if(n[a]&&!v(e,n[a]))throw new Error('id "'+a+'" resolves to more than one schema');n[a]=e}else this._refs[a]=r}for(var l in e)t.call(this,e[l],r+"/"+y.escapeFragment(l),i)}}var r=d(this._getId(e)),n={};return t.call(this,e,c(r,!1),r),n}var m=e("url"),v=e("./equal"),y=e("./util"),g=e("./schema_obj");t.exports=n,n.normalizeId=d,n.fullPath=c,n.url=p,n.ids=f,n.inlineRef=s,n.schema=i;var b=y.toHash(["properties","patternProperties","enum","dependencies","definitions"]),w=y.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]),_=/#\/?$/},{"./equal":5,"./schema_obj":11,"./util":13,url:45}],10:[function(e,t,r){"use strict";var n=e("./_rules"),i=e("./util").toHash;t.exports=function(){var e=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","uniqueItems","contains","items"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf"]}],t=["type"],r=["additionalItems","$schema","id","title","description","default","definitions"],o=["number","integer","string","array","object","boolean","null"];return e.all=i(t),e.types=i(o),e.forEach(function(r){r.rules=r.rules.map(function(r){var i;if("object"==typeof r){var o=Object.keys(r)[0];i=r[o],r=o,i.forEach(function(r){t.push(r),e.all[r]=!0})}return t.push(r),e.all[r]={keyword:r,code:n[r],implements:i}}),r.type&&(e.types[r.type]=r)}),e.keywords=i(t.concat(r)),e.custom={},e}},{"./_rules":3,"./util":13}],11:[function(e,t,r){"use strict";function n(e){i.copy(e,this)}var i=e("./util");t.exports=n},{"./util":13}],12:[function(e,t,r){"use strict";t.exports=function(e){for(var t,r=0,n=e.length,i=0;i<n;)r++,(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<n&&56320==(64512&(t=e.charCodeAt(i)))&&i++;return r}},{}],13:[function(e,t,r){"use strict";function n(e,t){t=t||{};for(var r in e)t[r]=e[r];return t}function i(e,t,r){var n=r?" !== ":" === ",i=r?" || ":" && ",o=r?"!":"",a=r?"":"!";switch(e){case"null":return t+n+"null";case"array":return o+"Array.isArray("+t+")";case"object":return"("+o+t+i+"typeof "+t+n+'"object"'+i+a+"Array.isArray("+t+"))";case"integer":return"(typeof "+t+n+'"number"'+i+a+"("+t+" % 1)"+i+t+n+t+")";default:return"typeof "+t+n+'"'+e+'"'}}function o(e,t){switch(e.length){case 1:return i(e[0],t,!0);default:var r="",n=s(e);n.array&&n.object&&(r=n.null?"(":"(!"+t+" || ",r+="typeof "+t+' !== "object")',delete n.null,delete n.array,delete n.object),n.number&&delete n.integer;for(var o in n)r+=(r?" && ":"")+i(o,t,!0);return r}}function a(e,t){if(Array.isArray(t)){for(var r=[],n=0;n<t.length;n++){var i=t[n];N[i]?r[r.length]=i:"array"===e&&"array"===i&&(r[r.length]=i)}if(r.length)return r}else{if(N[t])return[t];if("array"===e&&"array"===t)return["array"]}}function s(e){for(var t={},r=0;r<e.length;r++)t[e[r]]=!0;return t}function l(e){return"number"==typeof e?"["+e+"]":C.test(e)?"."+e:"['"+u(e)+"']"}function u(e){return e.replace(T,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}function c(e,t){t+="[^0-9]";var r=e.match(new RegExp(t,"g"));return r?r.length:0}function h(e,t,r){return t+="([^0-9])",r=r.replace(/\$/g,"$$$$"),e.replace(new RegExp(t,"g"),r+"$1")}function d(e){return e.replace(P,"").replace(k,"").replace(A,"if (!($1))")}function p(e,t){var r=e.match(R);return r&&2==r.length&&(e=t?e.replace(I,"").replace(L,j):e.replace(O,"").replace(D,M)),r=e.match(F),r&&3===r.length?e.replace(B,""):e}function f(e,t){if("boolean"==typeof e)return!e;for(var r in e)if(t[r])return!0}function m(e,t,r){if("boolean"==typeof e)return!e&&"not"!=r;for(var n in e)if(n!=r&&t[n])return!0}function v(e){return"'"+u(e)+"'"}function y(e,t,r,n){return w(e,r?"'/' + "+t+(n?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):n?"'[' + "+t+" + ']'":"'[\\'' + "+t+" + '\\']'")}function g(e,t,r){return w(e,v(r?"/"+x(t):l(t)))}function b(e,t,r){var n,i,o,a;if(""===e)return"rootData";if("/"==e[0]){if(!V.test(e))throw new Error("Invalid JSON-pointer: "+e);i=e,o="rootData"}else{if(!(a=e.match(H)))throw new Error("Invalid JSON-pointer: "+e);if(n=+a[1],"#"==(i=a[2])){if(n>=t)throw new Error("Cannot access property/index "+n+" levels up, current level is "+t);return r[t-n]}if(n>t)throw new Error("Cannot access data "+n+" levels up, current level is "+t);if(o="data"+(t-n||""),!i)return o}for(var s=o,u=i.split("/"),c=0;c<u.length;c++){var h=u[c];h&&(s+=" && "+(o+=l(S(h))))}return s}function w(e,t){return'""'==e?t:(e+" + "+t).replace(/' \+ '/g,"")}function _(e){return S(decodeURIComponent(e))}function E(e){return encodeURIComponent(x(e))}function x(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}function S(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}t.exports={copy:n,checkDataType:i,checkDataTypes:o,coerceToTypes:a,toHash:s,getProperty:l,escapeQuotes:u,equal:e("./equal"),ucs2length:e("./ucs2length"),varOccurences:c,varReplace:h,cleanUpCode:d,finalCleanUpCode:p,schemaHasRules:f,schemaHasRulesExcept:m,toQuotedString:v,getPathExpr:y,getPath:g,getData:b,unescapeFragment:_,escapeFragment:E,escapeJsonPointer:x};var N=s(["string","number","integer","boolean","null"]),C=/^[a-z$_][a-z$_0-9]*$/i,T=/'|\\/g,P=/else\s*{\s*}/g,k=/if\s*\([^)]+\)\s*\{\s*\}(?!\s*else)/g,A=/if\s*\(([^)]+)\)\s*\{\s*\}\s*else(?!\s*if)/g,R=/[^v\.]errors/g,O=/var errors = 0;|var vErrors = null;|validate.errors = vErrors;/g,I=/var errors = 0;|var vErrors = null;/g,D="return errors === 0;",M="validate.errors = null; return true;",L=/if \(errors === 0\) return data;\s*else throw new ValidationError\(vErrors\);/,j="return data;",F=/[^A-Za-z_$]rootData[^A-Za-z0-9_$]/g,B=/if \(rootData === undefined\) rootData = data;/,V=/^\/(?:[^~]|~0|~1)*$/,H=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/},{"./equal":5,"./ucs2length":12}],14:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,i=" ",o=e.level,a=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(a||""),d=e.opts.$data&&s&&s.$data;d?(i+=" var schema"+o+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+o):n=s;var p="maximum"==t,f=p?"exclusiveMaximum":"exclusiveMinimum",m=e.schema[f],v=e.opts.$data&&m&&m.$data,y=p?"<":">",g=p?">":"<",b=void 0;if(v){var w=e.util.getData(m.$data,a,e.dataPathArr),_="exclusive"+o,E="exclType"+o,x="exclIsNumber"+o,S="' + "+(N="op"+o)+" + '";i+=" var schemaExcl"+o+" = "+w+"; ",i+=" var "+_+"; var "+E+" = typeof "+(w="schemaExcl"+o)+"; if ("+E+" != 'boolean' && "+E+" != 'undefined' && "+E+" != 'number') { ",b=f,(C=C||[]).push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(b||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",!1!==e.opts.messages&&(i+=" , message: '"+f+" should be boolean' "),e.opts.verbose&&(i+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ",T=i,i=C.pop(),i+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+T+"]); ":" validate.errors = ["+T+"]; return false; ":" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else if ( ",d&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),i+=" "+E+" == 'number' ? ( ("+_+" = "+n+" === undefined || "+w+" "+y+"= "+n+") ? "+h+" "+g+"= "+w+" : "+h+" "+g+" "+n+" ) : ( ("+_+" = "+w+" === true) ? "+h+" "+g+"= "+n+" : "+h+" "+g+" "+n+" ) || "+h+" !== "+h+") { var op"+o+" = "+_+" ? '"+y+"' : '"+y+"=';"}else if(S=y,(x="number"==typeof m)&&d)N="'"+S+"'",i+=" if ( ",d&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),i+=" ( "+n+" === undefined || "+m+" "+y+"= "+n+" ? "+h+" "+g+"= "+m+" : "+h+" "+g+" "+n+" ) || "+h+" !== "+h+") { ";else{x&&void 0===s?(_=!0,b=f,u=e.errSchemaPath+"/"+f,n=m,g+="="):(x&&(n=Math[p?"min":"max"](m,s)),m===(!x||n)?(_=!0,b=f,u=e.errSchemaPath+"/"+f,g+="="):(_=!1,S+="="));var N="'"+S+"'";i+=" if ( ",d&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),i+=" "+h+" "+g+" "+n+" || "+h+" !== "+h+") { "}b=b||t;var C=C||[];C.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(b||"_limit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { comparison: "+N+", limit: "+n+", exclusive: "+_+" } ",!1!==e.opts.messages&&(i+=" , message: 'should be "+S+" ",i+=d?"' + "+n:n+"'"),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+l:""+s,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var T=i;return i=C.pop(),i+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+T+"]); ":" validate.errors = ["+T+"]; return false; ":" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",c&&(i+=" else { "),i}},{}],15:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,i=" ",o=e.level,a=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(a||""),d=e.opts.$data&&s&&s.$data;d?(i+=" var schema"+o+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+o):n=s;var p="maxItems"==t?">":"<";i+="if ( ",d&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),i+=" "+h+".length "+p+" "+n+") { ";var f=t,m=m||[];m.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(f||"_limitItems")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+n+" } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT have ",i+="maxItems"==t?"more":"less",i+=" than ",i+=d?"' + "+n+" + '":""+s,i+=" items' "),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+l:""+s,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var v=i;return i=m.pop(),i+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+v+"]); ":" validate.errors = ["+v+"]; return false; ":" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",c&&(i+=" else { "),i}},{}],16:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,i=" ",o=e.level,a=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(a||""),d=e.opts.$data&&s&&s.$data;d?(i+=" var schema"+o+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+o):n=s;var p="maxLength"==t?">":"<";i+="if ( ",d&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),i+=!1===e.opts.unicode?" "+h+".length ":" ucs2length("+h+") ",i+=" "+p+" "+n+") { ";var f=t,m=m||[];m.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(f||"_limitLength")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+n+" } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT be ",i+="maxLength"==t?"longer":"shorter",i+=" than ",i+=d?"' + "+n+" + '":""+s,i+=" characters' "),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+l:""+s,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var v=i;return i=m.pop(),i+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+v+"]); ":" validate.errors = ["+v+"]; return false; ":" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",
i+="} ",c&&(i+=" else { "),i}},{}],17:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,i=" ",o=e.level,a=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(a||""),d=e.opts.$data&&s&&s.$data;d?(i+=" var schema"+o+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+o):n=s;var p="maxProperties"==t?">":"<";i+="if ( ",d&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'number') || "),i+=" Object.keys("+h+").length "+p+" "+n+") { ";var f=t,m=m||[];m.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(f||"_limitProperties")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+n+" } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT have ",i+="maxProperties"==t?"more":"less",i+=" than ",i+=d?"' + "+n+" + '":""+s,i+=" properties' "),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+l:""+s,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var v=i;return i=m.pop(),i+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+v+"]); ":" validate.errors = ["+v+"]; return false; ":" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",c&&(i+=" else { "),i}},{}],18:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.schema[t],o=e.schemaPath+e.util.getProperty(t),a=e.errSchemaPath+"/"+t,s=!e.opts.allErrors,l=e.util.copy(e),u="",c="valid"+ ++l.level,h=l.baseId,d=!0,p=i;if(p)for(var f,m=-1,v=p.length-1;m<v;)f=p[m+=1],e.util.schemaHasRules(f,e.RULES.all)&&(d=!1,l.schema=f,l.schemaPath=o+"["+m+"]",l.errSchemaPath=a+"/"+m,n+="  "+e.validate(l)+" ",l.baseId=h,s&&(n+=" if ("+c+") { ",u+="}"));return s&&(n+=d?" if (true) { ":" "+u.slice(0,-1)+" "),n=e.util.cleanUpCode(n)}},{}],19:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d="errs__"+i,p=e.util.copy(e),f="",m="valid"+ ++p.level;if(a.every(function(t){return e.util.schemaHasRules(t,e.RULES.all)})){var v=p.baseId;n+=" var "+d+" = errors; var "+h+" = false;  ";var y=e.compositeRule;e.compositeRule=p.compositeRule=!0;var g=a;if(g)for(var b,w=-1,_=g.length-1;w<_;)b=g[w+=1],p.schema=b,p.schemaPath=s+"["+w+"]",p.errSchemaPath=l+"/"+w,n+="  "+e.validate(p)+" ",p.baseId=v,n+=" "+h+" = "+h+" || "+m+"; if (!"+h+") { ",f+="}";e.compositeRule=p.compositeRule=y,n+=" "+f+" if (!"+h+") {   var err =   ",!1!==e.createErrors?(n+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should match some schema in anyOf' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(n+=e.async?" throw new ValidationError(vErrors); ":" validate.errors = vErrors; return false; "),n+=" } else {  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; } ",e.opts.allErrors&&(n+=" } "),n=e.util.cleanUpCode(n)}else u&&(n+=" if (true) { ");return n}},{}],20:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d=e.opts.$data&&a&&a.$data;d&&(n+=" var schema"+i+" = "+e.util.getData(a.$data,o,e.dataPathArr)+"; "),d||(n+=" var schema"+i+" = validate.schema"+s+";"),n+="var "+h+" = equal("+c+", schema"+i+"); if (!"+h+") {   ";var p=p||[];p.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'const' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should be equal to constant' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var f=n;return n=p.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+f+"]); ":" validate.errors = ["+f+"]; return false; ":" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" }",u&&(n+=" else { "),n}},{}],21:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d="errs__"+i,p=e.util.copy(e),f="valid"+ ++p.level,m="i"+i,v=p.dataLevel=e.dataLevel+1,y="data"+v,g=e.baseId,b=e.util.schemaHasRules(a,e.RULES.all);if(n+="var "+d+" = errors;var "+h+";",b){var w=e.compositeRule;e.compositeRule=p.compositeRule=!0,p.schema=a,p.schemaPath=s,p.errSchemaPath=l,n+=" var "+f+" = false; for (var "+m+" = 0; "+m+" < "+c+".length; "+m+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers,!0);var _=c+"["+m+"]";p.dataPathArr[v]=m;var E=e.validate(p);p.baseId=g,n+=e.util.varOccurences(E,y)<2?" "+e.util.varReplace(E,y,_)+" ":" var "+y+" = "+_+"; "+E+" ",n+=" if ("+f+") break; }  ",e.compositeRule=p.compositeRule=w,n+="  if (!"+f+") {"}else n+=" if ("+c+".length == 0) {";var x=x||[];x.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should contain a valid item' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var S=n;return n=x.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+S+"]); ":" validate.errors = ["+S+"]; return false; ":" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else { ",b&&(n+="  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; } "),e.opts.allErrors&&(n+=" } "),n=e.util.cleanUpCode(n)}},{}],22:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,i,o=" ",a=e.level,s=e.dataLevel,l=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,h=!e.opts.allErrors,d="data"+(s||""),p="valid"+a,f="errs__"+a,m=e.opts.$data&&l&&l.$data;m?(o+=" var schema"+a+" = "+e.util.getData(l.$data,s,e.dataPathArr)+"; ",i="schema"+a):i=l;var v,y,g,b,w,_=this,E="definition"+a,x=_.definition,S="";if(m&&x.$data){w="keywordValidate"+a;var N=x.validateSchema;o+=" var "+E+" = RULES.custom['"+t+"'].definition; var "+w+" = "+E+".validate;"}else{if(!(b=e.useCustomRule(_,l,e.schema,e)))return;i="validate.schema"+u,w=b.code,v=x.compile,y=x.inline,g=x.macro}var C=w+".errors",T="i"+a,P="ruleErr"+a,k=x.async;if(k&&!e.async)throw new Error("async keyword in sync schema");if(y||g||(o+=C+" = null;"),o+="var "+f+" = errors;var "+p+";",m&&x.$data&&(S+="}",o+=" if ("+i+" === undefined) { "+p+" = true; } else { ",N&&(S+="}",o+=" "+p+" = "+E+".validateSchema("+i+"); if ("+p+") { ")),y)o+=x.statements?" "+b.validate+" ":" "+p+" = "+b.validate+"; ";else if(g){var A=e.util.copy(e),S="",R="valid"+ ++A.level;A.schema=b.validate,A.schemaPath="";var O=e.compositeRule;e.compositeRule=A.compositeRule=!0;var I=e.validate(A).replace(/validate\.schema/g,w);e.compositeRule=A.compositeRule=O,o+=" "+I}else{(j=j||[]).push(o),o="",o+="  "+w+".call( ",o+=e.opts.passContext?"this":"self",o+=v||!1===x.schema?" , "+d+" ":" , "+i+" , "+d+" , validate.schema"+e.schemaPath+" ",o+=" , (dataPath || '')",'""'!=e.errorPath&&(o+=" + "+e.errorPath);var D=s?"data"+(s-1||""):"parentData",M=s?e.dataPathArr[s]:"parentDataProperty",L=o+=" , "+D+" , "+M+" , rootData )  ";o=j.pop(),!1===x.errors?(o+=" "+p+" = ",k&&(o+=""+e.yieldAwait),o+=L+"; "):o+=k?" var "+(C="customErrors"+a)+" = null; try { "+p+" = "+e.yieldAwait+L+"; } catch (e) { "+p+" = false; if (e instanceof ValidationError) "+C+" = e.errors; else throw e; } ":" "+C+" = null; "+p+" = "+L+"; "}if(x.modifying&&(o+=" if ("+D+") "+d+" = "+D+"["+M+"];"),o+=""+S,x.valid)h&&(o+=" if (true) { ");else{o+=" if ( ",void 0===x.valid?(o+=" !",o+=g?""+R:""+p):o+=" "+!x.valid+" ",o+=") { ",n=_.keyword;var j=j||[];j.push(o),o="",(j=j||[]).push(o),o="",!1!==e.createErrors?(o+=" { keyword: '"+(n||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { keyword: '"+_.keyword+"' } ",!1!==e.opts.messages&&(o+=" , message: 'should pass \""+_.keyword+"\" keyword validation' "),e.opts.verbose&&(o+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),o+=" } "):o+=" {} ";var F=o;o=j.pop();var B=o+=!e.compositeRule&&h?e.async?" throw new ValidationError(["+F+"]); ":" validate.errors = ["+F+"]; return false; ":" var err = "+F+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";o=j.pop(),y?x.errors?"full"!=x.errors&&(o+="  for (var "+T+"="+f+"; "+T+"<errors; "+T+"++) { var "+P+" = vErrors["+T+"]; if ("+P+".dataPath === undefined) "+P+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+P+".schemaPath === undefined) { "+P+'.schemaPath = "'+c+'"; } ',e.opts.verbose&&(o+=" "+P+".schema = "+i+"; "+P+".data = "+d+"; "),o+=" } "):!1===x.errors?o+=" "+B+" ":(o+=" if ("+f+" == errors) { "+B+" } else {  for (var "+T+"="+f+"; "+T+"<errors; "+T+"++) { var "+P+" = vErrors["+T+"]; if ("+P+".dataPath === undefined) "+P+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+P+".schemaPath === undefined) { "+P+'.schemaPath = "'+c+'"; } ',e.opts.verbose&&(o+=" "+P+".schema = "+i+"; "+P+".data = "+d+"; "),o+=" } } "):g?(o+="   var err =   ",!1!==e.createErrors?(o+=" { keyword: '"+(n||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { keyword: '"+_.keyword+"' } ",!1!==e.opts.messages&&(o+=" , message: 'should pass \""+_.keyword+"\" keyword validation' "),e.opts.verbose&&(o+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),o+=" } "):o+=" {} ",o+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&h&&(o+=e.async?" throw new ValidationError(vErrors); ":" validate.errors = vErrors; return false; ")):!1===x.errors?o+=" "+B+" ":(o+=" if (Array.isArray("+C+")) { if (vErrors === null) vErrors = "+C+"; else vErrors = vErrors.concat("+C+"); errors = vErrors.length;  for (var "+T+"="+f+"; "+T+"<errors; "+T+"++) { var "+P+" = vErrors["+T+"]; if ("+P+".dataPath === undefined) "+P+".dataPath = (dataPath || '') + "+e.errorPath+";  "+P+'.schemaPath = "'+c+'";  ',e.opts.verbose&&(o+=" "+P+".schema = "+i+"; "+P+".data = "+d+"; "),o+=" } } else { "+B+" } "),o+=" } ",h&&(o+=" else { ")}return o}},{}],23:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="errs__"+i,d=e.util.copy(e),p="",f="valid"+ ++d.level,m={},v={},y=e.opts.ownProperties;for(_ in a){var g=a[_],b=Array.isArray(g)?v:m;b[_]=g}n+="var "+h+" = errors;";var w=e.errorPath;n+="var missing"+i+";";for(var _ in v)if((b=v[_]).length){if(n+=" if ( "+c+e.util.getProperty(_)+" !== undefined ",y&&(n+=" && Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(_)+"') "),u){n+=" && ( ";var E=b;if(E)for(var x=-1,S=E.length-1;x<S;)A=E[x+=1],x&&(n+=" || "),n+=" ( ( "+(D=c+(I=e.util.getProperty(A)))+" === undefined ",y&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(A)+"') "),n+=") && (missing"+i+" = "+e.util.toQuotedString(e.opts.jsonPointers?A:I)+") ) ";n+=")) {  ";var N="missing"+i,C="' + "+N+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(w,N,!0):w+" + "+N);var T=T||[];T.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { property: '"+e.util.escapeQuotes(_)+"', missingProperty: '"+C+"', depsCount: "+b.length+", deps: '"+e.util.escapeQuotes(1==b.length?b[0]:b.join(", "))+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should have ",n+=1==b.length?"property "+e.util.escapeQuotes(b[0]):"properties "+e.util.escapeQuotes(b.join(", ")),n+=" when property "+e.util.escapeQuotes(_)+" is present' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var P=n;n=T.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+P+"]); ":" validate.errors = ["+P+"]; return false; ":" var err = "+P+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{n+=" ) { ";var k=b;if(k)for(var A,R=-1,O=k.length-1;R<O;){A=k[R+=1];var I=e.util.getProperty(A),C=e.util.escapeQuotes(A),D=c+I;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(w,A,e.opts.jsonPointers)),n+=" if ( "+D+" === undefined ",y&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(A)+"') "),n+=") {  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { property: '"+e.util.escapeQuotes(_)+"', missingProperty: '"+C+"', depsCount: "+b.length+", deps: '"+e.util.escapeQuotes(1==b.length?b[0]:b.join(", "))+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should have ",n+=1==b.length?"property "+e.util.escapeQuotes(b[0]):"properties "+e.util.escapeQuotes(b.join(", ")),n+=" when property "+e.util.escapeQuotes(_)+" is present' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}n+=" }   ",u&&(p+="}",n+=" else { ")}e.errorPath=w;var M=d.baseId;for(var _ in m)g=m[_],e.util.schemaHasRules(g,e.RULES.all)&&(n+=" "+f+" = true; if ( "+c+e.util.getProperty(_)+" !== undefined ",y&&(n+=" && Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(_)+"') "),n+=") { ",d.schema=g,d.schemaPath=s+e.util.getProperty(_),d.errSchemaPath=l+"/"+e.util.escapeFragment(_),n+="  "+e.validate(d)+" ",d.baseId=M,n+=" }  ",u&&(n+=" if ("+f+") { ",p+="}"));return u&&(n+="   "+p+" if ("+h+" == errors) {"),n=e.util.cleanUpCode(n)}},{}],24:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d=e.opts.$data&&a&&a.$data;d&&(n+=" var schema"+i+" = "+e.util.getData(a.$data,o,e.dataPathArr)+"; ");var p="i"+i,f="schema"+i;d||(n+=" var "+f+" = validate.schema"+s+";"),n+="var "+h+";",d&&(n+=" if (schema"+i+" === undefined) "+h+" = true; else if (!Array.isArray(schema"+i+")) "+h+" = false; else {"),n+=h+" = false;for (var "+p+"=0; "+p+"<"+f+".length; "+p+"++) if (equal("+c+", "+f+"["+p+"])) { "+h+" = true; break; }",d&&(n+="  }  "),n+=" if (!"+h+") {   ";var m=m||[];m.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { allowedValues: schema"+i+" } ",!1!==e.opts.messages&&(n+=" , message: 'should be equal to one of the allowed values' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var v=n;return n=m.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+v+"]); ":" validate.errors = ["+v+"]; return false; ":" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" }",u&&(n+=" else { "),n}},{}],25:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||"");if(!1===e.opts.format)return u&&(n+=" if (true) { "),n;var h,d=e.opts.$data&&a&&a.$data;d?(n+=" var schema"+i+" = "+e.util.getData(a.$data,o,e.dataPathArr)+"; ",h="schema"+i):h=a;var p=e.opts.unknownFormats,f=Array.isArray(p);if(d)n+=" var "+(m="format"+i)+" = formats["+h+"]; var "+(v="isObject"+i)+" = typeof "+m+" == 'object' && !("+m+" instanceof RegExp) && "+m+".validate; var "+(y="formatType"+i)+" = "+v+" && "+m+".type || 'string'; if ("+v+") { ",e.async&&(n+=" var async"+i+" = "+m+".async; "),n+=" "+m+" = "+m+".validate; } if (  ",d&&(n+=" ("+h+" !== undefined && typeof "+h+" != 'string') || "),n+=" (","ignore"!=p&&(n+=" ("+h+" && !"+m+" ",f&&(n+=" && self._opts.unknownFormats.indexOf("+h+") == -1 "),n+=") || "),n+=" ("+m+" && "+y+" == '"+r+"' && !(typeof "+m+" == 'function' ? ",n+=e.async?" (async"+i+" ? "+e.yieldAwait+" "+m+"("+c+") : "+m+"("+c+")) ":" "+m+"("+c+") ",n+=" : "+m+".test("+c+"))))) {";else{var m=e.formats[a];if(!m){if("ignore"==p)return console.warn('unknown format "'+a+'" ignored in schema at path "'+e.errSchemaPath+'"'),u&&(n+=" if (true) { "),n;if(f&&p.indexOf(a)>=0)return u&&(n+=" if (true) { "),n;throw new Error('unknown format "'+a+'" is used in schema at path "'+e.errSchemaPath+'"')}var v="object"==typeof m&&!(m instanceof RegExp)&&m.validate,y=v&&m.type||"string";if(v){var g=!0===m.async;m=m.validate}if(y!=r)return u&&(n+=" if (true) { "),n;if(g){if(!e.async)throw new Error("async format in sync schema");b="formats"+e.util.getProperty(a)+".validate",n+=" if (!("+e.yieldAwait+" "+b+"("+c+"))) { "}else{n+=" if (! ";var b="formats"+e.util.getProperty(a);v&&(b+=".validate"),n+="function"==typeof m?" "+b+"("+c+") ":" "+b+".test("+c+") ",n+=") { "}}var w=w||[];w.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'format' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { format:  ",n+=d?""+h:""+e.util.toQuotedString(a),n+="  } ",!1!==e.opts.messages&&(n+=" , message: 'should match format \"",n+=d?"' + "+h+" + '":""+e.util.escapeQuotes(a),n+="\"' "),e.opts.verbose&&(n+=" , schema:  ",n+=d?"validate.schema"+s:""+e.util.toQuotedString(a),n+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var _=n;return n=w.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+_+"]); ":" validate.errors = ["+_+"]; return false; ":" var err = "+_+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } ",u&&(n+=" else { "),n}},{}],26:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d="errs__"+i,p=e.util.copy(e),f="",m="valid"+ ++p.level,v="i"+i,y=p.dataLevel=e.dataLevel+1,g="data"+y,b=e.baseId;if(n+="var "+d+" = errors;var "+h+";",Array.isArray(a)){var w=e.schema.additionalItems;if(!1===w){n+=" "+h+" = "+c+".length <= "+a.length+"; ";var _=l;l=e.errSchemaPath+"/additionalItems",n+="  if (!"+h+") {   ";var E=E||[];E.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+a.length+" } ",!1!==e.opts.messages&&(n+=" , message: 'should NOT have more than "+a.length+" items' "),e.opts.verbose&&(n+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var x=n;n=E.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+x+"]); ":" validate.errors = ["+x+"]; return false; ":" var err = "+x+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } ",l=_,u&&(f+="}",n+=" else { ")}var S=a;if(S)for(var N,C=-1,T=S.length-1;C<T;)N=S[C+=1],e.util.schemaHasRules(N,e.RULES.all)&&(n+=" "+m+" = true; if ("+c+".length > "+C+") { ",P=c+"["+C+"]",p.schema=N,p.schemaPath=s+"["+C+"]",p.errSchemaPath=l+"/"+C,p.errorPath=e.util.getPathExpr(e.errorPath,C,e.opts.jsonPointers,!0),p.dataPathArr[y]=C,k=e.validate(p),p.baseId=b,n+=e.util.varOccurences(k,g)<2?" "+e.util.varReplace(k,g,P)+" ":" var "+g+" = "+P+"; "+k+" ",n+=" }  ",u&&(n+=" if ("+m+") { ",f+="}"));"object"==typeof w&&e.util.schemaHasRules(w,e.RULES.all)&&(p.schema=w,p.schemaPath=e.schemaPath+".additionalItems",p.errSchemaPath=e.errSchemaPath+"/additionalItems",n+=" "+m+" = true; if ("+c+".length > "+a.length+") {  for (var "+v+" = "+a.length+"; "+v+" < "+c+".length; "+v+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers,!0),P=c+"["+v+"]",p.dataPathArr[y]=v,k=e.validate(p),p.baseId=b,n+=e.util.varOccurences(k,g)<2?" "+e.util.varReplace(k,g,P)+" ":" var "+g+" = "+P+"; "+k+" ",u&&(n+=" if (!"+m+") break; "),n+=" } }  ",u&&(n+=" if ("+m+") { ",f+="}"))}else if(e.util.schemaHasRules(a,e.RULES.all)){p.schema=a,p.schemaPath=s,p.errSchemaPath=l,n+="  for (var "+v+" = 0; "+v+" < "+c+".length; "+v+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers,!0);var P=c+"["+v+"]";p.dataPathArr[y]=v;var k=e.validate(p);p.baseId=b,n+=e.util.varOccurences(k,g)<2?" "+e.util.varReplace(k,g,P)+" ":" var "+g+" = "+P+"; "+k+" ",u&&(n+=" if (!"+m+") break; "),n+=" }"}return u&&(n+=" "+f+" if ("+d+" == errors) {"),n=e.util.cleanUpCode(n)}},{}],27:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,i=" ",o=e.level,a=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(a||""),d=e.opts.$data&&s&&s.$data;d?(i+=" var schema"+o+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+o):n=s,i+="var division"+o+";if (",d&&(i+=" "+n+" !== undefined && ( typeof "+n+" != 'number' || "),i+=" (division"+o+" = "+h+" / "+n+", ",i+=e.opts.multipleOfPrecision?" Math.abs(Math.round(division"+o+") - division"+o+") > 1e-"+e.opts.multipleOfPrecision+" ":" division"+o+" !== parseInt(division"+o+") ",i+=" ) ",d&&(i+="  )  "),i+=" ) {   ";var p=p||[];p.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { multipleOf: "+n+" } ",!1!==e.opts.messages&&(i+=" , message: 'should be multiple of ",i+=d?"' + "+n:n+"'"),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+l:""+s,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var f=i;return i=p.pop(),i+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+f+"]); ":" validate.errors = ["+f+"]; return false; ":" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",c&&(i+=" else { "),i}},{}],28:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="errs__"+i,d=e.util.copy(e),p="valid"+ ++d.level;if(e.util.schemaHasRules(a,e.RULES.all)){d.schema=a,d.schemaPath=s,d.errSchemaPath=l,n+=" var "+h+" = errors;  ";var f=e.compositeRule;e.compositeRule=d.compositeRule=!0,d.createErrors=!1;var m;d.opts.allErrors&&(m=d.opts.allErrors,d.opts.allErrors=!1),n+=" "+e.validate(d)+" ",d.createErrors=!0,m&&(d.opts.allErrors=m),e.compositeRule=d.compositeRule=f,n+=" if ("+p+") {   ";var v=v||[];v.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should NOT be valid' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var y=n;n=v.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+y+"]); ":" validate.errors = ["+y+"]; return false; ":" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else {  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; } ",e.opts.allErrors&&(n+=" } ")}else n+="  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should NOT be valid' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",u&&(n+=" if (false) { ");return n}},{}],29:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d="errs__"+i,p=e.util.copy(e),f="",m="valid"+ ++p.level;n+="var "+d+" = errors;var prevValid"+i+" = false;var "+h+" = false;";var v=p.baseId,y=e.compositeRule;e.compositeRule=p.compositeRule=!0;var g=a;if(g)for(var b,w=-1,_=g.length-1;w<_;)b=g[w+=1],e.util.schemaHasRules(b,e.RULES.all)?(p.schema=b,p.schemaPath=s+"["+w+"]",p.errSchemaPath=l+"/"+w,n+="  "+e.validate(p)+" ",p.baseId=v):n+=" var "+m+" = true; ",w&&(n+=" if ("+m+" && prevValid"+i+") "+h+" = false; else { ",f+="}"),n+=" if ("+m+") "+h+" = prevValid"+i+" = true;";return e.compositeRule=p.compositeRule=y,n+=f+"if (!"+h+") {   var err =   ",!1!==e.createErrors?(n+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(n+=" , message: 'should match exactly one schema in oneOf' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(n+=e.async?" throw new ValidationError(vErrors); ":" validate.errors = vErrors; return false; "),n+="} else {  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; }",e.opts.allErrors&&(n+=" } "),n}},{}],30:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,i=" ",o=e.level,a=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(a||""),d=e.opts.$data&&s&&s.$data;d?(i+=" var schema"+o+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+o):n=s;var p=d?"(new RegExp("+n+"))":e.usePattern(s);i+="if ( ",d&&(i+=" ("+n+" !== undefined && typeof "+n+" != 'string') || "),i+=" !"+p+".test("+h+") ) {   ";var f=f||[];f.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { pattern:  ",i+=d?""+n:""+e.util.toQuotedString(s),i+="  } ",!1!==e.opts.messages&&(i+=" , message: 'should match pattern \"",i+=d?"' + "+n+" + '":""+e.util.escapeQuotes(s),i+="\"' "),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+l:""+e.util.toQuotedString(s),i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var m=i;return i=f.pop(),i+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+m+"]); ":" validate.errors = ["+m+"]; return false; ":" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",c&&(i+=" else { "),i}},{}],31:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d="errs__"+i,p=e.util.copy(e),f="",m="valid"+ ++p.level,v="key"+i,y="idx"+i,g=p.dataLevel=e.dataLevel+1,b="data"+g,w="dataProperties"+i,_=Object.keys(a||{}),E=e.schema.patternProperties||{},x=Object.keys(E),S=e.schema.additionalProperties,N=_.length||x.length,C=!1===S,T="object"==typeof S&&Object.keys(S).length,P=e.opts.removeAdditional,k=C||T||P,A=e.opts.ownProperties,R=e.baseId,O=e.schema.required;if(O&&(!e.opts.v5||!O.$data)&&O.length<e.opts.loopRequired)var I=e.util.toHash(O);if(e.opts.patternGroups)var D=e.schema.patternGroups||{},M=Object.keys(D);if(n+="var "+d+" = errors;var "+m+" = true;",A&&(n+=" var "+w+" = undefined;"),k){if(n+=A?" "+w+" = "+w+" || Object.keys("+c+"); for (var "+y+"=0; "+y+"<"+w+".length; "+y+"++) { var "+v+" = "+w+"["+y+"]; ":" for (var "+v+" in "+c+") { ",N){if(n+=" var isAdditional"+i+" = !(false ",_.length)if(_.length>5)n+=" || validate.schema"+s+"["+v+"] ";else{var L=_;if(L)for(var j=-1,F=L.length-1;j<F;)Q=L[j+=1],n+=" || "+v+" == "+e.util.toQuotedString(Q)+" "}if(x.length){var B=x;if(B)for(var V=-1,H=B.length-1;V<H;)oe=B[V+=1],n+=" || "+e.usePattern(oe)+".test("+v+") "}if(e.opts.patternGroups&&M.length){var W=M;if(W)for(var V=-1,$=W.length-1;V<$;)ue=W[V+=1],n+=" || "+e.usePattern(ue)+".test("+v+") "}n+=" ); if (isAdditional"+i+") { "}if("all"==P)n+=" delete "+c+"["+v+"]; ";else{var U=e.errorPath,q="' + "+v+" + '";if(e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers)),C)P?n+=" delete "+c+"["+v+"]; ":(n+=" "+m+" = false; ",re=l,l=e.errSchemaPath+"/additionalProperties",(we=we||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { additionalProperty: '"+q+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should NOT have additional properties' "),e.opts.verbose&&(n+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",_e=n,n=we.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+_e+"]); ":" validate.errors = ["+_e+"]; return false; ":" var err = "+_e+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l=re,u&&(n+=" break; "));else if(T)if("failing"==P){n+=" var "+d+" = errors;  ";var z=e.compositeRule;e.compositeRule=p.compositeRule=!0,p.schema=S,p.schemaPath=e.schemaPath+".additionalProperties",p.errSchemaPath=e.errSchemaPath+"/additionalProperties",p.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers),J=c+"["+v+"]",p.dataPathArr[g]=v,fe=e.validate(p),p.baseId=R,n+=e.util.varOccurences(fe,b)<2?" "+e.util.varReplace(fe,b,J)+" ":" var "+b+" = "+J+"; "+fe+" ",n+=" if (!"+m+") { errors = "+d+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+c+"["+v+"]; }  ",e.compositeRule=p.compositeRule=z}else p.schema=S,p.schemaPath=e.schemaPath+".additionalProperties",p.errSchemaPath=e.errSchemaPath+"/additionalProperties",p.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers),J=c+"["+v+"]",p.dataPathArr[g]=v,fe=e.validate(p),p.baseId=R,n+=e.util.varOccurences(fe,b)<2?" "+e.util.varReplace(fe,b,J)+" ":" var "+b+" = "+J+"; "+fe+" ",u&&(n+=" if (!"+m+") break; ");e.errorPath=U}N&&(n+=" } "),n+=" }  ",u&&(n+=" if ("+m+") { ",f+="}")}var K=e.opts.useDefaults&&!e.compositeRule;if(_.length){var G=_;if(G)for(var Q,X=-1,Y=G.length-1;X<Y;){if(pe=a[Q=G[X+=1]],e.util.schemaHasRules(pe,e.RULES.all)){var Z=e.util.getProperty(Q),J=c+Z,ee=K&&void 0!==pe.default;if(p.schema=pe,p.schemaPath=s+Z,p.errSchemaPath=l+"/"+e.util.escapeFragment(Q),p.errorPath=e.util.getPath(e.errorPath,Q,e.opts.jsonPointers),p.dataPathArr[g]=e.util.toQuotedString(Q),fe=e.validate(p),p.baseId=R,e.util.varOccurences(fe,b)<2)fe=e.util.varReplace(fe,b,J),te=J;else{var te=b;n+=" var "+b+" = "+J+"; "}if(ee)n+=" "+fe+" ";else{if(I&&I[Q]){n+=" if ( "+te+" === undefined ",A&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(Q)+"') "),n+=") { "+m+" = false; ";var U=e.errorPath,re=l,ne=e.util.escapeQuotes(Q);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(U,Q,e.opts.jsonPointers)),
l=e.errSchemaPath+"/required",(we=we||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+ne+"' } ",!1!==e.opts.messages&&(n+=" , message: '",n+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+ne+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",_e=n,n=we.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+_e+"]); ":" validate.errors = ["+_e+"]; return false; ":" var err = "+_e+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l=re,e.errorPath=U,n+=" } else { "}else u?(n+=" if ( "+te+" === undefined ",A&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(Q)+"') "),n+=") { "+m+" = true; } else { "):(n+=" if ("+te+" !== undefined ",A&&(n+=" &&   Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(Q)+"') "),n+=" ) { ");n+=" "+fe+" } "}}u&&(n+=" if ("+m+") { ",f+="}")}}if(x.length){var ie=x;if(ie)for(var oe,ae=-1,se=ie.length-1;ae<se;)pe=E[oe=ie[ae+=1]],e.util.schemaHasRules(pe,e.RULES.all)&&(p.schema=pe,p.schemaPath=e.schemaPath+".patternProperties"+e.util.getProperty(oe),p.errSchemaPath=e.errSchemaPath+"/patternProperties/"+e.util.escapeFragment(oe),n+=A?" "+w+" = "+w+" || Object.keys("+c+"); for (var "+y+"=0; "+y+"<"+w+".length; "+y+"++) { var "+v+" = "+w+"["+y+"]; ":" for (var "+v+" in "+c+") { ",n+=" if ("+e.usePattern(oe)+".test("+v+")) { ",p.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers),J=c+"["+v+"]",p.dataPathArr[g]=v,fe=e.validate(p),p.baseId=R,n+=e.util.varOccurences(fe,b)<2?" "+e.util.varReplace(fe,b,J)+" ":" var "+b+" = "+J+"; "+fe+" ",u&&(n+=" if (!"+m+") break; "),n+=" } ",u&&(n+=" else "+m+" = true; "),n+=" }  ",u&&(n+=" if ("+m+") { ",f+="}"))}if(e.opts.patternGroups&&M.length){var le=M;if(le)for(var ue,ce=-1,he=le.length-1;ce<he;){var de=D[ue=le[ce+=1]],pe=de.schema;if(e.util.schemaHasRules(pe,e.RULES.all)){p.schema=pe,p.schemaPath=e.schemaPath+".patternGroups"+e.util.getProperty(ue)+".schema",p.errSchemaPath=e.errSchemaPath+"/patternGroups/"+e.util.escapeFragment(ue)+"/schema",n+=" var pgPropCount"+i+" = 0;  ",n+=A?" "+w+" = "+w+" || Object.keys("+c+"); for (var "+y+"=0; "+y+"<"+w+".length; "+y+"++) { var "+v+" = "+w+"["+y+"]; ":" for (var "+v+" in "+c+") { ",n+=" if ("+e.usePattern(ue)+".test("+v+")) { pgPropCount"+i+"++; ",p.errorPath=e.util.getPathExpr(e.errorPath,v,e.opts.jsonPointers),J=c+"["+v+"]",p.dataPathArr[g]=v;var fe=e.validate(p);p.baseId=R,n+=e.util.varOccurences(fe,b)<2?" "+e.util.varReplace(fe,b,J)+" ":" var "+b+" = "+J+"; "+fe+" ",u&&(n+=" if (!"+m+") break; "),n+=" } ",u&&(n+=" else "+m+" = true; "),n+=" }  ",u&&(n+=" if ("+m+") { ",f+="}");var me=de.minimum,ve=de.maximum;if(void 0!==me||void 0!==ve){if(n+=" var "+h+" = true; ",re=l,void 0!==me){var ye=me,ge="minimum",be="less";n+=" "+h+" = pgPropCount"+i+" >= "+me+"; ",l=e.errSchemaPath+"/patternGroups/minimum",n+="  if (!"+h+") {   ",(we=we||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'patternGroups' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { reason: '"+ge+"', limit: "+ye+", pattern: '"+e.util.escapeQuotes(ue)+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should NOT have "+be+" than "+ye+' properties matching pattern "'+e.util.escapeQuotes(ue)+"\"' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",_e=n,n=we.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+_e+"]); ":" validate.errors = ["+_e+"]; return false; ":" var err = "+_e+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } ",void 0!==ve&&(n+=" else ")}if(void 0!==ve){var ye=ve,ge="maximum",be="more";n+=" "+h+" = pgPropCount"+i+" <= "+ve+"; ",l=e.errSchemaPath+"/patternGroups/maximum",n+="  if (!"+h+") {   ";var we=we||[];we.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'patternGroups' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { reason: '"+ge+"', limit: "+ye+", pattern: '"+e.util.escapeQuotes(ue)+"' } ",!1!==e.opts.messages&&(n+=" , message: 'should NOT have "+be+" than "+ye+' properties matching pattern "'+e.util.escapeQuotes(ue)+"\"' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var _e=n;n=we.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+_e+"]); ":" validate.errors = ["+_e+"]; return false; ":" var err = "+_e+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } "}l=re,u&&(n+=" if ("+h+") { ",f+="}")}}}}return u&&(n+=" "+f+" if ("+d+" == errors) {"),n=e.util.cleanUpCode(n)}},{}],32:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="errs__"+i,d=e.util.copy(e),p="valid"+ ++d.level;if(e.util.schemaHasRules(a,e.RULES.all)){d.schema=a,d.schemaPath=s,d.errSchemaPath=l;var f="key"+i,m="idx"+i,v="i"+i,y="' + "+f+" + '",g="data"+(d.dataLevel=e.dataLevel+1),b="dataProperties"+i,w=e.opts.ownProperties,_=e.baseId;n+=" var "+h+" = errors; ",w&&(n+=" var "+b+" = undefined; "),n+=w?" "+b+" = "+b+" || Object.keys("+c+"); for (var "+m+"=0; "+m+"<"+b+".length; "+m+"++) { var "+f+" = "+b+"["+m+"]; ":" for (var "+f+" in "+c+") { ",n+=" var startErrs"+i+" = errors; ";var E=f,x=e.compositeRule;e.compositeRule=d.compositeRule=!0;var S=e.validate(d);d.baseId=_,n+=e.util.varOccurences(S,g)<2?" "+e.util.varReplace(S,g,E)+" ":" var "+g+" = "+E+"; "+S+" ",e.compositeRule=d.compositeRule=x,n+=" if (!"+p+") { for (var "+v+"=startErrs"+i+"; "+v+"<errors; "+v+"++) { vErrors["+v+"].propertyName = "+f+"; }   var err =   ",!1!==e.createErrors?(n+=" { keyword: 'propertyNames' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { propertyName: '"+y+"' } ",!1!==e.opts.messages&&(n+=" , message: 'property name \\'"+y+"\\' is invalid' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(n+=e.async?" throw new ValidationError(vErrors); ":" validate.errors = vErrors; return false; "),u&&(n+=" break; "),n+=" } }"}return u&&(n+="  if ("+h+" == errors) {"),n=e.util.cleanUpCode(n)}},{}],33:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,i,o=" ",a=e.level,s=e.dataLevel,l=e.schema[t],u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(s||""),d="valid"+a;if("#"==l||"#/"==l)e.isRoot?(n=e.async,i="validate"):(n=!0===e.root.schema.$async,i="root.refVal[0]");else{var p=e.resolveRef(e.baseId,l,e.isRoot);if(void 0===p){var f=e.MissingRefError.message(e.baseId,l);if("fail"==e.opts.missingRefs){console.error(f),(g=g||[]).push(o),o="",!1!==e.createErrors?(o+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { ref: '"+e.util.escapeQuotes(l)+"' } ",!1!==e.opts.messages&&(o+=" , message: 'can\\'t resolve reference "+e.util.escapeQuotes(l)+"' "),e.opts.verbose&&(o+=" , schema: "+e.util.toQuotedString(l)+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),o+=" } "):o+=" {} ";var m=o;o=g.pop(),o+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+m+"]); ":" validate.errors = ["+m+"]; return false; ":" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c&&(o+=" if (false) { ")}else{if("ignore"!=e.opts.missingRefs)throw new e.MissingRefError(e.baseId,l,f);console.warn(f),c&&(o+=" if (true) { ")}}else if(p.inline){var v=e.util.copy(e),y="valid"+ ++v.level;v.schema=p.schema,v.schemaPath="",v.errSchemaPath=l,o+=" "+e.validate(v).replace(/validate\.schema/g,p.code)+" ",c&&(o+=" if ("+y+") { ")}else n=!0===p.$async,i=p.code}if(i){var g=g||[];g.push(o),o="",o+=e.opts.passContext?" "+i+".call(this, ":" "+i+"( ",o+=" "+h+", (dataPath || '')",'""'!=e.errorPath&&(o+=" + "+e.errorPath);var b=o+=" , "+(s?"data"+(s-1||""):"parentData")+" , "+(s?e.dataPathArr[s]:"parentDataProperty")+", rootData)  ";if(o=g.pop(),n){if(!e.async)throw new Error("async schema referenced by sync schema");c&&(o+=" var "+d+"; "),o+=" try { "+e.yieldAwait+" "+b+"; ",c&&(o+=" "+d+" = true; "),o+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ",c&&(o+=" "+d+" = false; "),o+=" } ",c&&(o+=" if ("+d+") { ")}else o+=" if (!"+b+") { if (vErrors === null) vErrors = "+i+".errors; else vErrors = vErrors.concat("+i+".errors); errors = vErrors.length; } ",c&&(o+=" else { ")}return o}},{}],34:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=" ",i=e.level,o=e.dataLevel,a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d=e.opts.$data&&a&&a.$data;d&&(n+=" var schema"+i+" = "+e.util.getData(a.$data,o,e.dataPathArr)+"; ");var p="schema"+i;if(!d)if(a.length<e.opts.loopRequired&&e.schema.properties&&Object.keys(e.schema.properties).length){var f=[],m=a;if(m)for(var v,y=-1,g=m.length-1;y<g;){v=m[y+=1];var b=e.schema.properties[v];b&&e.util.schemaHasRules(b,e.RULES.all)||(f[f.length]=v)}}else f=a;if(d||f.length){var w=e.errorPath,_=d||f.length>=e.opts.loopRequired,E=e.opts.ownProperties;if(u)if(n+=" var missing"+i+"; ",_)d||(n+=" var "+p+" = validate.schema"+s+"; "),k="' + "+(P="schema"+i+"["+(S="i"+i)+"]")+" + '",e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(w,P,e.opts.jsonPointers)),n+=" var "+h+" = true; ",d&&(n+=" if (schema"+i+" === undefined) "+h+" = true; else if (!Array.isArray(schema"+i+")) "+h+" = false; else {"),n+=" for (var "+S+" = 0; "+S+" < "+p+".length; "+S+"++) { "+h+" = "+c+"["+p+"["+S+"]] !== undefined ",E&&(n+=" &&   Object.prototype.hasOwnProperty.call("+c+", "+p+"["+S+"]) "),n+="; if (!"+h+") break; } ",d&&(n+="  }  "),n+="  if (!"+h+") {   ",(C=C||[]).push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+k+"' } ",!1!==e.opts.messages&&(n+=" , message: '",n+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+k+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",T=n,n=C.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+T+"]); ":" validate.errors = ["+T+"]; return false; ":" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else { ";else{n+=" if ( ";var x=f;if(x)for(var S=-1,N=x.length-1;S<N;)R=x[S+=1],S&&(n+=" || "),n+=" ( ( "+(M=c+(D=e.util.getProperty(R)))+" === undefined ",E&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(R)+"') "),n+=") && (missing"+i+" = "+e.util.toQuotedString(e.opts.jsonPointers?R:D)+") ) ";n+=") {  ",k="' + "+(P="missing"+i)+" + '",e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(w,P,!0):w+" + "+P);var C=C||[];C.push(n),n="",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+k+"' } ",!1!==e.opts.messages&&(n+=" , message: '",n+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+k+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ";var T=n;n=C.pop(),n+=!e.compositeRule&&u?e.async?" throw new ValidationError(["+T+"]); ":" validate.errors = ["+T+"]; return false; ":" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n+=" } else { "}else if(_){d||(n+=" var "+p+" = validate.schema"+s+"; ");var P="schema"+i+"["+(S="i"+i)+"]",k="' + "+P+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(w,P,e.opts.jsonPointers)),d&&(n+=" if ("+p+" && !Array.isArray("+p+")) {  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+k+"' } ",!1!==e.opts.messages&&(n+=" , message: '",n+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+k+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+p+" !== undefined) { "),n+=" for (var "+S+" = 0; "+S+" < "+p+".length; "+S+"++) { if ("+c+"["+p+"["+S+"]] === undefined ",E&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", "+p+"["+S+"]) "),n+=") {  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+k+"' } ",!1!==e.opts.messages&&(n+=" , message: '",n+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+k+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",d&&(n+="  }  ")}else{var A=f;if(A)for(var R,O=-1,I=A.length-1;O<I;){R=A[O+=1];var D=e.util.getProperty(R),k=e.util.escapeQuotes(R),M=c+D;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(w,R,e.opts.jsonPointers)),n+=" if ( "+M+" === undefined ",E&&(n+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(R)+"') "),n+=") {  var err =   ",!1!==e.createErrors?(n+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+k+"' } ",!1!==e.opts.messages&&(n+=" , message: '",n+=e.opts._errorDataPathProperty?"is a required property":"should have required property \\'"+k+"\\'",n+="' "),e.opts.verbose&&(n+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),n+=" } "):n+=" {} ",n+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}e.errorPath=w}else u&&(n+=" if (true) {");return n}},{}],35:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,i=" ",o=e.level,a=e.dataLevel,s=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(a||""),d="valid"+o,p=e.opts.$data&&s&&s.$data;if(p?(i+=" var schema"+o+" = "+e.util.getData(s.$data,a,e.dataPathArr)+"; ",n="schema"+o):n=s,(s||p)&&!1!==e.opts.uniqueItems){p&&(i+=" var "+d+"; if ("+n+" === false || "+n+" === undefined) "+d+" = true; else if (typeof "+n+" != 'boolean') "+d+" = false; else { "),i+=" var "+d+" = true; if ("+h+".length > 1) { var i = "+h+".length, j; outer: for (;i--;) { for (j = i; j--;) { if (equal("+h+"[i], "+h+"[j])) { "+d+" = false; break outer; } } } } ",p&&(i+="  }  "),i+=" if (!"+d+") {   ";var f=f||[];f.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { i: i, j: j } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),e.opts.verbose&&(i+=" , schema:  ",i+=p?"validate.schema"+l:""+s,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var m=i;i=f.pop(),i+=!e.compositeRule&&c?e.async?" throw new ValidationError(["+m+"]); ":" validate.errors = ["+m+"]; return false; ":" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",c&&(i+=" else { ")}else c&&(i+=" if (true) { ");return i}},{}],36:[function(e,t,r){"use strict";t.exports=function(e,t,r){function n(e){for(var t=e.rules,r=0;r<t.length;r++)if(i(t[r]))return!0}function i(t){return void 0!==e.schema[t.keyword]||t.implements&&o(t)}function o(t){for(var r=t.implements,n=0;n<r.length;n++)if(void 0!==e.schema[r[n]])return!0}var a="",s=!0===e.schema.$async,l=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"),u=e.self._getId(e.schema);if(e.isTop){if(s){e.async=!0;var c="es7"==e.opts.async;e.yieldAwait=c?"await":"yield"}a+=" var validate = ",s?c?a+=" (async function ":("*"!=e.opts.async&&(a+="co.wrap"),a+="(function* "):a+=" (function ",a+=" (data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",u&&(e.opts.sourceCode||e.opts.processCode)&&(a+=" /*# sourceURL="+u+" */ ")}if("boolean"==typeof e.schema||!l&&!e.schema.$ref){var h=e.level,d=e.dataLevel,p=e.schema["false schema"],f=e.schemaPath+e.util.getProperty("false schema"),m=e.errSchemaPath+"/false schema",v=!e.opts.allErrors,y="data"+(d||""),g="valid"+h;return!1===e.schema?(e.isTop?v=!0:a+=" var "+g+" = false; ",(J=J||[]).push(a),a="",!1!==e.createErrors?(a+=" { keyword: '"+(w||"false schema")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(m)+" , params: {} ",!1!==e.opts.messages&&(a+=" , message: 'boolean schema is false' "),e.opts.verbose&&(a+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+y+" "),a+=" } "):a+=" {} ",ee=a,a=J.pop(),a+=!e.compositeRule&&v?e.async?" throw new ValidationError(["+ee+"]); ":" validate.errors = ["+ee+"]; return false; ":" var err = "+ee+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "):a+=e.isTop?s?" return data; ":" validate.errors = null; return true; ":" var "+g+" = true; ",e.isTop&&(a+=" }); return validate; "),a}if(e.isTop){var b=e.isTop,h=e.level=0,d=e.dataLevel=0,y="data";e.rootId=e.resolve.fullPath(e.self._getId(e.root.schema)),e.baseId=e.baseId||e.rootId,delete e.isTop,e.dataPathArr=[void 0],a+=" var vErrors = null; ",a+=" var errors = 0;     ",a+=" if (rootData === undefined) rootData = data; "}else{var h=e.level,y="data"+((d=e.dataLevel)||"");if(u&&(e.baseId=e.resolve.url(e.baseId,u)),s&&!e.async)throw new Error("async schema in sync schema");a+=" var errs_"+h+" = errors;"}var w,g="valid"+h,v=!e.opts.allErrors,_="",E="",x=e.schema.type,S=Array.isArray(x);if(S&&1==x.length&&(x=x[0],S=!1),e.schema.$ref&&l){if("fail"==e.opts.extendRefs)throw new Error('$ref: validation keywords used in schema at path "'+e.errSchemaPath+'" (see option extendRefs)');!0!==e.opts.extendRefs&&(l=!1,console.warn('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"'))}if(x){if(e.opts.coerceTypes)var N=e.util.coerceToTypes(e.opts.coerceTypes,x);if(j=e.RULES.types[x],N||S||!0===j||j&&!n(j)){var f=e.schemaPath+".type",m=e.errSchemaPath+"/type",f=e.schemaPath+".type",m=e.errSchemaPath+"/type",C=S?"checkDataTypes":"checkDataType";if(a+=" if ("+e.util[C](x,y,!0)+") { ",N){var T="dataType"+h,P="coerced"+h;a+=" var "+T+" = typeof "+y+"; ","array"==e.opts.coerceTypes&&(a+=" if ("+T+" == 'object' && Array.isArray("+y+")) "+T+" = 'array'; "),a+=" var "+P+" = undefined; ";var k="",A=N;if(A)for(var R,O=-1,I=A.length-1;O<I;)R=A[O+=1],O&&(a+=" if ("+P+" === undefined) { ",k+="}"),"array"==e.opts.coerceTypes&&"array"!=R&&(a+=" if ("+T+" == 'array' && "+y+".length == 1) { "+P+" = "+y+" = "+y+"[0]; "+T+" = typeof "+y+";  } "),"string"==R?a+=" if ("+T+" == 'number' || "+T+" == 'boolean') "+P+" = '' + "+y+"; else if ("+y+" === null) "+P+" = ''; ":"number"==R||"integer"==R?(a+=" if ("+T+" == 'boolean' || "+y+" === null || ("+T+" == 'string' && "+y+" && "+y+" == +"+y+" ","integer"==R&&(a+=" && !("+y+" % 1)"),a+=")) "+P+" = +"+y+"; "):"boolean"==R?a+=" if ("+y+" === 'false' || "+y+" === 0 || "+y+" === null) "+P+" = false; else if ("+y+" === 'true' || "+y+" === 1) "+P+" = true; ":"null"==R?a+=" if ("+y+" === '' || "+y+" === 0 || "+y+" === false) "+P+" = null; ":"array"==e.opts.coerceTypes&&"array"==R&&(a+=" if ("+T+" == 'string' || "+T+" == 'number' || "+T+" == 'boolean' || "+y+" == null) "+P+" = ["+y+"]; ");a+=" "+k+" if ("+P+" === undefined) {   ",(J=J||[]).push(a),a="",!1!==e.createErrors?(a+=" { keyword: '"+(w||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(m)+" , params: { type: '",a+=S?""+x.join(","):""+x,a+="' } ",!1!==e.opts.messages&&(a+=" , message: 'should be ",a+=S?""+x.join(","):""+x,a+="' "),e.opts.verbose&&(a+=" , schema: validate.schema"+f+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+y+" "),a+=" } "):a+=" {} ",ee=a,a=J.pop(),a+=!e.compositeRule&&v?e.async?" throw new ValidationError(["+ee+"]); ":" validate.errors = ["+ee+"]; return false; ":" var err = "+ee+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+=" } else {  ";var D=d?"data"+(d-1||""):"parentData",M=d?e.dataPathArr[d]:"parentDataProperty";a+=" "+y+" = "+P+"; ",d||(a+="if ("+D+" !== undefined)"),a+=" "+D+"["+M+"] = "+P+"; } "}else(J=J||[]).push(a),a="",!1!==e.createErrors?(a+=" { keyword: '"+(w||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(m)+" , params: { type: '",a+=S?""+x.join(","):""+x,a+="' } ",!1!==e.opts.messages&&(a+=" , message: 'should be ",a+=S?""+x.join(","):""+x,a+="' "),e.opts.verbose&&(a+=" , schema: validate.schema"+f+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+y+" "),a+=" } "):a+=" {} ",ee=a,a=J.pop(),a+=!e.compositeRule&&v?e.async?" throw new ValidationError(["+ee+"]); ":" validate.errors = ["+ee+"]; return false; ":" var err = "+ee+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";a+=" } "}}if(e.schema.$ref&&!l)a+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",v&&(a+=" } if (errors === ",a+=b?"0":"errs_"+h,a+=") { ",E+="}");else{e.opts.v5&&e.schema.patternGroups&&console.warn('keyword "patternGroups" is deprecated and disabled. Use option patternGroups: true to enable.');var L=e.RULES;if(L)for(var j,F=-1,B=L.length-1;F<B;)if(j=L[F+=1],n(j)){if(j.type&&(a+=" if ("+e.util.checkDataType(j.type,y)+") { "),e.opts.useDefaults&&!e.compositeRule)if("object"==j.type&&e.schema.properties){var p=e.schema.properties,V=Object.keys(p);if(V)for(var H,W=-1,$=V.length-1;W<$;)void 0!==(q=p[H=V[W+=1]]).default&&(a+="  if ("+(K=y+e.util.getProperty(H))+" === undefined) "+K+" = ",a+="shared"==e.opts.useDefaults?" "+e.useDefault(q.default)+" ":" "+JSON.stringify(q.default)+" ",a+="; ")}else if("array"==j.type&&Array.isArray(e.schema.items)){var U=e.schema.items;if(U)for(var q,O=-1,z=U.length-1;O<z;)if(void 0!==(q=U[O+=1]).default){var K=y+"["+O+"]";a+="  if ("+K+" === undefined) "+K+" = ",a+="shared"==e.opts.useDefaults?" "+e.useDefault(q.default)+" ":" "+JSON.stringify(q.default)+" ",a+="; "}}var G=j.rules;if(G)for(var Q,X=-1,Y=G.length-1;X<Y;)if(Q=G[X+=1],i(Q)){var Z=Q.code(e,Q.keyword,j.type);Z&&(a+=" "+Z+" ",v&&(_+="}"))}if(v&&(a+=" "+_+" ",_=""),j.type&&(a+=" } ",x&&x===j.type&&!N)){a+=" else { ";var f=e.schemaPath+".type",m=e.errSchemaPath+"/type",J=J||[];J.push(a),a="",!1!==e.createErrors?(a+=" { keyword: '"+(w||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(m)+" , params: { type: '",a+=S?""+x.join(","):""+x,a+="' } ",!1!==e.opts.messages&&(a+=" , message: 'should be ",a+=S?""+x.join(","):""+x,a+="' "),e.opts.verbose&&(a+=" , schema: validate.schema"+f+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+y+" "),a+=" } "):a+=" {} ";var ee=a;a=J.pop(),a+=!e.compositeRule&&v?e.async?" throw new ValidationError(["+ee+"]); ":" validate.errors = ["+ee+"]; return false; ":" var err = "+ee+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+=" } "}v&&(a+=" if (errors === ",a+=b?"0":"errs_"+h,a+=") { ",E+="}")}}return v&&(a+=" "+E+" "),b?(s?(a+=" if (errors === 0) return data;           ",a+=" else throw new ValidationError(vErrors); "):(a+=" validate.errors = vErrors; ",a+=" return errors === 0;       "),a+=" }); return validate;"):a+=" var "+g+" = errors === errs_"+h+";",a=e.util.cleanUpCode(a),b&&(a=e.util.finalCleanUpCode(a,s)),a}},{}],37:[function(e,t,r){"use strict";function n(e,t){function r(e,t,r){for(var n,o=0;o<i.length;o++){var a=i[o];if(a.type==t){n=a;break}}n||(n={type:t,rules:[]},i.push(n));var l={keyword:e,definition:r,custom:!0,code:s,implements:r.implements};n.rules.push(l),i.custom[e]=l}function n(e){if(!i.types[e])throw new Error("Unknown type "+e)}var i=this.RULES;if(i.keywords[e])throw new Error("Keyword "+e+" is already defined");if(!a.test(e))throw new Error("Keyword "+e+" is not a valid identifier");if(t){if(t.macro&&void 0!==t.valid)throw new Error('"valid" option cannot be used with macro keywords');var o=t.type;if(Array.isArray(o)){var l,u=o.length;for(l=0;l<u;l++)n(o[l]);for(l=0;l<u;l++)r(e,o[l],t)}else o&&n(o),r(e,o,t);var c=!0===t.$data&&this._opts.$data;if(c&&!t.validate)throw new Error('$data support: "validate" function is not defined');var h=t.metaSchema;h&&(c&&(h={anyOf:[h,{$ref:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/$data.json#"}]}),t.validateSchema=this.compile(h,!0))}i.keywords[e]=i.all[e]=!0}function i(e){var t=this.RULES.custom[e];return t?t.definition:this.RULES.keywords[e]||!1}function o(e){var t=this.RULES;delete t.keywords[e],delete t.all[e],delete t.custom[e];for(var r=0;r<t.length;r++)for(var n=t[r].rules,i=0;i<n.length;i++)if(n[i].keyword==e){n.splice(i,1);break}}var a=/^[a-z_$][a-z0-9_$\-]*$/i,s=e("./dotjs/custom");t.exports={add:n,get:i,remove:o}},{"./dotjs/custom":22}],38:[function(e,t,r){"use strict";t.exports=function(e){var t=e._opts.defaultMeta,r="string"==typeof t?{$ref:t}:e.getSchema("http://json-schema.org/draft-06/schema")?{$ref:"http://json-schema.org/draft-06/schema"}:{};e.addKeyword("patternGroups",{metaSchema:{type:"object",additionalProperties:{type:"object",required:["schema"],properties:{maximum:{type:"integer",minimum:0},minimum:{type:"integer",minimum:0},schema:r},additionalProperties:!1}}}),e.RULES.all.properties.implements.push("patternGroups")}},{}],39:[function(e,t,r){t.exports={$schema:"http://json-schema.org/draft-06/schema#",$id:"https://raw.githubusercontent.com/epoberezkin/ajv/master/lib/refs/$data.json#",description:"Meta-schema for $data reference (JSON-schema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}},{}],40:[function(e,t,r){t.exports={$schema:"http://json-schema.org/draft-06/schema#",$id:"http://json-schema.org/draft-06/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},title:{type:"string"},description:{type:"string"},default:{},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:{}},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:{},enum:{type:"array",minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:{}}},{}],41:[function(e,t,r){(function(e){!function(n){function i(e){throw new RangeError(I[e])}function o(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function a(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),n+o((e=e.replace(O,".")).split("."),t).join(".")}function s(e){for(var t,r,n=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function l(e){return o(e,function(e){var t="";return e>65535&&(t+=L((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=L(e)}).join("")}function u(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:E}function c(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function h(e,t,r){var n=0;for(e=r?M(e/C):e>>1,e+=M(e/t);e>D*S>>1;n+=E)e=M(e/D);return M(n+(D+1)*e/(e+N))}function d(e){var t,r,n,o,a,s,c,d,p,f,m=[],v=e.length,y=0,g=P,b=T;for((r=e.lastIndexOf(k))<0&&(r=0),n=0;n<r;++n)e.charCodeAt(n)>=128&&i("not-basic"),m.push(e.charCodeAt(n));for(o=r>0?r+1:0;o<v;){for(a=y,s=1,c=E;o>=v&&i("invalid-input"),((d=u(e.charCodeAt(o++)))>=E||d>M((_-y)/s))&&i("overflow"),y+=d*s,p=c<=b?x:c>=b+S?S:c-b,!(d<p);c+=E)s>M(_/(f=E-p))&&i("overflow"),s*=f;b=h(y-a,t=m.length+1,0==a),M(y/t)>_-g&&i("overflow"),g+=M(y/t),y%=t,m.splice(y++,0,g)}return l(m)}function p(e){var t,r,n,o,a,l,u,d,p,f,m,v,y,g,b,w=[];for(v=(e=s(e)).length,t=P,r=0,a=T,l=0;l<v;++l)(m=e[l])<128&&w.push(L(m));for(n=o=w.length,o&&w.push(k);n<v;){for(u=_,l=0;l<v;++l)(m=e[l])>=t&&m<u&&(u=m);for(u-t>M((_-r)/(y=n+1))&&i("overflow"),r+=(u-t)*y,t=u,l=0;l<v;++l)if((m=e[l])<t&&++r>_&&i("overflow"),m==t){for(d=r,p=E;f=p<=a?x:p>=a+S?S:p-a,!(d<f);p+=E)b=d-f,g=E-f,w.push(L(c(f+b%g,0))),d=M(b/g);w.push(L(c(d,0))),a=h(r,y,n==o),r=0,++n}++r,++t}return w.join("")}function f(e){return a(e,function(e){return A.test(e)?d(e.slice(4).toLowerCase()):e})}function m(e){return a(e,function(e){return R.test(e)?"xn--"+p(e):e})}var v="object"==typeof r&&r&&!r.nodeType&&r,y="object"==typeof t&&t&&!t.nodeType&&t,g="object"==typeof e&&e;g.global!==g&&g.window!==g&&g.self!==g||(n=g);var b,w,_=2147483647,E=36,x=1,S=26,N=38,C=700,T=72,P=128,k="-",A=/^xn--/,R=/[^\x20-\x7E]/,O=/[\x2E\u3002\uFF0E\uFF61]/g,I={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},D=E-x,M=Math.floor,L=String.fromCharCode;if(b={version:"1.4.1",ucs2:{decode:s,encode:l},decode:d,encode:p,toASCII:m,toUnicode:f},v&&y)if(t.exports==v)y.exports=b;else for(w in b)b.hasOwnProperty(w)&&(v[w]=b[w]);else n.punycode=b}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],42:[function(e,t,r){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t);
}t.exports=function(e,t,r,o){t=t||"&",r=r||"=";var a={};if("string"!=typeof e||0===e.length)return a;var s=/\+/g;e=e.split(t);var l=1e3;o&&"number"==typeof o.maxKeys&&(l=o.maxKeys);var u=e.length;l>0&&u>l&&(u=l);for(var c=0;c<u;++c){var h,d,p,f,m=e[c].replace(s,"%20"),v=m.indexOf(r);v>=0?(h=m.substr(0,v),d=m.substr(v+1)):(h=m,d=""),p=decodeURIComponent(h),f=decodeURIComponent(d),n(a,p)?i(a[p])?a[p].push(f):a[p]=[a[p],f]:a[p]=f}return a};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],43:[function(e,t,r){"use strict";function n(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,r,s){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?n(a(e),function(a){var s=encodeURIComponent(i(a))+r;return o(e[a])?n(e[a],function(e){return s+encodeURIComponent(i(e))}).join(t):s+encodeURIComponent(i(e[a]))}).join(t):s?encodeURIComponent(i(s))+r+encodeURIComponent(i(e)):""};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}},{}],44:[function(e,t,r){"use strict";r.decode=r.parse=e("./decode"),r.encode=r.stringify=e("./encode")},{"./decode":42,"./encode":43}],45:[function(e,t,r){"use strict";function n(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function i(e,t,r){if(e&&u.isObject(e)&&e instanceof n)return e;var i=new n;return i.parse(e,t,r),i}function o(e){return u.isString(e)&&(e=i(e)),e instanceof n?e.format():n.prototype.format.call(e)}function a(e,t){return i(e,!1,!0).resolve(t)}function s(e,t){return e?i(e,!1,!0).resolveObject(t):t}var l=e("punycode"),u=e("./util");r.parse=i,r.resolve=a,r.resolveObject=s,r.format=o,r.Url=n;var c=/^([a-z0-9.+-]+:)/i,h=/:[0-9]*$/,d=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,p=["<",">",'"',"`"," ","\r","\n","\t"],f=["{","}","|","\\","^","`"].concat(p),m=["'"].concat(f),v=["%","/","?",";","#"].concat(m),y=["/","?","#"],g=/^[+a-z0-9A-Z_-]{0,63}$/,b=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,w={javascript:!0,"javascript:":!0},_={javascript:!0,"javascript:":!0},E={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},x=e("querystring");n.prototype.parse=function(e,t,r){if(!u.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var n=e.indexOf("?"),i=-1!==n&&n<e.indexOf("#")?"?":"#",o=e.split(i),a=/\\/g;o[0]=o[0].replace(a,"/");var s=e=o.join(i);if(s=s.trim(),!r&&1===e.split("#").length){var h=d.exec(s);if(h)return this.path=s,this.href=s,this.pathname=h[1],h[2]?(this.search=h[2],this.query=t?x.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var p=c.exec(s);if(p){var f=(p=p[0]).toLowerCase();this.protocol=f,s=s.substr(p.length)}if(r||p||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var S="//"===s.substr(0,2);!S||p&&_[p]||(s=s.substr(2),this.slashes=!0)}if(!_[p]&&(S||p&&!E[p])){for(var N=-1,C=0;C<y.length;C++)-1!==(k=s.indexOf(y[C]))&&(-1===N||k<N)&&(N=k);var T,P;for(-1!==(P=-1===N?s.lastIndexOf("@"):s.lastIndexOf("@",N))&&(T=s.slice(0,P),s=s.slice(P+1),this.auth=decodeURIComponent(T)),N=-1,C=0;C<v.length;C++){var k=s.indexOf(v[C]);-1!==k&&(-1===N||k<N)&&(N=k)}-1===N&&(N=s.length),this.host=s.slice(0,N),s=s.slice(N),this.parseHost();var A="["===(this.hostname=this.hostname||"")[0]&&"]"===this.hostname[this.hostname.length-1];if(!A)for(var R=this.hostname.split(/\./),C=0,O=R.length;C<O;C++){var I=R[C];if(I&&!I.match(g)){for(var D="",M=0,L=I.length;M<L;M++)D+=I.charCodeAt(M)>127?"x":I[M];if(!D.match(g)){var j=R.slice(0,C),F=R.slice(C+1),B=I.match(b);B&&(j.push(B[1]),F.unshift(B[2])),F.length&&(s="/"+F.join(".")+s),this.hostname=j.join(".");break}}}this.hostname=this.hostname.length>255?"":this.hostname.toLowerCase(),A||(this.hostname=l.toASCII(this.hostname));var V=this.port?":"+this.port:"",H=this.hostname||"";this.host=H+V,this.href+=this.host,A&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!w[f])for(var C=0,O=m.length;C<O;C++){var W=m[C];if(-1!==s.indexOf(W)){var $=encodeURIComponent(W);$===W&&($=escape(W)),s=s.split(W).join($)}}var U=s.indexOf("#");-1!==U&&(this.hash=s.substr(U),s=s.slice(0,U));var q=s.indexOf("?");if(-1!==q?(this.search=s.substr(q),this.query=s.substr(q+1),t&&(this.query=x.parse(this.query)),s=s.slice(0,q)):t&&(this.search="",this.query={}),s&&(this.pathname=s),E[f]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var V=this.pathname||"",z=this.search||"";this.path=V+z}return this.href=this.format(),this},n.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",i=!1,o="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&u.isObject(this.query)&&Object.keys(this.query).length&&(o=x.stringify(this.query));var a=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||E[t])&&!1!==i?(i="//"+(i||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):i||(i=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),a=a.replace("#","%23"),t+i+r+a+n},n.prototype.resolve=function(e){return this.resolveObject(i(e,!1,!0)).format()},n.prototype.resolveObject=function(e){if(u.isString(e)){var t=new n;t.parse(e,!1,!0),e=t}for(var r=new n,i=Object.keys(this),o=0;o<i.length;o++){var a=i[o];r[a]=this[a]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var s=Object.keys(e),l=0;l<s.length;l++){var c=s[l];"protocol"!==c&&(r[c]=e[c])}return E[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!E[e.protocol]){for(var h=Object.keys(e),d=0;d<h.length;d++){var p=h[d];r[p]=e[p]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||_[e.protocol])r.pathname=e.pathname;else{for(x=(e.pathname||"").split("/");x.length&&!(e.host=x.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==x[0]&&x.unshift(""),x.length<2&&x.unshift(""),r.pathname=x.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var f=r.pathname||"",m=r.search||"";r.path=f+m}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var v=r.pathname&&"/"===r.pathname.charAt(0),y=e.host||e.pathname&&"/"===e.pathname.charAt(0),g=y||v||r.host&&e.pathname,b=g,w=r.pathname&&r.pathname.split("/")||[],x=e.pathname&&e.pathname.split("/")||[],S=r.protocol&&!E[r.protocol];if(S&&(r.hostname="",r.port=null,r.host&&(""===w[0]?w[0]=r.host:w.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===x[0]?x[0]=e.host:x.unshift(e.host)),e.host=null),g=g&&(""===x[0]||""===w[0])),y)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,w=x;else if(x.length)w||(w=[]),w.pop(),w=w.concat(x),r.search=e.search,r.query=e.query;else if(!u.isNullOrUndefined(e.search))return S&&(r.hostname=r.host=w.shift(),(A=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=A.shift(),r.host=r.hostname=A.shift())),r.search=e.search,r.query=e.query,u.isNull(r.pathname)&&u.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r;if(!w.length)return r.pathname=null,r.path=r.search?"/"+r.search:null,r.href=r.format(),r;for(var N=w.slice(-1)[0],C=(r.host||e.host||w.length>1)&&("."===N||".."===N)||""===N,T=0,P=w.length;P>=0;P--)"."===(N=w[P])?w.splice(P,1):".."===N?(w.splice(P,1),T++):T&&(w.splice(P,1),T--);if(!g&&!b)for(;T--;T)w.unshift("..");!g||""===w[0]||w[0]&&"/"===w[0].charAt(0)||w.unshift(""),C&&"/"!==w.join("/").substr(-1)&&w.push("");var k=""===w[0]||w[0]&&"/"===w[0].charAt(0);if(S){r.hostname=r.host=k?"":w.length?w.shift():"";var A=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@");A&&(r.auth=A.shift(),r.host=r.hostname=A.shift())}return(g=g||r.host&&w.length)&&!k&&w.unshift(""),w.length?r.pathname=w.join("/"):(r.pathname=null,r.path=null),u.isNull(r.pathname)&&u.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},n.prototype.parseHost=function(){var e=this.host,t=h.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},{"./util":46,punycode:41,querystring:44}],46:[function(e,t,r){"use strict";t.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},{}],47:[function(e,t,r){function n(e){var t=this,r=d.call(arguments,1);return new Promise(function(n,o){function a(t){var r;try{r=e.next(t)}catch(e){return o(e)}u(r)}function s(t){var r;try{r=e.throw(t)}catch(e){return o(e)}u(r)}function u(e){if(e.done)return n(e.value);var r=i.call(t,e.value);return r&&l(r)?r.then(a,s):s(new TypeError('You may only yield a function, promise, generator, array, or object, but the following object was passed: "'+String(e.value)+'"'))}return"function"==typeof e&&(e=e.apply(t,r)),e&&"function"==typeof e.next?void a():n(e)})}function i(e){return e?l(e)?e:c(e)||u(e)?n.call(this,e):"function"==typeof e?o.call(this,e):Array.isArray(e)?a.call(this,e):h(e)?s.call(this,e):e:e}function o(e){var t=this;return new Promise(function(r,n){e.call(t,function(e,t){return e?n(e):(arguments.length>2&&(t=d.call(arguments,1)),void r(t))})})}function a(e){return Promise.all(e.map(i,this))}function s(e){for(var t=new e.constructor,r=Object.keys(e),n=[],o=0;o<r.length;o++){var a=r[o],s=i.call(this,e[a]);s&&l(s)?function(e,r){t[r]=void 0,n.push(e.then(function(e){t[r]=e}))}(s,a):t[a]=e[a]}return Promise.all(n).then(function(){return t})}function l(e){return"function"==typeof e.then}function u(e){return"function"==typeof e.next&&"function"==typeof e.throw}function c(e){var t=e.constructor;return!!t&&("GeneratorFunction"===t.name||"GeneratorFunction"===t.displayName||u(t.prototype))}function h(e){return Object==e.constructor}var d=Array.prototype.slice;t.exports=n.default=n.co=n,n.wrap=function(e){function t(){return n.call(this,e.apply(this,arguments))}return t.__generatorFunction__=e,t}},{}],48:[function(e,t,r){var n="undefined"!=typeof JSON?JSON:e("jsonify");t.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var r=t.space||"";"number"==typeof r&&(r=Array(r+1).join(" "));var a="boolean"==typeof t.cycles&&t.cycles,s=t.replacer||function(e,t){return t},l=t.cmp&&function(e){return function(t){return function(r,n){return e({key:r,value:t[r]},{key:n,value:t[n]})}}}(t.cmp),u=[];return function e(t,c,h,d){var p=r?"\n"+new Array(d+1).join(r):"",f=r?": ":":";if(h&&h.toJSON&&"function"==typeof h.toJSON&&(h=h.toJSON()),void 0!==(h=s.call(t,c,h))){if("object"!=typeof h||null===h)return n.stringify(h);if(i(h)){for(var m=[],v=0;v<h.length;v++){var y=e(h,v,h[v],d+1)||n.stringify(null);m.push(p+r+y)}return"["+m.join(",")+p+"]"}if(-1!==u.indexOf(h)){if(a)return n.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}u.push(h);for(var g=o(h).sort(l&&l(h)),m=[],v=0;v<g.length;v++){var b=e(h,c=g[v],h[c],d+1);if(b){var w=n.stringify(c)+f+b;m.push(p+r+w)}}return u.splice(u.indexOf(h),1),"{"+m.join(",")+p+"}"}}({"":e},"",e,0)};var i=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},o=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},r=[];for(var n in e)t.call(e,n)&&r.push(n);return r}},{jsonify:49}],49:[function(e,t,r){r.parse=e("./lib/parse"),r.stringify=e("./lib/stringify")},{"./lib/parse":50,"./lib/stringify":51}],50:[function(e,t,r){var n,i,o,a,s={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},l=function(e){throw{name:"SyntaxError",message:e,at:n,text:o}},u=function(e){return e&&e!==i&&l("Expected '"+e+"' instead of '"+i+"'"),i=o.charAt(n),n+=1,i},c=function(){var e,t="";for("-"===i&&(t="-",u("-"));i>="0"&&i<="9";)t+=i,u();if("."===i)for(t+=".";u()&&i>="0"&&i<="9";)t+=i;if("e"===i||"E"===i)for(t+=i,u(),"-"!==i&&"+"!==i||(t+=i,u());i>="0"&&i<="9";)t+=i,u();return e=+t,isFinite(e)?e:void l("Bad number")},h=function(){var e,t,r,n="";if('"'===i)for(;u();){if('"'===i)return u(),n;if("\\"===i)if(u(),"u"===i){for(r=0,t=0;t<4&&(e=parseInt(u(),16),isFinite(e));t+=1)r=16*r+e;n+=String.fromCharCode(r)}else{if("string"!=typeof s[i])break;n+=s[i]}else n+=i}l("Bad string")},d=function(){for(;i&&i<=" ";)u()},p=function(){switch(i){case"t":return u("t"),u("r"),u("u"),u("e"),!0;case"f":return u("f"),u("a"),u("l"),u("s"),u("e"),!1;case"n":return u("n"),u("u"),u("l"),u("l"),null}l("Unexpected '"+i+"'")},f=function(){var e=[];if("["===i){if(u("["),d(),"]"===i)return u("]"),e;for(;i;){if(e.push(a()),d(),"]"===i)return u("]"),e;u(","),d()}}l("Bad array")},m=function(){var e,t={};if("{"===i){if(u("{"),d(),"}"===i)return u("}"),t;for(;i;){if(e=h(),d(),u(":"),Object.hasOwnProperty.call(t,e)&&l('Duplicate key "'+e+'"'),t[e]=a(),d(),"}"===i)return u("}"),t;u(","),d()}}l("Bad object")};a=function(){switch(d(),i){case"{":return m();case"[":return f();case'"':return h();case"-":return c();default:return i>="0"&&i<="9"?c():p()}},t.exports=function(e,t){var r;return o=e,n=0,i=" ",r=a(),d(),i&&l("Syntax error"),"function"==typeof t?function e(r,n){var i,o,a=r[n];if(a&&"object"==typeof a)for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&(void 0!==(o=e(a,i))?a[i]=o:delete a[i]);return t.call(r,n,a)}({"":r},""):r}},{}],51:[function(e,t,r){function n(e){return l.lastIndex=0,l.test(e)?'"'+e.replace(l,function(e){var t=u[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function i(e,t){var r,l,u,c,h,d=o,p=t[e];switch(p&&"object"==typeof p&&"function"==typeof p.toJSON&&(p=p.toJSON(e)),"function"==typeof s&&(p=s.call(t,e,p)),typeof p){case"string":return n(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(o+=a,h=[],"[object Array]"===Object.prototype.toString.apply(p)){for(c=p.length,r=0;r<c;r+=1)h[r]=i(r,p)||"null";return u=0===h.length?"[]":o?"[\n"+o+h.join(",\n"+o)+"\n"+d+"]":"["+h.join(",")+"]",o=d,u}if(s&&"object"==typeof s)for(c=s.length,r=0;r<c;r+=1)"string"==typeof(l=s[r])&&(u=i(l,p))&&h.push(n(l)+(o?": ":":")+u);else for(l in p)Object.prototype.hasOwnProperty.call(p,l)&&(u=i(l,p))&&h.push(n(l)+(o?": ":":")+u);return u=0===h.length?"{}":o?"{\n"+o+h.join(",\n"+o)+"\n"+d+"}":"{"+h.join(",")+"}",o=d,u}}var o,a,s,l=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,u={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};t.exports=function(e,t,r){var n;if(o="",a="","number"==typeof r)for(n=0;n<r;n+=1)a+=" ";else"string"==typeof r&&(a=r);if(s=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return i("",{"":e})}},{}],ajv:[function(e,t,r){"use strict";function n(e){if(!(this instanceof n))return new n(e);e=this._opts=j.copy(e)||{},this._schemas={},this._refs={},this._fragments={},this._formats=I(e.format);var t=this._schemaUriFormat=this._formats["uri-reference"];this._schemaUriFormatFunc=function(e){return t.test(e)},this._cache=e.cache||new A,this._loadingSchemas={},this._compilations=[],this.RULES=D(),this._getId=y(e),e.loopRequired=e.loopRequired||1/0,"property"==e.errorDataPath&&(e._errorDataPathProperty=!0),void 0===e.serialize&&(e.serialize=O),this._metaOpts=T(this),e.formats&&N(this),x(this),"object"==typeof e.meta&&this.addMetaSchema(e.meta),S(this),e.patternGroups&&L(this)}function i(e,t){var r;if("string"==typeof e){if(!(r=this.getSchema(e)))throw new Error('no schema with key or ref "'+e+'"')}else{var n=this._addSchema(e);r=n.validate||this._compile(n)}var i=r(t);return!0===r.$async?"*"==this._opts.async?F(i):i:(this.errors=r.errors,i)}function o(e,t){var r=this._addSchema(e,void 0,t);return r.validate||this._compile(r)}function a(e,t,r,n){if(Array.isArray(e))for(var i=0;i<e.length;i++)this.addSchema(e[i],void 0,r,n);else{var o=this._getId(e);if(void 0!==o&&"string"!=typeof o)throw new Error("schema id must be string");C(this,t=k.normalizeId(t||o)),this._schemas[t]=this._addSchema(e,r,n,!0)}}function s(e,t,r){this.addSchema(e,t,r,!0)}function l(e,t){var r=e.$schema;if(void 0!==r&&"string"!=typeof r)throw new Error("$schema must be a string");if(!(r=r||this._opts.defaultMeta||u(this)))return console.warn("meta-schema not available"),this.errors=null,!0;var n=this._formats.uri;this._formats.uri="function"==typeof n?this._schemaUriFormatFunc:this._schemaUriFormat;var i;try{i=this.validate(r,e)}finally{this._formats.uri=n}if(!i&&t){var o="schema is invalid: "+this.errorsText();if("log"!=this._opts.validateSchema)throw new Error(o);console.error(o)}return i}function u(e){var t=e._opts.meta;return e._opts.defaultMeta="object"==typeof t?e._getId(t)||t:e.getSchema(H)?H:void 0}function c(e){var t=d(this,e);switch(typeof t){case"object":return t.validate||this._compile(t);case"string":return this.getSchema(t);case"undefined":return h(this,e)}}function h(e,t){var r=k.schema.call(e,{schema:{}},t);if(r){var n=r.schema,i=r.root,o=r.baseId,a=P.call(e,n,i,void 0,o);return e._fragments[t]=new R({ref:t,fragment:!0,schema:n,root:i,baseId:o,validate:a}),a}}function d(e,t){return t=k.normalizeId(t),e._schemas[t]||e._refs[t]||e._fragments[t]}function p(e){if(e instanceof RegExp)return f(this,this._schemas,e),void f(this,this._refs,e);switch(typeof e){case"undefined":return f(this,this._schemas),f(this,this._refs),void this._cache.clear();case"string":var t=d(this,e);return t&&this._cache.del(t.cacheKey),delete this._schemas[e],void delete this._refs[e];case"object":var r=this._opts.serialize,n=r?r(e):e;this._cache.del(n);var i=this._getId(e);i&&(i=k.normalizeId(i),delete this._schemas[i],delete this._refs[i])}}function f(e,t,r){for(var n in t){var i=t[n];i.meta||r&&!r.test(n)||(e._cache.del(i.cacheKey),delete t[n])}}function m(e,t,r,n){if("object"!=typeof e&&"boolean"!=typeof e)throw new Error("schema should be object or boolean");var i=this._opts.serialize,o=i?i(e):e,a=this._cache.get(o);if(a)return a;n=n||!1!==this._opts.addUsedSchema;var s=k.normalizeId(this._getId(e));s&&n&&C(this,s);var l,u=!1!==this._opts.validateSchema&&!t;u&&!(l=s&&s==k.normalizeId(e.$schema))&&this.validateSchema(e,!0);var c=k.ids.call(this,e),h=new R({id:s,schema:e,localRefs:c,cacheKey:o,meta:r});return"#"!=s[0]&&n&&(this._refs[s]=h),this._cache.put(o,h),u&&l&&this.validateSchema(e,!0),h}function v(e,t){function r(){var t=e.validate,n=t.apply(null,arguments);return r.errors=t.errors,n}if(e.compiling)return e.validate=r,r.schema=e.schema,r.errors=null,r.root=t||r,!0===e.schema.$async&&(r.$async=!0),r;e.compiling=!0;var n;e.meta&&(n=this._opts,this._opts=this._metaOpts);var i;try{i=P.call(this,e.schema,t,e.localRefs)}finally{e.compiling=!1,e.meta&&(this._opts=n)}return e.validate=i,e.refs=i.refs,e.refVal=i.refVal,e.root=i.root,i}function y(e){switch(e.schemaId){case"$id":return b;case"id":return g;default:return w}}function g(e){return e.$id&&console.warn("schema $id ignored",e.$id),e.id}function b(e){return e.id&&console.warn("schema id ignored",e.id),e.$id}function w(e){if(e.$id&&e.id&&e.$id!=e.id)throw new Error("schema $id is different from id");return e.$id||e.id}function _(e,t){if(!(e=e||this.errors))return"No errors";for(var r=void 0===(t=t||{}).separator?", ":t.separator,n=void 0===t.dataVar?"data":t.dataVar,i="",o=0;o<e.length;o++){var a=e[o];a&&(i+=n+a.dataPath+" "+a.message+r)}return i.slice(0,-r.length)}function E(e,t){"string"==typeof t&&(t=new RegExp(t)),this._formats[e]=t}function x(t){var r;if(t._opts.$data&&(r=e("./refs/$data.json"),t.addMetaSchema(r,r.$id,!0)),!1!==t._opts.meta){var n=e("./refs/json-schema-draft-06.json");t._opts.$data&&(n=M(n,$)),t.addMetaSchema(n,H,!0),t._refs["http://json-schema.org/schema"]=H}}function S(e){var t=e._opts.schemas;if(t)if(Array.isArray(t))e.addSchema(t);else for(var r in t)e.addSchema(t[r],r)}function N(e){for(var t in e._opts.formats){var r=e._opts.formats[t];e.addFormat(t,r)}}function C(e,t){if(e._schemas[t]||e._refs[t])throw new Error('schema with key or id "'+t+'" already exists')}function T(e){for(var t=j.copy(e._opts),r=0;r<W.length;r++)delete t[W[r]];return t}var P=e("./compile"),k=e("./compile/resolve"),A=e("./cache"),R=e("./compile/schema_obj"),O=e("json-stable-stringify"),I=e("./compile/formats"),D=e("./compile/rules"),M=e("./$data"),L=e("./patternGroups"),j=e("./compile/util"),F=e("co");t.exports=n,n.prototype.validate=i,n.prototype.compile=o,n.prototype.addSchema=a,n.prototype.addMetaSchema=s,n.prototype.validateSchema=l,n.prototype.getSchema=c,n.prototype.removeSchema=p,n.prototype.addFormat=E,n.prototype.errorsText=_,n.prototype._addSchema=m,n.prototype._compile=v,n.prototype.compileAsync=e("./compile/async");var B=e("./keyword");n.prototype.addKeyword=B.add,n.prototype.getKeyword=B.get,n.prototype.removeKeyword=B.remove;var V=e("./compile/error_classes");n.ValidationError=V.Validation,n.MissingRefError=V.MissingRef,n.$dataMetaSchema=M;var H="http://json-schema.org/draft-06/schema",W=["removeAdditional","useDefaults","coerceTypes"],$=["/properties"]},{"./$data":1,"./cache":2,"./compile":8,"./compile/async":4,"./compile/error_classes":6,"./compile/formats":7,"./compile/resolve":9,"./compile/rules":10,"./compile/schema_obj":11,"./compile/util":13,"./keyword":37,"./patternGroups":38,"./refs/$data.json":39,"./refs/json-schema-draft-06.json":40,co:47,"json-stable-stringify":48}]},{},[])("ajv")}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("salve",[],t):"object"==typeof exports?exports.salve=t():e.salve=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=31)}([function(e,t,r){function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]}function i(e,t){e.prototype.newWalker=function(e){return new t(this,e)}}function o(e){return e.hash()}function a(e){function t(e){return e}e instanceof _.NaiveSet&&(e=e.toArray());var r=new c.HashMap(t);e.forEach(function(e){for(var n=e.params,i=r,o=0;o<n.length;++o)if(o===n.length-1)i.add(n[o],!1);else{var a=i.has(n[o]);void 0===a&&(a=new c.HashMap(t),i.add(n[o],a)),i=a}});var n=function(){var e="",t="    ";return function(r){var i="",o=r.keys();o.sort();for(var a=0,s=o;a<s.length;a++){var l=s[a],u=r.has(l);u!==!1?(i+=""+e+l+":\n",e+=t,i+=n(r.has(l)),e=e.slice(t.length)):i+=""+e+l+"\n"}return i}}();return n(r)}function s(e,t){if(void 0===t&&(t=""),e instanceof c.HashMap)return e;throw new Error("did not get a HashMap "+t)}function l(e,t){if(void 0===t&&(t=""),e instanceof h.NameResolver)return e;throw new Error("did not get a HashMap "+t)}var u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var c=r(8),h=r(3),d=r(30),p=!1;if(p){var f=function(e){console.log(e)},m=function(){f((new Error).stack)};n(m);var v,y,g,b;!function(){var e="",t=" ",r=function(e){var t=e.el;if(null==t)return"";if(void 0===t.name)return" with path "+t.xmlPath;var r=" named "+t.name.toString();return null==e.boundName?r:r+" (bound to "+e.boundName.toString()+")"};b=function(t,n,i){f(""+e+t+n+" on class "+i.constructor.name+(" id "+i.id+r(i)))},v=function(r,n,i){e+=t,b("calling ",n,this);var o=r.apply(this,i);return b("called ",n,this),f(e+"return from the call: "+d.inspect(o)),e=e.slice(t.length),o},y=function(r,n,i){e+=t,b("calling ",n,this),f(e+d.inspect(i[0]));var o=r.apply(this,i);return b("called ",n,this),o!==!1&&f(e+"return from the call: "+d.inspect(o)),e=e.slice(t.length),o},g=function(r,n,i){e+=t,b("calling ",n,this);var o=r.apply(this,i);return b("called ",n,this),f(e+"return from the call: "+d.inspect(o)),e=e.slice(t.length),o}}();var w=function(e,t,r){var n="___"+t;e[n]=e[t],e[t]=function(){return r.call(this,e[n],t,arguments)}};n(w)}t.addWalker=i;var _=r(13),E=r(13);t.EventSet=E.NaiveSet;var x=function(){function e(e){this.id="P"+this.__newID(),this.xmlPath=e}return e.prototype.hash=function(){return this.id},e.prototype._resolve=function(e){},e.prototype._prepare=function(e){},e.prototype._hasAttrs=function(){return!1},e.prototype._gatherElementDefinitions=function(e){},e.prototype.__newID=function(){return e.__id++},e}();x.__id=0,t.BasePattern=x;var S=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.newWalker=function(e){throw new Error("derived classes must override this")},t}(x);t.Pattern=S;var N=function(e){function t(t,r){var n=e.call(this,t)||this;return n.pat=r,n}return u(t,e),t.prototype._resolve=function(e){return this.pat._resolve(e)},t.prototype._prepare=function(e){this.pat._prepare(e)},t.prototype._hasAttrs=function(){return this.pat._hasAttrs()},t.prototype._gatherElementDefinitions=function(e){this.pat._gatherElementDefinitions(e)},t}(S);t.OneSubpattern=N;var C=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.patA=r,i.patB=n,i}return u(t,e),t.prototype._resolve=function(e){var t=this.patA._resolve(e),r=this.patB._resolve(e);return void 0!==t&&void 0!==r?t.concat(r):void 0!==t?t:r},t.prototype._prepare=function(e){this.patA._prepare(e),this.patB._prepare(e)},t.prototype._hasAttrs=function(){return this.patA._hasAttrs()||this.patB._hasAttrs()},t.prototype._gatherElementDefinitions=function(e){this.patA._gatherElementDefinitions(e),this.patB._gatherElementDefinitions(e)},t}(S);t.TwoSubpatterns=C;var T=function(){function e(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=1===t.length&&t[0]instanceof Array?t[0]:t,i=n.join(),o=e.__cache[i];return void 0!==o?o:(this.id="E"+this.__newID(),this.params=n,this.key=i,e.__cache[i]=this,this)}return e.prototype.hash=function(){return this.id},e.prototype.isAttributeEvent=function(){return"attributeName"===this.params[0]||"attributeValue"===this.params[0]},e.prototype.toString=function(){return"Event: "+this.params.join(", ")},e.prototype.__newID=function(){return e.__id++},e}();T.__cache=Object.create(null),T.__id=0,t.Event=T,t.eventsToTreeString=a,t.emptyEvent=new T("<empty>");var P=function(){function e(t){this.id="W"+this.__newID(),this.suppressedAttributes=!1,t instanceof e?(this.el=t.el,this.possibleCached=t.possibleCached,this.suppressedAttributes=t.suppressedAttributes):this.el=t,p&&(w(this,"_possible",v),w(this,"fireEvent",y),w(this,"end",g),w(this,"_suppressAttributes",g),w(this,"_clone",g))}return e.prototype.hash=function(){return this.id},e.prototype.possible=function(){return new _.NaiveSet(this._possible())},e.prototype.canEnd=function(e){return void 0===e&&(e=!1),!0},e.prototype.end=function(e){return void 0===e&&(e=!1),!1},e.prototype.clone=function(){return this._clone(new c.HashMap(o))},e.prototype._clone=function(e){return new this.constructor(this,e)},e.prototype._suppressAttributes=function(){this.suppressedAttributes=!0},e.prototype._cloneIfNeeded=function(e,t){var r=t.has(e);return void 0!==r?r:(r=e.clone(),t.add(e,r),r)},e.prototype.__newID=function(){return e.__id++},e}();P.__id=0,t.Walker=P,t.isHashMap=s,t.isNameResolver=l;var k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype._possible=function(){return this.subwalker.possible()},t.prototype.fireEvent=function(e){return this.subwalker.fireEvent(e)},t.prototype._suppressAttributes=function(){this.suppressedAttributes||(this.suppressedAttributes=!0,this.subwalker._suppressAttributes())},t.prototype.canEnd=function(e){return void 0===e&&(e=!1),this.subwalker.canEnd(e)},t.prototype.end=function(e){return void 0===e&&(e=!1),this.subwalker.end(e)},t}(P);t.SingleSubwalker=k;var A=function(e){function t(t,r){var n=e.call(this,t)||this;return n.name=r,n}return u(t,e),t.prototype._prepare=function(){},t.prototype._resolve=function(e){if(this.resolvesTo=e[this.name],void 0===this.resolvesTo)return[this]},t.prototype.newWalker=function(e){return this.resolvesTo.pat.newWalker(e)},t}(S);t.Ref=A;var R=function(e){function t(t,r,n){var i=e.call(this,t,n)||this;return i.name=r,i}return u(t,e),t}(N);t.Define=R;var O=function(e){function t(r,n){var i=this;if(r instanceof t){var o=r,a=s(n);i=e.call(this,o,a)||this,i.nameResolver=i._cloneIfNeeded(o.nameResolver,a),i.subwalker=o.subwalker._clone(a)}else{var u=r,c=l(n);i=e.call(this,u)||this,i.nameResolver=c,i.subwalker=u.pat.newWalker(i.nameResolver)}return i}return u(t,e),t}(k);i(R,O)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.msg=e}return e.prototype.toString=function(){return this.msg},e.prototype.getNames=function(){return[]},e.prototype.toStringWithNames=function(e){return this.msg},e}();t.ValidationError=i;var o=function(e){function t(t,r){var n=e.call(this,t)||this;return n.name=r,n}return n(t,e),t.prototype.toString=function(){return this.toStringWithNames([this.name])},t.prototype.getNames=function(){return[this.name]},t.prototype.toStringWithNames=function(e){return this.msg+": "+e[0]},t}(i);t.SingleNameError=o;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(o);t.AttributeNameError=a;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(o);t.AttributeValueError=s;var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(o);t.ElementNameError=l;var u=function(e){function t(t,r){var n=e.call(this,"")||this;return n.namesA=t,n.namesB=r,n}return n(t,e),t.prototype.toString=function(){return this.toStringWithNames(this.namesA.concat(this.namesB))},t.prototype.getNames=function(){return this.namesA.concat(this.namesB)},t.prototype.toStringWithNames=function(e){var t=e.slice(0,this.namesA.length),r=e.slice(this.namesA.length);return"must choose either "+t.join(", ")+" or "+r.join(", ")},t}(i);t.ChoiceError=u},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{
value:!0});var i=function(){function e(e){this.path=e}return e.prototype.getNamespaces=function(){var e=Object.create(null);return this._recordNamespaces(e),Object.keys(e)},e.prototype.toJSON=function(){return this.toObject()},e.prototype.toString=function(){return JSON.stringify(this)},e}();t.Base=i;var o=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.ns=r,i.name=n,i}return n(t,e),t.prototype.match=function(e,t){return this.ns===e&&this.name===t},t.prototype.wildcardMatch=function(e,t){return!1},t.prototype.toObject=function(){return{ns:this.ns,name:this.name}},t.prototype.simple=function(){return!0},t.prototype.toArray=function(){return[this]},t.prototype._recordNamespaces=function(e){e[this.ns]=1},t}(i);t.Name=o;var a=function(e){function t(t,r){var n=e.call(this,t)||this;return n.a=r[0],n.b=r[1],n}return n(t,e),t.prototype.match=function(e,t){return this.a.match(e,t)||this.b.match(e,t)},t.prototype.wildcardMatch=function(e,t){return this.a.wildcardMatch(e,t)||this.b.wildcardMatch(e,t)},t.prototype.toObject=function(){return{a:this.a.toObject(),b:this.b.toObject()}},t.prototype.simple=function(){return this.a.simple()&&this.b.simple()},t.prototype.toArray=function(){var e=this.a.toArray();if(null===e)return null;var t=this.b.toArray();return null===t?null:e.concat(t)},t.prototype._recordNamespaces=function(e){this.a._recordNamespaces(e),this.b._recordNamespaces(e)},t}(i);t.NameChoice=a;var s=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.ns=r,i.except=n,i}return n(t,e),t.prototype.match=function(e,t){return this.ns===e&&!(void 0!==this.except&&this.except.match(e,t))},t.prototype.wildcardMatch=function(e,t){return this.match(e,t)},t.prototype.toObject=function(){var e={ns:this.ns};return void 0!==this.except&&(e.except=this.except.toObject()),e},t.prototype.simple=function(){return!1},t.prototype.toArray=function(){return null},t.prototype._recordNamespaces=function(e){e[this.ns]=1,void 0!==this.except&&(e["::except"]=1)},t}(i);t.NsName=s;var l=function(e){function t(t,r){var n=e.call(this,t)||this;return n.except=r,n}return n(t,e),t.prototype.match=function(e,t){return void 0===this.except||!this.except.match(e,t)},t.prototype.wildcardMatch=function(e,t){return this.match(e,t)},t.prototype.toObject=function(){var e={pattern:"AnyName"};return void 0!==this.except&&(e.except=this.except.toObject()),e},t.prototype.simple=function(){return!1},t.prototype.toArray=function(){return null},t.prototype._recordNamespaces=function(e){e["*"]=1,void 0!==this.except&&(e["::except"]=1)},t}(i);t.AnyName=l},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(4);t.XML1_NAMESPACE="http://www.w3.org/XML/1998/namespace",t.XMLNS_NAMESPACE="http://www.w3.org/2000/xmlns/";var i=function(){function e(){this.forward=Object.create(null),this.backwards=Object.create(null)}return e}(),o=function(){function e(e){this.id="N"+this.__newID(),void 0!==e?this._contextStack=e._contextStack.slice():(this._contextStack=[],this.enterContext(),this._contextStack[0].forward.xml=t.XML1_NAMESPACE,this._contextStack[0].backwards[t.XML1_NAMESPACE]=["xml"],this._contextStack[0].forward.xmlns=t.XMLNS_NAMESPACE,this._contextStack[0].backwards[t.XMLNS_NAMESPACE]=["xmlns"])}return e.prototype.hash=function(){return this.id},e.prototype.clone=function(){return new e(this)},e.prototype.definePrefix=function(e,r){if("xmlns"===e)throw new Error("trying to define 'xmlns' but the XML Namespaces standard stipulates that 'xmlns' cannot be declared (= \"defined\")");if("xml"===e&&r!==t.XML1_NAMESPACE)throw new Error("trying to define 'xml' to an incorrect URI");this._contextStack[0].forward[e]=r;var n=this._contextStack[0].backwards[r];void 0===n&&(n=this._contextStack[0].backwards[r]=[]),""===e?n.unshift(""):n.push(e)},e.prototype.enterContext=function(){this._contextStack.unshift(new i)},e.prototype.leaveContext=function(){if(!(this._contextStack.length>1))throw new Error("trying to leave the default context");this._contextStack.shift()},e.prototype.resolveName=function(e,t){void 0===t&&(t=!1);var r=e.split(":");if(1===r.length){if(t)return new n.EName("",e);r=["",e]}if(r.length>2)throw new Error("invalid name passed to resolveName");for(var i,o=0;void 0===i&&o<this._contextStack.length;++o){var a=this._contextStack[o];i=a.forward[r[0]]}return void 0===i?""===r[0]?new n.EName("",r[1]):void 0:new n.EName(i,r[1])},e.prototype.unresolveName=function(e,t){if(""===e)return t;for(var r,n=0;void 0===r&&n<this._contextStack.length;++n){var i=this._contextStack[n];r=i.backwards[e]}if(void 0!==r){var o=r[0];return""!==o?o+":"+t:t}},e.prototype.prefixFromURI=function(e){for(var t,r=0;void 0===t&&r<this._contextStack.length;++r){var n=this._contextStack[r];t=n.backwards[e]}if(void 0!==t)return t[0]},e.prototype.__newID=function(){return e.__id++},e}();o.__id=0,t.NameResolver=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.ns=e,this.name=t}return e.prototype.toString=function(){return"{"+this.ns+"}"+this.name},e.prototype.equal=function(e){return this.ns===e.ns&&this.name===e.name},e}();t.EName=n},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(7),o=function(){function e(e){this.message=e}return e.prototype.toString=function(){return this.message},e}();t.ParamError=o;var a=function(){function e(e){this.message=e}return e.prototype.toString=function(){return this.message},e}();t.ValueError=a;var s=function(e){function t(r,n){var o=e.call(this)||this;o.errors=n;var a=r+": "+n.map(function(e){return e.toString()}).join("\n"),s=new Error(a);return o.name="ParameterParsingError",o.stack=s.stack,o.message=s.message,i.fixPrototype(o,t),o}return n(t,e),t}(Error);t.ParameterParsingError=s;var l=function(e){function t(r){var n=e.call(this)||this;n.errors=r;var o=r.map(function(e){return e.toString()}).join("\n"),a=new Error(o);return n.name="ValueValidationError",n.stack=a.stack,n.message=a.message,i.fixPrototype(n,t),n}return n(t,e),t}(Error);t.ValueValidationError=l},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(i.Pattern);t.NotAllowed=o;var a=function(e){function t(r,n){var o=this;if(r instanceof t){var a=r;n=i.isHashMap(n),o=e.call(this,a,n)||this}else{var s=r;o=e.call(this,s)||this,o.possibleCached=new i.EventSet}return o}return n(t,e),t.prototype.possible=function(){return new i.EventSet},t.prototype._possible=function(){return this.possibleCached},t.prototype.fireEvent=function(e){},t}(i.Walker);t.NotAllowedWalker=a,i.addWalker(o,a)},function(e,t,r){function n(e,t){for(var r in t)e[r]=t[r]}function i(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var i=0,o=t;i<o.length;i++){var a=o[i];n(e,a)}return e}function o(e,t){var r=void 0!==Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__;r!==t&&(void 0!==Object.setPrototypeOf?Object.setPrototypeOf(e,t.prototype):e.__proto__=t.prototype)}Object.defineProperty(t,"__esModule",{value:!0}),t.extend=i,t.fixPrototype=o},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t,r){if(this.hashF=t,this.backing=Object.create(null),this._size=0,void 0!==r)if(r instanceof e){for(var n=this.backing,i=r.backing,o=Object.keys(i),a=0,s=o;a<s.length;a++){var l=s[a];n[l]=i[l]}this._size=o.length}else if(r instanceof Array)for(var u=0,c=r;u<c.length;u++){var h=c[u];this.add(h)}else this.add(r)}return e.prototype.union=function(e){if(null!=e){if(!(e instanceof this.constructor))throw new Error("union invalid class object; my class "+this.constructor.name+" other class "+e.constructor.name);for(var t=e.backing,r=Object.keys(t),n=0,i=r;n<i.length;n++){var o=i[n];this._store(o,t[o])}}},e.prototype.forEach=function(e){for(var t=this.backing,r=Object.keys(t),n=0,i=r;n<i.length;n++){var o=i[n];e(t[o])}},e.prototype.size=function(){return this._size},e.prototype.filter=function(e){var t=new this.constructor;void 0===t.hashF&&(t.hashF=this.hashF);for(var r=this.backing,n=Object.keys(r),i=0,o=n;i<o.length;i++){var a=o[i],s=r[a],l=s instanceof Array?s:[s];e.apply(void 0,l)&&t._store(a,s)}return t},e.prototype.has=function(e){var t=this.hashF(e);return void 0!==this.backing[t]},e.prototype.toString=function(){return this.toArray().join(", ")},e.prototype.toArray=function(){for(var e=[],t=this.backing,r=Object.keys(t),n=0,i=r;n<i.length;n++){var o=i[n];e.push(t[o])}return e},e.prototype._store=function(e,t){if(null==e)throw new Error("undefined or null hash");void 0===this.backing[e]&&(this.backing[e]=t,this._size++)},e}();t.HashBase=i;var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.add=function(e){this._store(this.hashF(e),e)},t}(i);t.HashSet=o;var a=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.hashF=t,n}return n(t,e),t.prototype.add=function(e,t){this._store(this.hashF(e),[e,t])},t.prototype.forEach=function(e){for(var t=this.backing,r=Object.keys(t),n=0,i=r;n<i.length;n++){var o=i[n];e(t[o][0],t[o][1])}},t.prototype.has=function(e){var t=this.hashF(e),r=this.backing[t];if(void 0!==r)return r[1]},t.prototype.keys=function(){return Object.keys(this.backing)},t}(i);t.HashMap=a},function(e,t,r){function n(){return x}Object.defineProperty(t,"__esModule",{value:!0});var i=r(4),o=r(18),a=r(0),s=r(19),l=r(20),u=r(21),c=r(22),h=r(12),d=r(23),p=r(24),f=r(25),m=r(6),v=r(26),y=r(27),g=r(28),b=r(29),w=r(2),_=r(0);t.eventsToTreeString=_.eventsToTreeString,t.Event=_.Event,t.EventSet=_.EventSet,t.BasePattern=_.BasePattern,t.Walker=_.Walker;var E=r(12);t.Grammar=E.Grammar,t.GrammarWalker=E.GrammarWalker,t.RefError=E.RefError;var x={GrammarWalker:h.GrammarWalker,Text:g.Text};t.__test=n,t.__protected={Empty:c.Empty,Data:l.Data,List:f.List,Param:y.Param,Value:b.Value,NotAllowed:m.NotAllowed,Text:g.Text,Ref:a.Ref,OneOrMore:v.OneOrMore,Choice:s.Choice,Group:d.Group,Attribute:o.Attribute,Element:u.Element,Define:a.Define,Grammar:h.Grammar,EName:i.EName,Interleave:p.Interleave,Name:w.Name,NameChoice:w.NameChoice,NsName:w.NsName,AnyName:w.AnyName}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(15),i=r(17),o=function(){function e(){this.libraries=Object.create(null)}return e.prototype.add=function(e){var t=e.uri;if(t in this.libraries)throw new Error("URI clash: "+t);this.libraries[t]=e},e.prototype.find=function(e){return this.libraries[e]},e.prototype.get=function(e){var t=this.find(e);if(void 0===t)throw new Error("can't get library with URI: "+e);return t},e}();t.Registry=o,t.registry=new o,t.registry.add(n.builtin),t.registry.add(i.xmlschema);var a=r(5);t.ParameterParsingError=a.ParameterParsingError,t.ValueValidationError=a.ValueValidationError,t.ValueError=a.ValueError},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n="A-Z_a-zÀ-ÖØ-öø-ÿĀ-ıĴ-ľŁ-ňŊ-žƀ-ǃǍ-ǰǴ-ǵǺ-ȗɐ-ʨʻ-ˁΆΈ-ΊΌΎ-ΡΣ-ώϐ-ϖϚϜϞϠϢ-ϳЁ-ЌЎ-яё-ќў-ҁҐ-ӄӇ-ӈӋ-ӌӐ-ӫӮ-ӵӸ-ӹԱ-Ֆՙա-ֆא-תװ-ײء-غف-يٱ-ڷں-ھۀ-ێې-ۓەۥ-ۦअ-हऽक़-ॡঅ-ঌএ-ঐও-নপ-রলশ-হড়-ঢ়য়-ৡৰ-ৱਅ-ਊਏ-ਐਓ-ਨਪ-ਰਲ-ਲ਼ਵ-ਸ਼ਸ-ਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઋઍએ-ઑઓ-નપ-રલ-ળવ-હઽૠଅ-ଌଏ-ଐଓ-ନପ-ରଲ-ଳଶ-ହଽଡ଼-ଢ଼ୟ-ୡஅ-ஊஎ-ஐஒ-கங-சஜஞ-டண-தந-பம-வஷ-ஹఅ-ఌఎ-ఐఒ-నప-ళవ-హౠ-ౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹೞೠ-ೡഅ-ഌഎ-ഐഒ-നപ-ഹൠ-ൡก-ฮะา-ำเ-ๅກ-ຂຄງ-ຈຊຍດ-ທນ-ຟມ-ຣລວສ-ຫອ-ຮະາ-ຳຽເ-ໄཀ-ཇཉ-ཀྵႠ-Ⴥა-ჶᄀᄂ-ᄃᄅ-ᄇᄉᄋ-ᄌᄎ-ᄒᄼᄾᅀᅌᅎᅐᅔ-ᅕᅙᅟ-ᅡᅣᅥᅧᅩᅭ-ᅮᅲ-ᅳᅵᆞᆨᆫᆮ-ᆯᆷ-ᆸᆺᆼ-ᇂᇫᇰᇹḀ-ẛẠ-ỹἀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼΩK-Å℮ↀ-ↂぁ-ゔァ-ヺㄅ-ㄬ가-힣",i="一-龥〇〡-〩";t.xmlLetter=n+i;var o="0-9٠-٩۰-۹०-९০-৯੦-੯૦-૯୦-୯௧-௯౦-౯೦-೯൦-൯๐-๙໐-໙༠-༩",a="̀-͠ͅ-҃͡-֑҆-֣֡-ֹֻ-ֽֿׁ-ׂًׄ-ْٰۖ-ۜ۝-۟۠-ۤۧ-۪ۨ-ۭँ-ः़ा-ौ्॑-॔ॢ-ॣঁ-ঃ়ািী-ৄে-ৈো-্ৗৢ-ৣਂ਼ਾਿੀ-ੂੇ-ੈੋ-੍ੰ-ੱઁ-ઃ઼ા-ૅે-ૉો-્ଁ-ଃ଼ା-ୃେ-ୈୋ-୍ୖ-ୗஂ-ஃா-ூெ-ைொ-்ௗఁ-ఃా-ౄె-ైొ-్ౕ-ౖಂ-ಃಾ-ೄೆ-ೈೊ-್ೕ-ೖം-ഃാ-ൃെ-ൈൊ-്ൗัิ-ฺ็-๎ັິ-ູົ-ຼ່-ໍ༘-༹༙༵༷༾༿ཱ-྄྆-ྋྐ-ྕྗྙ-ྭྱ-ྷྐྵ⃐-〪⃜⃡-゙゚〯",s="·ːˑ·ـๆໆ々〱-〵ゝ-ゞー-ヾ";t.xmlNameChar="-"+t.xmlLetter+o+"._:"+a+s;var l="["+t.xmlLetter+"_:](?:["+t.xmlNameChar+"])*";t.xmlNameRe=new RegExp("^"+l+"$"),t.xmlNcname="["+t.xmlLetter+"_](?:[-"+t.xmlLetter+o+"._"+a+(s+"])*"),t.xmlNcnameRe=new RegExp("^"+t.xmlNcname+"$")},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),o=r(2),a=r(3),s=r(7),l=r(0),u=function(e){function t(r){var n=e.call(this)||this;return n.references=r,s.fixPrototype(n,t),n}return n(t,e),t.prototype.toString=function(){return"Cannot resolve the following references: "+this.references.join(", ")},t}(Error);t.RefError=u;var c=function(e){function t(t,r,n){var i=e.call(this,t)||this;i.xmlPath=t,i.start=r,i.definitions=Object.create(null),i._namespaces=Object.create(null),void 0!==n&&n.forEach(function(e){i.add(e)});var o=i._resolve(i.definitions);if(void 0!==o)throw new u(o);return i._prepare(i._namespaces),i}return n(t,e),t.prototype.add=function(e){this.definitions[e.name]=e,"start"===e.name&&(this.start=e)},t.prototype._gatherElementDefinitions=function(e){for(var t in this.definitions)this.definitions[t]._gatherElementDefinitions(e)},Object.defineProperty(t.prototype,"elementDefinitions",{get:function(){var e=this._elementDefinitions;if(void 0!==e)return e;var t=this._elementDefinitions=Object.create(null);return this._gatherElementDefinitions(t),t},enumerable:!0,configurable:!0}),t.prototype.whollyContextIndependent=function(){var e=this.elementDefinitions;for(var t in e)if(e[t].length>1)return!1;return!0},t.prototype.getNamespaces=function(){return Object.keys(this._namespaces)},t.prototype._prepare=function(e){this.start._prepare(e);for(var t in this.definitions)this.definitions[t]._prepare(e)},t.prototype._resolve=function(e){var t,r=[];for(var n in e)t=e[n]._resolve(e),void 0!==t&&(r=r.concat(t));if(t=this.start._resolve(e),void 0!==t&&(r=r.concat(t)),0!==r.length)return r},t.prototype.newWalker=function(){return h.makeWalker(this)},t}(l.BasePattern);t.Grammar=c;var h=function(e){function t(r,n){var i=this;if(r instanceof t){var o=r;n=l.isHashMap(n),i=e.call(this,o,n)||this,i.nameResolver=i._cloneIfNeeded(o.nameResolver,n),i.subwalker=o.subwalker._clone(n);for(var s=i._misplacedElements=[],u=0,c=o._misplacedElements;u<c.length;u++){var h=c[u];s.push(h instanceof l.Walker?h._clone(n):h.concat([]))}i._swallowAttributeValue=o._swallowAttributeValue,i.suspendedWs=o.suspendedWs,i.ignoreNextWs=o.ignoreNextWs,i._prevEvWasText=o._prevEvWasText}else{var d=r;i=e.call(this,d)||this,i.nameResolver=new a.NameResolver,i._misplacedElements=[],i._swallowAttributeValue=!1,i.ignoreNextWs=!1,i._prevEvWasText=!1,i.subwalker=d.start.newWalker(i.nameResolver)}return i}return n(t,e),t.makeWalker=function(e){return new t(e)},t.prototype.resolveName=function(e,t){return this.nameResolver.resolveName(e,t)},t.prototype.unresolveName=function(e,t){return this.nameResolver.unresolveName(e,t)},t.prototype.fireEvent=function(e){function t(e){if(void 0===r&&(r=[new i.ValidationError("text not allowed here")]),r===!1)return e;if(e===!1)return r;if(void 0===e)throw new Error("undefined x");return r.concat(e)}var r=!1;if("enterContext"===e.params[0]||"leaveContext"===e.params[0]||"definePrefix"===e.params[0]){switch(e.params[0]){case"enterContext":this.nameResolver.enterContext();break;case"leaveContext":this.nameResolver.leaveContext();break;case"definePrefix":this.nameResolver.definePrefix(e.params[1],e.params[2]);break;default:throw new Error("unexpected event: "+e.params[0])}return!1}if("text"===e.params[0]&&""===e.params[1].trim())return void 0!==this.suspendedWs?this.suspendedWs+=e.params[1]:this.suspendedWs=e.params[1],!1;var n=this._misplacedElements.length>0&&this._misplacedElements[0]instanceof l.Walker?this._misplacedElements[0]:this.subwalker,a=this.ignoreNextWs;switch(this.ignoreNextWs=!1,e.params[0]){case"enterStartTag":this.suspendedWs=void 0;break;case"text":if(this._prevEvWasText)throw new Error("fired two text events in a row: this is disallowed by salve");if(a){this.suspendedWs=void 0;var s=e.params[1].replace(/^\s+/,"");s.length!==e.params[1].length&&(e=new l.Event("text",s))}else void 0!==this.suspendedWs&&""!==this.suspendedWs&&(r=n.fireEvent(new l.Event("text",this.suspendedWs)),this.suspendedWs=void 0);break;case"endTag":this.ignoreNextWs=!0;default:void 0===this.suspendedWs||""===this.suspendedWs||a||(r=n.fireEvent(new l.Event("text",this.suspendedWs))),this.suspendedWs=void 0}if(this._prevEvWasText="text"===e.params[0],this._misplacedElements.length>0&&this._misplacedElements[0]instanceof Array){var u=this._misplacedElements[0];switch(e.params[0]){case"enterStartTag":u.unshift(e.params.slice(1));break;case"endTag":u.shift()}return 0===u.length&&this._misplacedElements.shift(),!1}if(this._swallowAttributeValue)return this._swallowAttributeValue=!1,"attributeValue"!==e.params[0]&&[new i.ValidationError("attribute value required")];var c=n.fireEvent(e);if(void 0===c)switch(e.params[0]){case"enterStartTag":var h=new o.Name("",e.params[1],e.params[2]);c=[new i.ElementNameError("tag not allowed here",h)];var d=this.el.elementDefinitions[h.toString()];if(void 0!==d&&1===d.length){var p=d[0].newWalker(this.nameResolver);if(this._misplacedElements.unshift(p),p.fireEvent(e)!==!1)throw new Error("internal error: the infered element does not accept its initial event")}else this._misplacedElements.unshift([e.params.slice(1)]);break;case"endTag":c=[new i.ElementNameError("unexpected end tag",new o.Name("",e.params[1],e.params[2]))];break;case"attributeName":c=[new i.AttributeNameError("attribute not allowed here",new o.Name("",e.params[1],e.params[2]))],this._swallowAttributeValue=!0;break;case"attributeValue":c=[new i.ValidationError("unexpected attributeValue event; it is likely that fireEvent is incorrectly called")];break;case"text":c=[new i.ValidationError("text not allowed here")];break;case"leaveStartTag":default:throw new Error("unexpected event type in GrammarWalker's fireEvent: "+e.params[0].toString())}if(this._misplacedElements.length>0&&this._misplacedElements[0]instanceof l.Walker&&(n=this._misplacedElements[0],n.canEnd())){this._misplacedElements.shift();var f=n.end();f&&(c=c?c.concat(f):f)}return t(c)},t.prototype.possible=function(){if(0!==this._misplacedElements.length){var e=this._misplacedElements[0];return e instanceof l.Walker?e.possible():new l.EventSet}return this.subwalker.possible()},t.prototype._suppressAttributes=function(){throw new Error("_suppressAttributes cannot be called on a GrammarWalker")},t}(l.SingleSubwalker);t.GrammarWalker=h},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(t){if(null!=t)if(t instanceof e)this.b=t.b.concat([]);else if(t instanceof Array){this.b=[];for(var r=0,n=t;r<n.length;r++){var i=n[r];this.add(i)}}else this.b=[t];else this.b=[]}return e.prototype.add=function(e){var t=this.b.indexOf(e);t<0&&this.b.push(e)},e.prototype.union=function(t){if(null!=t){if(!(t instanceof e))throw new Error("union with non-NaiveSet");for(var r=t.b.length,n=0;n<r;++n)this.add(t.b[n])}},e.prototype.filter=function(e){var t=this,r=new this.constructor;return r.b=this.b.filter(function(r,n){return e(r,n,t)}),r},e.prototype.map=function(e){for(var t=new this.constructor,r=0;r<this.b.length;++r){var n=this.b[r],i=e(n,r,this);void 0!==i&&t.add(i)}return t},e.prototype.forEach=function(e){var t=this;this.b.forEach(function(r,n){e(r,n,t)})},e.prototype.toString=function(){return this.b.join(", ")},e.prototype.size=function(){return this.b.length},e.prototype.has=function(e){return this.b.indexOf(e)>=0},e.prototype.toArray=function(){return this.b.slice()},e}();t.NaiveSet=n},function(e,t,r){function n(e){var t="string"==typeof e?JSON.parse(e):e;if("object"==typeof t&&void 0===t.v)throw new h;var r=t.v,n=t.o,i=t.d;if(3===r)return new p(n).walkObject(i);throw new Error("unknown version: "+r)}var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(9),a=r(7),s=o.__protected,l=[Array,s.Empty,s.Data,s.List,s.Param,s.Value,s.NotAllowed,s.Text,s.Ref,s.OneOrMore,s.Choice,s.Group,s.Attribute,s.Element,s.Define,s.Grammar,s.EName,s.Interleave,s.Name,s.NameChoice,s.NsName,s.AnyName],u={0:Array,Empty:s.Empty,1:s.Empty,Data:s.Data,2:s.Data,List:s.List,3:s.List,Param:s.Param,4:s.Param,Value:s.Value,5:s.Value,NotAllowed:s.NotAllowed,6:s.NotAllowed,Text:s.Text,7:s.Text,Ref:s.Ref,8:s.Ref,OneOrMore:s.OneOrMore,9:s.OneOrMore,Choice:s.Choice,10:s.Choice,Group:s.Group,11:s.Group,Attribute:s.Attribute,12:s.Attribute,Element:s.Element,13:s.Element,Define:s.Define,14:s.Define,Grammar:s.Grammar,15:s.Grammar,EName:s.EName,16:s.EName,Interleave:s.Interleave,17:s.Interleave,Name:s.Name,18:s.Name,NameChoice:s.NameChoice,19:s.NameChoice,NsName:s.NsName,20:s.NsName,AnyName:s.AnyName,21:s.AnyName},c=1,h=function(e){function t(){var r=e.call(this,"your schema file must be recreated with a newer version of salve-convert")||this;return a.fixPrototype(r,t),r}return i(t,e),t}(Error),d=function(){function e(e){this.options=e}return e.prototype.walkObject=function(e){var t=e[0],r=l[t];if(void 0===r){if(e.length<1)throw new Error("array too small to contain object");throw new Error("undefined type: "+t)}if(r===Array)throw new Error("trying to build array with _constructObjectV2");var n,i=0!==(this.options&c)&&r!==s.EName;return e.length>1?(n=e.slice(1),i?n.unshift(0,""):n.unshift(0),this._transformArray(n)):n=i?[""]:[],this._processObject(r,n)},e.prototype._processObject=function(e,t){},e.prototype._transformArray=function(e){if(0!==e[0])throw new Error("array type not 0, but "+e[0]+" for array "+e);e.splice(0,1);for(var t=e.length,r=0;r<t;r++){var n=e[r];n instanceof Array&&(0!==n[0]?e[r]=this.walkObject(n):this._transformArray(n))}},e}();t.V2JSONWalker=d;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype._processObject=function(e,t){if(e===s.Data&&t.length>=4){var r=t[3];if(r.length%2!==0)throw new Error("parameter array length not a multiple of 2");for(var n=new Array(r.length/2),i=r.length,o=0;o<i;o+=2)n[o/2]={name:r[o],value:r[o+1]};t[3]=n}else if(e===s.OneOrMore){if(1!==t[1].length)throw new Error("OneOrMore with an array of patterns that contains other than 1 pattern");t=[t[0],t[1][0]]}else if(e===s.Attribute||e===s.Element||e===s.Define){if(1!==t[2].length)throw new Error("PatternOnePattern with an array of patterns that contains other than 1 pattern");t=[t[0],t[1],t[2][0]]}else if(e===s.Choice||e===s.Group||e===s.Interleave){if(2!==t[1].length)throw new Error("PatternTwoPatterns with an array of patterns that contains other than 2 pattern");t=[t[0],t[1][0],t[1][1]]}var a=Object.create(e.prototype),l=e.apply(a,t);return void 0!==l?l:a},t}(d);t.constructTree=n,t.__protected={V2JSONWalker:d,nameToConstructor:u,OPTION_NO_PATHS:c}},function(e,t,r){function n(e){return e.trim().replace(/\s{2,}/g," ")}var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(5),a=function(){function e(){}return e.prototype.parseParams=function(e,t){if(void 0!==t&&t.length>0)throw new o.ParameterParsingError(e,[new o.ParamError("this type does not accept parameters")])},e.prototype.parseValue=function(e){var t=this.disallows(e);if(t instanceof Array&&0!==t.length)throw new o.ValueValidationError(t);return{value:e}},e}(),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.regexp=/.*/,t.needsContext=!1,t}return i(t,e),t.prototype.equal=function(e,t){if(void 0===t.value)throw Error("it looks like you are trying to use an unparsed value");return e===t.value},t.prototype.disallows=function(e){return!1},t}(a),l=new s,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="token",t.needsContext=!1,t.regexp=/.*/,t}return i(t,e),t.prototype.equal=function(e,t){if(void 0===t.value)throw Error("it looks like you are trying to use an unparsed value");return n(e)===n(t.value)},t.prototype.disallows=function(e){return!1},t}(a),c=new u;t.builtin={uri:"",types:{string:l,token:c}}},function(e,t,r){(function(e,n){var i=function(){function e(e){var t=new Error(e);this.name="SalveParsingError",this.stack=t.stack,this.message=t.message}function n(t,r){throw new e(t)}function i(e){A.unshift({negative:e,capturedMultiChar:[]})}function o(){this.yy={}}var a=function(e,t,r,n){for(r=r||{},n=e.length;n--;r[e[n]]=t);return r},s=[1,8],l=[1,10],u=[1,13],c=[1,19],h=[1,20],d=[1,14],p=[1,15],f=[1,16],m=[1,17],v=[5,23],y=[5,8,20,22,23,26,30,31,42,43,44,45],g=[5,8,12,13,14,15,20,22,23,26,30,31,42,43,44,45],b=[5,8,12,13,14,15,20,22,23,26,29,30,31,36,38,40,41,42,43,44,45],w=[1,37],_=[1,39],E=[1,40],x=[38,40,41,42,43,44,45],S=[29,36,38,40,41,42,43,44,45],N={trace:function(){},yy:{},symbols_:{error:2,start:3,input:4,EOF:5,regexp:6,branch:7,"|":8,piece:9,atom:10,quantifier:11,"?":12,"*":13,"+":14,"{":15,quantity:16,"}":17,NUMBER:18,",":19,CHAR:20,charClass:21,"(":22,")":23,charClassEsc:24,charClassExpr:25,WILDCARDESC:26,charClassExprStart:27,charGroup:28,"]":29,"[":30,"[^":31,posCharGroups:32,charClassSub:33,posCharGroup:34,charRange:35,CLASSSUBTRACTION:36,seRange:37,"-":38,charOrEsc:39,XMLCHAR:40,SingleCharEsc:41,SINGLECHARESC:42,MULTICHARESC:43,CATESC:44,COMPLESC:45,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",8:"|",12:"?",13:"*",14:"+",15:"{",17:"}",18:"NUMBER",19:",",20:"CHAR",22:"(",23:")",26:"WILDCARDESC",29:"]",30:"[",31:"[^",36:"CLASSSUBTRACTION",38:"-",40:"XMLCHAR",41:"SingleCharEsc",42:"SINGLECHARESC",43:"MULTICHARESC",44:"CATESC",45:"COMPLESC"},productions_:[0,[3,1],[4,1],[4,2],[6,1],[6,3],[7,1],[7,2],[9,1],[9,2],[11,1],[11,1],[11,1],[11,3],[16,1],[16,3],[16,2],[10,1],[10,1],[10,3],[21,1],[21,1],[21,1],[25,3],[27,1],[27,1],[28,1],[28,1],[32,1],[32,2],[34,1],[34,1],[33,3],[35,1],[35,1],[37,3],[37,1],[39,1],[39,1],[24,1],[24,1],[24,1],[24,1]],performAction:function(e,t,r,o,a,s,l,u){var c=s.length-1;switch(a){case 1:switch(this.parseError=n,u=u||"re"){case"string":return s[c];case"re":var h=R.test(s[c])?T:RegExp;return new h(s[c]);default:throw new Error("unsupported output type: "+u)}break;case 2:this.$="^$";break;case 3:this.$="^"+s[c-1]+"$";break;case 5:case 13:case 35:this.$=s[c-2].concat(s[c-1],s[c]);break;case 7:case 9:case 29:this.$=s[c-1]+s[c];break;case 15:this.$=s[c-2].concat(",",s[c]);break;case 16:this.$=s[c-1].concat(s[c]);break;case 19:this.$="(?:"+s[c-1]+s[c];break;case 23:var d=A.shift(),p=d.capturedMultiChar,f=d.subtraction?"(?!"+d.subtraction+")":"";if(0!==p.length){var m=["(?:",f];if(d.negative){m.push("(?=[");for(var v=0;v<p.length;++v)m.push(O[p[v]].slice(1));m.push("])")}else for(var v=0;v<p.length;++v)m.push("[",O[p[v]],"]|");m.push(s[c-2],s[c-1],s[c],")"),this.$=m.join("")}else this.$=""!==f?"(?:"+f+s[c-2].concat(s[c-1],s[c])+")":s[c-2].concat(s[c-1],s[c]);break;case 24:i(!1),this.$=s[c];break;case 25:i(!0),this.$=s[c];break;case 32:this.$=s[c-2],A[0].subtraction=s[c];break;case 40:if(A.length){var y=O[s[c]];"^"===y.charAt(0)?(A[0].capturedMultiChar.push(s[c]),this.$=""):this.$=y}else this.$=I[s[c]]}},table:[{3:1,4:2,5:[1,3],6:4,7:5,9:6,10:7,20:s,21:9,22:l,24:11,25:12,26:u,27:18,30:c,31:h,42:d,43:p,44:f,45:m},{1:[3]},{1:[2,1]},{1:[2,2]},{5:[1,21]},a(v,[2,4],{10:7,21:9,24:11,25:12,27:18,9:23,8:[1,22],20:s,22:l,26:u,30:c,31:h,42:d,43:p,44:f,45:m}),a(y,[2,6]),a(y,[2,8],{11:24,12:[1,25],13:[1,26],14:[1,27],15:[1,28]}),a(g,[2,17]),a(g,[2,18]),{6:29,7:5,9:6,10:7,20:s,21:9,22:l,24:11,25:12,26:u,27:18,30:c,31:h,42:d,43:p,44:f,45:m},a(g,[2,20]),a(g,[2,21]),a(g,[2,22]),a(b,[2,39]),a(b,[2,40]),a(b,[2,41]),a(b,[2,42]),{24:34,28:30,32:31,33:32,34:33,35:35,37:36,38:w,39:38,40:_,41:E,42:d,43:p,44:f,45:m},a(x,[2,24]),a(x,[2,25]),{1:[2,3]},{6:41,7:5,9:6,10:7,20:s,21:9,22:l,24:11,25:12,26:u,27:18,30:c,31:h,42:d,43:p,44:f,45:m},a(y,[2,7]),a(y,[2,9]),a(y,[2,10]),a(y,[2,11]),a(y,[2,12]),{16:42,18:[1,43]},{23:[1,44]},{29:[1,45]},{24:34,29:[2,26],34:46,35:35,36:[1,47],37:36,38:w,39:38,40:_,41:E,42:d,43:p,44:f,45:m},{29:[2,27]},a(S,[2,28]),a(S,[2,30]),a(S,[2,31]),a(S,[2,33]),a(S,[2,34]),a([29,36,40,41,42,43,44,45],[2,36],{38:[1,48]}),a(S,[2,37]),a(S,[2,38]),a(v,[2,5]),{17:[1,49]},{17:[2,14],19:[1,50]},a(g,[2,19]),a([5,8,12,13,14,15,20,22,23,26,29,30,31,42,43,44,45],[2,23]),a(S,[2,29]),{25:51,27:18,30:c,31:h},{39:52,40:_,41:E},a(y,[2,13]),{17:[2,16],18:[1,53]},{29:[2,32]},a(S,[2,35]),{17:[2,15]}],defaultActions:{2:[2,1],3:[2,2],21:[2,3],32:[2,27],51:[2,32],53:[2,15]},parseError:function(e,t){function r(e,t){this.message=e,this.hash=t}if(!t.recoverable)throw r.prototype=Error,new r(e,t);this.trace(e)},parse:function(e){var t=this,r=[0],n=[null],i=[],o=this.table,a="",s=0,l=0,u=0,c=2,h=1,d=i.slice.call(arguments,1),p=Object.create(this.lexer),f={yy:{}};for(var m in this.yy)Object.prototype.hasOwnProperty.call(this.yy,m)&&(f.yy[m]=this.yy[m]);p.setInput(e,f.yy),f.yy.lexer=p,f.yy.parser=this,"undefined"==typeof p.yylloc&&(p.yylloc={});var v=p.yylloc;i.push(v);var y=p.options&&p.options.ranges;"function"==typeof f.yy.parseError?this.parseError=f.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var g,b,w,_,E,x,S,N,C,T=function(){var e;return e=p.lex()||h,"number"!=typeof e&&(e=t.symbols_[e]||e),e},P={};;){if(w=r[r.length-1],this.defaultActions[w]?_=this.defaultActions[w]:(null!==g&&"undefined"!=typeof g||(g=T()),_=o[w]&&o[w][g]),"undefined"==typeof _||!_.length||!_[0]){var k="";C=[];for(x in o[w])this.terminals_[x]&&x>c&&C.push("'"+this.terminals_[x]+"'");k=p.showPosition?"Parse error on line "+(s+1)+":\n"+p.showPosition()+"\nExpecting "+C.join(", ")+", got '"+(this.terminals_[g]||g)+"'":"Parse error on line "+(s+1)+": Unexpected "+(g==h?"end of input":"'"+(this.terminals_[g]||g)+"'"),this.parseError(k,{text:p.match,token:this.terminals_[g]||g,line:p.yylineno,loc:v,expected:C})}if(_[0]instanceof Array&&_.length>1)throw new Error("Parse Error: multiple actions possible at state: "+w+", token: "+g);switch(_[0]){case 1:r.push(g),n.push(p.yytext),i.push(p.yylloc),r.push(_[1]),g=null,b?(g=b,b=null):(l=p.yyleng,a=p.yytext,s=p.yylineno,v=p.yylloc,u>0&&u--);break;case 2:if(S=this.productions_[_[1]][1],P.$=n[n.length-S],P._$={first_line:i[i.length-(S||1)].first_line,last_line:i[i.length-1].last_line,first_column:i[i.length-(S||1)].first_column,last_column:i[i.length-1].last_column},y&&(P._$.range=[i[i.length-(S||1)].range[0],i[i.length-1].range[1]]),E=this.performAction.apply(P,[a,l,s,f.yy,_[1],n,i].concat(d)),
"undefined"!=typeof E)return E;S&&(r=r.slice(0,-1*S*2),n=n.slice(0,-1*S),i=i.slice(0,-1*S)),r.push(this.productions_[_[1]][0]),n.push(P.$),i.push(P._$),N=o[r[r.length-2]][r[r.length-1]],r.push(N);break;case 3:return!0}}return!0}},C=r(11),T=r(41);e.prototype=new Error,t.SalveParsingError=e;var P=C.xmlNameChar,k=C.xmlLetter,A=[],R=/\\p/i,O={"\\s":" \\t\\n\\r","\\S":"^ \\t\\n\\r","\\i":""+k+"_:","\\I":"^"+k+"_:","\\c":""+P,"\\C":"^"+P,"\\d":"\\p{Nd}","\\D":"^\\p{Nd}","\\w":"^\\p{P}\\p{Z}\\p{C}","\\W":"\\p{P}\\p{Z}\\p{C}"},I=[];for(var D in O)O.hasOwnProperty(D)&&(I[D]="["+O[D]+"]");var M=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,r=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t;var n=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),r.length-1&&(this.yylineno-=r.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:r?(r.length===n.length?this.yylloc.first_column:0)+n[n.length-r.length].length-r[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var r,n,i;if(this.options.backtrack_lexer&&(i={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(i.yylloc.range=this.yylloc.range.slice(0))),n=e[0].match(/(?:\r\n?|\n).*/g),n&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-n[n.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],r=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),r)return r;if(this._backtrack){for(var o in i)this[o]=i[o];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,r,n;this._more||(this.yytext="",this.match="");for(var i=this._currentRules(),o=0;o<i.length;o++)if(r=this._input.match(this.rules[i[o]]),r&&(!t||r[0].length>t[0].length)){if(t=r,n=o,this.options.backtrack_lexer){if(e=this.test_match(r,i[o]),e!==!1)return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}return t?(e=this.test_match(t,i[n]),e!==!1&&e):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){var e=this.conditionStack.length-1;return e>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return e=this.conditionStack.length-1-Math.abs(e||0),e>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,t,r,n){switch(r){case 0:return 18;case 1:return 19;case 2:return this.popState(),17;case 3:return this.begin("CHARCLASS"),31;case 4:return this.begin("CHARCLASS"),30;case 5:return 42;case 6:return 43;case 7:return 36;case 8:return 38;case 9:return 40;case 10:return this.popState(),29;case 11:return 22;case 12:return 8;case 13:return 23;case 14:return 13;case 15:return 14;case 16:return 12;case 17:return this.begin("QUANTITY"),15;case 18:return 17;case 19:return 29;case 20:return"^";case 21:return 44;case 22:return 45;case 23:return 26;case 24:return 5;case 25:return 20}},rules:[/^(?:[0-9])/,/^(?:,)/,/^(?:\})/,/^(?:\[\^)/,/^(?:\[)/,/^(?:\\[-nrt\|.?*+(){}[\]^])/,/^(?:\\[sSiIcCdDwW])/,/^(?:-(?=\[))/,/^(?:-)/,/^(?:[^-[\]])/,/^(?:\])/,/^(?:\()/,/^(?:\|)/,/^(?:\))/,/^(?:\*)/,/^(?:\+)/,/^(?:\?)/,/^(?:\{)/,/^(?:\})/,/^(?:\])/,/^(?:\^)/,/^(?:\\p\{.*?\})/,/^(?:\\P\{.*?\})/,/^(?:\.)/,/^(?:$)/,/^(?:[^\\])/],conditions:{CHARCLASS:{rules:[3,4,5,6,7,8,9,10],inclusive:!1},QUANTITY:{rules:[0,1,2],inclusive:!1},INITIAL:{rules:[3,4,5,6,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25],inclusive:!0}}};return e}();return N.lexer=M,o.prototype=N,N.Parser=o,new o}();t.parser=i,t.Parser=i.Parser,t.parse=function(){return i.parse.apply(i,arguments)},t.main=function(){throw new Error("this module cannot be used as main")},"undefined"!=typeof e&&r.c[r.s]===e&&t.main(n.argv.slice(1))}).call(t,r(33)(e),r(32))},function(e,t,r){function n(e,t){return e.search(/^\d+$/)===-1&&new h.ParamError(t+" must have an integer value")}function i(e,t){return!(!n(e,t)&&Number(e)>=0)&&new h.ParamError(t+" must have a non-negative integer value")}function o(e,t){return!(!n(e,t)&&Number(e)>0)&&new h.ParamError(t+" must have a positive value")}function a(e,t){switch(t){case c.PRESERVE:break;case c.REPLACE:e=e.replace(/\r\n\t/g," ");break;case c.COLLAPSE:e=e.replace(/\r\n\t/g," ").trim().replace(/\s{2,}/g," ");break;default:throw new Error("unexpected value: "+t)}return e}function s(e){return e%4===0&&e%100!==0||e%400===0}function l(e){var t=e.match(Ve);if(null===t)return!1;var r=t[1],n=s(Number(r)),i=Number(t[2]);if(0===i||i>12)return!1;var o=Number(t[3]),a=He[i];if(2!==i||n||(a=28),0===o||o>a)return!1;var l=t[4].split(":"),u=Number(l[1]);if(u>59)return!1;var c=Number(l[2]);if(c>59)return!1;var h=0===u&&0===c?24:23;if(Number(l[0])>h)return!1;if(void 0!==t[5]&&""!==t[5]&&"Z"!==t[5]){var d=t[5].split(":"),p=Number(d[0].slice(1));if(p>14)return!1;var f=Number(d[1]);if(f>59)return!1;if(14===p&&0!==f)return!1}return!0}var u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var c,h=r(5),d=r(16),p=r(11);!function(e){e[e.PRESERVE=1]="PRESERVE",e[e.REPLACE=2]="REPLACE",e[e.COLLAPSE=3]="COLLAPSE"}(c||(c={}));for(var f=function(){function e(){this.repeatable=!1}return e.prototype.combine=function(e){if(!this.repeatable)throw new Error("this parameter is not repeatable");throw new Error("derived classes must implement this method if they are repeatable")},e}(),m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.convert=function(e){return Number(e)},t}(f),v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.isInvalidParam=function(e,t){return i(e,t)},t}(m),y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="length",t}return u(t,e),t.prototype.isInvalidValue=function(e,t,r){return r.valueLength(e)!==t&&new h.ValueError("length of value should be "+t)},t}(v),g=new y,b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="minLength",t}return u(t,e),t.prototype.isInvalidValue=function(e,t,r){return!(r.valueLength(e)>=t)&&new h.ValueError("length of value should be greater than or equal to "+t)},t}(v),w=new b,_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="maxLength",t}return u(t,e),t.prototype.isInvalidValue=function(e,t,r){return!(r.valueLength(e)<=t)&&new h.ValueError("length of value should be less than or equal to "+t)},t}(v),E=new _,x=Object.create(null),S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="pattern",t.repeatable=!0,t}return u(t,e),t.prototype.convert=function(e){var t=x[e];return void 0===t&&(t=x[e]=d.parse(e)),{rng:e,internal:t}},t.prototype.combine=function(e){return e.map(this.convert)},t.prototype.isInvalidParam=function(e){try{this.convert(e)}catch(e){if(e instanceof d.SalveParsingError)return new h.ParamError(e.message);throw e}return!1},t.prototype.isInvalidValue=function(e,t){if(t instanceof Array){for(var r=void 0,n=0,i=t;n<i.length;n++){var o=i[n];if(!o.internal.test(e)){r=o;break}}return void 0!==r&&new h.ValueError("value does not match the pattern "+r.rng)}return!t.internal.test(e)&&new h.ValueError("value does not match the pattern "+t.rng)},t}(f),N=new S,C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="totalDigits",t}return u(t,e),t.prototype.isInvalidParam=function(e,t){return o(e,t)},t.prototype.isInvalidValue=function(e,t){var r=String(Number(e)).replace(/[-+.]/g,"");return r.length>t&&new h.ValueError("value must have at most "+t+" digits")},t}(m),T=new C,P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="fractionDigits",t}return u(t,e),t.prototype.isInvalidValue=function(e,t){var r=String(Number(e)).replace(/^.*\./,"");return r.length>t&&new h.ValueError("value must have at most "+t+" fraction digits")},t}(v),k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.isInvalidParam=function(e,t,r){var n=r.disallows(e);return!!n&&new h.ParamError(n[0].message)},t}(m),A=new P,R=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="maxInclusive",t}return u(t,e),t.prototype.isInvalidValue=function(e,t){return e>t&&new h.ValueError("value must be less than or equal to "+t)},t}(k),O=new R,I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="maxExclusive",t}return u(t,e),t.prototype.isInvalidValue=function(e,t){return e>=t&&new h.ValueError("value must be less than "+t)},t}(k),D=new I,M=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="minInclusive",t}return u(t,e),t.prototype.isInvalidValue=function(e,t){return e<t&&new h.ValueError("value must be greater than or equal to "+t)},t}(k),L=new M,j=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="minExclusive",t}return u(t,e),t.prototype.isInvalidValue=function(e,t){return e<=t&&new h.ValueError("value must be greater than "+t)},t}(k),F=new j,B=function(){function e(){this.whiteSpaceDefault=c.COLLAPSE}return e.throwMissingLocation=function(e){throw new Error("internal error: undefined location")},Object.defineProperty(e.prototype,"paramNameToObj",{get:function(){var e=this._paramNameToObj,t=void 0!==e?e:Object.create(null);if(void 0===e){this._paramNameToObj=t;for(var r=0,n=this.validParams;r<n.length;r++){var i=n[r];t[i.name]=i}}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultParams",{get:function(){var e=this._defaultParams;if(void 0!==e)return e;var t;return this._defaultParams=t=this.parseParams(),t},enumerable:!0,configurable:!0}),e.prototype.convertValue=function(e,t){return a(e,this.whiteSpaceDefault)},e.prototype.valueLength=function(e){return e.length},e.prototype.parseValue=function(e,t){var r=this.disallows(e,{},t);if(r)throw new h.ValueValidationError(r);return{value:this.convertValue(e,t)}},e.prototype.parseParams=function(t,r){var n=[],i=Object.create(null);r=void 0!==r?r:[];for(var o=0,a=r;o<a.length;o++){var s=a[o],l=s.name,u=s.value,c=this.paramNameToObj[l];if(void 0===c)return void n.push(new h.ParamError("unexpected parameter: "+l));var d=c.isInvalidParam(u,l,this);d&&n.push(d),void 0===i[l]||c.repeatable||n.push(new h.ParamError("cannot repeat parameter "+l));var p=i[l];void 0===p&&(p=i[l]=[]),p.push(u)}if(0!==n.length){if(void 0!==t)throw new h.ParameterParsingError(t,n);e.throwMissingLocation(n)}var f=i;for(var m in f){var u=f[m],c=this.paramNameToObj[m];u.length>1?f[m]=c.combine(u):f[m]=void 0!==c.convert?c.convert(u[0]):u[0]}if(f.minLength>f.maxLength&&n.push(new h.ParamError("minLength must be less than or equal to maxLength")),void 0!==f.length&&(void 0!==f.minLength&&n.push(new h.ParamError("length and minLength cannot appear together")),void 0!==f.maxLength&&n.push(new h.ParamError("length and maxLength cannot appear together"))),void 0!==f.maxInclusive&&(void 0!==f.maxExclusive&&n.push(new h.ParamError("maxInclusive and maxExclusive cannot appear together")),f.minExclusive>=f.maxInclusive&&n.push(new h.ParamError("minExclusive must be less than maxInclusive"))),void 0!==f.minInclusive&&(void 0!==f.minExclusive&&n.push(new h.ParamError("minInclusive and minExclusive cannot appear together")),f.minInclusive>f.maxInclusive&&n.push(new h.ParamError("minInclusive must be less than or equal to maxInclusive")),f.minInclusive>=f.maxExclusive&&n.push(new h.ParamError("minInclusive must be less than maxExclusive"))),f.minExclusive>f.maxExclusive&&n.push(new h.ParamError("minExclusive must be less than or equal to maxExclusive")),0!==n.length){if(void 0!==t)throw new h.ParameterParsingError(t,n);e.throwMissingLocation(n)}return f},e.prototype.disallowedByParams=function(e,t,r,n){if(void 0!==r){for(var i=[],o=0,a=Object.keys(r);o<a.length;o++){var s=a[o],l=this.paramNameToObj[s],u=l.isInvalidValue(t,r[s],this);u&&i.push(u)}if(0!==i.length)return i}return!1},e.prototype.equal=function(e,t,r){if(void 0===t.value)throw Error("it looks like you are trying to use an unparsed value");var n;try{n=this.convertValue(e,r)}catch(e){if(e instanceof h.ValueValidationError)return!1;throw e}return n===t.value},e.prototype.disallows=function(e,t,r){if(t instanceof Array)throw new Error("it looks like you are passing unparsed parameters to disallows");if(void 0!==t&&0!==Object.keys(t).length||(t=this.defaultParams),null===a(e,c.COLLAPSE).match(this.regexp))return[new h.ValueError(this.typeErrorMsg)];var n;try{n=this.convertValue(e,r)}catch(e){if(e instanceof h.ValueValidationError)return e.errors;throw e}return this.disallowedByParams(e,n,t,r)},e}(),V=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="string",t.typeErrorMsg="value is not a string",t.whiteSpaceDefault=c.PRESERVE,t.validParams=[g,w,E,N],t.needsContext=!1,t.regexp=/^.*$/,t}return u(t,e),t}(B),H=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="normalizedString",t.typeErrorMsg="string contains a tab, carriage return or newline",t.regexp=/^[^\r\n\t]+$/,t}return u(t,e),t}(V),W=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="token",t.typeErrorMsg="not a valid token",t.regexp=/^(?:(?! )(?:(?! {3})[^\r\n\t])*[^\r\n\t ])?$/,t}return u(t,e),t}(H),$=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="language",t.typeErrorMsg="not a valid language identifier",t.regexp=/^[a-zA-Z]{1,8}(-[a-zA-Z0-9]{1,8})*$/,t}return u(t,e),t}(W),U=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="Name",t.typeErrorMsg="not a valid Name",t.regexp=p.xmlNameRe,t}return u(t,e),t}(W),q=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="NCName",t.typeErrorMsg="not a valid NCName",t.regexp=p.xmlNcnameRe,t}return u(t,e),t}(U),z=new RegExp("^["+p.xmlNameChar+"]+$"),K=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="NMTOKEN",t.typeErrorMsg="not a valid NMTOKEN",t.regexp=z,t}return u(t,e),t}(W),G=new RegExp("^["+p.xmlNameChar+"]+(?: ["+p.xmlNameChar+"]+)*$"),Q=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="NMTOKENS",t.typeErrorMsg="not a valid NMTOKENS",t.regexp=G,t.whiteSpaceDefault=c.COLLAPSE,t}return u(t,e),t}(K),X=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="ID",t.typeErrorMsg="not a valid ID",t}return u(t,e),t}(q),Y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="IDREF",t.typeErrorMsg="not a valid IDREF",t}return u(t,e),t}(q),Z=new RegExp("^"+p.xmlNcname+"(?: "+p.xmlNcname+")*$"),J=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="IDREFS",t.typeErrorMsg="not a valid IDREFS",t.regexp=Z,t.whiteSpaceDefault=c.COLLAPSE,t}return u(t,e),t}(Y),ee=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="ENTITY",t.typeErrorMsg="not a valid ENTITY",t}return u(t,e),t}(V),te=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="ENTITIES",t.typeErrorMsg="not a valid ENTITIES",t}return u(t,e),t}(V),re="[-+]?(?!$)\\d*(\\.\\d*)?",ne=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="decimal",t.typeErrorMsg="value not a decimal number",t.regexp=new RegExp("^"+re+"$"),t.whiteSpaceDefault=c.COLLAPSE,t.needsContext=!1,t.validParams=[T,A,N,F,L,D,O],t}return u(t,e),t.prototype.convertValue=function(t){return Number(e.prototype.convertValue.call(this,t))},t}(B),ie="[-+]?\\d+",oe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="integer",t.typeErrorMsg="value is not an integer",t.regexp=new RegExp("^"+ie+"$"),t.validParams=[T,N,F,L,D,O],t}return u(t,e),t.prototype.parseParams=function(t,r){function n(e){var r=[new h.ParamError(e)];if(void 0!==t)throw new h.ParameterParsingError(t,r);return B.throwMissingLocation(r)}var i,o,a=e.prototype.parseParams.call(this,t,r),s=this.highestVal;return void 0!==s&&(void 0!==a.maxExclusive?(i=a.maxExclusive,i>s&&n("maxExclusive cannot be greater than "+s)):void 0!==a.maxInclusive?(o=a.maxInclusive,o>s&&n("maxInclusive cannot be greater than "+s)):a.maxInclusive=this.highestVal),void 0!==this.lowestVal&&(void 0!==a.minExclusive?(i=a.minExclusive,i<this.lowestVal&&n("minExclusive cannot be lower than "+this.lowestVal)):void 0!==a.minInclusive?(o=a.minInclusive,o<this.lowestVal&&n("minInclusive cannot be lower than "+this.lowestVal)):a.minInclusive=this.lowestVal),a},t}(ne),ae=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="nonPositiveInteger",t.typeErrorMsg="value is not a nonPositiveInteger",t.regexp=/^\+?0+|-\d+$/,t.highestVal=0,t.validParams=[T,N,F,L,D,O],t}return u(t,e),t}(oe),se=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="negativeInteger",t.typeErrorMsg="value is not a negativeInteger",t.regexp=/^-\d+$/,t.highestVal=-1,t.validParams=[T,N,F,L,D,O],t}return u(t,e),t}(ae),le=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="nonNegativeInteger",t.typeErrorMsg="value is not a nonNegativeInteger",t.regexp=/^(\+?\d+|-0)$/,t.lowestVal=0,t.validParams=[T,N,F,L,D,O],t}return u(t,e),t}(oe),ue=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="positiveInteger",t.typeErrorMsg="value is not a positiveInteger",t.regexp=/^\+?\d+$/,t.lowestVal=1,t.validParams=[T,N,F,L,D,O],t}return u(t,e),t}(le),ce=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="long",t.typeErrorMsg="value is not a long",t.highestVal=0x8000000000000000,t.lowestVal=-0x8000000000000000,t.validParams=[T,N,F,L,D,O],t}return u(t,e),t}(oe),he=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="int",t.typeErrorMsg="value is not an int",t.highestVal=2147483647,t.lowestVal=-2147483648,t}return u(t,e),t}(ce),de=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="short",t.typeErrorMsg="value is not a short",t.highestVal=32767,t.lowestVal=-32768,t}return u(t,e),t}(he),pe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="byte",t.typeErrorMsg="value is not a byte",t.highestVal=127,t.lowestVal=-128,t}return u(t,e),t}(de),fe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="unsignedLong",t.typeErrorMsg="value is not an unsignedLong",t.highestVal=0x10000000000000000,t.validParams=[T,N,F,L,D,O],t}return u(t,e),t}(le),me=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="unsignedInt",t.typeErrorMsg="value is not an unsignedInt",t.highestVal=4294967295,t.validParams=[T,N,F,L,D,O],t}return u(t,e),t}(fe),ve=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="unsignedShort",t.typeErrorMsg="value is not an unsignedShort",t.highestVal=65535,t.validParams=[T,N,F,L,D,O],t}return u(t,e),t}(me),ye=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="unsignedByte",t.typeErrorMsg="value is not an unsignedByte",t.highestVal=255,t.validParams=[T,N,F,L,D,O],t}return u(t,e),t}(ve),ge=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="boolean",t.typeErrorMsg="not a valid boolean",t.regexp=/^(1|0|true|false)$/,t.validParams=[N],t.needsContext=!1,t}return u(t,e),t.prototype.convertValue=function(e){return"1"===e||"true"===e},t}(B),be="[AQgw]",we="[AEIMQUYcgkosw048]",_e="[A-Za-z0-9+/]",Ee="(?:"+_e+" ?)",xe="(?:"+we+" ?)",Se="(?:"+be+" ?)",Ne=new RegExp("^(?:(?:"+Ee+"{4})*(?:(?:"+Ee+"{3}"+_e+")|(?:"+Ee+"{2}"+xe+"=)|(?:"+(""+Ee+Se+"= ?=)))?$")),Ce=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="base64Binary",t.typeErrorMsg="not a valid base64Binary",t.regexp=Ne,t.needsContext=!1,t.validParams=[g,w,E,N],t}return u(t,e),t.prototype.convertValue=function(e){return e.replace(/\s/g,"")},t.prototype.valueLength=function(e){return Math.floor(3*e.replace(/[\s=]/g,"").length/4)},t}(B),Te=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="hexBinary",t.typeErrorMsg="not a valid hexBinary",t.regexp=/^(?:[0-9a-fA-F]{2})*$/,t.needsContext=!1,t.validParams=[g,w,E,N],t}return u(t,e),t.prototype.convertValue=function(e){return e},t.prototype.valueLength=function(e){return e.length/2},t}(B),Pe=new RegExp("^(?:(?:[-+]?INF)|(?:NaN)|(?:"+re+"(?:[Ee]"+ie+")?))$"),ke=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="float",t.typeErrorMsg="not a valid float",t.regexp=Pe,t.needsContext=!1,t.validParams=[N,L,F,O,D],t}return u(t,e),t.prototype.convertValue=function(e,t){return parseFloat(e)},t}(B),Ae=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="double",t.typeErrorMsg="not a valid double",t.regexp=Pe,t.needsContext=!1,t.validParams=[N,L,F,O,D],t}return u(t,e),t.prototype.convertValue=function(e,t){return parseFloat(e)},t}(B),Re=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="QName",t.typeErrorMsg="not a valid QName",t.regexp=new RegExp("^(?:"+p.xmlNcname+":)?"+p.xmlNcname+"$"),t.needsContext=!0,t.validParams=[N,g,w,E],t}return u(t,e),t.prototype.convertValue=function(t,r){var n=r.resolver.resolveName(e.prototype.convertValue.call(this,t));if(void 0===n)throw new h.ValueValidationError([new h.ValueError("cannot resolve the name "+t)]);return"{"+n.ns+"}"+n.name},t}(B),Oe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="NOTATION",t.typeErrorMsg="not a valid NOTATION",t.regexp=new RegExp("^(?:"+p.xmlNcname+":)?"+p.xmlNcname+"$"),t.needsContext=!0,t.validParams=[N,g,w,E],t}return u(t,e),t.prototype.convertValue=function(t,r){var n=r.resolver.resolveName(e.prototype.convertValue.call(this,t));if(void 0===n)throw new h.ValueValidationError([new h.ValueError("cannot resolve the name "+t)]);return"{"+n.ns+"}"+n.name},t}(B),Ie=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="duration",t.typeErrorMsg="not a valid duration",t.regexp=/^-?P(?!$)(?:\d+Y)?(?:\d+M)?(?:\d+D)?(?:T(?!$)(?:\d+H)?(?:\d+M)?(?:\d+(\.\d+)?S)?)?$/,t.validParams=[N],t.needsContext=!1,t}return u(t,e),t}(B),De="-?(?:[1-9]\\d*)?\\d{4}",Me="[01]\\d",Le="[0-3]\\d",je="[012]\\d:[0-5]\\d:[0-5]\\d(?:\\.\\d+)?",Fe="(?:[+-][01]\\d:[0-5]\\d|Z)",Be=new RegExp(Fe+"$"),Ve=new RegExp("^("+De+")-("+Me+")-("+Le+")T("+je+")"+("("+Fe+"?)$")),He=[void 0,31,29,31,30,31,30,31,31,30,31,30,31],We=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="dateTime",t.typeErrorMsg="not a valid dateTime",t.regexp=new RegExp("^"+De+"-"+Me+"-"+Le+("T"+je+Fe+"?$")),t.needsContext=!1,t.validParams=[N],t}return u(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);return n instanceof Array?n:!l(t)&&[new h.ValueError(this.typeErrorMsg)]},t}(B),$e=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="time",t.typeErrorMsg="not a valid time",t.regexp=new RegExp("^"+je+Fe+"?$"),t.validParams=[N],t.needsContext=!1,t}return u(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);return n?n:!l("1901-01-01T"+t)&&[new h.ValueError(this.typeErrorMsg)]},t}(B),Ue=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="date",t.typeErrorMsg="not a valid date",t.regexp=new RegExp("^"+De+"-"+Me+"-"+Le+Fe+"?$"),t.needsContext=!1,t.validParams=[N],t}return u(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);if(n)return n;var i=t.match(Be);return t=null!==i?t.slice(0,i.index)+"T00:00:00"+i[0]:t+"T00:00:00",!l(t)&&[new h.ValueError(this.typeErrorMsg)]},t}(B),qe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="gYearMonth",t.typeErrorMsg="not a valid gYearMonth",t.regexp=new RegExp("^"+De+"-"+Me+Fe+"?$"),t.validParams=[N],t.needsContext=!1,t}return u(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);if(n)return n;var i=t.match(Be);return t=null!==i?t.slice(0,i.index)+"-01T00:00:00"+i[0]:t+"-01T00:00:00",!l(t)&&[new h.ValueError(this.typeErrorMsg)]},t}(B),ze=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="gYear",t.typeErrorMsg="not a valid gYear",t.regexp=new RegExp("^"+De+Fe+"?$"),t.needsContext=!1,t.validParams=[N],t}return u(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);if(n)return n;var i=t.match(Be);return t=null!==i?t.slice(0,i.index)+"-01-01T00:00:00"+i[0]:t+"-01-01T00:00:00",!l(t)&&[new h.ValueError(this.typeErrorMsg)]},t}(B),Ke=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="gMonthDay",t.typeErrorMsg="not a valid gMonthDay",t.regexp=new RegExp("^"+Me+"-"+Le+Fe+"?$"),t.needsContext=!1,t.validParams=[N],t}return u(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);if(n)return n;var i=t.match(Be);return t=null!==i?t.slice(0,i.index)+"T00:00:00"+i[0]:t+"T00:00:00",!l("2000-"+t)&&[new h.ValueError(this.typeErrorMsg)]},t}(B),Ge=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="gDay",t.typeErrorMsg="not a valid gDay",t.regexp=new RegExp("^"+Le+Fe+"?$"),t.needsContext=!1,t.validParams=[N],t}return u(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);if(n)return n;var i=t.match(Be);return t=null!==i?t.slice(0,i.index)+"T00:00:00"+i[0]:t+"T00:00:00",!l("2000-01-"+t)&&[new h.ValueError(this.typeErrorMsg)]},t}(B),Qe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="gMonth",t.typeErrorMsg="not a valid gMonth",t.regexp=new RegExp("^"+Me+Fe+"?$"),t.needsContext=!1,t.validParams=[N],t}return u(t,e),t.prototype.disallows=function(t,r){var n=e.prototype.disallows.call(this,t,r);if(n)return n;var i=t.match(Be);return t=null!==i?t.slice(0,i.index)+"-01T00:00:00"+i[0]:t+"-01T00:00:00",!l("2000-"+t)&&[new h.ValueError(this.typeErrorMsg)]},t}(B),Xe=/^(?:[A-Za-z][A-Za-z0-9+\-.]*:(?:\/\/(?:(?:[A-Za-z0-9\-._~!$&'()*+,;=:]|%[0-9A-Fa-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\.[A-Za-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\-._~!$&'()*+,;=]|%[0-9A-Fa-f]{2})*)(?::[0-9]*)?(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|\/(?:(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?|(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|)(?:\?(?:[A-Za-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9A-Fa-f]{2})*)?(?:\#(?:[A-Za-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9A-Fa-f]{2})*)?|(?:\/\/(?:(?:[A-Za-z0-9\-._~!$&'()*+,;=:]|%[0-9A-Fa-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\.[A-Za-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\-._~!$&'()*+,;=]|%[0-9A-Fa-f]{2})*)(?::[0-9]*)?(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|\/(?:(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?|(?:[A-Za-z0-9\-._~!$&'()*+,;=@]|%[0-9A-Fa-f]{2})+(?:\/(?:[A-Za-z0-9\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|)(?:\?(?:[A-Za-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9A-Fa-f]{2})*)?(?:\#(?:[A-Za-z0-9\-._~!$&'()*+,;=:@\/?]|%[0-9A-Fa-f]{2})*)?)$/,Ye=function(e){
function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="anyURI",t.typeErrorMsg="not a valid anyURI",t.regexp=Xe,t.needsContext=!1,t.validParams=[N,g,w,E],t}return u(t,e),t}(B),Ze=[V,H,W,$,U,q,K,Q,X,Y,J,ee,te,ne,oe,ae,se,le,ue,ce,he,de,pe,fe,me,ve,ye,ge,Ce,Te,ke,Ae,Re,Oe,Ie,We,$e,Ue,qe,ze,Ke,Ge,Qe,Ye],Je={uri:"http://www.w3.org/2001/XMLSchema-datatypes",types:{}},et=0,tt=Ze;et<tt.length;et++){var rt=tt[et],nt=new rt;Je.types[nt.name]=nt}t.xmlschema=Je},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),o=r(0),a=function(e){function t(t,r,n){var i=e.call(this,t,n)||this;return i.name=r,i}return n(t,e),t.prototype._prepare=function(e){var t=Object.create(null);this.name._recordNamespaces(t),delete t[""];for(var r in t)e[r]=1},t.prototype._hasAttrs=function(){return!0},t}(o.OneSubpattern);t.Attribute=a;var s=function(e){function t(r,n){var i=this;if(r instanceof t){var a=r,s=o.isHashMap(n);i=e.call(this,a,s)||this,i.nameResolver=i._cloneIfNeeded(a.nameResolver,s),i.seenName=a.seenName,i.seenValue=a.seenValue,i.subwalker=void 0!==a.subwalker?a.subwalker._clone(s):void 0,i.attrNameEvent=a.attrNameEvent,i.neutralized=a.neutralized}else{var l=r,u=o.isNameResolver(n);i=e.call(this,l)||this,i.nameResolver=u,i.attrNameEvent=new o.Event("attributeName",l.name),i.seenName=!1,i.seenValue=!1,i.neutralized=!1}return i}return n(t,e),t.prototype._possible=function(){if(this.suppressedAttributes)return new o.EventSet;if(!this.seenName)return new o.EventSet(this.attrNameEvent);if(!this.seenValue){void 0===this.subwalker&&(this.subwalker=this.el.pat.newWalker(this.nameResolver));var e=this.subwalker._possible(),t=new o.EventSet;return e.forEach(function(e){if("text"!==e.params[0])throw new Error("unexpected event type: "+e.params[0]);t.add(new o.Event("attributeValue",e.params[1]))}),t}return new o.EventSet},t.prototype.possible=function(){return this._possible()},t.prototype.fireEvent=function(e){if(!this.suppressedAttributes&&!this.neutralized){if("neutralizeAttribute"===e.params[0]&&this.el.name.toString()===e.params[1].toString())return this.neutralized=!0,!1;if(this.seenName){if(!this.seenValue&&"attributeValue"===e.params[0]){this.seenValue=!0,void 0===this.subwalker&&(this.subwalker=this.el.pat.newWalker(this.nameResolver));var t=new o.Event("text",e.params[1]),r=this.subwalker.fireEvent(t);return void 0===r?[new i.AttributeValueError("invalid attribute value",this.el.name)]:(r===!1&&(r=this.subwalker.end()),r)}}else if("attributeName"===e.params[0]&&this.el.name.match(e.params[1],e.params[2]))return this.seenName=!0,!1}},t.prototype._suppressAttributes=function(){this.suppressedAttributes=!0},t.prototype.canEnd=function(e){return void 0===e&&(e=!1),this.seenValue||this.neutralized},t.prototype.end=function(e){return void 0===e&&(e=!1),!this.neutralized&&(this.seenName?!this.seenValue&&[new i.AttributeValueError("attribute value missing",this.el.name)]:[new i.AttributeNameError("attribute missing",this.el.name)])},t}(o.Walker);o.addWalker(a,s)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),o=r(0),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(o.TwoSubpatterns);t.Choice=a;var s=function(e){function t(r,n){var i=this;if(r instanceof t){var a=r,s=o.isHashMap(n);i=e.call(this,a,s)||this,i.nameResolver=i._cloneIfNeeded(a.nameResolver,s),i.chosen=a.chosen,i.walkerA=void 0!==a.walkerA?a.walkerA._clone(s):void 0,i.walkerB=void 0!==a.walkerB?a.walkerB._clone(s):void 0,i.instantiatedWalkers=a.instantiatedWalkers}else{var l=r,u=o.isNameResolver(n);i=e.call(this,l)||this,i.nameResolver=u,i.chosen=!1,i.instantiatedWalkers=!1}return i}return n(t,e),t.prototype._possible=function(){if(this._instantiateWalkers(),void 0!==this.possibleCached)return this.possibleCached;if(this.possibleCached=void 0!==this.walkerA?this.walkerA._possible():void 0,void 0!==this.walkerB){this.possibleCached=new o.EventSet(this.possibleCached);var e=this.walkerB._possible();this.possibleCached.union(e)}else void 0===this.possibleCached&&(this.possibleCached=new o.EventSet);return this.possibleCached},t.prototype.fireEvent=function(e){this._instantiateWalkers(),this.possibleCached=void 0;var t=void 0!==this.walkerA?this.walkerA.fireEvent(e):void 0,r=void 0!==this.walkerB?this.walkerB.fireEvent(e):void 0;return void 0!==t?(this.chosen=!0,void 0===r?(this.walkerB=void 0,t):t):void 0!==r?(this.chosen=!0,this.walkerA=void 0,r):void 0},t.prototype._suppressAttributes=function(){this._instantiateWalkers(),this.suppressedAttributes||(this.possibleCached=void 0,this.suppressedAttributes=!0,void 0!==this.walkerA&&this.walkerA._suppressAttributes(),void 0!==this.walkerB&&this.walkerB._suppressAttributes())},t.prototype.canEnd=function(e){void 0===e&&(e=!1),this._instantiateWalkers();var t=!1,r=!1;return e&&(t=!this.el.patA._hasAttrs(),r=!this.el.patB._hasAttrs()),t=t||void 0!==this.walkerA&&this.walkerA.canEnd(e),r=r||void 0!==this.walkerB&&this.walkerB.canEnd(e),t||r},t.prototype.end=function(e){if(void 0===e&&(e=!1),this._instantiateWalkers(),this.canEnd(e))return!1;var t=void 0!==this.walkerA&&this.walkerA.end(e),r=void 0!==this.walkerB&&this.walkerB.end(e);if(!t&&!r)return!1;if(t&&!r)return t;if(!t&&r)return r;var n=[],o=[],a=!1;return this.walkerA.possible().forEach(function(e){"enterStartTag"===e.params[0]?n.push(e.params[1]):a=!0}),a||(this.walkerB.possible().forEach(function(e){"enterStartTag"===e.params[0]?o.push(e.params[1]):a=!0}),a)?t||r:[new i.ChoiceError(n,o)]},t.prototype._instantiateWalkers=function(){this.instantiatedWalkers||(this.instantiatedWalkers=!0,this.walkerA=this.el.patA.newWalker(this.nameResolver),this.walkerB=this.el.patB.newWalker(this.nameResolver))},t}(o.Walker);o.addWalker(a,s)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(10),o=r(1),a=r(0),s=function(e){function t(t,r,n,o,a){void 0===r&&(r="token"),void 0===n&&(n="");var s=e.call(this,t)||this;if(s.type=r,s.datatypeLibrary=n,s.except=a,s.datatype=i.registry.get(s.datatypeLibrary).types[s.type],void 0===s.datatype)throw new Error("unkown type: "+r);return s.rngParams=void 0!==o?o:[],s}return n(t,e),Object.defineProperty(t.prototype,"params",{get:function(){var e=this._params;return null!=e?e:e=this._params=this.datatype.parseParams(this.xmlPath,this.rngParams)},enumerable:!0,configurable:!0}),t}(a.Pattern);t.Data=s;var l=function(e){function t(r,n){var i=this;if(r instanceof t){var o=r,s=a.isHashMap(n);i=e.call(this,o,s)||this,i.nameResolver=i._cloneIfNeeded(o.nameResolver,s),i.context=void 0!==o.context?{resolver:i.nameResolver}:void 0,i.matched=o.matched}else{var l=r,u=a.isNameResolver(n,"as 2nd argument");i=e.call(this,l)||this,i.nameResolver=u,i.possibleCached=new a.EventSet(new a.Event("text",i.el.datatype.regexp)),i.context=l.datatype.needsContext?{resolver:i.nameResolver}:void 0,i.matched=!1}return i}return n(t,e),t.prototype._possible=function(){return this.possibleCached},t.prototype.fireEvent=function(e){if(!this.matched&&"text"===e.params[0]&&!this.el.datatype.disallows(e.params[1],this.el.params,this.context)){if(void 0!==this.el.except){var t=this.el.except.newWalker(this.nameResolver),r=t.fireEvent(e);if(r===!1)return}return this.matched=!0,this.possibleCached=new a.EventSet,!1}},t.prototype.canEnd=function(e){if(void 0===e&&(e=!1),this.matched)return!0;if(void 0!==this.el.except){var t=this.el.except.newWalker(this.nameResolver);if(t.canEnd())return!1}return!this.el.datatype.disallows("",this.el.params,this.context)},t.prototype.end=function(e){return void 0===e&&(e=!1),!this.canEnd(e)&&[new o.ValidationError("value required")]},t.prototype._suppressAttributes=function(){},t}(a.Walker);a.addWalker(s,l)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),o=r(2),a=r(0),s=r(6),l=function(e){function t(t,r,n){var i=e.call(this,t,n)||this;return i.name=r,i}return n(t,e),t.prototype._prepare=function(e){this.name._recordNamespaces(e),this.pat._prepare(e)},t.prototype.newWalker=function(e){return this.pat instanceof s.NotAllowed?this.pat.newWalker(e):u.makeWalker(this,e)},t.prototype._hasAttrs=function(){return!1},t.prototype._gatherElementDefinitions=function(e){var t=this.name.toString();void 0===e[t]?e[t]=[this]:e[t].push(this)},t}(a.OneSubpattern);t.Element=l;var u=function(e){function t(r,n){var i=this;if(r instanceof t){var o=r,s=a.isHashMap(n);i=e.call(this,o,s)||this,i.nameResolver=i._cloneIfNeeded(o.nameResolver,s),i.seenName=o.seenName,i.endedStartTag=o.endedStartTag,i.closed=o.closed,i.walker=void 0!==o.walker?o.walker._clone(s):void 0,i.startTagEvent=o.startTagEvent,i.endTagEvent=o.endTagEvent,i.boundName=o.boundName}else{var l=r,u=a.isNameResolver(n);i=e.call(this,l)||this,i.nameResolver=u,i.seenName=!1,i.endedStartTag=!1,i.closed=!1,i.startTagEvent=new a.Event("enterStartTag",l.name)}return i}return n(t,e),t.makeWalker=function(e,r){return new t(e,r)},t.prototype._possible=function(){if(!this.seenName)return new a.EventSet(this.startTagEvent);if(!this.endedStartTag){var e=this.walker,r=e._possible(),n=new a.EventSet,i=new a.EventSet;return r.forEach(function(e){"attributeValue"===e.params[0]?i.add(e):e.isAttributeEvent()&&n.add(e)}),0!==i.size()?n=i:e.canEnd(!0)&&n.add(t._leaveStartTagEvent),n}if(!this.closed){var e=this.walker,o=new a.EventSet(e._possible());return e.canEnd()&&o.add(this.endTagEvent),o}return new a.EventSet},t.prototype.possible=function(){return this._possible()},t.prototype.fireEvent=function(e){if(!this.endedStartTag){if(this.seenName){if("leaveStartTag"===e.params[0]){this.endedStartTag=!0;var t=this.walker,r=t.end(!0),n=[];if(r)for(var s=0,l=r;s<l.length;s++){var u=l[s];(u instanceof i.AttributeValueError||u instanceof i.AttributeNameError)&&n.push(u),u instanceof i.AttributeNameError&&t.fireEvent(new a.Event(["neutralizeAttribute",u.name]))}return t._suppressAttributes(),0!==n.length&&n}}else if("enterStartTag"===e.params[0]&&this.el.name.match(e.params[1],e.params[2]))return this.walker=this.el.pat.newWalker(this.nameResolver),this.seenName=!0,this.boundName=new o.Name("",e.params[1],e.params[2]),this.endTagEvent=new a.Event("endTag",this.boundName),!1;return void 0!==this.walker?this.walker.fireEvent(e):void 0}if(!this.closed){var t=this.walker,n=t.fireEvent(e);if(void 0===n)if("endTag"===e.params[0]){if(this.boundName.match(e.params[1],e.params[2])){this.closed=!0;var r=t.end();if(n=[],r)for(var c=0,h=r;c<h.length;c++){var u=h[c];u instanceof i.AttributeValueError||u instanceof i.AttributeNameError||n.push(u)}return 0!==n.length&&n}}else if("leaveStartTag"===e.params[0])return[new i.ValidationError("unexpected leaveStartTag event; it is likely that fireEvent is incorrectly called")];return n}},t.prototype._suppressAttributes=function(){},t.prototype.canEnd=function(e){return void 0===e&&(e=!1),!!e||this.closed},t.prototype.end=function(e){if(void 0===e&&(e=!1),e)return!1;var t=[];if(this.seenName){if(!this.endedStartTag||!this.closed){if(void 0!==this.walker){var r=this.walker.end();r&&(t=r)}t.push(this.endedStartTag?new i.ElementNameError("tag not closed",this.el.name):new i.ElementNameError("start tag not terminated",this.el.name))}}else t.push(new i.ElementNameError("tag required",this.el.name));return t.length>0&&t},t}(a.Walker);u._leaveStartTagEvent=new a.Event("leaveStartTag")},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(i.Pattern);t.Empty=o;var a=function(e){function t(r,n){var o=this;return r instanceof t?(n=i.isHashMap(n),o=e.call(this,r,n)||this):(o=e.call(this,r)||this,o.possibleCached=new i.EventSet),o}return n(t,e),t.prototype.possible=function(){return new i.EventSet},t.prototype._possible=function(){return this.possibleCached},t.prototype.fireEvent=function(e){if(e===i.emptyEvent||"text"===e.params[0]&&""===e.params[1].trim())return!1},t}(i.Walker);t.EmptyWalker=a,i.addWalker(o,a)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),o=r(0),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(o.TwoSubpatterns);t.Group=a;var s=function(e){function t(r,n){var i=this;if(r instanceof t){var a=r,s=o.isHashMap(n);i=e.call(this,a,s)||this,i.nameResolver=i._cloneIfNeeded(a.nameResolver,s),i.hitA=a.hitA,i.endedA=a.endedA,i.hitB=a.hitB,i.walkerA=void 0!==a.walkerA?a.walkerA._clone(s):void 0,i.walkerB=void 0!==a.walkerB?a.walkerB._clone(s):void 0}else{var l=r,u=o.isNameResolver(n);i=e.call(this,l)||this,i.nameResolver=u,i.hitA=!1,i.endedA=!1,i.hitB=!1}return i}return n(t,e),t.prototype._possible=function(){if(this._instantiateWalkers(),void 0!==this.possibleCached)return this.possibleCached;var e=this.walkerA,t=this.walkerB;if(this.possibleCached=this.endedA?void 0:e._possible(),this.suppressedAttributes)(this.endedA||e.canEnd())&&(this.possibleCached=new o.EventSet(this.possibleCached),this.possibleCached.union(t._possible()));else{var r=t._possible();this.endedA&&!this.hitB||e.canEnd()||(r=r.filter(function(e){return e.isAttributeEvent()})),this.possibleCached=new o.EventSet(this.possibleCached),this.possibleCached.union(r)}return this.possibleCached},t.prototype.fireEvent=function(e){this._instantiateWalkers();var t=this.walkerA,r=this.walkerB;if(this.possibleCached=void 0,!this.endedA){var n=t.fireEvent(e);if(void 0!==n)return this.hitA=!0,n;if(!e.isAttributeEvent()&&!t.canEnd())return}var i=r.fireEvent(e);if(void 0!==i&&(this.hitB=!0),!e.isAttributeEvent()&&void 0!==i&&!this.endedA){var o=t.end();this.endedA=!0,i?o&&(i=i.concat(o)):i=o}return i},t.prototype._suppressAttributes=function(){this._instantiateWalkers(),this.suppressedAttributes||(this.possibleCached=void 0,this.suppressedAttributes=!0,this.walkerA._suppressAttributes(),this.walkerB._suppressAttributes())},t.prototype.canEnd=function(e){void 0===e&&(e=!1),this._instantiateWalkers();var t=this.walkerA,r=this.walkerB;if(e){var n=this.el.patA._hasAttrs(),i=this.el.patB._hasAttrs();return n&&i?t.canEnd(e)&&r.canEnd(e):n?t.canEnd(!0):!i||r.canEnd(!0)}return t.canEnd(e)&&r.canEnd(e)},t.prototype.end=function(e){if(void 0===e&&(e=!1),this.canEnd(e))return!1;var t,r=this.walkerA,n=this.walkerB;if(e){var o=this.el.patA._hasAttrs(),a=this.el.patB._hasAttrs();if(o){if(this.endedA)throw new Error("invalid state: endedA is true but we are processing attributes");if(t=r.end(!0),a){var s=n.end(!0);s&&(t=t?t.concat(s):s)}return t}return!!a&&n.end(!0)}var l=!1;if(!this.endedA&&(l=r.end(!1)))for(var u=0,c=l;u<c.length;u++){var h=c[u];if(!(h instanceof i.AttributeValueError||h instanceof i.AttributeNameError))return l}var d=n.end(!1);return d?l?l.concat(d):d:l},t.prototype._instantiateWalkers=function(){void 0===this.walkerA&&(this.walkerA=this.el.patA.newWalker(this.nameResolver),this.walkerB=this.el.patB.newWalker(this.nameResolver))},t}(o.Walker);o.addWalker(a,s)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(i.TwoSubpatterns);t.Interleave=o;var a=function(e){function t(r,n){var o=this;if(r instanceof t){var a=r,s=i.isHashMap(n);o=e.call(this,a,s)||this,o.nameResolver=o._cloneIfNeeded(a.nameResolver,s),o.inA=a.inA,o.inB=a.inB,o.walkerA=void 0!==a.walkerA?a.walkerA._clone(s):void 0,o.walkerB=void 0!==a.walkerB?a.walkerB._clone(s):void 0}else{var l=r,u=i.isNameResolver(n);o=e.call(this,l)||this,o.nameResolver=u,o.inA=!1,o.inB=!1}return o}return n(t,e),t.prototype._possible=function(){if(this._instantiateWalkers(),void 0!==this.possibleCached)return this.possibleCached;if(this.inA&&this.inB)throw new Error("impossible state");var e=this.walkerA,t=this.walkerB;return this.inA&&!e.canEnd()?this.possibleCached=e._possible():this.inB&&!t.canEnd()&&(this.possibleCached=t._possible()),void 0===this.possibleCached&&(this.possibleCached=e.possible(),this.possibleCached.union(t._possible())),this.possibleCached},t.prototype.fireEvent=function(e){if(this._instantiateWalkers(),this.possibleCached=void 0,this.inA&&this.inB)throw new Error("impossible state");var t,r,n=this.walkerA,i=this.walkerB;if(!this.inA&&!this.inB)return t=n.fireEvent(e),t===!1?(this.inA=!0,!1):(r=i.fireEvent(e),r===!1?(this.inB=!0,!1):void 0===r?t:void 0===t?r:t.concat(r));if(this.inA){if(t=n.fireEvent(e),t instanceof Array||t===!1)return t;if(r=i.fireEvent(e),r===!1)return this.inA=!1,this.inB=!0,!1}else{if(r=i.fireEvent(e),r instanceof Array||r===!1)return r;if(t=n.fireEvent(e),t===!1)return this.inA=!0,this.inB=!1,!1}},t.prototype._suppressAttributes=function(){this._instantiateWalkers(),this.suppressedAttributes||(this.possibleCached=void 0,this.suppressedAttributes=!0,this.walkerA._suppressAttributes(),this.walkerB._suppressAttributes())},t.prototype.canEnd=function(e){return void 0===e&&(e=!1),this._instantiateWalkers(),this.walkerA.canEnd(e)&&this.walkerB.canEnd(e)},t.prototype.end=function(e){void 0===e&&(e=!1),this._instantiateWalkers();var t=this.walkerA.end(e),r=this.walkerB.end(e);return t&&!r?t:r&&!t?r:!(!t||!r)&&t.concat(r)},t.prototype._instantiateWalkers=function(){void 0===this.walkerA&&(this.walkerA=this.el.patA.newWalker(this.nameResolver)),void 0===this.walkerB&&(this.walkerB=this.el.patB.newWalker(this.nameResolver))},t}(i.Walker);i.addWalker(o,a)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),o=r(0),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(o.OneSubpattern);t.List=a;var s=function(e){function t(r,n){var i=this;if(r instanceof t){var a=r,s=o.isHashMap(n,"as 2nd argument");i=e.call(this,a,s)||this,i.nameResolver=i._cloneIfNeeded(a.nameResolver,s),i.subwalker=a.subwalker._clone(s),i.seenTokens=a.seenTokens,i.matched=a.matched}else{var l=r,u=o.isNameResolver(n,"as 2nd argument");i=e.call(this,l)||this,i.nameResolver=u,i.subwalker=l.pat.newWalker(i.nameResolver),i.seenTokens=!1,i.matched=!1}return i}return n(t,e),t.prototype.fireEvent=function(e){if("text"===e.params[0]){var t=e.params[1].trim();if(""===t)return!1;this.seenTokens=!0;for(var r=t.split(/\s+/),n=0,i=r;n<i.length;n++){var a=i[n],s=this.subwalker.fireEvent(new o.Event(e.params[0],a));if(s!==!1)return s}return this.matched=!0,!1}},t.prototype._suppressAttributes=function(){},t.prototype.canEnd=function(e){return void 0===e&&(e=!1),this.seenTokens?this.subwalker.canEnd(e):this.subwalker.fireEvent(o.emptyEvent)===!1},t.prototype.end=function(e){void 0===e&&(e=!1);var t=this.subwalker.end(e);return t!==!1?t:!this.canEnd(e)&&[new i.ValidationError("unfulfilled list")]},t}(o.SingleSubwalker);o.addWalker(a,s)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(i.OneSubpattern);t.OneOrMore=o;var a=function(e){function t(r,n){var o=this;if(r instanceof t){var a=r,s=i.isHashMap(n);o=e.call(this,a,s)||this,o.seenOnce=a.seenOnce,o.nameResolver=o._cloneIfNeeded(a.nameResolver,s),o.currentIteration=void 0!==a.currentIteration?a.currentIteration._clone(s):void 0,o.nextIteration=void 0!==a.nextIteration?a.nextIteration._clone(s):void 0}else{var l=r,u=i.isNameResolver(n);o=e.call(this,l)||this,o.nameResolver=u,o.seenOnce=!1}return o}return n(t,e),t.prototype._possible=function(){if(void 0!==this.possibleCached)return this.possibleCached;if(this._instantiateCurrentIteration(),this.possibleCached=this.currentIteration._possible(),this.currentIteration.canEnd()){this.possibleCached=new i.EventSet(this.possibleCached),this._instantiateNextIteration();var e=this.nextIteration._possible();this.possibleCached.union(e)}return this.possibleCached},t.prototype.fireEvent=function(e){this.possibleCached=void 0,this._instantiateCurrentIteration();var t=this.currentIteration,r=t.fireEvent(e);if(r===!1&&(this.seenOnce=!0),void 0!==r)return r;if(this.seenOnce&&t.canEnd()){if(r=t.end())throw new Error("internal error; canEnd() returns true but end() fails");this._instantiateNextIteration();var n=this.nextIteration.fireEvent(e);return n===!1&&(this.currentIteration=this.nextIteration,this.nextIteration=void 0),n}},t.prototype._suppressAttributes=function(){this._instantiateCurrentIteration(),this.suppressedAttributes||(this.suppressedAttributes=!0,this.possibleCached=void 0,this.currentIteration._suppressAttributes(),void 0!==this.nextIteration&&this.nextIteration._suppressAttributes())},t.prototype.canEnd=function(e){return void 0===e&&(e=!1),e?!this.el.pat._hasAttrs()||(this._instantiateCurrentIteration(),this.currentIteration.canEnd(!0)):this.seenOnce&&this.currentIteration.canEnd()},t.prototype.end=function(e){return void 0===e&&(e=!1),!this.canEnd(e)&&(this._instantiateCurrentIteration(),this.currentIteration.end(e))},t.prototype._instantiateCurrentIteration=function(){void 0===this.currentIteration&&(this.currentIteration=this.el.pat.newWalker(this.nameResolver))},t.prototype._instantiateNextIteration=function(){void 0===this.nextIteration&&(this.nextIteration=this.el.pat.newWalker(this.nameResolver),this.suppressedAttributes&&this.nextIteration._suppressAttributes())},t}(i.Walker);i.addWalker(o,a)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=function(e){function t(t){e.call(this,t)||this;throw new Error("this pattern is a placeholder and should never actually be used")}return n(t,e),t}(i.Pattern);t.Param=o},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=r(6),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(i.Pattern);t.Text=a;var s=function(e){function t(r,n){var a=this;if(r instanceof o.NotAllowedWalker){var s=r;n=i.isHashMap(n),a=e.call(this,s,n)||this}else a=e.call(this,r)||this,a.possibleCached=new i.EventSet(t._textEvent);return a}return n(t,e),t.prototype._possible=function(){return this.possibleCached},t.prototype.fireEvent=function(e){return"text"!==e.params[0]&&void 0},t}(i.Walker);s._textEvent=new i.Event("text",/^.*$/),i.addWalker(a,s)},function(e,t,r){var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(10),o=r(1),a=r(3),s=r(0),l=function(e){function t(t,r,n,o,a){void 0===n&&(n="token"),void 0===o&&(o=""),void 0===a&&(a="");var s=e.call(this,t)||this;if(s.type=n,s.datatypeLibrary=o,s.ns=a,s.datatype=i.registry.get(s.datatypeLibrary).types[s.type],void 0===s.datatype)throw new Error("unkown type: "+n);return s.rawValue=r,s}return n(t,e),Object.defineProperty(t.prototype,"value",{get:function(){var e=this._value;if(null!=e)return e;var t;if(this.datatype.needsContext){var r=new a.NameResolver;r.definePrefix("",this.ns),t={resolver:r}}return e=this._value=this.datatype.parseValue(this.rawValue,t)},enumerable:!0,configurable:!0}),t}(s.Pattern);t.Value=l;var u=function(e){function t(r,n){var i=this;if(r instanceof t){var o=r,a=s.isHashMap(n,"as 2nd argument");i=e.call(this,o,a)||this,i.nameResolver=i._cloneIfNeeded(o.nameResolver,a),i.context=void 0!==o.context?{resolver:i.nameResolver}:void 0,i.matched=o.matched}else{var l=r,u=s.isNameResolver(n,"as 2nd argument");i=e.call(this,l)||this,i.nameResolver=u,i.possibleCached=new s.EventSet(new s.Event("text",l.rawValue)),i.context=l.datatype.needsContext?{resolver:i.nameResolver}:void 0,i.matched=!1}return i}return n(t,e),t.prototype._possible=function(){return this.possibleCached},t.prototype.fireEvent=function(e){if(!this.matched&&"text"===e.params[0]&&this.el.datatype.equal(e.params[1],this.el.value,this.context))return this.matched=!0,this.possibleCached=new s.EventSet,!1},t.prototype.canEnd=function(e){return void 0===e&&(e=!1),this.matched||""===this.el.rawValue},t.prototype.end=function(e){return void 0===e&&(e=!1),!this.canEnd(e)&&[new o.ValidationError("value required: "+this.el.rawValue)]},t.prototype._suppressAttributes=function(){},t}(s.Walker);s.addWalker(l,u)},function(e,t,r){function n(e){return void 0===e?"undefined":null===e?"null":e.toString()}Object.defineProperty(t,"__esModule",{value:!0}),t.inspect=n},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.version="4.1.2";var n=r(9);t.eventsToTreeString=n.eventsToTreeString,t.Event=n.Event,t.EventSet=n.EventSet,t.Grammar=n.Grammar,t.GrammarWalker=n.GrammarWalker,t.BasePattern=n.BasePattern,t.RefError=n.RefError,t.Walker=n.Walker,t.__test=n.__test;var i=r(14);t.constructTree=i.constructTree;var o=r(4);t.EName=o.EName;var a=r(1);t.AttributeNameError=a.AttributeNameError,t.AttributeValueError=a.AttributeValueError,t.ChoiceError=a.ChoiceError,t.ElementNameError=a.ElementNameError,t.ValidationError=a.ValidationError;var s=r(3);t.NameResolver=s.NameResolver;var l=r(2);t.BaseName=l.Base,t.Name=l.Name,t.NameChoice=l.NameChoice,t.NsName=l.NsName,t.AnyName=l.AnyName;var u=r(8);t.HashMap=u.HashMap},function(e,t){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function i(e){if(c===setTimeout)return setTimeout(e,0);if((c===r||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function o(e){if(h===clearTimeout)return clearTimeout(e);if((h===n||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{return h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}function a(){m&&p&&(m=!1,p.length?f=p.concat(f):v=-1,f.length&&s())}function s(){if(!m){var e=i(a);m=!0;for(var t=f.length;t;){for(p=f,f=[];++v<t;)p&&p[v].run();v=-1,t=f.length}p=null,m=!1,o(e)}}function l(e,t){this.fun=e,this.array=t}function u(){}var c,h,d=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:r}catch(e){c=r}try{h="function"==typeof clearTimeout?clearTimeout:n}catch(e){h=n}}();var p,f=[],m=!1,v=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];f.push(new l(e,t)),1!==f.length||m||i(s)},l.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=u,d.addListener=u,d.once=u,d.off=u,d.removeListener=u,d.removeAllListeners=u,d.emit=u,d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){e.exports=function(e){"use strict";function t(e){var t=/^(?:\(\?:\))*\^/,r=/\$(?:\(\?:\))*$/;return t.test(e)&&r.test(e)&&r.test(e.replace(/\\[\s\S]/g,""))?e.replace(t,"").replace(r,""):e}function r(t){return e.isRegExp(t)?t[n]&&t[n].captureNames?t:e(t.source):e(t)}var n="xregexp",i=/(\()(?!\?)|\\([1-9]\d*)|\\[\s\S]|\[(?:[^\\\]]|\\[\s\S])*]/g,o=e.union([/\({{([\w$]+)}}\)|{{([\w$]+)}}/,i],"g");e.build=function(a,s,l){var u,c,h,d,p=/^\(\?([\w$]+)\)/.exec(a),f={},m=0,v=0,y=[0];p&&(l=l||"",p[1].replace(/./g,function(e){l+=l.indexOf(e)>-1?"":e}));for(d in s)s.hasOwnProperty(d)&&(h=r(s[d]),f[d]={pattern:t(h.source),names:h[n].captureNames||[]});return a=r(a),c=a[n].captureNames||[],a=a.source.replace(o,function(e,t,r,n,o){var a,s,l,h=t||r;if(h){if(!f.hasOwnProperty(h))throw new ReferenceError("Undefined property "+e);return t?(a=c[v],y[++v]=++m,s="(?<"+(a||h)+">"):s="(?:",u=m,s+f[h].pattern.replace(i,function(e,t,r){if(t){if(a=f[h].names[m-u],++m,a)return"(?<"+a+">"}else if(r)return l=+r-1,f[h].names[l]?"\\k<"+f[h].names[l]+">":"\\"+(+r+u);return e})+")"}if(n){if(a=c[v],y[++v]=++m,a)return"(?<"+a+">"}else if(o)return l=+o-1,c[l]?"\\k<"+c[l]+">":"\\"+y[+o];return e}),e(a,l)}}},function(e,t){e.exports=function(e){"use strict";function t(e,t,r,n){return{name:e,value:t,start:r,end:n}}e.matchRecursive=function(r,n,i,o,a){o=o||"",a=a||{};var s,l,u,c,h,d=o.indexOf("g")>-1,p=o.indexOf("y")>-1,f=o.replace(/y/g,""),m=a.escapeChar,v=a.valueNames,y=[],g=0,b=0,w=0,_=0;
if(n=e(n,f),i=e(i,f),m){if(m.length>1)throw new Error("Cannot use more than one escape character");m=e.escape(m),h=new RegExp("(?:"+m+"[\\S\\s]|(?:(?!"+e.union([n,i]).source+")[^"+m+"])+)+",o.replace(/[^imu]+/g,""))}for(;;){if(m&&(w+=(e.exec(r,h,w,"sticky")||[""])[0].length),u=e.exec(r,n,w),c=e.exec(r,i,w),u&&c&&(u.index<=c.index?c=null:u=null),u||c)b=(u||c).index,w=b+(u||c)[0].length;else if(!g)break;if(p&&!g&&b>_)break;if(u)g||(s=b,l=w),++g;else{if(!c||!g)throw new Error("Unbalanced delimiter found in string");if(!--g&&(v?(v[0]&&s>_&&y.push(t(v[0],r.slice(_,s),_,s)),v[1]&&y.push(t(v[1],r.slice(s,l),s,l)),v[2]&&y.push(t(v[2],r.slice(l,b),l,b)),v[3]&&y.push(t(v[3],r.slice(b,w),b,w))):y.push(r.slice(l,b)),_=w,!d))break}b===w&&++w}return d&&!p&&v&&v[0]&&r.length>_&&y.push(t(v[0],r.slice(_),_,r.length)),y}}},function(e,t){e.exports=function(e){"use strict";function t(e){return e.replace(/[- _]+/g,"").toLowerCase()}function r(e){var t=/^\\[xu](.+)/.exec(e);return t?l(t[1]):e.charCodeAt("\\"===e.charAt(0)?1:0)}function n(t){var n="",i=-1;return e.forEach(t,/(\\x..|\\u....|\\?[\s\S])(?:-(\\x..|\\u....|\\?[\s\S]))?/,function(e){var t=r(e[1]);t>i+1&&(n+="\\u"+c(u(i+1)),t>i+2&&(n+="-\\u"+c(u(t-1)))),i=r(e[2]||e[1])}),i<65535&&(n+="\\u"+c(u(i+1)),i<65534&&(n+="-\\uFFFF")),n}function i(e){var t="b!";return s[e][t]||(s[e][t]=n(s[e].bmp))}function o(e,t){var r=s[e],n="";return r.bmp&&!r.isBmpLast&&(n="["+r.bmp+"]"+(r.astral?"|":"")),r.astral&&(n+=r.astral),r.isBmpLast&&r.bmp&&(n+=(r.astral?"|":"")+"["+r.bmp+"]"),t?"(?:(?!"+n+")(?:[�-�][�-�]|[\0-￿]))":"(?:"+n+")"}function a(e,t){var r=t?"a!":"a=";return s[e][r]||(s[e][r]=o(e,t))}var s={},l=e._dec,u=e._hex,c=e._pad4;e.addToken(/\\([pP])(?:{(\^?)([^}]*)}|([A-Za-z]))/,function(e,r,n){var o="Invalid double negation ",l="Unknown Unicode token ",u="Unicode token missing data ",c="Astral mode required for Unicode token ",h="Astral mode does not support Unicode tokens within character classes",d="P"===e[1]||!!e[2],p=n.indexOf("A")>-1,f=t(e[4]||e[3]),m=s[f];if("P"===e[1]&&e[2])throw new SyntaxError(o+e[0]);if(!s.hasOwnProperty(f))throw new SyntaxError(l+e[0]);if(m.inverseOf){if(f=t(m.inverseOf),!s.hasOwnProperty(f))throw new ReferenceError(u+e[0]+" -> "+m.inverseOf);m=s[f],d=!d}if(!m.bmp&&!p)throw new SyntaxError(c+e[0]);if(p){if("class"===r)throw new SyntaxError(h);return a(f,d)}return"class"===r?d?i(f):m.bmp:(d?"[^":"[")+m.bmp+"]"},{scope:"all",optionalFlags:"A",leadChar:"\\"}),e.addUnicodeData=function(r){var n,i,o="Unicode token requires name",a="Unicode token has no character data ";for(i=0;i<r.length;++i){if(n=r[i],!n.name)throw new Error(o);if(!(n.inverseOf||n.bmp||n.astral))throw new Error(a+n.name);s[t(n.name)]=n,n.alias&&(s[t(n.alias)]=n)}e.cache.flush("patterns")}}},function(e,t){e.exports=function(e){"use strict";if(!e.addUnicodeData)throw new ReferenceError("Unicode Base must be loaded before Unicode Blocks");e.addUnicodeData([{name:"InAegean_Numbers",astral:"�[�-�]"},{name:"InAhom",astral:"�[�-�]"},{name:"InAlchemical_Symbols",astral:"�[�-�]"},{name:"InAlphabetic_Presentation_Forms",bmp:"ﬀ-ﭏ"},{name:"InAnatolian_Hieroglyphs",astral:"�[�-�]"},{name:"InAncient_Greek_Musical_Notation",astral:"�[�-�]"},{name:"InAncient_Greek_Numbers",astral:"�[�-�]"},{name:"InAncient_Symbols",astral:"�[�-�]"},{name:"InArabic",bmp:"؀-ۿ"},{name:"InArabic_Extended_A",bmp:"ࢠ-ࣿ"},{name:"InArabic_Mathematical_Alphabetic_Symbols",astral:"�[�-�]"},{name:"InArabic_Presentation_Forms_A",bmp:"ﭐ-﷿"},{name:"InArabic_Presentation_Forms_B",bmp:"ﹰ-\ufeff"},{name:"InArabic_Supplement",bmp:"ݐ-ݿ"},{name:"InArmenian",bmp:"԰-֏"},{name:"InArrows",bmp:"←-⇿"},{name:"InAvestan",astral:"�[�-�]"},{name:"InBalinese",bmp:"ᬀ-᭿"},{name:"InBamum",bmp:"ꚠ-꛿"},{name:"InBamum_Supplement",astral:"�[�-�]"},{name:"InBasic_Latin",bmp:"\0-"},{name:"InBassa_Vah",astral:"�[�-�]"},{name:"InBatak",bmp:"ᯀ-᯿"},{name:"InBengali",bmp:"ঀ-৿"},{name:"InBlock_Elements",bmp:"▀-▟"},{name:"InBopomofo",bmp:"㄀-ㄯ"},{name:"InBopomofo_Extended",bmp:"ㆠ-ㆿ"},{name:"InBox_Drawing",bmp:"─-╿"},{name:"InBrahmi",astral:"�[�-�]"},{name:"InBraille_Patterns",bmp:"⠀-⣿"},{name:"InBuginese",bmp:"ᨀ-᨟"},{name:"InBuhid",bmp:"ᝀ-᝟"},{name:"InByzantine_Musical_Symbols",astral:"�[�-�]"},{name:"InCJK_Compatibility",bmp:"㌀-㏿"},{name:"InCJK_Compatibility_Forms",bmp:"︰-﹏"},{name:"InCJK_Compatibility_Ideographs",bmp:"豈-﫿"},{name:"InCJK_Compatibility_Ideographs_Supplement",astral:"�[�-�]"},{name:"InCJK_Radicals_Supplement",bmp:"⺀-⻿"},{name:"InCJK_Strokes",bmp:"㇀-㇯"},{name:"InCJK_Symbols_and_Punctuation",bmp:"　-〿"},{name:"InCJK_Unified_Ideographs",bmp:"一-鿿"},{name:"InCJK_Unified_Ideographs_Extension_A",bmp:"㐀-䶿"},{name:"InCJK_Unified_Ideographs_Extension_B",astral:"[�-�][�-�]|�[�-�]"},{name:"InCJK_Unified_Ideographs_Extension_C",astral:"�[�-�]|[�-�][�-�]|�[�-�]"},{name:"InCJK_Unified_Ideographs_Extension_D",astral:"�[�-�]|�[�-�]"},{name:"InCJK_Unified_Ideographs_Extension_E",astral:"[�-�][�-�]|�[�-�]|�[�-�]"},{name:"InCarian",astral:"�[�-�]"},{name:"InCaucasian_Albanian",astral:"�[�-�]"},{name:"InChakma",astral:"�[�-�]"},{name:"InCham",bmp:"ꨀ-꩟"},{name:"InCherokee",bmp:"Ꭰ-᏿"},{name:"InCherokee_Supplement",bmp:"ꭰ-ꮿ"},{name:"InCombining_Diacritical_Marks",bmp:"̀-ͯ"},{name:"InCombining_Diacritical_Marks_Extended",bmp:"᪰-᫿"},{name:"InCombining_Diacritical_Marks_Supplement",bmp:"᷀-᷿"},{name:"InCombining_Diacritical_Marks_for_Symbols",bmp:"⃐-⃿"},{name:"InCombining_Half_Marks",bmp:"︠-︯"},{name:"InCommon_Indic_Number_Forms",bmp:"꠰-꠿"},{name:"InControl_Pictures",bmp:"␀-␿"},{name:"InCoptic",bmp:"Ⲁ-⳿"},{name:"InCoptic_Epact_Numbers",astral:"�[�-�]"},{name:"InCounting_Rod_Numerals",astral:"�[�-�]"},{name:"InCuneiform",astral:"�[�-�]"},{name:"InCuneiform_Numbers_and_Punctuation",astral:"�[�-�]"},{name:"InCurrency_Symbols",bmp:"₠-⃏"},{name:"InCypriot_Syllabary",astral:"�[�-�]"},{name:"InCyrillic",bmp:"Ѐ-ӿ"},{name:"InCyrillic_Extended_A",bmp:"ⷠ-ⷿ"},{name:"InCyrillic_Extended_B",bmp:"Ꙁ-ꚟ"},{name:"InCyrillic_Supplement",bmp:"Ԁ-ԯ"},{name:"InDeseret",astral:"�[�-�]"},{name:"InDevanagari",bmp:"ऀ-ॿ"},{name:"InDevanagari_Extended",bmp:"꣠-ꣿ"},{name:"InDingbats",bmp:"✀-➿"},{name:"InDomino_Tiles",astral:"�[�-�]"},{name:"InDuployan",astral:"�[�-�]"},{name:"InEarly_Dynastic_Cuneiform",astral:"�[�-�]"},{name:"InEgyptian_Hieroglyphs",astral:"�[�-�]|�[�-�]"},{name:"InElbasan",astral:"�[�-�]"},{name:"InEmoticons",astral:"�[�-�]"},{name:"InEnclosed_Alphanumeric_Supplement",astral:"�[�-�]"},{name:"InEnclosed_Alphanumerics",bmp:"①-⓿"},{name:"InEnclosed_CJK_Letters_and_Months",bmp:"㈀-㋿"},{name:"InEnclosed_Ideographic_Supplement",astral:"�[�-�]"},{name:"InEthiopic",bmp:"ሀ-፿"},{name:"InEthiopic_Extended",bmp:"ⶀ-⷟"},{name:"InEthiopic_Extended_A",bmp:"꬀-꬯"},{name:"InEthiopic_Supplement",bmp:"ᎀ-᎟"},{name:"InGeneral_Punctuation",bmp:" -⁯"},{name:"InGeometric_Shapes",bmp:"■-◿"},{name:"InGeometric_Shapes_Extended",astral:"�[�-�]"},{name:"InGeorgian",bmp:"Ⴀ-ჿ"},{name:"InGeorgian_Supplement",bmp:"ⴀ-⴯"},{name:"InGlagolitic",bmp:"Ⰰ-ⱟ"},{name:"InGothic",astral:"�[�-�]"},{name:"InGrantha",astral:"�[�-�]"},{name:"InGreek_Extended",bmp:"ἀ-῿"},{name:"InGreek_and_Coptic",bmp:"Ͱ-Ͽ"},{name:"InGujarati",bmp:"઀-૿"},{name:"InGurmukhi",bmp:"਀-੿"},{name:"InHalfwidth_and_Fullwidth_Forms",bmp:"＀-￯"},{name:"InHangul_Compatibility_Jamo",bmp:"㄰-㆏"},{name:"InHangul_Jamo",bmp:"ᄀ-ᇿ"},{name:"InHangul_Jamo_Extended_A",bmp:"ꥠ-꥿"},{name:"InHangul_Jamo_Extended_B",bmp:"ힰ-퟿"},{name:"InHangul_Syllables",bmp:"가-힯"},{name:"InHanunoo",bmp:"ᜠ-᜿"},{name:"InHatran",astral:"�[�-�]"},{name:"InHebrew",bmp:"֐-׿"},{name:"InHigh_Private_Use_Surrogates",bmp:"�-�"},{name:"InHigh_Surrogates",bmp:"�-�"},{name:"InHiragana",bmp:"぀-ゟ"},{name:"InIPA_Extensions",bmp:"ɐ-ʯ"},{name:"InIdeographic_Description_Characters",bmp:"⿰-⿿"},{name:"InImperial_Aramaic",astral:"�[�-�]"},{name:"InInscriptional_Pahlavi",astral:"�[�-�]"},{name:"InInscriptional_Parthian",astral:"�[�-�]"},{name:"InJavanese",bmp:"ꦀ-꧟"},{name:"InKaithi",astral:"�[�-�]"},{name:"InKana_Supplement",astral:"�[�-�]"},{name:"InKanbun",bmp:"㆐-㆟"},{name:"InKangxi_Radicals",bmp:"⼀-⿟"},{name:"InKannada",bmp:"ಀ-೿"},{name:"InKatakana",bmp:"゠-ヿ"},{name:"InKatakana_Phonetic_Extensions",bmp:"ㇰ-ㇿ"},{name:"InKayah_Li",bmp:"꤀-꤯"},{name:"InKharoshthi",astral:"�[�-�]"},{name:"InKhmer",bmp:"ក-៿"},{name:"InKhmer_Symbols",bmp:"᧠-᧿"},{name:"InKhojki",astral:"�[�-�]"},{name:"InKhudawadi",astral:"�[�-�]"},{name:"InLao",bmp:"຀-໿"},{name:"InLatin_Extended_Additional",bmp:"Ḁ-ỿ"},{name:"InLatin_Extended_A",bmp:"Ā-ſ"},{name:"InLatin_Extended_B",bmp:"ƀ-ɏ"},{name:"InLatin_Extended_C",bmp:"Ⱡ-Ɀ"},{name:"InLatin_Extended_D",bmp:"꜠-ꟿ"},{name:"InLatin_Extended_E",bmp:"ꬰ-꭯"},{name:"InLatin_1_Supplement",bmp:"-ÿ"},{name:"InLepcha",bmp:"ᰀ-ᱏ"},{name:"InLetterlike_Symbols",bmp:"℀-⅏"},{name:"InLimbu",bmp:"ᤀ-᥏"},{name:"InLinear_A",astral:"�[�-�]"},{name:"InLinear_B_Ideograms",astral:"�[�-�]"},{name:"InLinear_B_Syllabary",astral:"�[�-�]"},{name:"InLisu",bmp:"ꓐ-꓿"},{name:"InLow_Surrogates",bmp:"�-�"},{name:"InLycian",astral:"�[�-�]"},{name:"InLydian",astral:"�[�-�]"},{name:"InMahajani",astral:"�[�-�]"},{name:"InMahjong_Tiles",astral:"�[�-�]"},{name:"InMalayalam",bmp:"ഀ-ൿ"},{name:"InMandaic",bmp:"ࡀ-࡟"},{name:"InManichaean",astral:"�[�-�]"},{name:"InMathematical_Alphanumeric_Symbols",astral:"�[�-�]"},{name:"InMathematical_Operators",bmp:"∀-⋿"},{name:"InMeetei_Mayek",bmp:"ꯀ-꯿"},{name:"InMeetei_Mayek_Extensions",bmp:"ꫠ-꫿"},{name:"InMende_Kikakui",astral:"�[�-�]"},{name:"InMeroitic_Cursive",astral:"�[�-�]"},{name:"InMeroitic_Hieroglyphs",astral:"�[�-�]"},{name:"InMiao",astral:"�[�-�]"},{name:"InMiscellaneous_Mathematical_Symbols_A",bmp:"⟀-⟯"},{name:"InMiscellaneous_Mathematical_Symbols_B",bmp:"⦀-⧿"},{name:"InMiscellaneous_Symbols",bmp:"☀-⛿"},{name:"InMiscellaneous_Symbols_and_Arrows",bmp:"⬀-⯿"},{name:"InMiscellaneous_Symbols_and_Pictographs",astral:"�[�-�]|�[�-�]"},{name:"InMiscellaneous_Technical",bmp:"⌀-⏿"},{name:"InModi",astral:"�[�-�]"},{name:"InModifier_Tone_Letters",bmp:"꜀-ꜟ"},{name:"InMongolian",bmp:"᠀-᢯"},{name:"InMro",astral:"�[�-�]"},{name:"InMultani",astral:"�[�-�]"},{name:"InMusical_Symbols",astral:"�[�-�]"},{name:"InMyanmar",bmp:"က-႟"},{name:"InMyanmar_Extended_A",bmp:"ꩠ-ꩿ"},{name:"InMyanmar_Extended_B",bmp:"ꧠ-꧿"},{name:"InNKo",bmp:"߀-߿"},{name:"InNabataean",astral:"�[�-�]"},{name:"InNew_Tai_Lue",bmp:"ᦀ-᧟"},{name:"InNumber_Forms",bmp:"⅐-↏"},{name:"InOgham",bmp:" -᚟"},{name:"InOl_Chiki",bmp:"᱐-᱿"},{name:"InOld_Hungarian",astral:"�[�-�]"},{name:"InOld_Italic",astral:"�[�-�]"},{name:"InOld_North_Arabian",astral:"�[�-�]"},{name:"InOld_Permic",astral:"�[�-�]"},{name:"InOld_Persian",astral:"�[�-�]"},{name:"InOld_South_Arabian",astral:"�[�-�]"},{name:"InOld_Turkic",astral:"�[�-�]"},{name:"InOptical_Character_Recognition",bmp:"⑀-⑟"},{name:"InOriya",bmp:"଀-୿"},{name:"InOrnamental_Dingbats",astral:"�[�-�]"},{name:"InOsmanya",astral:"�[�-�]"},{name:"InPahawh_Hmong",astral:"�[�-�]"},{name:"InPalmyrene",astral:"�[�-�]"},{name:"InPau_Cin_Hau",astral:"�[�-�]"},{name:"InPhags_pa",bmp:"ꡀ-꡿"},{name:"InPhaistos_Disc",astral:"�[�-�]"},{name:"InPhoenician",astral:"�[�-�]"},{name:"InPhonetic_Extensions",bmp:"ᴀ-ᵿ"},{name:"InPhonetic_Extensions_Supplement",bmp:"ᶀ-ᶿ"},{name:"InPlaying_Cards",astral:"�[�-�]"},{name:"InPrivate_Use_Area",bmp:"-"},{name:"InPsalter_Pahlavi",astral:"�[�-�]"},{name:"InRejang",bmp:"ꤰ-꥟"},{name:"InRumi_Numeral_Symbols",astral:"�[�-�]"},{name:"InRunic",bmp:"ᚠ-᛿"},{name:"InSamaritan",bmp:"ࠀ-࠿"},{name:"InSaurashtra",bmp:"ꢀ-꣟"},{name:"InSharada",astral:"�[�-�]"},{name:"InShavian",astral:"�[�-�]"},{name:"InShorthand_Format_Controls",astral:"�[�-�]"},{name:"InSiddham",astral:"�[�-�]"},{name:"InSinhala",bmp:"඀-෿"},{name:"InSinhala_Archaic_Numbers",astral:"�[�-�]"},{name:"InSmall_Form_Variants",bmp:"﹐-﹯"},{name:"InSora_Sompeng",astral:"�[�-�]"},{name:"InSpacing_Modifier_Letters",bmp:"ʰ-˿"},{name:"InSpecials",bmp:"￰-￿"},{name:"InSundanese",bmp:"ᮀ-ᮿ"},{name:"InSundanese_Supplement",bmp:"᳀-᳏"},{name:"InSuperscripts_and_Subscripts",bmp:"⁰-₟"},{name:"InSupplemental_Arrows_A",bmp:"⟰-⟿"},{name:"InSupplemental_Arrows_B",bmp:"⤀-⥿"},{name:"InSupplemental_Arrows_C",astral:"�[�-�]"},{name:"InSupplemental_Mathematical_Operators",bmp:"⨀-⫿"},{name:"InSupplemental_Punctuation",bmp:"⸀-⹿"},{name:"InSupplemental_Symbols_and_Pictographs",astral:"�[�-�]"},{name:"InSupplementary_Private_Use_Area_A",astral:"[�-�][�-�]"},{name:"InSupplementary_Private_Use_Area_B",astral:"[�-�][�-�]"},{name:"InSutton_SignWriting",astral:"�[�-�]"},{name:"InSyloti_Nagri",bmp:"ꠀ-꠯"},{name:"InSyriac",bmp:"܀-ݏ"},{name:"InTagalog",bmp:"ᜀ-ᜟ"},{name:"InTagbanwa",bmp:"ᝠ-᝿"},{name:"InTags",astral:"�[�-�]"},{name:"InTai_Le",bmp:"ᥐ-᥿"},{name:"InTai_Tham",bmp:"ᨠ-᪯"},{name:"InTai_Viet",bmp:"ꪀ-꫟"},{name:"InTai_Xuan_Jing_Symbols",astral:"�[�-�]"},{name:"InTakri",astral:"�[�-�]"},{name:"InTamil",bmp:"஀-௿"},{name:"InTelugu",bmp:"ఀ-౿"},{name:"InThaana",bmp:"ހ-޿"},{name:"InThai",bmp:"฀-๿"},{name:"InTibetan",bmp:"ༀ-࿿"},{name:"InTifinagh",bmp:"ⴰ-⵿"},{name:"InTirhuta",astral:"�[�-�]"},{name:"InTransport_and_Map_Symbols",astral:"�[�-�]"},{name:"InUgaritic",astral:"�[�-�]"},{name:"InUnified_Canadian_Aboriginal_Syllabics",bmp:"᐀-ᙿ"},{name:"InUnified_Canadian_Aboriginal_Syllabics_Extended",bmp:"ᢰ-᣿"},{name:"InVai",bmp:"ꔀ-꘿"},{name:"InVariation_Selectors",bmp:"︀-️"},{name:"InVariation_Selectors_Supplement",astral:"�[�-�]"},{name:"InVedic_Extensions",bmp:"᳐-᳿"},{name:"InVertical_Forms",bmp:"︐-︟"},{name:"InWarang_Citi",astral:"�[�-�]"},{name:"InYi_Radicals",bmp:"꒐-꓏"},{name:"InYi_Syllables",bmp:"ꀀ-꒏"},{name:"InYijing_Hexagram_Symbols",bmp:"䷀-䷿"}])}},function(e,t){e.exports=function(e){"use strict";if(!e.addUnicodeData)throw new ReferenceError("Unicode Base must be loaded before Unicode Categories");e.addUnicodeData([{name:"C",alias:"Other",isBmpLast:!0,bmp:"\0--­͸͹΀-΃΋΍΢԰՗՘ՠֈ֋֌֐׈-׏׫-ׯ׵-؅؜؝۝܎܏݋݌޲-޿߻-߿࠮࠯࠿࡜࡝࡟-࢟ࢵ-࣢঄঍঎঑঒঩঱঳-঵঺঻৅৆৉৊৏-৖৘-৛৞৤৥ৼ-਀਄਋-਎਑਒਩਱਴਷਺਻਽੃-੆੉੊੎-੐੒-੘੝੟-੥੶-઀઄઎઒઩઱઴઺઻૆૊૎૏૑-૟૤૥૲-૸ૺ-଀଄଍଎଑଒଩଱଴଺଻୅୆୉୊୎-୕୘-୛୞୤୥୸-஁஄஋-஍஑஖-஘஛஝஠-஢஥-஧஫-஭஺-஽௃-௅௉௎௏௑-௖௘-௥௻-௿ఄ఍఑఩఺-఼౅౉౎-౔౗౛-౟౤౥౰-౷ಀ಄಍಑಩಴಺಻೅೉೎-೔೗-ೝ೟೤೥೰ೳ-ഀഄ഍഑഻഼൅൉൏-ൖ൘-൞൤൥൶-൸඀ඁ඄඗-඙඲඼඾඿෇-෉෋-෎෕෗෠-෥෰෱෵-฀฻-฾๜-຀຃຅ຆຉ຋ຌຎ-ຓຘຠ຤຦ຨຩຬ຺຾຿໅໇໎໏໚໛໠-໿཈཭-཰྘྽࿍࿛-࿿჆჈-჌჎჏቉቎቏቗቙቞቟኉኎኏኱኶኷኿዁዆዇዗጑጖጗፛፜፽-፿᎚-᎟᏶᏷᏾᏿᚝-᚟᛹-᛿ᜍ᜕-ᜟ᜷-᜿᝔-᝟᝭᝱᝴-᝿៞៟៪-៯៺-៿᠎᠏᠚-᠟ᡸ-᡿᢫-᢯᣶-᣿᤟᤬-᤯᤼-᤿᥁-᥃᥮᥯᥵-᥿᦬-᦯᧊-᧏᧛-᧝᨜᨝᩟᩽᩾᪊-᪏᪚-᪟᪮᪯ᪿ-᫿ᭌ-᭏᭽-᭿᯴-᯻᰸-᰺᱊-᱌ᲀ-Ჿ᳈-᳏᳷ᳺ-᳿᷶-᷻἖἗἞἟὆὇὎὏὘὚὜὞὾὿᾵῅῔῕῜῰῱῵῿​-‏‪-‮⁠-⁯⁲⁳₏₝-₟₿-⃏⃱-⃿↌-↏⏻-⏿␧-␿⑋-⑟⭴⭵⮖⮗⮺-⮼⯉⯒-⯫⯰-⯿Ⱟⱟ⳴-⳸⴦⴨-⴬⴮⴯⵨-⵮⵱-⵾⶗-⶟⶧⶯⶷⶿⷇⷏⷗⷟⹃-⹿⺚⻴-⻿⿖-⿯⿼-⿿぀゗゘㄀-㄄ㄮ-㄰㆏ㆻ-ㆿ㇤-㇯㈟㋿䶶-䶿鿖-鿿꒍-꒏꓇-꓏꘬-꘿꛸-꛿ꞮꞯꞸ-ꟶ꠬-꠯꠺-꠿꡸-꡿ꣅ-꣍꣚-꣟ꣾꣿ꥔-꥞꥽-꥿꧎꧚-꧝꧿꨷-꨿꩎꩏꩚꩛꫃-꫚꫷-꬀꬇꬈꬏꬐꬗-꬟꬧꬯ꭦ-꭯꯮꯯꯺-꯿힤-힯퟇-퟊퟼-﩮﩯﫚-﫿﬇-﬒﬘-﬜﬷﬽﬿﭂﭅﯂-﯒﵀-﵏﶐﶑﷈-﷯﷾﷿︚-︟﹓﹧﹬-﹯﹵﻽-＀﾿-￁￈￉￐￑￘￙￝-￟￧￯-￻￾￿",astral:"�[�-����-��-��-��-��-�]|�[�-���-�]|�[�-��-������-��-���-��-��-��-��-��-�]|�[�-���-��-����-��-����-��-�]|�[��-��-�]|�[�-��-��-��-�]|�[��]|�[���-��-��-��-��-�]|�[���-��-��-��-��-��-��-�]|�[�������-��-��-��-��-��-��-��-��-��-��-��-��-��-���-��-�]|�[�-�]|�[�-�����������-��-�����������������������-����-��-�]|�[�-�]|�[�-��-�]|�[�-��-���-��-��-���-��-�����-���-������-��-��-������������������-��-����-��-�]|�[���-�]|�[�-�]|�[�-�]|[����-��-��-����-��-���-��-��-�][�-�]|�[�-��-��-��-�]|�[�-��-��-��-��-�]|�[���������������������-������]|�[�-��-��-����-��-��-��-��-��-��-��-�]|�[�����-�����-��-���-��-��-��-��-�����-����-��-��-��-��-��-��-��-����-��-��-��-�]|�[�-�]|�[�-��-��-����-�]|�[�-�]|�[�-�]|�[�-��-��-��-��-��-��-��-�]|�[�-�]"},{name:"Cc",alias:"Control",bmp:"\0--"},{name:"Cf",alias:"Format",bmp:"­؀-؅؜۝܏᠎​-‏‪-‮⁠-⁤⁦-⁯\ufeff￹-￻",astral:"�[��-�]|�[�-�]|�[�-�]|𑂽"},{name:"Cn",alias:"Unassigned",bmp:"͸͹΀-΃΋΍΢԰՗՘ՠֈ֋֌֐׈-׏׫-ׯ׵-׿؝܎݋݌޲-޿߻-߿࠮࠯࠿࡜࡝࡟-࢟ࢵ-࣢঄঍঎঑঒঩঱঳-঵঺঻৅৆৉৊৏-৖৘-৛৞৤৥ৼ-਀਄਋-਎਑਒਩਱਴਷਺਻਽੃-੆੉੊੎-੐੒-੘੝੟-੥੶-઀઄઎઒઩઱઴઺઻૆૊૎૏૑-૟૤૥૲-૸ૺ-଀଄଍଎଑଒଩଱଴଺଻୅୆୉୊୎-୕୘-୛୞୤୥୸-஁஄஋-஍஑஖-஘஛஝஠-஢஥-஧஫-஭஺-஽௃-௅௉௎௏௑-௖௘-௥௻-௿ఄ఍఑఩఺-఼౅౉౎-౔౗౛-౟౤౥౰-౷ಀ಄಍಑಩಴಺಻೅೉೎-೔೗-ೝ೟೤೥೰ೳ-ഀഄ഍഑഻഼൅൉൏-ൖ൘-൞൤൥൶-൸඀ඁ඄඗-඙඲඼඾඿෇-෉෋-෎෕෗෠-෥෰෱෵-฀฻-฾๜-຀຃຅ຆຉ຋ຌຎ-ຓຘຠ຤຦ຨຩຬ຺຾຿໅໇໎໏໚໛໠-໿཈཭-཰྘྽࿍࿛-࿿჆჈-჌჎჏቉቎቏቗቙቞቟኉኎኏኱኶኷኿዁዆዇዗጑጖጗፛፜፽-፿᎚-᎟᏶᏷᏾᏿᚝-᚟᛹-᛿ᜍ᜕-ᜟ᜷-᜿᝔-᝟᝭᝱᝴-᝿៞៟៪-៯៺-៿᠏᠚-᠟ᡸ-᡿᢫-᢯᣶-᣿᤟᤬-᤯᤼-᤿᥁-᥃᥮᥯᥵-᥿᦬-᦯᧊-᧏᧛-᧝᨜᨝᩟᩽᩾᪊-᪏᪚-᪟᪮᪯ᪿ-᫿ᭌ-᭏᭽-᭿᯴-᯻᰸-᰺᱊-᱌ᲀ-Ჿ᳈-᳏᳷ᳺ-᳿᷶-᷻἖἗἞἟὆὇὎὏὘὚὜὞὾὿᾵῅῔῕῜῰῱῵῿⁥⁲⁳₏₝-₟₿-⃏⃱-⃿↌-↏⏻-⏿␧-␿⑋-⑟⭴⭵⮖⮗⮺-⮼⯉⯒-⯫⯰-⯿Ⱟⱟ⳴-⳸⴦⴨-⴬⴮⴯⵨-⵮⵱-⵾⶗-⶟⶧⶯⶷⶿⷇⷏⷗⷟⹃-⹿⺚⻴-⻿⿖-⿯⿼-⿿぀゗゘㄀-㄄ㄮ-㄰㆏ㆻ-ㆿ㇤-㇯㈟㋿䶶-䶿鿖-鿿꒍-꒏꓇-꓏꘬-꘿꛸-꛿ꞮꞯꞸ-ꟶ꠬-꠯꠺-꠿꡸-꡿ꣅ-꣍꣚-꣟ꣾꣿ꥔-꥞꥽-꥿꧎꧚-꧝꧿꨷-꨿꩎꩏꩚꩛꫃-꫚꫷-꬀꬇꬈꬏꬐꬗-꬟꬧꬯ꭦ-꭯꯮꯯꯺-꯿힤-힯퟇-퟊퟼-퟿﩮﩯﫚-﫿﬇-﬒﬘-﬜﬷﬽﬿﭂﭅﯂-﯒﵀-﵏﶐﶑﷈-﷯﷾﷿︚-︟﹓﹧﹬-﹯﹵﻽﻾＀﾿-￁￈￉￐￑￘￙￝-￟￧￯-￸￾￿",astral:"�[��-��-��-�]|�[�-����-��-��-��-�]|�[�-��-������-��-���-��-��-��-��-��-�]|�[�-���-��-����-��-����-��-�]|�[��-��-�]|�[�-��-��-��-�]|�[��]|�[���-��-��-��-��-�]|�[���-��-��-��-��-��-��-�]|�[�������-��-��-��-��-��-��-��-��-��-��-��-��-��-���-��-�]|�[�-�]|�[�-�����������-��-�����������������������-����-��-�]|[��][��]|�[�-�]|�[�-��-��-����-�]|�[���-�]|�[�-�]|�[�-�]|[����-��-��-����-��-���-��-��-�][�-�]|�[�-��-��-��-�]|�[�-��-��-��-��-�]|�[���������������������-������]|�[�-���-�]|�[�-��-��-����-��-��-��-��-��-��-��-�]|�[�����-�����-��-���-��-��-��-��-�����-����-��-��-��-��-��-��-��-����-��-��-��-�]|�[�-�]|�[�-��-��-��-��-���-��-�����-���-������-��-��-������������������-��-����-��-�]|�[�-�]|�[�-�]|�[�-��-��-��-��-��-��-��-�]|�[�-�]"},{name:"Co",alias:"Private_Use",bmp:"-",astral:"[�-��-�][�-�]|[��][�-�]"},{name:"Cs",alias:"Surrogate",bmp:"�-�"},{name:"L",alias:"Letter",bmp:"A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠ-ࢴऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛱ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿕ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞭꞰ-ꞷꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭥꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",astral:"�[�-��-�]|�[�-��-�]|�[�-��-�]|�[�-��-��-�]|�[�-�]|�[�-��-��-��-��-��-�]|�[�-��-��-����-��-��-��-��-��-��-��-��-��-��-��-�]|�[�-�]|�[�-�]|�[�-���-�]|[��-��-��-�][�-�]|�[�-�����-��-��-���-��-�]|�[�-��-��-��-��-��-��-�]|�[�-�]|�[�-���-�����-��-��-��-����-��-��-�����-��-��-��-��-��-��-��-��-��-��-�]|�[�-��-�������-��-���-��-��-��-��-��-��-��-���-��-��-��-��-��-��-��-��-��-��-��-��-�]|�[�-��-��-��-��-���-��-����-��-��-���-��-��-��-��-����-��-����-����-�]|�[�-�]|�[�-��-������-��-��������-�������������-��-��-��-���-��-��-��-��-�]|�[�-���-�]|�[�-�]|�[�-��-��-��-�]|�[��]|�[�-�]"},{name:"Ll",alias:"Lowercase_Letter",bmp:"a-zµß-öø-ÿāăąćĉċčďđēĕėęěĝğġģĥħĩīĭįıĳĵķĸĺļľŀłńņňŉŋōŏőœŕŗřśŝşšţťŧũūŭůűųŵŷźżž-ƀƃƅƈƌƍƒƕƙ-ƛƞơƣƥƨƪƫƭưƴƶƹƺƽ-ƿǆǉǌǎǐǒǔǖǘǚǜǝǟǡǣǥǧǩǫǭǯǰǳǵǹǻǽǿȁȃȅȇȉȋȍȏȑȓȕȗșțȝȟȡȣȥȧȩȫȭȯȱȳ-ȹȼȿɀɂɇɉɋɍɏ-ʓʕ-ʯͱͳͷͻ-ͽΐά-ώϐϑϕ-ϗϙϛϝϟϡϣϥϧϩϫϭϯ-ϳϵϸϻϼа-џѡѣѥѧѩѫѭѯѱѳѵѷѹѻѽѿҁҋҍҏґғҕҗҙқҝҟҡңҥҧҩҫҭүұҳҵҷҹһҽҿӂӄӆӈӊӌӎӏӑӓӕӗәӛӝӟӡӣӥӧөӫӭӯӱӳӵӷӹӻӽӿԁԃԅԇԉԋԍԏԑԓԕԗԙԛԝԟԡԣԥԧԩԫԭԯա-ևᏸ-ᏽᴀ-ᴫᵫ-ᵷᵹ-ᶚḁḃḅḇḉḋḍḏḑḓḕḗḙḛḝḟḡḣḥḧḩḫḭḯḱḳḵḷḹḻḽḿṁṃṅṇṉṋṍṏṑṓṕṗṙṛṝṟṡṣṥṧṩṫṭṯṱṳṵṷṹṻṽṿẁẃẅẇẉẋẍẏẑẓẕ-ẝẟạảấầẩẫậắằẳẵặẹẻẽếềểễệỉịọỏốồổỗộớờởỡợụủứừửữựỳỵỷỹỻỽỿ-ἇἐ-ἕἠ-ἧἰ-ἷὀ-ὅὐ-ὗὠ-ὧὰ-ώᾀ-ᾇᾐ-ᾗᾠ-ᾧᾰ-ᾴᾶᾷιῂ-ῄῆῇῐ-ΐῖῗῠ-ῧῲ-ῴῶῷℊℎℏℓℯℴℹℼℽⅆ-ⅉⅎↄⰰ-ⱞⱡⱥⱦⱨⱪⱬⱱⱳⱴⱶ-ⱻⲁⲃⲅⲇⲉⲋⲍⲏⲑⲓⲕⲗⲙⲛⲝⲟⲡⲣⲥⲧⲩⲫⲭⲯⲱⲳⲵⲷⲹⲻⲽⲿⳁⳃⳅⳇⳉⳋⳍⳏⳑⳓⳕⳗⳙⳛⳝⳟⳡⳣⳤⳬⳮⳳⴀ-ⴥⴧⴭꙁꙃꙅꙇꙉꙋꙍꙏꙑꙓꙕꙗꙙꙛꙝꙟꙡꙣꙥꙧꙩꙫꙭꚁꚃꚅꚇꚉꚋꚍꚏꚑꚓꚕꚗꚙꚛꜣꜥꜧꜩꜫꜭꜯ-ꜱꜳꜵꜷꜹꜻꜽꜿꝁꝃꝅꝇꝉꝋꝍꝏꝑꝓꝕꝗꝙꝛꝝꝟꝡꝣꝥꝧꝩꝫꝭꝯꝱ-ꝸꝺꝼꝿꞁꞃꞅꞇꞌꞎꞑꞓ-ꞕꞗꞙꞛꞝꞟꞡꞣꞥꞧꞩꞵꞷꟺꬰ-ꭚꭠ-ꭥꭰ-ꮿﬀ-ﬆﬓ-ﬗａ-ｚ",astral:"�[�-�]|�[�-��-��-��-��-���-��-��-��-��-��-��-��-��-��-��-��-��-��-��-��-��-��-��-��-��-��]|�[�-�]|�[�-�]"},{name:"Lm",alias:"Modifier_Letter",bmp:"ʰ-ˁˆ-ˑˠ-ˤˬˮʹͺՙـۥۦߴߵߺࠚࠤࠨॱๆໆჼៗᡃᪧᱸ-ᱽᴬ-ᵪᵸᶛ-ᶿⁱⁿₐ-ₜⱼⱽⵯⸯ々〱-〵〻ゝゞー-ヾꀕꓸ-ꓽꘌꙿꚜꚝꜗ-ꜟꝰꞈꟸꟹꧏꧦꩰꫝꫳꫴꭜ-ꭟｰﾞﾟ",astral:"�[�-�]|�[�-�]"},{name:"Lo",alias:"Other_Letter",bmp:"ªºƻǀ-ǃʔא-תװ-ײؠ-ؿف-يٮٯٱ-ۓەۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪࠀ-ࠕࡀ-ࡘࢠ-ࢴऄ-हऽॐक़-ॡॲ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๅກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎა-ჺჽ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛱ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៜᠠ-ᡂᡄ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱷᳩ-ᳬᳮ-ᳱᳵᳶℵ-ℸⴰ-ⵧⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ〆〼ぁ-ゖゟァ-ヺヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿕ꀀ-ꀔꀖ-ꒌꓐ-ꓷꔀ-ꘋꘐ-ꘟꘪꘫꙮꚠ-ꛥꞏꟷꟻ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧠ-ꧤꧧ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩯꩱ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛꫜꫠ-ꫪꫲꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎יִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼｦ-ｯｱ-ﾝﾠ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",astral:"�[�-��-�]|�[�-��-�]|�[�-��-�]|�[�-�]|�[�-�]|�[�-��-��-����-��-��-��-��-��-��-��-��-��-��-��-�]|�[�-�]|�[�-�]|�[�-��]|[��-��-��-�][�-�]|�[�-�����-��-��-���-��-�]|�[��-�]|�[�-�]|�[�-���-�����-��-��-��-����-��-��-�����-��-��-��-��-��-��-��-��-��-��-�]|�[�-��-��-��-��-���-��-����-��-��-���-��-��-��-��-����-��-����-����-�]|�[�-�]|�[�-��-������-��-��������-�������������-��-��-��-���-��-��-��-��-�]|�[�-��-��-��-��-��-�]|�[�-��-��-��-��-��-�]|�[�-�]|�[�-��-��-��-�]|�[��]|�[�-�]"},{name:"Lt",alias:"Titlecase_Letter",bmp:"ǅǈǋǲᾈ-ᾏᾘ-ᾟᾨ-ᾯᾼῌῼ"},{name:"Lu",alias:"Uppercase_Letter",bmp:"A-ZÀ-ÖØ-ÞĀĂĄĆĈĊČĎĐĒĔĖĘĚĜĞĠĢĤĦĨĪĬĮİĲĴĶĹĻĽĿŁŃŅŇŊŌŎŐŒŔŖŘŚŜŞŠŢŤŦŨŪŬŮŰŲŴŶŸŹŻŽƁƂƄƆƇƉ-ƋƎ-ƑƓƔƖ-ƘƜƝƟƠƢƤƦƧƩƬƮƯƱ-ƳƵƷƸƼǄǇǊǍǏǑǓǕǗǙǛǞǠǢǤǦǨǪǬǮǱǴǶ-ǸǺǼǾȀȂȄȆȈȊȌȎȐȒȔȖȘȚȜȞȠȢȤȦȨȪȬȮȰȲȺȻȽȾɁɃ-ɆɈɊɌɎͰͲͶͿΆΈ-ΊΌΎΏΑ-ΡΣ-ΫϏϒ-ϔϘϚϜϞϠϢϤϦϨϪϬϮϴϷϹϺϽ-ЯѠѢѤѦѨѪѬѮѰѲѴѶѸѺѼѾҀҊҌҎҐҒҔҖҘҚҜҞҠҢҤҦҨҪҬҮҰҲҴҶҸҺҼҾӀӁӃӅӇӉӋӍӐӒӔӖӘӚӜӞӠӢӤӦӨӪӬӮӰӲӴӶӸӺӼӾԀԂԄԆԈԊԌԎԐԒԔԖԘԚԜԞԠԢԤԦԨԪԬԮԱ-ՖႠ-ჅჇჍᎠ-ᏵḀḂḄḆḈḊḌḎḐḒḔḖḘḚḜḞḠḢḤḦḨḪḬḮḰḲḴḶḸḺḼḾṀṂṄṆṈṊṌṎṐṒṔṖṘṚṜṞṠṢṤṦṨṪṬṮṰṲṴṶṸṺṼṾẀẂẄẆẈẊẌẎẐẒẔẞẠẢẤẦẨẪẬẮẰẲẴẶẸẺẼẾỀỂỄỆỈỊỌỎỐỒỔỖỘỚỜỞỠỢỤỦỨỪỬỮỰỲỴỶỸỺỼỾἈ-ἏἘ-ἝἨ-ἯἸ-ἿὈ-ὍὙὛὝὟὨ-ὯᾸ-ΆῈ-ΉῘ-ΊῨ-ῬῸ-Ώℂℇℋ-ℍℐ-ℒℕℙ-ℝℤΩℨK-ℭℰ-ℳℾℿⅅↃⰀ-ⰮⱠⱢ-ⱤⱧⱩⱫⱭ-ⱰⱲⱵⱾ-ⲀⲂⲄⲆⲈⲊⲌⲎⲐⲒⲔⲖⲘⲚⲜⲞⲠⲢⲤⲦⲨⲪⲬⲮⲰⲲⲴⲶⲸⲺⲼⲾⳀⳂⳄⳆⳈⳊⳌⳎⳐⳒⳔⳖⳘⳚⳜⳞⳠⳢⳫⳭⳲꙀꙂꙄꙆꙈꙊꙌꙎꙐꙒꙔꙖꙘꙚꙜꙞꙠꙢꙤꙦꙨꙪꙬꚀꚂꚄꚆꚈꚊꚌꚎꚐꚒꚔꚖꚘꚚꜢꜤꜦꜨꜪꜬꜮꜲꜴꜶꜸꜺꜼꜾꝀꝂꝄꝆꝈꝊꝌꝎꝐꝒꝔꝖꝘꝚꝜꝞꝠꝢꝤꝦꝨꝪꝬꝮꝹꝻꝽꝾꞀꞂꞄꞆꞋꞍꞐꞒꞖꞘꞚꞜꞞꞠꞢꞤꞦꞨꞪ-ꞭꞰ-ꞴꞶＡ-Ｚ",astral:"�[�-�]|�[�-�]|�[�-�]|�[�-��-��-��������-��-��-����-��-��-����-��-���-��-��-��-��-��-��-��-��-��-��-��-��]"},{name:"M",alias:"Mark",bmp:"̀-ͯ҃-҉֑-ׇֽֿׁׂׅׄؐ-ًؚ-ٰٟۖ-ۜ۟-۪ۤۧۨ-ܑۭܰ-݊ަ-ް߫-߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛ࣣ-ःऺ-़ा-ॏ॑-ॗॢॣঁ-ঃ়া-ৄেৈো-্ৗৢৣਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑੰੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୢୣஂா-ூெ-ைொ-்ௗఀ-ఃా-ౄె-ైొ-్ౕౖౢౣಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣഁ-ഃാ-ൄെ-ൈൊ-്ൗൢൣංඃ්ා-ුූෘ-ෟෲෳัิ-ฺ็-๎ັິ-ູົຼ່-ໍ༹༘༙༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏႚ-ႝ፝-፟ᜒ-᜔ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝᠋-᠍ᢩᤠ-ᤫᤰ-᤻ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼᪰-᪾ᬀ-ᬄ᬴-᭄᭫-᭳ᮀ-ᮂᮡ-ᮭ᯦-᯳ᰤ-᰷᳐-᳔᳒-᳨᳭ᳲ-᳴᳸᳹᷀-᷵᷼-᷿⃐-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯꙯-꙲ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧꢀꢁꢴ-꣄꣠-꣱ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀ꧥꨩ-ꨶꩃꩌꩍꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭ﬞ︀-️︠-︯",astral:"�[�-��-��-����-��-��-�]|�[�-��-��-��-��-��-�]|�[�-��-��-��-��-��-���-��-��-��-��-��-���-����-�����-��-�]|�[�-��-�]|�[�-��-�]|�[��]|�[���-�]|�[�-��-����-��-�]|�[�-����-��-����]|�[�-�]|�[�-�]"},{name:"Mc",alias:"Spacing_Mark",bmp:"ःऻा-ीॉ-ौॎॏংঃা-ীেৈোৌৗਃਾ-ੀઃા-ીૉોૌଂଃାୀେୈୋୌୗாிுூெ-ைொ-ௌௗఁ-ఃు-ౄಂಃಾೀ-ೄೇೈೊೋೕೖംഃാ-ീെ-ൈൊ-ൌൗංඃා-ෑෘ-ෟෲෳ༾༿ཿါာေးျြၖၗၢ-ၤၧ-ၭႃႄႇ-ႌႏႚ-ႜាើ-ៅះៈᤣ-ᤦᤩ-ᤫᤰᤱᤳ-ᤸᨙᨚᩕᩗᩡᩣᩤᩭ-ᩲᬄᬵᬻᬽ-ᭁᭃ᭄ᮂᮡᮦᮧ᮪ᯧᯪ-ᯬᯮ᯲᯳ᰤ-ᰫᰴᰵ᳡ᳲᳳ〮〯ꠣꠤꠧꢀꢁꢴ-ꣃꥒ꥓ꦃꦴꦵꦺꦻꦽ-꧀ꨯꨰꨳꨴꩍꩻꩽꫫꫮꫯꫵꯣꯤꯦꯧꯩꯪ꯬",astral:"�[���-�]|�[����-������-����-�����-������-����-����]|�[�-���-���-��-���-�����������]|�[�-�]"},{name:"Me",alias:"Enclosing_Mark",bmp:"҈҉᪾⃝-⃠⃢-⃤꙰-꙲"},{name:"Mn",alias:"Nonspacing_Mark",bmp:"̀-ͯ҃-֑҇-ׇֽֿׁׂׅׄؐ-ًؚ-ٰٟۖ-ۜ۟-۪ۤۧۨ-ܑۭܰ-݊ަ-ް߫-߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛ࣣ-ंऺ़ु-ै्॑-ॗॢॣঁ়ু-ৄ্ৢৣਁਂ਼ੁੂੇੈੋ-੍ੑੰੱੵઁં઼ુ-ૅેૈ્ૢૣଁ଼ିୁ-ୄ୍ୖୢୣஂீ்ఀా-ీె-ైొ-్ౕౖౢౣಁ಼ಿೆೌ್ೢೣഁു-ൄ്ൢൣ්ි-ුූัิ-ฺ็-๎ັິ-ູົຼ່-ໍཱ༹༘༙༵༷-ཾྀ-྄྆྇ྍ-ྗྙ-ྼ࿆ိ-ူဲ-့္်ွှၘၙၞ-ၠၱ-ၴႂႅႆႍႝ፝-፟ᜒ-᜔ᜲ-᜴ᝒᝓᝲᝳ឴឵ិ-ួំ៉-៓៝᠋-᠍ᢩᤠ-ᤢᤧᤨᤲ᤹-᤻ᨘᨗᨛᩖᩘ-ᩞ᩠ᩢᩥ-ᩬᩳ-᩿᩼᪰-᪽ᬀ-ᬃ᬴ᬶ-ᬺᬼᭂ᭫-᭳ᮀᮁᮢ-ᮥᮨᮩ᮫-ᮭ᯦ᯨᯩᯭᯯ-ᯱᰬ-ᰳᰶ᰷᳐-᳔᳒-᳢᳠-᳨᳭᳴᳸᳹᷀-᷵᷼-᷿⃐-⃥⃜⃡-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〭꙯ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠥꠦ꣄꣠-꣱ꤦ-꤭ꥇ-ꥑꦀ-ꦂ꦳ꦶ-ꦹꦼꧥꨩ-ꨮꨱꨲꨵꨶꩃꩌꩼꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫬꫭ꫶ꯥꯨ꯭ﬞ︀-️︠-︯",astral:"�[�-�������-��������-�������-���-��-��-�]|�[�-��-��-��-��-�]|�[�-��-�]|�[�-�]|�[��]|�[���-�]|�[�-��-����-��-�]|�[�-����-��-����]|�[��-��-��-����-��-��-�����-��-��-������-������-��-�]|�[�-�]|�[�-�]"},{name:"N",alias:"Number",bmp:"0-9²³¹¼-¾٠-٩۰-۹߀-߉०-९০-৯৴-৹੦-੯૦-૯୦-୯୲-୷௦-௲౦-౯౸-౾೦-೯൦-൵෦-෯๐-๙໐-໙༠-༳၀-၉႐-႙፩-፼ᛮ-ᛰ០-៩៰-៹᠐-᠙᥆-᥏᧐-᧚᪀-᪉᪐-᪙᭐-᭙᮰-᮹᱀-᱉᱐-᱙⁰⁴-⁹₀-₉⅐-ↂↅ-↉①-⒛⓪-⓿❶-➓⳽〇〡-〩〸-〺㆒-㆕㈠-㈩㉈-㉏㉑-㉟㊀-㊉㊱-㊿꘠-꘩ꛦ-ꛯ꠰-꠵꣐-꣙꤀-꤉꧐-꧙꧰-꧹꩐-꩙꯰-꯹０-９",astral:"�[�-��-����-��-����-�]|�[�-�]|�[�-��-�]|�[�-�]|�[�-�]|�[�-��-��-�]|�[�-�]|�[�-��-��-��-��-��-�]|�[�-�]|�[�-�]|�[�-�]|�[�-��-��-��-��-����-��-��-����-��-��-��-��-�]|�[�-��-��-��-�]"},{name:"Nd",alias:"Decimal_Number",bmp:"0-9٠-٩۰-۹߀-߉०-९০-৯੦-੯૦-૯୦-୯௦-௯౦-౯೦-೯൦-൯෦-෯๐-๙໐-໙༠-༩၀-၉႐-႙០-៩᠐-᠙᥆-᥏᧐-᧙᪀-᪉᪐-᪙᭐-᭙᮰-᮹᱀-᱉᱐-᱙꘠-꘩꣐-꣙꤀-꤉꧐-꧙꧰-꧹꩐-꩙꯰-꯹０-９",astral:"�[�-�]|�[�-�]|�[�-��-��-��-�]|�[�-�]|�[�-��-��-��-��-�]|�[�-��-�]"},{name:"Nl",alias:"Letter_Number",bmp:"ᛮ-ᛰⅠ-ↂↅ-ↈ〇〡-〩〸-〺ꛦ-ꛯ",astral:"�[�-�]|�[�-����-�]"},{name:"No",alias:"Other_Number",bmp:"²³¹¼-¾৴-৹୲-୷௰-௲౸-౾൰-൵༪-༳፩-፼៰-៹᧚⁰⁴-⁹₀-₉⅐-⅟↉①-⒛⓪-⓿❶-➓⳽㆒-㆕㈠-㈩㉈-㉏㉑-㉟㊀-㊉㊱-㊿꠰-꠵",astral:"�[�-��-�]|�[�-��-�]|�[�-�]|�[�-�]|�[�-�]|�[�-��-��-��-��-����-��-��-����-��-��-��-��-�]|�[��]|�[�-�]|�[�-�]|�[�-��-����-��-�]"},{name:"P",alias:"Punctuation",bmp:"!-#%-\\x2A,-/:;\\x3F@\\x5B-\\x5D_\\x7B}¡§«¶·»¿;·՚-՟։֊־׀׃׆׳״؉؊،؍؛؞؟٪-٭۔܀-܍߷-߹࠰-࠾࡞।॥॰૰෴๏๚๛༄-༒༔༺-༽྅࿐-࿔࿙࿚၊-၏჻፠-፨᐀᙭᙮᚛᚜᛫-᛭᜵᜶។-៖៘-៚᠀-᠊᥄᥅᨞᨟᪠-᪦᪨-᪭᭚-᭠᯼-᯿᰻-᰿᱾᱿᳀-᳇᳓‐-‧‰-⁃⁅-⁑⁓-⁞⁽⁾₍₎⌈-⌋〈〉❨-❵⟅⟆⟦-⟯⦃-⦘⧘-⧛⧼⧽⳹-⳼⳾⳿⵰⸀-⸮⸰-⹂、-〃〈-】〔-〟〰〽゠・꓾꓿꘍-꘏꙳꙾꛲-꛷꡴-꡷꣎꣏꣸-꣺꣼꤮꤯꥟꧁-꧍꧞꧟꩜-꩟꫞꫟꫰꫱꯫﴾﴿︐-︙︰-﹒﹔-﹡﹣﹨﹪﹫！-＃％-＊，-／：；？＠［-］＿｛｝｟-･",astral:"�[����-���-��-��-�]|�[�-�]|�[��-��-��-�]|�[�-�]|𐕯|𛲟|�[�-����-��-����-����-��-��]|�[�-���]|�[����-��]"},{name:"Pc",alias:"Connector_Punctuation",bmp:"_‿⁀⁔︳︴﹍-﹏＿"},{name:"Pd",alias:"Dash_Punctuation",bmp:"\\x2D֊־᐀᠆‐-―⸗⸚⸺⸻⹀〜〰゠︱︲﹘﹣－"},{name:"Pe",alias:"Close_Punctuation",bmp:"\\x29\\x5D}༻༽᚜⁆⁾₎⌉⌋〉❩❫❭❯❱❳❵⟆⟧⟩⟫⟭⟯⦄⦆⦈⦊⦌⦎⦐⦒⦔⦖⦘⧙⧛⧽⸣⸥⸧⸩〉》」』】〕〗〙〛〞〟﴾︘︶︸︺︼︾﹀﹂﹄﹈﹚﹜﹞）］｝｠｣"},{name:"Pf",alias:"Final_Punctuation",bmp:"»’”›⸃⸅⸊⸍⸝⸡"},{name:"Pi",alias:"Initial_Punctuation",bmp:"«‘‛“‟‹⸂⸄⸉⸌⸜⸠"},{name:"Po",alias:"Other_Punctuation",bmp:"!-#%-'\\x2A,\\x2E/:;\\x3F@\\x5C¡§¶·¿;·՚-՟։׀׃׆׳״؉؊،؍؛؞؟٪-٭۔܀-܍߷-߹࠰-࠾࡞।॥॰૰෴๏๚๛༄-༒༔྅࿐-࿔࿙࿚၊-၏჻፠-፨᙭᙮᛫-᛭᜵᜶។-៖៘-៚᠀-᠅᠇-᠊᥄᥅᨞᨟᪠-᪦᪨-᪭᭚-᭠᯼-᯿᰻-᰿᱾᱿᳀-᳇᳓‖‗†-‧‰-‸※-‾⁁-⁃⁇-⁑⁓⁕-⁞⳹-⳼⳾⳿⵰⸀⸁⸆-⸈⸋⸎-⸖⸘⸙⸛⸞⸟⸪-⸮⸰-⸹⸼-⸿⹁、-〃〽・꓾꓿꘍-꘏꙳꙾꛲-꛷꡴-꡷꣎꣏꣸-꣺꣼꤮꤯꥟꧁-꧍꧞꧟꩜-꩟꫞꫟꫰꫱꯫︐-︖︙︰﹅﹆﹉-﹌﹐-﹒﹔-﹗﹟-﹡﹨﹪﹫！-＃％-＇＊，．／：；？＠＼｡､･",astral:"�[����-���-��-��-�]|�[�-�]|�[��-��-��-�]|�[�-�]|𐕯|𛲟|�[�-����-��-����-����-��-��]|�[�-���]|�[����-��]"},{name:"Ps",alias:"Open_Punctuation",bmp:"\\x28\\x5B\\x7B༺༼᚛‚„⁅⁽₍⌈⌊〈❨❪❬❮❰❲❴⟅⟦⟨⟪⟬⟮⦃⦅⦇⦉⦋⦍⦏⦑⦓⦕⦗⧘⧚⧼⸢⸤⸦⸨⹂〈《「『【〔〖〘〚〝﴿︗︵︷︹︻︽︿﹁﹃﹇﹙﹛﹝（［｛｟｢"},{name:"S",alias:"Symbol",bmp:"\\x24\\x2B<->\\x5E`\\x7C~¢-¦¨©¬®-±´¸×÷˂-˅˒-˟˥-˫˭˯-˿͵΄΅϶҂֍-֏؆-؈؋؎؏۞۩۽۾߶৲৳৺৻૱୰௳-௺౿൹฿༁-༃༓༕-༗༚-༟༴༶༸྾-࿅࿇-࿌࿎࿏࿕-࿘႞႟᎐-᎙៛᥀᧞-᧿᭡-᭪᭴-᭼᾽᾿-῁῍-῏῝-῟῭-`´῾⁄⁒⁺-⁼₊-₌₠-₾℀℁℃-℆℈℉℔№-℘℞-℣℥℧℩℮℺℻⅀-⅄⅊-⅍⅏↊↋←-⌇⌌-⌨⌫-⏺␀-␦⑀-⑊⒜-ⓩ─-❧➔-⟄⟇-⟥⟰-⦂⦙-⧗⧜-⧻⧾-⭳⭶-⮕⮘-⮹⮽-⯈⯊-⯑⯬-⯯⳥-⳪⺀-⺙⺛-⻳⼀-⿕⿰-⿻〄〒〓〠〶〷〾〿゛゜㆐㆑㆖-㆟㇀-㇣㈀-㈞㈪-㉇㉐㉠-㉿㊊-㊰㋀-㋾㌀-㏿䷀-䷿꒐-꓆꜀-꜖꜠꜡꞉꞊꠨-꠫꠶-꠹꩷-꩹꭛﬩﮲-﯁﷼﷽﹢﹤-﹦﹩＄＋＜-＞＾｀｜～￠-￦￨-￮￼�",astral:"�[�-��-��-��-��-��-��-��]|�[�-��-��-��-��-��-��-��-��-��-��-��-����-�]|�[�-��-��-��-��-��-��-�]|�[����������]|�[�-��-���-���-�]|𛲜|𑜿|�[���]|�[�-��]|�[�-��-��-��-���]|�[�-��-��-��-����-��-��-���-�]|�[��]"},{name:"Sc",alias:"Currency_Symbol",bmp:"\\x24¢-¥֏؋৲৳৻૱௹฿៛₠-₾꠸﷼﹩＄￠￡￥￦"},{name:"Sk",alias:"Modifier_Symbol",bmp:"\\x5E`¨¯´¸˂-˅˒-˟˥-˫˭˯-˿͵΄΅᾽᾿-῁῍-῏῝-῟῭-`´῾゛゜꜀-꜖꜠꜡꞉꞊꭛﮲-﯁＾｀￣",astral:"�[�-�]"},{name:"Sm",alias:"Math_Symbol",bmp:"\\x2B<->\\x7C~¬±×÷϶؆-؈⁄⁒⁺-⁼₊-₌℘⅀-⅄⅋←-↔↚↛↠↣↦↮⇎⇏⇒⇔⇴-⋿⌠⌡⍼⎛-⎳⏜-⏡▷◁◸-◿♯⟀-⟄⟇-⟥⟰-⟿⤀-⦂⦙-⧗⧜-⧻⧾-⫿⬰-⭄⭇-⭌﬩﹢﹤-﹦＋＜-＞｜～￢￩-￬",astral:"�[��]|�[����������]"},{name:"So",alias:"Other_Symbol",bmp:"¦©®°҂֍֎؎؏۞۩۽۾߶৺୰௳-௸௺౿൹༁-༃༓༕-༗༚-༟༴༶༸྾-࿅࿇-࿌࿎࿏࿕-࿘႞႟᎐-᎙᥀᧞-᧿᭡-᭪᭴-᭼℀℁℃-℆℈℉℔№℗℞-℣℥℧℩℮℺℻⅊⅌⅍⅏↊↋↕-↙↜-↟↡↢↤↥↧-↭↯-⇍⇐⇑⇓⇕-⇳⌀-⌇⌌-⌟⌢-⌨⌫-⍻⍽-⎚⎴-⏛⏢-⏺␀-␦⑀-⑊⒜-ⓩ─-▶▸-◀◂-◷☀-♮♰-❧➔-➿⠀-⣿⬀-⬯⭅⭆⭍-⭳⭶-⮕⮘-⮹⮽-⯈⯊-⯑⯬-⯯⳥-⳪⺀-⺙⺛-⻳⼀-⿕⿰-⿻〄〒〓〠〶〷〾〿㆐㆑㆖-㆟㇀-㇣㈀-㈞㈪-㉇㉐㉠-㉿㊊-㊰㋀-㋾㌀-㏿䷀-䷿꒐-꓆꠨-꠫꠶꠷꠹꩷-꩹﷽￤￨￭￮￼�",astral:"�[�-��-��-��-��-��-��-��]|�[�-��-��-��-��-��-��-�]|�[�-��-��-��-��-��-��-��-��-��-��-��-����-�]|�[�-��-���-���-�]|𛲜|𑜿|�[���]|�[�-��]|�[�-��-��-��-���]|�[�-��-��-��-����-��-��-���-�]"},{name:"Z",alias:"Separator",bmp:"    - \u2028\u2029  　"},{name:"Zl",alias:"Line_Separator",bmp:"\u2028"},{name:"Zp",alias:"Paragraph_Separator",bmp:"\u2029"},{name:"Zs",alias:"Space_Separator",bmp:"    -   　"}])}},function(e,t){e.exports=function(e){"use strict";if(!e.addUnicodeData)throw new ReferenceError("Unicode Base must be loaded before Unicode Properties");var t=[{name:"ASCII",bmp:"\0-"},{name:"Alphabetic",bmp:"A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͅͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙա-ևְ-ׇֽֿׁׂׅׄא-תװ-ײؐ-ؚؠ-ٗٙ-ٟٮ-ۓە-ۜۡ-ۭۨ-ۯۺ-ۼۿܐ-ܿݍ-ޱߊ-ߪߴߵߺࠀ-ࠗࠚ-ࠬࡀ-ࡘࢠ-ࢴࣣ-ࣰࣩ-ऻऽ-ौॎ-ॐॕ-ॣॱ-ঃঅ-ঌএঐও-নপ-রলশ-হঽ-ৄেৈোৌৎৗড়ঢ়য়-ৣৰৱਁ-ਃਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਾ-ੂੇੈੋੌੑਖ਼-ੜਫ਼ੰ-ੵઁ-ઃઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽ-ૅે-ૉોૌૐૠ-ૣૹଁ-ଃଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽ-ୄେୈୋୌୖୗଡ଼ଢ଼ୟ-ୣୱஂஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹா-ூெ-ைொ-ௌௐௗఀ-ఃఅ-ఌఎ-ఐఒ-నప-హఽ-ౄె-ైొ-ౌౕౖౘ-ౚౠ-ౣಁ-ಃಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽ-ೄೆ-ೈೊ-ೌೕೖೞೠ-ೣೱೲഁ-ഃഅ-ഌഎ-ഐഒ-ഺഽ-ൄെ-ൈൊ-ൌൎൗൟ-ൣൺ-ൿංඃඅ-ඖක-නඳ-රලව-ෆා-ුූෘ-ෟෲෳก-ฺเ-ๆํກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ູົ-ຽເ-ໄໆໍໜ-ໟༀཀ-ཇཉ-ཬཱ-ཱྀྈ-ྗྙ-ྼက-ံးျ-ဿၐ-ၢၥ-ၨၮ-ႆႎႜႝႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚ፟ᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜓᜠ-ᜳᝀ-ᝓᝠ-ᝬᝮ-ᝰᝲᝳក-ឳា-ៈៗៜᠠ-ᡷᢀ-ᢪᢰ-ᣵᤀ-ᤞᤠ-ᤫᤰ-ᤸᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨛᨠ-ᩞᩡ-ᩴᪧᬀ-ᬳᬵ-ᭃᭅ-ᭋᮀ-ᮩᮬ-ᮯᮺ-ᯥᯧ-ᯱᰀ-ᰵᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳳᳵᳶᴀ-ᶿᷧ-ᷴḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⒶ-ⓩⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⷠ-ⷿⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿕ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙴ-ꙻꙿ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞭꞰ-ꞷꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠧꡀ-ꡳꢀ-ꣃꣲ-ꣷꣻꣽꤊ-ꤪꤰ-ꥒꥠ-ꥼꦀ-ꦲꦴ-ꦿꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨶꩀ-ꩍꩠ-ꩶꩺꩾ-ꪾꫀꫂꫛ-ꫝꫠ-ꫯꫲ-ꫵꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭥꭰ-ꯪ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",astral:"�[�-��-�]|�[�-��-��-��-��-���-��-����-��-���-���-��-��-��-��-��-����-��-����-��-��������-�]|�[�-��-�]|�[�-��-�]|�[�-��-��-�]|�[�-�]|�[�-��-��-��-��-��-��-�]|�[�-��-��-��-��-��-�]|�[�-��-��-�]|�[�-�]|�[�-�]|[��-��-��-�][�-�]|�[�-��-�������-��-���-��-��-��-��-��-��-��-���-��-��-��-��-��-��-��-��-��-��-��-��-�]|�[�-��-��-��-��]|�[�-�]|�[�-��-������-��-��������-�������������-��-��-��-���-��-��-��-��-�]|�[�-�����-��-��-��-����-��-��-�]|�[�-��-�]|�[�-���-�]|�[�-��-��-����-��-��-��-��-��-��-��-��-��-��-��-��-�]|�[�-���-�����-��-��-��-����-��-��-����-����-��-��-��-��-��-��-��-��-��-��-�]|�[�-�]|�[��]|�[�-��-��-�]|�[�-�]"},{name:"Any",isBmpLast:!0,bmp:"\0-￿",astral:"[�-�][�-�]"},{name:"Default_Ignorable_Code_Point",bmp:"­͏؜ᅟᅠ឴឵᠋-᠎​-‏‪-‮⁠-⁯ㅤ︀-️\ufeffﾠ￰-￸",astral:"[�-�][�-�]|�[�-�]|�[�-�]"},{name:"Lowercase",bmp:"a-zªµºß-öø-ÿāăąćĉċčďđēĕėęěĝğġģĥħĩīĭįıĳĵķĸĺļľŀłńņňŉŋōŏőœŕŗřśŝşšţťŧũūŭůűųŵŷźżž-ƀƃƅƈƌƍƒƕƙ-ƛƞơƣƥƨƪƫƭưƴƶƹƺƽ-ƿǆǉǌǎǐǒǔǖǘǚǜǝǟǡǣǥǧǩǫǭǯǰǳǵǹǻǽǿȁȃȅȇȉȋȍȏȑȓȕȗșțȝȟȡȣȥȧȩȫȭȯȱȳ-ȹȼȿɀɂɇɉɋɍɏ-ʓʕ-ʸˀˁˠ-ˤͅͱͳͷͺ-ͽΐά-ώϐϑϕ-ϗϙϛϝϟϡϣϥϧϩϫϭϯ-ϳϵϸϻϼа-џѡѣѥѧѩѫѭѯѱѳѵѷѹѻѽѿҁҋҍҏґғҕҗҙқҝҟҡңҥҧҩҫҭүұҳҵҷҹһҽҿӂӄӆӈӊӌӎӏӑӓӕӗәӛӝӟӡӣӥӧөӫӭӯӱӳӵӷӹӻӽӿԁԃԅԇԉԋԍԏԑԓԕԗԙԛԝԟԡԣԥԧԩԫԭԯա-ևᏸ-ᏽᴀ-ᶿḁḃḅḇḉḋḍḏḑḓḕḗḙḛḝḟḡḣḥḧḩḫḭḯḱḳḵḷḹḻḽḿṁṃṅṇṉṋṍṏṑṓṕṗṙṛṝṟṡṣṥṧṩṫṭṯṱṳṵṷṹṻṽṿẁẃẅẇẉẋẍẏẑẓẕ-ẝẟạảấầẩẫậắằẳẵặẹẻẽếềểễệỉịọỏốồổỗộớờởỡợụủứừửữựỳỵỷỹỻỽỿ-ἇἐ-ἕἠ-ἧἰ-ἷὀ-ὅὐ-ὗὠ-ὧὰ-ώᾀ-ᾇᾐ-ᾗᾠ-ᾧᾰ-ᾴᾶᾷιῂ-ῄῆῇῐ-ΐῖῗῠ-ῧῲ-ῴῶῷⁱⁿₐ-ₜℊℎℏℓℯℴℹℼℽⅆ-ⅉⅎⅰ-ⅿↄⓐ-ⓩⰰ-ⱞⱡⱥⱦⱨⱪⱬⱱⱳⱴⱶ-ⱽⲁⲃⲅⲇⲉⲋⲍⲏⲑⲓⲕⲗⲙⲛⲝⲟⲡⲣⲥⲧⲩⲫⲭⲯⲱⲳⲵⲷⲹⲻⲽⲿⳁⳃⳅⳇⳉⳋⳍⳏⳑⳓⳕⳗⳙⳛⳝⳟⳡⳣⳤⳬⳮⳳⴀ-ⴥⴧⴭꙁꙃꙅꙇꙉꙋꙍꙏꙑꙓꙕꙗꙙꙛꙝꙟꙡꙣꙥꙧꙩꙫꙭꚁꚃꚅꚇꚉꚋꚍꚏꚑꚓꚕꚗꚙꚛ-ꚝꜣꜥꜧꜩꜫꜭꜯ-ꜱꜳꜵꜷꜹꜻꜽꜿꝁꝃꝅꝇꝉꝋꝍꝏꝑꝓꝕꝗꝙꝛꝝꝟꝡꝣꝥꝧꝩꝫꝭꝯ-ꝸꝺꝼꝿꞁꞃꞅꞇꞌꞎꞑꞓ-ꞕꞗꞙꞛꞝꞟꞡꞣꞥꞧꞩꞵꞷꟸ-ꟺꬰ-ꭚꭜ-ꭥꭰ-ꮿﬀ-ﬆﬓ-ﬗａ-ｚ",astral:"�[�-�]|�[�-��-��-��-��-���-��-��-��-��-��-��-��-��-��-��-��-��-��-��-��-��-��-��-��-��-��]|�[�-�]|�[�-�]"},{name:"Noncharacter_Code_Point",bmp:"﷐-﷯￾￿",astral:"[����������������][��]"},{name:"Uppercase",bmp:"A-ZÀ-ÖØ-ÞĀĂĄĆĈĊČĎĐĒĔĖĘĚĜĞĠĢĤĦĨĪĬĮİĲĴĶĹĻĽĿŁŃŅŇŊŌŎŐŒŔŖŘŚŜŞŠŢŤŦŨŪŬŮŰŲŴŶŸŹŻŽƁƂƄƆƇƉ-ƋƎ-ƑƓƔƖ-ƘƜƝƟƠƢƤƦƧƩƬƮƯƱ-ƳƵƷƸƼǄǇǊǍǏǑǓǕǗǙǛǞǠǢǤǦǨǪǬǮǱǴǶ-ǸǺǼǾȀȂȄȆȈȊȌȎȐȒȔȖȘȚȜȞȠȢȤȦȨȪȬȮȰȲȺȻȽȾɁɃ-ɆɈɊɌɎͰͲͶͿΆΈ-ΊΌΎΏΑ-ΡΣ-ΫϏϒ-ϔϘϚϜϞϠϢϤϦϨϪϬϮϴϷϹϺϽ-ЯѠѢѤѦѨѪѬѮѰѲѴѶѸѺѼѾҀҊҌҎҐҒҔҖҘҚҜҞҠҢҤҦҨҪҬҮҰҲҴҶҸҺҼҾӀӁӃӅӇӉӋӍӐӒӔӖӘӚӜӞӠӢӤӦӨӪӬӮӰӲӴӶӸӺӼӾԀԂԄԆԈԊԌԎԐԒԔԖԘԚԜԞԠԢԤԦԨԪԬԮԱ-ՖႠ-ჅჇჍᎠ-ᏵḀḂḄḆḈḊḌḎḐḒḔḖḘḚḜḞḠḢḤḦḨḪḬḮḰḲḴḶḸḺḼḾṀṂṄṆṈṊṌṎṐṒṔṖṘṚṜṞṠṢṤṦṨṪṬṮṰṲṴṶṸṺṼṾẀẂẄẆẈẊẌẎẐẒẔẞẠẢẤẦẨẪẬẮẰẲẴẶẸẺẼẾỀỂỄỆỈỊỌỎỐỒỔỖỘỚỜỞỠỢỤỦỨỪỬỮỰỲỴỶỸỺỼỾἈ-ἏἘ-ἝἨ-ἯἸ-ἿὈ-ὍὙὛὝὟὨ-ὯᾸ-ΆῈ-ΉῘ-ΊῨ-ῬῸ-Ώℂℇℋ-ℍℐ-ℒℕℙ-ℝℤΩℨK-ℭℰ-ℳℾℿⅅⅠ-ⅯↃⒶ-ⓏⰀ-ⰮⱠⱢ-ⱤⱧⱩⱫⱭ-ⱰⱲⱵⱾ-ⲀⲂⲄⲆⲈⲊⲌⲎⲐⲒⲔⲖⲘⲚⲜⲞⲠⲢⲤⲦⲨⲪⲬⲮⲰⲲⲴⲶⲸⲺⲼⲾⳀⳂⳄⳆⳈⳊⳌⳎⳐⳒⳔⳖⳘⳚⳜⳞⳠⳢⳫⳭⳲꙀꙂꙄꙆꙈꙊꙌꙎꙐꙒꙔꙖꙘꙚꙜꙞꙠꙢꙤꙦꙨꙪꙬꚀꚂꚄꚆꚈꚊꚌꚎꚐꚒꚔꚖꚘꚚꜢꜤꜦꜨꜪꜬꜮꜲꜴꜶꜸꜺꜼꜾꝀꝂꝄꝆꝈꝊꝌꝎꝐꝒꝔꝖꝘꝚꝜꝞꝠꝢꝤꝦꝨꝪꝬꝮꝹꝻꝽꝾꞀꞂꞄꞆꞋꞍꞐꞒꞖꞘꞚꞜꞞꞠꞢꞤꞦꞨꞪ-ꞭꞰ-ꞴꞶＡ-Ｚ",astral:"�[�-�]|�[�-�]|�[�-��-��-��������-��-��-����-��-��-����-��-���-��-��-��-��-��-��-��-��-��-��-��-��]|�[�-�]|�[�-��-��-�]"},{name:"White_Space",bmp:"\t-\r    - \u2028\u2029  　"}];t.push({name:"Assigned",inverseOf:"Cn"}),e.addUnicodeData(t)}},function(e,t){e.exports=function(e){"use strict";if(!e.addUnicodeData)throw new ReferenceError("Unicode Base must be loaded before Unicode Scripts");e.addUnicodeData([{name:"Ahom",astral:"�[�-��-��-�]"},{name:"Anatolian_Hieroglyphs",astral:"�[�-�]"},{name:"Arabic",bmp:"؀-؄؆-؋؍-ؚ؞ؠ-ؿف-يٖ-ٯٱ-ۜ۞-ۿݐ-ݿࢠ-ࢴࣣ-ࣿﭐ-﯁ﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-﷽ﹰ-ﹴﹶ-ﻼ",astral:"�[�-�]|�[�-��-������-��-��������-�������������-��-��-��-���-��-��-��-��-���]"},{name:"Armenian",bmp:"Ա-Ֆՙ-՟ա-և֊֍-֏ﬓ-ﬗ"},{name:"Avestan",astral:"�[�-��-�]"},{name:"Balinese",bmp:"ᬀ-ᭋ᭐-᭼"},{name:"Bamum",bmp:"ꚠ-꛷",astral:"�[�-�]"},{name:"Bassa_Vah",astral:"�[�-��-�]"
},{name:"Batak",bmp:"ᯀ-᯳᯼-᯿"},{name:"Bengali",bmp:"ঀ-ঃঅ-ঌএঐও-নপ-রলশ-হ়-ৄেৈো-ৎৗড়ঢ়য়-ৣ০-৻"},{name:"Bopomofo",bmp:"˪˫ㄅ-ㄭㆠ-ㆺ"},{name:"Brahmi",astral:"�[�-��-��]"},{name:"Braille",bmp:"⠀-⣿"},{name:"Buginese",bmp:"ᨀ-ᨛ᨞᨟"},{name:"Buhid",bmp:"ᝀ-ᝓ"},{name:"Canadian_Aboriginal",bmp:"᐀-ᙿᢰ-ᣵ"},{name:"Carian",astral:"�[�-�]"},{name:"Caucasian_Albanian",astral:"�[�-��]"},{name:"Chakma",astral:"�[�-��-�]"},{name:"Cham",bmp:"ꨀ-ꨶꩀ-ꩍ꩐-꩙꩜-꩟"},{name:"Cherokee",bmp:"Ꭰ-Ᏽᏸ-ᏽꭰ-ꮿ"},{name:"Common",bmp:"\0-@\\x5B-`\\x7B-©«-¹»-¿×÷ʹ-˟˥-˩ˬ-˿ʹ;΅·։؅،؛؜؟ـ۝।॥฿࿕-࿘჻᛫-᛭᜵᜶᠂᠃᠅᳓᳡ᳩ-ᳬᳮ-ᳳᳵᳶ -​‎-⁤⁦-⁰⁴-⁾₀-₎₠-₾℀-℥℧-℩ℬ-ℱℳ-⅍⅏-⅟↉-↋←-⏺␀-␦⑀-⑊①-⟿⤀-⭳⭶-⮕⮘-⮹⮽-⯈⯊-⯑⯬-⯯⸀-⹂⿰-⿻　-〄〆〈-〠〰-〷〼-〿゛゜゠・ー㆐-㆟㇀-㇣㈠-㉟㉿-㋏㍘-㏿䷀-䷿꜀-꜡ꞈ-꞊꠰-꠹꤮ꧏ꭛﴾﴿︐-︙︰-﹒﹔-﹦﹨-﹫\ufeff！-＠［-｀｛-･ｰﾞﾟ￠-￦￨-￮￹-�",astral:"�[�-��-��-��-��-��-��-��]|�[�-�]|�[�-��-�������-��-���-��-��-��-��-��-��-��-���-��-��-��-�]|�[��-�]|�[�-��-��-��-��-��-��-�]|�[�-��-��-��-��-��-�]|�[�-��-��-��-����-��-��-��-�]|�[�-��-��-��-��-��-��-��-��-��-��-����-��-����-�]"},{name:"Coptic",bmp:"Ϣ-ϯⲀ-ⳳ⳹-⳿"},{name:"Cuneiform",astral:"�[�-��-��-�]|�[�-�]"},{name:"Cypriot",astral:"�[�-���-�����]"},{name:"Cyrillic",bmp:"Ѐ-҄҇-ԯᴫᵸⷠ-ⷿꙀ-ꚟ︮︯"},{name:"Deseret",astral:"�[�-�]"},{name:"Devanagari",bmp:"ऀ-ॐ॓-ॣ०-ॿ꣠-ꣽ"},{name:"Duployan",astral:"�[�-��-��-��-��-�]"},{name:"Egyptian_Hieroglyphs",astral:"�[�-�]|�[�-�]"},{name:"Elbasan",astral:"�[�-�]"},{name:"Ethiopic",bmp:"ሀ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚ፝-፼ᎀ-᎙ⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮ"},{name:"Georgian",bmp:"Ⴀ-ჅჇჍა-ჺჼ-ჿⴀ-ⴥⴧⴭ"},{name:"Glagolitic",bmp:"Ⰰ-Ⱞⰰ-ⱞ"},{name:"Gothic",astral:"�[�-�]"},{name:"Grantha",astral:"�[�-��-����-��-����-��-����-����-��-��-�]"},{name:"Greek",bmp:"Ͱ-ͳ͵-ͷͺ-ͽͿ΄ΆΈ-ΊΌΎ-ΡΣ-ϡϰ-Ͽᴦ-ᴪᵝ-ᵡᵦ-ᵪᶿἀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ῄῆ-ΐῖ-Ί῝-`ῲ-ῴῶ-῾Ωꭥ",astral:"�[�-��]|�[�-�]"},{name:"Gujarati",bmp:"ઁ-ઃઅ-ઍએ-ઑઓ-નપ-રલળવ-હ઼-ૅે-ૉો-્ૐૠ-ૣ૦-૱ૹ"},{name:"Gurmukhi",bmp:"ਁ-ਃਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹ਼ਾ-ੂੇੈੋ-੍ੑਖ਼-ੜਫ਼੦-ੵ"},{name:"Han",bmp:"⺀-⺙⺛-⻳⼀-⿕々〇〡-〩〸-〻㐀-䶵一-鿕豈-舘並-龎",astral:"�[�-��-�]|[�-��-��-�][�-�]|�[�-��-�]|�[�-�]|�[�-��-�]|�[�-�]"},{name:"Hangul",bmp:"ᄀ-ᇿ〮〯ㄱ-ㆎ㈀-㈞㉠-㉾ꥠ-ꥼ가-힣ힰ-ퟆퟋ-ퟻﾠ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ"},{name:"Hanunoo",bmp:"ᜠ-᜴"},{name:"Hatran",astral:"�[�-����-�]"},{name:"Hebrew",bmp:"֑-ׇא-תװ-״יִ-זּטּ-לּמּנּסּףּפּצּ-ﭏ"},{name:"Hiragana",bmp:"ぁ-ゖゝ-ゟ",astral:"𛀁|🈀"},{name:"Imperial_Aramaic",astral:"�[�-��-�]"},{name:"Inherited",bmp:"̀-ًͯ҅҆-ٰٕ॒॑᪰-᪾᳐-᳔᳒-᳢᳠-᳨᳭᳴᳸᳹᷀-᷵᷼-᷿‌‍⃐-〪⃰-゙゚〭︀-️︠-︭",astral:"�[�-��-��-��-�]|�[��]|�[�-�]"},{name:"Inscriptional_Pahlavi",astral:"�[�-��-�]"},{name:"Inscriptional_Parthian",astral:"�[�-��-�]"},{name:"Javanese",bmp:"ꦀ-꧍꧐-꧙꧞꧟"},{name:"Kaithi",astral:"�[�-�]"},{name:"Kannada",bmp:"ಁ-ಃಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹ಼-ೄೆ-ೈೊ-್ೕೖೞೠ-ೣ೦-೯ೱೲ"},{name:"Katakana",bmp:"ァ-ヺヽ-ヿㇰ-ㇿ㋐-㋾㌀-㍗ｦ-ｯｱ-ﾝ",astral:"𛀀"},{name:"Kayah_Li",bmp:"꤀-꤭꤯"},{name:"Kharoshthi",astral:"�[�-����-��-��-��-��-��-�]"},{name:"Khmer",bmp:"ក-៝០-៩៰-៹᧠-᧿"},{name:"Khojki",astral:"�[�-��-�]"},{name:"Khudawadi",astral:"�[�-��-�]"},{name:"Lao",bmp:"ກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ູົ-ຽເ-ໄໆ່-ໍ໐-໙ໜ-ໟ"},{name:"Latin",bmp:"A-Za-zªºÀ-ÖØ-öø-ʸˠ-ˤᴀ-ᴥᴬ-ᵜᵢ-ᵥᵫ-ᵷᵹ-ᶾḀ-ỿⁱⁿₐ-ₜKÅℲⅎⅠ-ↈⱠ-ⱿꜢ-ꞇꞋ-ꞭꞰ-ꞷꟷ-ꟿꬰ-ꭚꭜ-ꭤﬀ-ﬆＡ-Ｚａ-ｚ"},{name:"Lepcha",bmp:"ᰀ-᰷᰻-᱉ᱍ-ᱏ"},{name:"Limbu",bmp:"ᤀ-ᤞᤠ-ᤫᤰ-᤻᥀᥄-᥏"},{name:"Linear_A",astral:"�[�-��-��-�]"},{name:"Linear_B",astral:"�[�-��-��-����-��-��-�]"},{name:"Lisu",bmp:"ꓐ-꓿"},{name:"Lycian",astral:"�[�-�]"},{name:"Lydian",astral:"�[�-��]"},{name:"Mahajani",astral:"�[�-�]"},{name:"Malayalam",bmp:"ഁ-ഃഅ-ഌഎ-ഐഒ-ഺഽ-ൄെ-ൈൊ-ൎൗൟ-ൣ൦-൵൹-ൿ"},{name:"Mandaic",bmp:"ࡀ-࡛࡞"},{name:"Manichaean",astral:"�[�-��-�]"},{name:"Meetei_Mayek",bmp:"ꫠ-꫶ꯀ-꯭꯰-꯹"},{name:"Mende_Kikakui",astral:"�[�-��-�]"},{name:"Meroitic_Cursive",astral:"�[�-��-��-�]"},{name:"Meroitic_Hieroglyphs",astral:"�[�-�]"},{name:"Miao",astral:"�[�-��-��-�]"},{name:"Modi",astral:"�[�-��-�]"},{name:"Mongolian",bmp:"᠀᠁᠄᠆-᠎᠐-᠙ᠠ-ᡷᢀ-ᢪ"},{name:"Mro",astral:"�[�-��-���]"},{name:"Multani",astral:"�[�-���-��-��-�]"},{name:"Myanmar",bmp:"က-႟ꧠ-ꧾꩠ-ꩿ"},{name:"Nabataean",astral:"�[�-��-�]"},{name:"New_Tai_Lue",bmp:"ᦀ-ᦫᦰ-ᧉ᧐-᧚᧞᧟"},{name:"Nko",bmp:"߀-ߺ"},{name:"Ogham",bmp:" -᚜"},{name:"Ol_Chiki",bmp:"᱐-᱿"},{name:"Old_Hungarian",astral:"�[�-��-��-�]"},{name:"Old_Italic",astral:"�[�-�]"},{name:"Old_North_Arabian",astral:"�[�-�]"},{name:"Old_Permic",astral:"�[�-�]"},{name:"Old_Persian",astral:"�[�-��-�]"},{name:"Old_South_Arabian",astral:"�[�-�]"},{name:"Old_Turkic",astral:"�[�-�]"},{name:"Oriya",bmp:"ଁ-ଃଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହ଼-ୄେୈୋ-୍ୖୗଡ଼ଢ଼ୟ-ୣ୦-୷"},{name:"Osmanya",astral:"�[�-��-�]"},{name:"Pahawh_Hmong",astral:"�[�-��-��-��-��-�]"},{name:"Palmyrene",astral:"�[�-�]"},{name:"Pau_Cin_Hau",astral:"�[�-�]"},{name:"Phags_Pa",bmp:"ꡀ-꡷"},{name:"Phoenician",astral:"�[�-��]"},{name:"Psalter_Pahlavi",astral:"�[�-��-��-�]"},{name:"Rejang",bmp:"ꤰ-꥓꥟"},{name:"Runic",bmp:"ᚠ-ᛪᛮ-ᛸ"},{name:"Samaritan",bmp:"ࠀ-࠭࠰-࠾"},{name:"Saurashtra",bmp:"ꢀ-꣄꣎-꣙"},{name:"Sharada",astral:"�[�-��-�]"},{name:"Shavian",astral:"�[�-�]"},{name:"Siddham",astral:"�[�-��-�]"},{name:"SignWriting",astral:"�[�-��-��-�]"},{name:"Sinhala",bmp:"ංඃඅ-ඖක-නඳ-රලව-ෆ්ා-ුූෘ-ෟ෦-෯ෲ-෴",astral:"�[�-�]"},{name:"Sora_Sompeng",astral:"�[�-��-�]"},{name:"Sundanese",bmp:"ᮀ-ᮿ᳀-᳇"},{name:"Syloti_Nagri",bmp:"ꠀ-꠫"},{name:"Syriac",bmp:"܀-܍܏-݊ݍ-ݏ"},{name:"Tagalog",bmp:"ᜀ-ᜌᜎ-᜔"},{name:"Tagbanwa",bmp:"ᝠ-ᝬᝮ-ᝰᝲᝳ"},{name:"Tai_Le",bmp:"ᥐ-ᥭᥰ-ᥴ"},{name:"Tai_Tham",bmp:"ᨠ-ᩞ᩠-᩿᩼-᪉᪐-᪙᪠-᪭"},{name:"Tai_Viet",bmp:"ꪀ-ꫂꫛ-꫟"},{name:"Takri",astral:"�[�-��-�]"},{name:"Tamil",bmp:"ஂஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹா-ூெ-ைொ-்ௐௗ௦-௺"},{name:"Telugu",bmp:"ఀ-ఃఅ-ఌఎ-ఐఒ-నప-హఽ-ౄె-ైొ-్ౕౖౘ-ౚౠ-ౣ౦-౯౸-౿"},{name:"Thaana",bmp:"ހ-ޱ"},{name:"Thai",bmp:"ก-ฺเ-๛"},{name:"Tibetan",bmp:"ༀ-ཇཉ-ཬཱ-ྗྙ-ྼ྾-࿌࿎-࿔࿙࿚"},{name:"Tifinagh",bmp:"ⴰ-ⵧⵯ⵰⵿"},{name:"Tirhuta",astral:"�[�-��-�]"},{name:"Ugaritic",astral:"�[�-��]"},{name:"Vai",bmp:"ꔀ-ꘫ"},{name:"Warang_Citi",astral:"�[�-��]"},{name:"Yi",bmp:"ꀀ-ꒌ꒐-꓆"}])}},function(e,t,r){var n=r(42);r(34)(n),r(35)(n),r(36)(n),r(37)(n),r(38)(n),r(39)(n),r(40)(n),e.exports=n},function(e,t,r){function n(e){var t=!0;try{new RegExp("",e)}catch(e){t=!1}return t&&"y"===e?new RegExp("aa|.","y").test("b"):t}function i(e,t,r,n,i){var o;if(e[x]={captureNames:t},i)return e;if(e.__proto__)e.__proto__=E.prototype;else for(o in E.prototype)e[o]=E.prototype[o];return e[x].source=r,e[x].flags=n?n.split("").sort().join(""):n,e}function o(e){return N.replace.call(e,/([\s\S])(?=[\s\S]*\1)/g,"")}function a(e,t){if(!E.isRegExp(e))throw new TypeError("Type RegExp expected");var r=e[x]||{},n=l(e),a="",s="",c=null,h=null;return t=t||{},t.removeG&&(s+="g"),t.removeY&&(s+="y"),s&&(n=N.replace.call(n,new RegExp("["+s+"]+","g"),"")),t.addG&&(a+="g"),t.addY&&(a+="y"),a&&(n=o(n+a)),t.isInternalOnly||(void 0!==r.source&&(c=r.source),null!=r.flags&&(h=a?o(r.flags+a):r.flags)),e=i(new RegExp(e.source,n),u(e)?r.captureNames.slice(0):null,c,h,t.isInternalOnly)}function s(e){return parseInt(e,16)}function l(e){return M?e.flags:N.exec.call(/\/([a-z]*)$/i,RegExp.prototype.toString.call(e))[1]}function u(e){return!(!e[x]||!e[x].captureNames)}function c(e){return parseInt(e,10).toString(16)}function h(e,t){var r,n=e.length;for(r=0;r<n;++r)if(e[r]===t)return r;return-1}function d(e,t){return L.call(e)==="[object "+t+"]"}function p(e,t,r){return N.test.call(r.indexOf("x")>-1?/^(?:\s|#[^#\n]*|\(\?#[^)]*\))*(?:[?*+]|{\d+(?:,\d*)?})/:/^(?:\(\?#[^)]*\))*(?:[?*+]|{\d+(?:,\d*)?})/,e.slice(t))}function f(e){for(;e.length<4;)e="0"+e;return e}function m(e,t){var r;if(o(t)!==t)throw new SyntaxError("Invalid duplicate regex flag "+t);for(e=N.replace.call(e,/^\(\?([\w$]+)\)/,function(e,r){if(N.test.call(/[gy]/,r))throw new SyntaxError("Cannot use flag g or y in mode modifier "+e);return t=o(t+r),""}),r=0;r<t.length;++r)if(!B[t.charAt(r)])throw new SyntaxError("Unknown regex flag "+t.charAt(r));return{pattern:e,flags:t}}function v(e){var t={};return d(e,"String")?(E.forEach(e,/[^\s,]+/,function(e){t[e]=!0}),t):e}function y(e){if(!/^[\w$]$/.test(e))throw new Error("Flag must be a single character A-Za-z0-9_$");B[e]=!0}function g(e,t,r,n,i){for(var o,a,s=k.length,l=e.charAt(r),u=null;s--;)if(a=k[s],!(a.leadChar&&a.leadChar!==l||a.scope!==n&&"all"!==a.scope||a.flag&&t.indexOf(a.flag)===-1)&&(o=E.exec(e,a.regex,r,"sticky"))){u={matchLength:o[0].length,output:a.handler.call(i,o,n,t),reparse:a.reparse};break}return u}function b(e){S.astral=e}function w(e){RegExp.prototype.exec=(e?C:N).exec,RegExp.prototype.test=(e?C:N).test,String.prototype.match=(e?C:N).match,String.prototype.replace=(e?C:N).replace,String.prototype.split=(e?C:N).split,S.natives=e}function _(e){if(null==e)throw new TypeError("Cannot convert null or undefined to object");return e}function E(e,t){if(E.isRegExp(e)){if(void 0!==t)throw new TypeError("Cannot supply flags when copying a RegExp");return a(e)}if(e=void 0===e?"":String(e),t=void 0===t?"":String(t),E.isInstalled("astral")&&t.indexOf("A")===-1&&(t+="A"),P[e]||(P[e]={}),!P[e][t]){for(var r,n={hasNamedCapture:!1,captureNames:[]},o=A,s="",l=0,u=m(e,t),c=u.pattern,h=u.flags;l<c.length;){do r=g(c,h,l,o,n),r&&r.reparse&&(c=c.slice(0,l)+r.output+c.slice(l+r.matchLength));while(r&&r.reparse);if(r)s+=r.output,l+=r.matchLength||1;else{var d=E.exec(c,O[o],l,"sticky")[0];s+=d,l+=d.length,"["===d&&o===A?o=R:"]"===d&&o===R&&(o=A)}}P[e][t]={pattern:N.replace.call(s,/(?:\(\?:\))+/g,"(?:)"),flags:N.replace.call(h,/[^gimuy]+/g,""),captures:n.hasNamedCapture?n.captureNames:null}}var p=P[e][t];return i(new RegExp(p.pattern,p.flags),p.captures,e,t)}var x="xregexp",S={astral:!1,natives:!1},N={exec:RegExp.prototype.exec,test:RegExp.prototype.test,match:String.prototype.match,replace:String.prototype.replace,split:String.prototype.split},C={},T={},P={},k=[],A="default",R="class",O={default:/\\(?:0(?:[0-3][0-7]{0,2}|[4-7][0-7]?)?|[1-9]\d*|x[\dA-Fa-f]{2}|u(?:[\dA-Fa-f]{4}|{[\dA-Fa-f]+})|c[A-Za-z]|[\s\S])|\(\?(?:[:=!]|<[=!])|[?*+]\?|{\d+(?:,\d*)?}\??|[\s\S]/,class:/\\(?:[0-3][0-7]{0,2}|[4-7][0-7]?|x[\dA-Fa-f]{2}|u(?:[\dA-Fa-f]{4}|{[\dA-Fa-f]+})|c[A-Za-z]|[\s\S])|[\s\S]/},I=/\$(?:{([\w$]+)}|(\d\d?|[\s\S]))/g,D=void 0===N.exec.call(/()??/,"")[1],M=void 0!==/x/.flags,L={}.toString,j=n("u"),F=n("y"),B={g:!0,i:!0,m:!0,u:j,y:F};E.prototype=new RegExp,E.version="3.1.1",E._hasNativeFlag=n,E._dec=s,E._hex=c,E._pad4=f,E.addToken=function(e,t,r){r=r||{};var n,i=r.optionalFlags;if(r.flag&&y(r.flag),i)for(i=N.split.call(i,""),n=0;n<i.length;++n)y(i[n]);k.push({regex:a(e,{addG:!0,addY:F,isInternalOnly:!0}),handler:t,scope:r.scope||A,flag:r.flag,reparse:r.reparse,leadChar:r.leadChar}),E.cache.flush("patterns")},E.cache=function(e,t){return T[e]||(T[e]={}),T[e][t]||(T[e][t]=E(e,t))},E.cache.flush=function(e){"patterns"===e?P={}:T={}},E.escape=function(e){return N.replace.call(_(e),/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},E.exec=function(e,t,r,n){var i,o,s="g",l=!1;return l=F&&!!(n||t.sticky&&n!==!1),l&&(s+="y"),t[x]=t[x]||{},o=t[x][s]||(t[x][s]=a(t,{addG:!0,addY:l,removeY:n===!1,isInternalOnly:!0})),o.lastIndex=r=r||0,i=C.exec.call(o,e),n&&i&&i.index!==r&&(i=null),t.global&&(t.lastIndex=i?o.lastIndex:0),i},E.forEach=function(e,t,r){for(var n,i=0,o=-1;n=E.exec(e,t,i);)r(n,++o,e,t),i=n.index+(n[0].length||1)},E.globalize=function(e){return a(e,{addG:!0})},E.install=function(e){e=v(e),!S.astral&&e.astral&&b(!0),!S.natives&&e.natives&&w(!0)},E.isInstalled=function(e){return!!S[e]},E.isRegExp=function(e){return"[object RegExp]"===L.call(e)},E.match=function(e,t,r){var n,i,o=t.global&&"one"!==r||"all"===r,s=(o?"g":"")+(t.sticky?"y":"")||"noGY";return t[x]=t[x]||{},i=t[x][s]||(t[x][s]=a(t,{addG:!!o,removeG:"one"===r,isInternalOnly:!0})),n=N.match.call(_(e),i),t.global&&(t.lastIndex="one"===r&&n?n.index+n[0].length:0),o?n||[]:n&&n[0]},E.matchChain=function(e,t){return function e(r,n){function i(e){if(o.backref){if(!(e.hasOwnProperty(o.backref)||+o.backref<e.length))throw new ReferenceError("Backreference to undefined group: "+o.backref);a.push(e[o.backref]||"")}else a.push(e[0])}for(var o=t[n].regex?t[n]:{regex:t[n]},a=[],s=0;s<r.length;++s)E.forEach(r[s],o.regex,i);return n!==t.length-1&&a.length?e(a,n+1):a}([e],0)},E.replace=function(e,t,r,n){var i,o=E.isRegExp(t),s=t.global&&"one"!==n||"all"===n,l=(s?"g":"")+(t.sticky?"y":"")||"noGY",u=t;return o?(t[x]=t[x]||{},u=t[x][l]||(t[x][l]=a(t,{addG:!!s,removeG:"one"===n,isInternalOnly:!0}))):s&&(u=new RegExp(E.escape(String(t)),"g")),i=C.replace.call(_(e),u,r),o&&t.global&&(t.lastIndex=0),i},E.replaceEach=function(e,t){var r,n;for(r=0;r<t.length;++r)n=t[r],e=E.replace(e,n[0],n[1],n[2]);return e},E.split=function(e,t,r){return C.split.call(_(e),t,r)},E.test=function(e,t,r,n){return!!E.exec(e,t,r,n)},E.uninstall=function(e){e=v(e),S.astral&&e.astral&&b(!1),S.natives&&e.natives&&w(!1)},E.union=function(e,t){function r(e,t,r){var a=i[o-n];if(t){if(++o,a)return"(?<"+a+">"}else if(r)return"\\"+(+r+n);return e}var n,i,o=0;if(!d(e,"Array")||!e.length)throw new TypeError("Must provide a nonempty array of patterns to merge");for(var a,s=/(\()(?!\?)|\\([1-9]\d*)|\\[\s\S]|\[(?:[^\\\]]|\\[\s\S])*]/g,l=[],u=0;u<e.length;++u)a=e[u],E.isRegExp(a)?(n=o,i=a[x]&&a[x].captureNames||[],l.push(N.replace.call(E(a.source).source,s,r))):l.push(E.escape(a));return E(l.join("|"),t)},C.exec=function(e){var t,r,n,i=this.lastIndex,o=N.exec.apply(this,arguments);if(o){if(!D&&o.length>1&&h(o,"")>-1&&(r=a(this,{removeG:!0,isInternalOnly:!0}),N.replace.call(String(e).slice(o.index),r,function(){var e,t=arguments.length;for(e=1;e<t-2;++e)void 0===arguments[e]&&(o[e]=void 0)})),this[x]&&this[x].captureNames)for(n=1;n<o.length;++n)t=this[x].captureNames[n-1],t&&(o[t]=o[n]);this.global&&!o[0].length&&this.lastIndex>o.index&&(this.lastIndex=o.index)}return this.global||(this.lastIndex=i),o},C.test=function(e){return!!C.exec.call(this,e)},C.match=function(e){var t;if(E.isRegExp(e)){if(e.global)return t=N.match.apply(this,arguments),e.lastIndex=0,t}else e=new RegExp(e);return C.exec.call(e,_(this))},C.replace=function(e,t){var r,n,i,o=E.isRegExp(e);return o?(e[x]&&(n=e[x].captureNames),r=e.lastIndex):e+="",i=d(t,"Function")?N.replace.call(String(this),e,function(){var r,i=arguments;if(n)for(i[0]=new String(i[0]),r=0;r<n.length;++r)n[r]&&(i[0][n[r]]=i[r+1]);return o&&e.global&&(e.lastIndex=i[i.length-2]+i[0].length),t.apply(void 0,i)}):N.replace.call(null==this?this:String(this),e,function(){var e=arguments;return N.replace.call(String(t),I,function(t,r,i){var o;if(r){if(o=+r,o<=e.length-3)return e[o]||"";if(o=n?h(n,r):-1,o<0)throw new SyntaxError("Backreference to undefined group "+t);return e[o+1]||""}if("$"===i)return"$";if("&"===i||0===+i)return e[0];if("`"===i)return e[e.length-1].slice(0,e[e.length-2]);if("'"===i)return e[e.length-1].slice(e[e.length-2]+e[0].length);if(i=+i,!isNaN(i)){if(i>e.length-3)throw new SyntaxError("Backreference to undefined group "+t);return e[i]||""}throw new SyntaxError("Invalid token "+t)})}),o&&(e.global?e.lastIndex=0:e.lastIndex=r),i},C.split=function(e,t){if(!E.isRegExp(e))return N.split.apply(this,arguments);var r,n=String(this),i=[],o=e.lastIndex,a=0;return t=(void 0===t?-1:t)>>>0,E.forEach(n,e,function(e){e.index+e[0].length>a&&(i.push(n.slice(a,e.index)),e.length>1&&e.index<n.length&&Array.prototype.push.apply(i,e.slice(1)),r=e[0].length,a=e.index+r)}),a===n.length?N.test.call(e,"")&&!r||i.push(""):i.push(n.slice(a)),e.lastIndex=o,i.length>t?i.slice(0,t):i},E.addToken(/\\([ABCE-RTUVXYZaeg-mopqyz]|c(?![A-Za-z])|u(?![\dA-Fa-f]{4}|{[\dA-Fa-f]+})|x(?![\dA-Fa-f]{2}))/,function(e,t){if("B"===e[1]&&t===A)return e[0];throw new SyntaxError("Invalid escape "+e[0])},{scope:"all",leadChar:"\\"}),E.addToken(/\\u{([\dA-Fa-f]+)}/,function(e,t,r){var n=s(e[1]);if(n>1114111)throw new SyntaxError("Invalid Unicode code point "+e[0]);if(n<=65535)return"\\u"+f(c(n));if(j&&r.indexOf("u")>-1)return e[0];throw new SyntaxError("Cannot use Unicode code point above \\u{FFFF} without flag u")},{scope:"all",leadChar:"\\"}),E.addToken(/\[(\^?)]/,function(e){return e[1]?"[\\s\\S]":"\\b\\B"},{leadChar:"["}),E.addToken(/\(\?#[^)]*\)/,function(e,t,r){return p(e.input,e.index+e[0].length,r)?"":"(?:)"},{leadChar:"("}),E.addToken(/\s+|#[^\n]*\n?/,function(e,t,r){return p(e.input,e.index+e[0].length,r)?"":"(?:)"},{flag:"x"}),E.addToken(/\./,function(){return"[\\s\\S]"},{flag:"s",leadChar:"."}),E.addToken(/\\k<([\w$]+)>/,function(e){var t=isNaN(e[1])?h(this.captureNames,e[1])+1:+e[1],r=e.index+e[0].length;if(!t||t>this.captureNames.length)throw new SyntaxError("Backreference to undefined group "+e[0]);return"\\"+t+(r===e.input.length||isNaN(e.input.charAt(r))?"":"(?:)")},{leadChar:"\\"}),E.addToken(/\\(\d+)/,function(e,t){if(!(t===A&&/^[1-9]/.test(e[1])&&+e[1]<=this.captureNames.length)&&"0"!==e[1])throw new SyntaxError("Cannot use octal escape or backreference to undefined group "+e[0]);return e[0]},{scope:"all",leadChar:"\\"}),E.addToken(/\(\?P?<([\w$]+)>/,function(e){if(!isNaN(e[1]))throw new SyntaxError("Cannot use integer as capture name "+e[0]);if("length"===e[1]||"__proto__"===e[1])throw new SyntaxError("Cannot use reserved word as capture name "+e[0]);if(h(this.captureNames,e[1])>-1)throw new SyntaxError("Cannot use same name for multiple groups "+e[0]);return this.captureNames.push(e[1]),this.hasNamedCapture=!0,"("},{leadChar:"("}),E.addToken(/\((?!\?)/,function(e,t,r){return r.indexOf("n")>-1?"(?:":(this.captureNames.push(null),"(")},{optionalFlags:"n",leadChar:"("}),e.exports=E}])}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("salve")):"function"==typeof define&&define.amd?define("salve-dom",["salve"],t):"object"==typeof exports?exports["salve-dom"]=t(require("salve")):e["salve-dom"]=t(e.salve)}(this,function(e){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._eventListeners=Object.create(null),this._generalListeners=[],this._trace=!1}return e.prototype.addEventListener=function(e,t){if("*"===e)this._generalListeners.push(t);else{var r=this._eventListeners[e];void 0===r&&(r=this._eventListeners[e]=[]),r.push(t)}},e.prototype.addOneTimeEventListener=function(e,t){var r=this,n=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return r.removeEventListener(e,n),t.apply(r,i)};return this.addEventListener(e,n),n},e.prototype.removeEventListener=function(e,t){var r="*"===e?this._generalListeners:this._eventListeners[e];if(void 0!==r){var n=r.lastIndexOf(t);n!==-1&&r.splice(n,1)}},e.prototype.removeAllListeners=function(e){"*"===e?this._generalListeners=[]:this._eventListeners[e]=[]},e.prototype._emit=function(e,t){this._trace&&console.log("simple_event_emitter emitting:",e,"with:",t);var r=this._generalListeners;if(r.length>0){r=r.slice();for(var n=0,i=r;n<i.length;n++){var o=i[n],a=o.call(void 0,e,t);if(a===!1)return}}var r=this._eventListeners[e];if(void 0!==r&&r.length>0){r=r.slice();for(var s=0,l=r;s<l.length;s++){var o=l[s],a=o.call(void 0,t);if(a===!1)return}}},e}();t.EventEmitter=n},function(e,t,r){function n(e,t){var r=void 0!==Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__;r!==t&&(void 0!==Object.setPrototypeOf?Object.setPrototypeOf(e,t.prototype):e.__proto__=t.prototype)}Object.defineProperty(t,"__esModule",{value:!0}),t.fixPrototype=n},function(t,r){t.exports=e},function(e,t,r){function n(e,t){return Array.prototype.indexOf.call(e,t)}function i(e){var t=Node.ATTRIBUTE_NODE;return e instanceof Attr||void 0!==t&&e.nodeType===t}function o(e,t,r,n){for(var i=e.possible().toArray(),o=!1,a=0,s=i;a<s.length;a++){var l=s[a];if(l.params[0]===t){var u=l.params[1],c=u.match(r,n);if(o=o||c,c&&!u.wildcardMatch(r,n))return!1}}return o}var a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=r(2),l=r(0),u=r(1);t.isAttr=i;var c;!function(e){e[e.START_TAG=1]="START_TAG",e[e.CONTENTS=2]="CONTENTS",e[e.END_TAG=3]="END_TAG"}(c||(c={}));var h;!function(e){e[e.INCOMPLETE=1]="INCOMPLETE",e[e.WORKING=2]="WORKING",e[e.INVALID=3]="INVALID",e[e.VALID=4]="VALID"}(h=t.WorkingState||(t.WorkingState={}));var d=function(){function e(e,t){this.partDone=e,this.portion=t}return e}(),p=new s.Event("enterContext"),f=new s.Event("leaveStartTag"),m=new s.Event("leaveContext"),v=function(e){function t(){var r=e.call(this,"undefined event_index; _validateUpTo should have taken care of that")||this;return u.fixPrototype(r,t),r}return a(t,e),t}(Error),y=function(){function e(e,t,r){void 0===r&&(r={}),this.schema=e,this.root=t,this._cycleEntered=0,this._timeout=200,this._maxTimespan=100,this._resetting=!1,this._errors=[],this._boundWrapper=this._workWrapper.bind(this),this._validationEvents=[],this._workingState=h.INCOMPLETE,this._partDone=0,this._validationStage=c.CONTENTS,this._previousChild=null,this._validationStack=[new d(0,1)],this._walkerCache=Object.create(null),this._walkerCacheMax=-1,this._prefix="salveDom",this._walkerCacheGap=100,this._events=new l.EventEmitter;for(var n=["timeout","maxTimespan","walkerCacheGap"],i=0,o=n;i<o.length;i++){var a=o[i],s=r[a];if(void 0!==s){if(s<0)throw new Error("the value for "+a+" cannot be negative");this["_"+a]=r[a]}}void 0!==r.prefix&&(this._prefix=r.prefix),this._curEl=this.root,this._setNodeProperty(this._curEl,"EventIndexAfterStart",this._validationEvents.length),this._setWorkingState(h.INCOMPLETE,0),this._validationWalker=this.schema.newWalker(),this.events=this._events}return e.prototype.makeKey=function(e){return""+this._prefix+e},e.prototype.getNodeProperty=function(e,t){return e[this.makeKey(t)]},e.prototype._setNodeProperty=function(e,t,r){e[this.makeKey(t)]=r},e.prototype._clearNodeProperties=function(e){for(var t=["EventIndexAfter","EventIndexAfterStart","EventIndexBeforeAttributes","EventIndexAfterAttributes","PossibleDueToWildcard"],r=0,n=t;r<n.length;r++){var i=n[r];delete e[this.makeKey(i)]}},e.prototype.start=function(){void 0!==this._timeoutId&&this._stop(h.WORKING),this._timeoutId=setTimeout(this._boundWrapper,0)},e.prototype.getSchemaNamespaces=function(){return this.schema.getNamespaces()},e.prototype.getDocumentNamespaces=function(){function e(r){if(null!==r){for(var n=r.attributes.length,i=0;i<n;++i){var o=r.attributes[i];if(0===o.name.lastIndexOf("xmlns",0)){var a=o.name.slice(6),s=t[a];void 0===s&&(s=t[a]=[]),s.push(o.value)}}for(var l=r.firstChild;null!==l;)l.nodeType===Node.ELEMENT_NODE&&e(l),l=l.nextSibling}}var t={};return e(this.root.firstChild),t},e.prototype._workWrapper=function(){this._work()&&(this._timeoutId=setTimeout(this._boundWrapper,this._timeout))},e.prototype._work=function(){for(var e=Date.now();;){if(this._maxTimespan>0&&Date.now()-e>=this._maxTimespan)return!0;var t=this._cycle();if(!t)return!1}},e.prototype._cycle=function(){var e=this;if(this._resetting=!1,this._cycleEntered>0)throw new Error("internal error: _cycle is being reentered");if(this._cycleEntered<0)throw new Error("internal error: _cycleEntered negative");this._cycleEntered++;var t=this._validationWalker,r=this._validationStack,i=this._validationEvents,o=r[0].portion,a=this._validationStage,l=function(){var l=u._curEl;switch(a){case c.START_TAG:l=l,r.unshift(new d(u._partDone,o)),u._fireAndProcessEvent(t,p,l,0);for(var v=l.attributes.length,y=0;y<v;++y){var g=l.attributes[y];"xmlns"===g.name?u._fireAndProcessEvent(t,new s.Event("definePrefix","",g.value),l,0):0===g.name.lastIndexOf("xmlns:",0)&&u._fireAndProcessEvent(t,new s.Event("definePrefix",g.name.slice(6),g.value),l,0)}var b=l.tagName,w=l.parentNode,_=n(w.childNodes,l),E=t.resolveName(b,!1);return void 0===E&&(u._processEventResult([new s.ValidationError("cannot resolve the name "+b)],w,_),E=new s.EName("",b)),u._setPossibleDueToWildcard(l,t,"enterStartTag",E.ns,E.name),u._fireAndProcessEvent(t,new s.Event("enterStartTag",E.ns,E.name),w,_),u._setNodeProperty(l,"EventIndexBeforeAttributes",i.length),u._fireAttributeEvents(t,l),u._setNodeProperty(l,"EventIndexAfterAttributes",i.length),u._fireAndProcessEvent(t,f,l,0),a=u._validationStage=c.CONTENTS,u._setNodeProperty(l,"EventIndexAfterStart",i.length),u._cycleEntered--,{value:!0};case c.CONTENTS:for(var x,S=null===u._previousChild?l.firstChild:u._previousChild.nextSibling,N=[],C=function(){if(0!==N.length){var r=new s.Event("text",N.join("")),i=t.fireEvent(r);if(i instanceof Array){if(void 0===x)throw new Error("flushText running with undefined node");var o=x.parentNode;e._processEventResult(i,o,n(o.childNodes,x))}}N=[],x=void 0};null!==S;){switch(S.nodeType){case Node.TEXT_NODE:N.push(S.data),void 0===x&&(x=S);break;case Node.ELEMENT_NODE:return C(),o/=l.childElementCount,u._curEl=l=S,a=u._validationStage=c.START_TAG,u._previousChild=null,"continue-stage_change";case Node.COMMENT_NODE:break;default:throw new Error("unexpected node type: "+S.nodeType)}S=S.nextSibling}C(),a=u._validationStage=c.END_TAG;break;case c.END_TAG:if(l===u.root){var T=t.end();return T instanceof Array&&u._processEventResult(T,l,l.childNodes.length),u._runDocumentValidation(),u._setNodeProperty(l,"EventIndexAfter",i.length),u._partDone=1,u._stop(u._errors.length>0?h.INVALID:h.VALID),u._cycleEntered--,{value:!1}}var P=l,b=l.tagName,E=t.resolveName(b,!1);void 0===E&&(E=new s.EName("",b)),u._fireAndProcessEvent(t,new s.Event("endTag",E.ns,E.name),l,l.childNodes.length),u._fireAndProcessEvent(t,m,l,l.childNodes.length),u._previousChild=l,u._curEl=l=l.parentNode;var k=u._partDone;if(l!==u.root){r.shift();var A=r[0];k=A.partDone+=o,o=A.portion}return u._setWorkingState(h.WORKING,k),u._setNodeProperty(P,"EventIndexAfter",u._validationEvents.length),a=u._validationStage=c.CONTENTS,u._cycleEntered--,{value:!0};default:throw new Error("unexpected state")}},u=this;e:for(;;){var v=l();if("object"==typeof v)return v.value;switch(v){case"continue-stage_change":continue e}}},e.prototype.stop=function(){this._stop()},e.prototype._stop=function(e){void 0!==this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0,void 0===e?this._workingState===h.WORKING&&this._setWorkingState(h.INCOMPLETE,this._partDone):this._setWorkingState(e,this._partDone)},e.prototype._runDocumentValidation=function(){},e.prototype.restartAt=function(e){this.resetTo(e),this.start()},e.prototype.resetTo=function(e){this._resetting||(this._resetting=!0,this._resetTo(e))},e.prototype._erase=function(e){this._clearNodeProperties(e);for(var t=e.firstElementChild;null!==t;)this._erase(t),t=t.nextElementSibling},e.prototype._resetTo=function(e){this._erase(this.root),this._validationStage=c.CONTENTS,this._previousChild=null,this._validationWalker=this.schema.newWalker(),this._validationEvents=[],this._curEl=this.root,this._partDone=0,this._errors=[],this._walkerCache=Object.create(null),this._walkerCacheMax=-1,this._events._emit("reset-errors",{at:0})},e.prototype._setWorkingState=function(e,t){var r=!1;this._workingState!==e&&(this._workingState=e,r=!0),this._partDone!==t&&(this._partDone=t,r=!0),r&&this._events._emit("state-update",{state:e,partDone:t})},e.prototype.getWorkingState=function(){return{state:this._workingState,partDone:this._partDone}},Object.defineProperty(e.prototype,"errors",{get:function(){return this._errors.slice()},enumerable:!0,configurable:!0}),e.prototype._processEventResult=function(e,t,r){for(var n=0,i=e;n<i.length;n++){var o=i[n];this._processError({error:o,node:t,index:r})}},e.prototype._processError=function(e){this._errors.push(e),this._events._emit("error",e)},e.prototype._fireAttributeEvents=function(e,t){for(var r=t.attributes,n=0;n<r.length;++n){var i=r[n];"xmlns"!==i.name&&0!==i.name.lastIndexOf("xmlns",0)&&this._fireAttributeNameEvent(e,t,i)&&this._fireAndProcessEvent(e,new s.Event("attributeValue",i.value),i,0)}},e.prototype._fireAttributeNameEvent=function(e,t,r){var n=r.name,i=e.resolveName(n,!0);return void 0===i?(this._processError({error:new s.ValidationError("cannot resolve attribute name "+n),node:r,index:0}),!1):(this._setPossibleDueToWildcard(r,e,"attributeName",i.ns,i.name),this._fireAndProcessEvent(e,new s.Event("attributeName",i.ns,i.name),r,0),!0)},e.prototype._fireAndProcessEvent=function(e,t,r,i){this._validationEvents.push(t);var o=e.fireEvent(t);o instanceof Array&&(null!=r&&void 0!==i&&"number"!=typeof i&&(i=n(r.childNodes,i)),this._processEventResult(o,r,i))},e.prototype._validateUpTo=function(e,t,r){if(void 0===r&&(r=!1),r=!!r,r&&(void 0===e.childNodes||e.childNodes[t].nodeType!==Node.ELEMENT_NODE))throw new Error("trying to validate after attributes but before the end of the start tag on a node which is not an element node");var n=e,o="EventIndexAfter";if(e===this.root&&t<=0){if(r)o="EventIndexAfterAttributes",n=e.childNodes[t];else if(0===t)return}else if(i(e))n=e.ownerElement,o="EventIndexBeforeAttributes";else switch(e.nodeType){case Node.TEXT_NODE:n=e.previousElementSibling,null===n&&(n=e.parentNode,o="EventIndexAfterStart");break;case Node.ELEMENT_NODE:case Node.DOCUMENT_FRAGMENT_NODE:case Node.DOCUMENT_NODE:var a=e.childNodes[t],s=void 0===a?e.lastElementChild:a.previousElementSibling;r?(o="EventIndexAfterAttributes",n=a):null!==s?n=s:o="EventIndexAfterStart";break;default:throw new Error("unexpected node type: "+e.nodeType)}for(;void 0===this.getNodeProperty(n,o);)this._cycle()},e.prototype._getWalkerAt=function(e,t,r){function n(e){if(void 0===o)throw new Error("calling fireTextEvent without a walker");o.fireEvent(new s.Event("text",e.data))}if(void 0===r&&(r=!1),r=!!r,r&&(void 0===e.childNodes||e.childNodes[t].nodeType!==Node.ELEMENT_NODE))throw new Error("trying to get a walker for attribute events on a node which is not an element node");if(this._validateUpTo(e,t,r),e===this.root&&t<=0&&!r)return 0===t?this.schema.newWalker():this._validationWalker;var o;if(i(e)){var a=e.ownerElement;o=this.readyWalker(this.getNodeProperty(a,"EventIndexBeforeAttributes")),"xmlns"!==e.name&&"xmlns"!==e.prefix&&(o=o.clone(),this._fireAttributeNameEvent(o,a,e))}else switch(e.nodeType){case Node.TEXT_NODE:var l=e.previousElementSibling,u=void 0,c=void 0;null!==l?(u=l,c="EventIndexAfter"):(u=e.parentNode,c="EventIndexAfterStart"),o=this.readyWalker(this.getNodeProperty(u,c)),t>0&&(o=o.clone(),n(e));break;case Node.ELEMENT_NODE:case Node.DOCUMENT_NODE:case Node.DOCUMENT_FRAGMENT_NODE:var h=e.childNodes[t],l=void 0,u=void 0,c=void 0;if(r?(u=h,c="EventIndexAfterAttributes"):(l=void 0===h?e.lastElementChild:h.previousElementSibling,null!==l?(u=l,c="EventIndexAfter"):(u=e,c="EventIndexAfterStart")),o=this.readyWalker(this.getNodeProperty(u,c)),!r){var d=null!=h?h.previousSibling:null;null!==d&&d!==l&&d.nodeType===Node.TEXT_NODE&&(o=o.clone(),n(d))}break;default:throw new Error("unexpected node type: "+e.nodeType)}return o},e.prototype.readyWalker=function(e){if(void 0===e)throw new v;var t=this._walkerCache,r=this._walkerCacheMax,n=t[e];if(n)return n;var i=e;if(i>=r)i=r,n=t[i];else for(;!n&&--i>=0;)n=t[i];n?n=n.clone():(n=this.schema.newWalker(),i=0);for(var o=i;o<e;++o)n.fireEvent(this._validationEvents[o]);return e-i>=this._walkerCacheGap&&(t[e]=n,this._walkerCacheMax=Math.max(e,r)),n},e.prototype.possibleAt=function(e,t,r){void 0===r&&(r=!1);var n=this._getWalkerAt(e,t,r);return n.possible()},e.prototype.possibleWhere=function(e,t){for(var r=[],n=0;n<=e.childNodes.length;++n){var i=this.possibleAt(e,n);if(i.has(t))r.push(n);else if("enterStartTag"===t.params[0]||"attributeName"===t.params[0])for(var o=0,a=i.toArray();o<a.length;o++){var s=a[o];if(s.params[0]===t.params[0]&&s.params[1].match(t.params[1],t.params[2])){r.push(n);break}}}return r},e.prototype.speculativelyValidate=function(e,t,r){var n;if(r instanceof Array){n=e.ownerDocument.createDocumentFragment();
for(var i=0,o=r;i<o.length;i++){var a=o[i];n.insertBefore(a.cloneNode(!0),null)}}else n=r.cloneNode(!0);var s=e.ownerDocument.createElement("div");return s.insertBefore(n,null),this.speculativelyValidateFragment(e,t,s)},e.prototype.speculativelyValidateFragment=function(t,r,n){if(n.nodeType!==Node.ELEMENT_NODE)throw new Error("toParse is not an element");var i=new e(this.schema,n);return i._validationWalker=this._getWalkerAt(t,r).clone(),i._validateUpTo(n,n.childNodes.length),0!==i._errors.length&&i._errors},e.prototype.getErrorsFor=function(e){var t=e.parentNode;if(null===t)throw new Error("node without a parent!");this._validateUpTo(t,n(t.childNodes,e)+1);for(var r=[],i=0,o=this._errors;i<o.length;i++){var a=o[i];a.node===e&&r.push(a)}return r},e.prototype._setPossibleDueToWildcard=function(e,t,r,n,i){var a=this.getNodeProperty(e,"PossibleDueToWildcard"),s=o(t,r,n,i);this._setNodeProperty(e,"PossibleDueToWildcard",s),void 0!==a&&a===s||this._events._emit("possible-due-to-wildcard-change",e)},e.prototype.resolveNameAt=function(e,t,r,n){return void 0===n&&(n=!1),this._getWalkerAt(e,t).resolveName(r,n)},e.prototype.unresolveNameAt=function(e,t,r,n){return this._getWalkerAt(e,t).unresolveName(r,n)},e}();t.Validator=y}])}),define("wed/action",["require","exports","module"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r,n,i){void 0===n&&(n=""),void 0===i&&(i=!1),this.editor=e,this.desc=t,this.abbreviatedDesc=r,this.icon=n,this.needsInput=i,this._enabled=!0,this.needsInput=!!i,this.boundHandler=this.eventHandler.bind(this),this.boundTerminalHandler=this.terminalEventHandler.bind(this)}return e.prototype.eventHandler=function(e){this.execute(e.data),e.preventDefault()},e.prototype.terminalEventHandler=function(e){return this.eventHandler(e),e.preventDefault(),e.stopPropagation(),!1},e.prototype.getDescription=function(){return this.desc},e.prototype.getDescriptionFor=function(e){return this.getDescription()},e.prototype.getAbbreviatedDescription=function(){return this.abbreviatedDesc},e.prototype.getIcon=function(){return this.icon},e.prototype.getLabelFor=function(e){var t=this.getDescriptionFor(e),r=this.getIcon();return""!==r&&""!==t?r+" "+t:""!==r?r:t},e.prototype.toString=function(){return this.getDescription()},e.prototype.getEnabled=function(){return this._enabled},e}();t.Action=n}),function(e,t){"function"==typeof define&&define.amd?define("rangy-core",e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e():t.rangy=e()}(function(){function e(e,t){var r=typeof e[t];return r==w||!(r!=b||!e[t])||"unknown"==r}function t(e,t){return!(typeof e[t]!=b||!e[t])}function r(e,t){return typeof e[t]!=_}function n(e){return function(t,r){for(var n=r.length;n--;)if(!e(t,r[n]))return!1;return!0}}function i(e){return e&&C(e,N)&&P(e,S)}function o(e){return t(e,"body")?e.body:e.getElementsByTagName("body")[0]}function a(t){typeof console!=_&&e(console,"log")&&console.log(t)}function s(e,t){R&&t?alert(e):a(e)}function l(e){I.initialized=!0,I.supported=!1,s("Rangy is not supported in this environment. Reason: "+e,I.config.alertOnFail)}function u(e){s("Rangy warning: "+e,I.config.alertOnWarn)}function c(e){return e.message||e.description||String(e)}function h(){if(R&&!I.initialized){var t,r=!1,n=!1;e(document,"createRange")&&(t=document.createRange(),C(t,x)&&P(t,E)&&(r=!0));var s=o(document);if(!s||"body"!=s.nodeName.toLowerCase())return void l("No body element found");if(s&&e(s,"createTextRange")&&(t=s.createTextRange(),i(t)&&(n=!0)),!r&&!n)return void l("Neither Range nor TextRange are available");I.initialized=!0,I.features={implementsDomRange:r,implementsTextRange:n};var u,h;for(var d in A)(u=A[d])instanceof m&&u.init(u,I);for(var p=0,f=L.length;p<f;++p)try{L[p](I)}catch(e){h="Rangy init listener threw an exception. Continuing. Detail: "+c(e),a(h)}}}function d(e,t,r){r&&(e+=" in module "+r.name),I.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function p(e,t,r,n){e[t]=function(){return d(t,r,n),e[r].apply(e,O.toArray(arguments))}}function f(e){e=e||window,h();for(var t=0,r=j.length;t<r;++t)j[t](e)}function m(e,t,r){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=r}function v(e,t,r){var n=new m(e,t,function(t){if(!t.initialized){t.initialized=!0;try{r(I,t),t.supported=!0}catch(t){var n="Module '"+e+"' failed to load: "+c(t);a(n),t.stack&&a(t.stack)}}});return A[e]=n,n}function y(){}function g(){}var b="object",w="function",_="undefined",E=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],x=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],S=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],N=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],C=n(e),T=n(t),P=n(r),k=[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var r=0,n=e.length;r<n;++r)t(e[r],r)},A={},R=typeof window!=_&&typeof document!=_,O={isHostMethod:e,isHostObject:t,isHostProperty:r,areHostMethods:C,areHostObjects:T,areHostProperties:P,isTextRange:i,getBody:o,forEach:k},I={version:"1.3.1-dev",initialized:!1,isBrowser:R,supported:!0,util:O,features:{},modules:A,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==_||rangyAutoInitialize}};I.fail=l,I.warn=u;var D;({}).hasOwnProperty?(O.extend=D=function(e,t,r){var n,i;for(var o in t)t.hasOwnProperty(o)&&(n=e[o],i=t[o],r&&null!==n&&"object"==typeof n&&null!==i&&"object"==typeof i&&D(n,i,!0),e[o]=i);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},O.createOptions=function(e,t){var r={};return D(r,t),e&&D(r,e),r}):l("hasOwnProperty not supported"),R||l("Rangy can only run in a browser"),function(){var e;if(R){var t=document.createElement("div");t.appendChild(document.createElement("span"));var r=[].slice;try{1==r.call(t.childNodes,0)[0].nodeType&&(e=function(e){return r.call(e,0)})}catch(e){}}e||(e=function(e){for(var t=[],r=0,n=e.length;r<n;++r)t[r]=e[r];return t}),O.toArray=e}();var M;R&&(e(document,"addEventListener")?M=function(e,t,r){e.addEventListener(t,r,!1)}:e(document,"attachEvent")?M=function(e,t,r){e.attachEvent("on"+t,r)}:l("Document does not have required addEventListener or attachEvent method"),O.addListener=M);var L=[];O.deprecationNotice=d,O.createAliasForDeprecatedMethod=p,I.init=h,I.addInitListener=function(e){I.initialized?e(I):L.push(e)};var j=[];I.addShimListener=function(e){j.push(e)},R&&(I.shim=I.createMissingNativeApi=f,p(I,"createMissingNativeApi","shim")),m.prototype={init:function(){for(var e,t,r=this.dependencies||[],n=0,i=r.length;n<i;++n){if(t=r[n],e=A[t],!(e&&e instanceof m))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error(e)},warn:function(e){I.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){I.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},I.createModule=function(e){var t,r;2==arguments.length?(t=arguments[1],r=[]):(t=arguments[2],r=arguments[1]);var n=v(e,r,t);I.initialized&&I.supported&&n.init()},I.createCoreModule=function(e,t,r){v(e,t,r)},I.RangePrototype=y,I.rangePrototype=new y,I.selectionPrototype=new g,I.createCoreModule("DomUtil",[],function(e,t){function r(e){var t;return typeof e.namespaceURI==R||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function n(e){var t=e.parentNode;return 1==t.nodeType?t:null}function i(e){for(var t=0;e=e.previousSibling;)++t;return t}function o(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function a(e,t){var r,n=[];for(r=e;r;r=r.parentNode)n.push(r);for(r=t;r;r=r.parentNode)if(L(n,r))return r;return null}function s(e,t,r){for(var n=r?t:t.parentNode;n;){if(n===e)return!0;n=n.parentNode}return!1}function l(e,t){return s(e,t,!0)}function u(e,t,r){for(var n,i=r?e:e.parentNode;i;){if(n=i.parentNode,n===t)return i;i=n}return null}function c(e){var t=e.nodeType;return 3==t||4==t||8==t}function h(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t}function d(e,t){var r=t.nextSibling,n=t.parentNode;return r?n.insertBefore(e,r):n.appendChild(e),e}function p(e,t,r){var n=e.cloneNode(!1);if(n.deleteData(0,t),e.deleteData(t,e.length-t),d(n,e),r)for(var o,a=0;o=r[a++];)o.node==e&&o.offset>t?(o.node=n,o.offset-=t):o.node==e.parentNode&&o.offset>i(e)&&++o.offset;return n}function f(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=R)return e.ownerDocument;if(typeof e.document!=R)return e.document;if(e.parentNode)return f(e.parentNode);throw t.createError("getDocument: no document found for node")}function m(e){var r=f(e);if(typeof r.defaultView!=R)return r.defaultView;if(typeof r.parentWindow!=R)return r.parentWindow;throw t.createError("Cannot get a window object for node")}function v(e){if(typeof e.contentDocument!=R)return e.contentDocument;if(typeof e.contentWindow!=R)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function y(e){if(typeof e.contentWindow!=R)return e.contentWindow;if(typeof e.contentDocument!=R)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function g(e){return e&&O.isHostMethod(e,"setTimeout")&&O.isHostObject(e,"document")}function b(e,t,r){var n;if(e?O.isHostProperty(e,"nodeType")?n=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?v(e):f(e):g(e)&&(n=e.document):n=document,!n)throw t.createError(r+"(): Parameter must be a Window object or DOM node");return n}function w(e){for(var t;t=e.parentNode;)e=t;return e}function _(e,r,n,o){var s,l,c,h,d;if(e==n)return r===o?0:r<o?-1:1;if(s=u(n,e,!0))return r<=i(s)?-1:1;if(s=u(e,n,!0))return i(s)<o?-1:1;if(l=a(e,n),!l)throw new Error("comparePoints error: nodes have no common ancestor");if(c=e===l?l:u(e,l,!0),h=n===l?l:u(n,l,!0),c===h)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(d=l.firstChild;d;){if(d===c)return-1;if(d===h)return 1;d=d.nextSibling}}function E(e){var t;try{return t=e.parentNode,!1}catch(e){return!0}}function x(e){if(!e)return"[No node]";if(j&&E(e))return"[Broken node]";if(c(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+i(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function S(e){for(var t,r=f(e).createDocumentFragment();t=e.firstChild;)r.appendChild(t);return r}function N(e,t,r){var n=I(e),i=e.createElement("div");i.contentEditable=""+!!r,t&&(i.innerHTML=t);var o=n.firstChild;return o?n.insertBefore(i,o):n.appendChild(i),i}function C(e){return e.parentNode.removeChild(e)}function T(e){this.root=e,this._next=e}function P(e){return new T(e)}function k(e,t){this.node=e,this.offset=t}function A(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var R="undefined",O=e.util,I=O.getBody;O.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),O.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var D=document.createElement("div");O.areHostMethods(D,["insertBefore","appendChild","cloneNode"]||!O.areHostObjects(D,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),O.isHostProperty(D,"innerHTML")||t.fail("Element is missing innerHTML property");var M=document.createTextNode("test");O.areHostMethods(M,["splitText","deleteData","insertData","appendData","cloneNode"]||!O.areHostObjects(D,["previousSibling","nextSibling","childNodes","parentNode"])||!O.areHostProperties(M,["data"]))||t.fail("Incomplete Text Node implementation");var L=function(e,t){for(var r=e.length;r--;)if(e[r]===t)return!0;return!1},j=!1;!function(){var t=document.createElement("b");t.innerHTML="1";var r=t.firstChild;t.innerHTML="<br />",j=E(r),e.features.crashyTextNodes=j}();var F;typeof window.getComputedStyle!=R?F=function(e,t){return m(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=R?F=function(e,t){return e.currentStyle?e.currentStyle[t]:""}:t.fail("No means of obtaining computed style properties found"),T.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,r=this._current=this._next;if(this._current)if(e=r.firstChild)this._next=e;else{for(t=null;r!==this.root&&!(t=r.nextSibling);)r=r.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},k.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+x(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},A.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},A.prototype.toString=function(){return this.message},e.dom={arrayContains:L,isHtmlNamespace:r,parentElement:n,getNodeIndex:i,getNodeLength:o,getCommonAncestor:a,isAncestorOf:s,isOrIsAncestorOf:l,getClosestAncestorIn:u,isCharacterDataNode:c,isTextOrCommentNode:h,insertAfter:d,splitDataNode:p,getDocument:f,getWindow:m,getIframeWindow:y,getIframeDocument:v,getBody:I,isWindow:g,getContentDocument:b,getRootContainer:w,comparePoints:_,isBrokenNode:E,inspectNode:x,getComputedStyleProperty:F,createTestElement:N,removeNode:C,fragmentFromNodeChildren:S,createIterator:P,DomPosition:k},e.DOMException=A}),I.createCoreModule("DomRange",["DomUtil"],function(e,t){function r(e,t){return 3!=e.nodeType&&(H(e,t.startContainer)||H(e,t.endContainer))}function n(e){return e.document||W(e.startContainer)}function i(e){return G(e.startContainer)}function o(e){return new j(e.parentNode,V(e))}function a(e){return new j(e.parentNode,V(e)+1)}function s(e,t,r){var n=11==e.nodeType?e.firstChild:e;return B(t)?r==t.length?M.insertAfter(e,t):t.parentNode.insertBefore(e,0==r?t:U(t,r)):r>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[r]),n}function l(e,t,r){if(N(e),N(t),n(t)!=n(e))throw new F("WRONG_DOCUMENT_ERR");var i=$(e.startContainer,e.startOffset,t.endContainer,t.endOffset),o=$(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return r?i<=0&&o>=0:i<0&&o>0}function u(e){for(var t,r,i,o=n(e.range).createDocumentFragment();r=e.next();){if(t=e.isPartiallySelectedSubtree(),r=r.cloneNode(!t),t&&(i=e.getSubtreeIterator(),r.appendChild(u(i)),i.detach()),10==r.nodeType)throw new F("HIERARCHY_REQUEST_ERR");o.appendChild(r)}return o}function c(e,t,r){var n,i;r=r||{stop:!1};for(var o,a;o=e.next();)if(e.isPartiallySelectedSubtree()){if(t(o)===!1)return void(r.stop=!0);if(a=e.getSubtreeIterator(),c(a,t,r),a.detach(),r.stop)return}else for(n=M.createIterator(o);i=n.next();)if(t(i)===!1)return void(r.stop=!0)}function h(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),h(t),t.detach()):e.remove()}function d(e){for(var t,r,i=n(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),r=e.getSubtreeIterator(),t.appendChild(d(r)),r.detach()):e.remove(),10==t.nodeType)throw new F("HIERARCHY_REQUEST_ERR");i.appendChild(t)}return i}function p(e,t,r){var n,i=!(!t||!t.length),o=!!r;i&&(n=new RegExp("^("+t.join("|")+")$"));var a=[];return c(new m(e,!1),function(t){if((!i||n.test(t.nodeType))&&(!o||r(t))){var s=e.startContainer;if(t!=s||!B(s)||e.startOffset!=s.length){var l=e.endContainer;t==l&&B(l)&&0==e.endOffset||a.push(t)}}}),a}function f(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+M.inspectNode(e.startContainer)+":"+e.startOffset+", "+M.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function m(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var r=e.commonAncestorContainer;this.sc===this.ec&&B(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==r||B(this.sc)?q(this.sc,r,!0):this.sc.childNodes[this.so],this._last=this.ec!==r||B(this.ec)?q(this.ec,r,!0):this.ec.childNodes[this.eo-1])}}function v(e){return function(t,r){for(var n,i=r?t:t.parentNode;i;){if(n=i.nodeType,K(e,n))return i;i=i.parentNode}return null}}function y(e,t){if(ie(e,t))throw new F("INVALID_NODE_TYPE_ERR")}function g(e,t){if(!K(t,e.nodeType))throw new F("INVALID_NODE_TYPE_ERR")}function b(e,t){if(t<0||t>(B(e)?e.length:e.childNodes.length))throw new F("INDEX_SIZE_ERR")}function w(e,t){if(re(e,!0)!==re(t,!0))throw new F("WRONG_DOCUMENT_ERR")}function _(e){if(ne(e,!0))throw new F("NO_MODIFICATION_ALLOWED_ERR")}function E(e,t){if(!e)throw new F(t)}function x(e,t){return t<=(B(e)?e.length:e.childNodes.length)}function S(e){return!!e.startContainer&&!!e.endContainer&&!(Q&&(M.isBrokenNode(e.startContainer)||M.isBrokenNode(e.endContainer)))&&G(e.startContainer)==G(e.endContainer)&&x(e.startContainer,e.startOffset)&&x(e.endContainer,e.endOffset)}function N(e){if(!S(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}function C(e,t){N(e);var r=e.startContainer,n=e.startOffset,i=e.endContainer,o=e.endOffset,a=r===i;B(i)&&o>0&&o<i.length&&U(i,o,t),B(r)&&n>0&&n<r.length&&(r=U(r,n,t),a?(o-=n,i=r):i==r.parentNode&&o>=V(r)&&o++,n=0),e.setStartAndEnd(r,n,i,o)}function T(e){N(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}function P(e){e.START_TO_START=ce,e.START_TO_END=he,e.END_TO_END=de,e.END_TO_START=pe,e.NODE_BEFORE=fe,e.NODE_AFTER=me,e.NODE_BEFORE_AND_AFTER=ve,e.NODE_INSIDE=ye}function k(e){P(e),P(e.prototype)}function A(e,t){return function(){N(this);var r,n,i=this.startContainer,o=this.startOffset,s=this.commonAncestorContainer,l=new m(this,!0);i!==s&&(r=q(i,s,!0),n=a(r),i=n.node,o=n.offset),c(l,_),l.reset();var u=e(l);return l.detach(),t(this,i,o,i,o),u}}function R(t,n){function i(e,t){return function(r){g(r,Y),g(G(r),Z);var n=(e?o:a)(r);(t?s:l)(this,n.node,n.offset)}}function s(e,t,r){var i=e.endContainer,o=e.endOffset;t===e.startContainer&&r===e.startOffset||(G(t)==G(i)&&1!=$(t,r,i,o)||(i=t,o=r),n(e,t,r,i,o))}function l(e,t,r){var i=e.startContainer,o=e.startOffset;t===e.endContainer&&r===e.endOffset||(G(t)==G(i)&&$(t,r,i,o)!=-1||(i=t,o=r),n(e,i,o,t,r))}var u=function(){};u.prototype=e.rangePrototype,t.prototype=new u,L.extend(t.prototype,{setStart:function(e,t){y(e,!0),b(e,t),s(this,e,t)},setEnd:function(e,t){y(e,!0),b(e,t),l(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],r=e[1],i=t,o=r;switch(e.length){case 3:o=e[2];break;case 4:i=e[2],o=e[3]}y(t,!0),b(t,r),y(i,!0),b(i,o),n(this,t,r,i,o)},setBoundary:function(e,t,r){this["set"+(r?"Start":"End")](e,t)},setStartBefore:i(!0,!0),setStartAfter:i(!1,!0),setEndBefore:i(!0,!1),setEndAfter:i(!1,!1),collapse:function(e){N(this),e?n(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):n(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){y(e,!0),n(this,e,0,e,z(e))},selectNode:function(e){y(e,!1),g(e,Y);var t=o(e),r=a(e);n(this,t.node,t.offset,r.node,r.offset)},extractContents:A(d,n),deleteContents:A(h,n),canSurroundContents:function(){N(this),_(this.startContainer),_(this.endContainer);var e=new m(this,!0),t=e._first&&r(e._first,this)||e._last&&r(e._last,this);return e.detach(),!t},splitBoundaries:function(){C(this)},splitBoundariesPreservingPositions:function(e){C(this,e)},normalizeBoundaries:function(){N(this);var e,t=this.startContainer,r=this.startOffset,i=this.endContainer,o=this.endOffset,a=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(i=e,o=e.length,e.appendData(t.data),X(t))},s=function(e){var n=e.previousSibling;if(n&&n.nodeType==e.nodeType){t=e;var a=e.length;if(r=n.length,e.insertData(0,n.data),X(n),t==i)o+=r,i=t;else if(i==e.parentNode){var s=V(e);o==s?(i=e,o=a):o>s&&o--}}},l=!0;if(B(i))o==i.length?a(i):0==o&&(e=i.previousSibling,e&&e.nodeType==i.nodeType&&(o=e.length,t==i&&(l=!1),e.appendData(i.data),X(i),i=e));else{if(o>0){var u=i.childNodes[o-1];u&&B(u)&&a(u)}l=!this.collapsed}if(l){if(B(t))0==r?s(t):r==t.length&&(e=t.nextSibling,e&&e.nodeType==t.nodeType&&(i==e&&(i=t,o+=t.length),t.appendData(e.data),X(e)));else if(r<t.childNodes.length){var c=t.childNodes[r];c&&B(c)&&s(c)}}else t=i,r=o;n(this,t,r,i,o)},collapseToPoint:function(e,t){y(e,!0),b(e,t),this.setStartAndEnd(e,t)},parentElement:function(){N(this);var e=this.commonAncestorContainer;return e?oe(this.commonAncestorContainer,!0):null}}),k(t)}function O(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:M.getCommonAncestor(e.startContainer,e.endContainer)}function I(e,t,r,n,i){e.startContainer=t,e.startOffset=r,e.endContainer=n,e.endOffset=i,e.document=M.getDocument(t),O(e)}function D(e){I(this,e,0,e,0)}var M=e.dom,L=e.util,j=M.DomPosition,F=e.DOMException,B=M.isCharacterDataNode,V=M.getNodeIndex,H=M.isOrIsAncestorOf,W=M.getDocument,$=M.comparePoints,U=M.splitDataNode,q=M.getClosestAncestorIn,z=M.getNodeLength,K=M.arrayContains,G=M.getRootContainer,Q=e.features.crashyTextNodes,X=M.removeNode;m.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,B(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,r=this._current;!B(r)||r!==this.sc&&r!==this.ec?r.parentNode&&X(r):(e=r===this.sc?this.so:0,t=r===this.ec?this.eo:r.length,e!=t&&r.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return r(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new D(n(this.range));var t=this._current,r=t,i=0,o=t,a=z(t);H(t,this.sc)&&(r=this.sc,i=this.so),H(t,this.ec)&&(o=this.ec,a=this.eo),I(e,r,i,o,a)}return new m(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var Y=[1,3,4,5,7,8,10],Z=[2,9,11],J=[5,6,10,12],ee=[1,3,4,5,7,8,10,11],te=[1,3,4,5,7,8],re=v([9,11]),ne=v(J),ie=v([6,10,12]),oe=v([1]),ae=document.createElement("style"),se=!1;try{ae.innerHTML="<b>x</b>",se=3==ae.firstChild.nodeType}catch(e){}e.features.htmlParsingConforms=se;var le=se?function(e){var t=this.startContainer,r=W(t);if(!t)throw new F("INVALID_STATE_ERR");var n=null;return 1==t.nodeType?n=t:B(t)&&(n=M.parentElement(t)),n=null===n||"HTML"==n.nodeName&&M.isHtmlNamespace(W(n).documentElement)&&M.isHtmlNamespace(n)?r.createElement("body"):n.cloneNode(!1),n.innerHTML=e,M.fragmentFromNodeChildren(n)}:function(e){var t=n(this),r=t.createElement("body");return r.innerHTML=e,M.fragmentFromNodeChildren(r)},ue=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ce=0,he=1,de=2,pe=3,fe=0,me=1,ve=2,ye=3;L.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){N(this),w(this.startContainer,t.startContainer);var r,n,i,o,a=e==pe||e==ce?"start":"end",s=e==he||e==ce?"start":"end";return r=this[a+"Container"],n=this[a+"Offset"],i=t[s+"Container"],o=t[s+"Offset"],$(r,n,i,o)},insertNode:function(e){if(N(this),g(e,ee),_(this.startContainer),H(e,this.startContainer))throw new F("HIERARCHY_REQUEST_ERR");var t=s(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){N(this);var e,t;if(this.collapsed)return n(this).createDocumentFragment();if(this.startContainer===this.endContainer&&B(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=n(this).createDocumentFragment(),t.appendChild(e),t;var r=new m(this,!0);return e=u(r),r.detach(),e},canSurroundContents:function(){N(this),_(this.startContainer),_(this.endContainer);var e=new m(this,!0),t=e._first&&r(e._first,this)||e._last&&r(e._last,this);return e.detach(),!t},surroundContents:function(e){if(g(e,te),!this.canSurroundContents())throw new F("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);s(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){N(this);for(var e,t=new D(n(this)),r=ue.length;r--;)e=ue[r],t[e]=this[e];return t},toString:function(){N(this);var e=this.startContainer;if(e===this.endContainer&&B(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],r=new m(this,!0);return c(r,function(e){3!=e.nodeType&&4!=e.nodeType||t.push(e.data)}),r.detach(),t.join("")},compareNode:function(e){N(this);var t=e.parentNode,r=V(e);if(!t)throw new F("NOT_FOUND_ERR");var n=this.comparePoint(t,r),i=this.comparePoint(t,r+1);return n<0?i>0?ve:fe:i>0?me:ye},comparePoint:function(e,t){return N(this),E(e,"HIERARCHY_REQUEST_ERR"),w(e,this.startContainer),$(e,t,this.startContainer,this.startOffset)<0?-1:$(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:le,toHtml:function(){return T(this)},intersectsNode:function(e,t){if(N(this),G(e)!=i(this))return!1;var r=e.parentNode,n=V(e);if(!r)return!0;var o=$(r,n,this.endContainer,this.endOffset),a=$(r,n+1,this.startContainer,this.startOffset);return t?o<=0&&a>=0:o<0&&a>0},isPointInRange:function(e,t){return N(this),E(e,"HIERARCHY_REQUEST_ERR"),w(e,this.startContainer),$(e,t,this.startContainer,this.startOffset)>=0&&$(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return l(this,e,!1)},intersectsOrTouchesRange:function(e){return l(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=$(this.startContainer,this.startOffset,e.startContainer,e.startOffset),r=$(this.endContainer,this.endOffset,e.endContainer,e.endOffset),n=this.cloneRange();return t==-1&&n.setStart(e.startContainer,e.startOffset),1==r&&n.setEnd(e.endContainer,e.endOffset),n}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return $(e.startContainer,e.startOffset,this.startContainer,this.startOffset)==-1&&t.setStart(e.startContainer,e.startOffset),1==$(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new F("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==ye},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,z(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var r=t.getNodes([3]);if(r.length>0){t.setStart(r[0],0);var n=r.pop();return t.setEnd(n,n.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return N(this),p(this,e,t)},getDocument:function(){return n(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var r=n(this),i=e.createRange(r);t=t||M.getBody(r),i.selectNodeContents(t);var o=this.intersection(i),a=0,s=0;return o&&(i.setEnd(o.startContainer,o.startOffset),a=i.toString().length,s=a+o.toString().length),{start:a,end:s,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,r=0;this.setStart(t,0),this.collapse(!0);for(var n,i,o,a,s=[t],l=!1,u=!1;!u&&(n=s.pop());)if(3==n.nodeType)i=r+n.length,!l&&e.start>=r&&e.start<=i&&(this.setStart(n,e.start-r),l=!0),l&&e.end>=r&&e.end<=i&&(this.setEnd(n,e.end-r),u=!0),r=i;else for(a=n.childNodes,o=a.length;o--;)s.push(a[o])},getName:function(){return"DomRange"},equals:function(e){return D.rangesEqual(this,e)},isValid:function(){return S(this)},inspect:function(){return f(this)},detach:function(){}}),R(D,I),L.extend(D,{rangeProperties:ue,RangeIterator:m,copyComparisonConstants:k,createPrototypeRange:R,inspect:f,toHtml:T,getRangeDocument:n,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=D}),I.createCoreModule("WrappedRange",["DomRange"],function(e,t){var r,n,i=e.dom,o=e.util,a=i.DomPosition,s=e.DomRange,l=i.getBody,u=i.getContentDocument,c=i.isCharacterDataNode;if(e.features.implementsDomRange&&!function(){function n(e){for(var t,r=d.length;r--;)t=d[r],e[t]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function a(e,t,r,n,i){var o=e.startContainer!==t||e.startOffset!=r,a=e.endContainer!==n||e.endOffset!=i,s=!e.equals(e.nativeRange);(o||a||s)&&(e.setEnd(n,i),e.setStart(t,r))}var c,h,d=s.rangeProperties;r=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,n(this)},s.createPrototypeRange(r,a),c=r.prototype,c.selectNode=function(e){this.nativeRange.selectNode(e),n(this)},c.cloneContents=function(){return this.nativeRange.cloneContents()},c.surroundContents=function(e){this.nativeRange.surroundContents(e),n(this)},c.collapse=function(e){this.nativeRange.collapse(e),n(this)},c.cloneRange=function(){return new r(this.nativeRange.cloneRange())},c.refresh=function(){n(this)},c.toString=function(){return this.nativeRange.toString()};var p=document.createTextNode("test");l(document).appendChild(p);var f=document.createRange();f.setStart(p,0),f.setEnd(p,0);try{f.setStart(p,1),c.setStart=function(e,t){this.nativeRange.setStart(e,t),n(this)},c.setEnd=function(e,t){this.nativeRange.setEnd(e,t),n(this)},h=function(e){return function(t){this.nativeRange[e](t),n(this)}}}catch(e){c.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(r){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}n(this)},c.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(r){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}n(this)},h=function(e,t){return function(r){try{this.nativeRange[e](r)}catch(n){this.nativeRange[t](r),this.nativeRange[e](r)}n(this)}}}c.setStartBefore=h("setStartBefore","setEndBefore"),c.setStartAfter=h("setStartAfter","setEndAfter"),c.setEndBefore=h("setEndBefore","setStartBefore"),c.setEndAfter=h("setEndAfter","setStartAfter"),c.selectNodeContents=function(e){this.setStartAndEnd(e,0,i.getNodeLength(e))},f.selectNodeContents(p),f.setEnd(p,3);var m=document.createRange();m.selectNodeContents(p),m.setEnd(p,4),m.setStart(p,2),f.compareBoundaryPoints(f.START_TO_END,m)==-1&&1==f.compareBoundaryPoints(f.END_TO_START,m)?c.compareBoundaryPoints=function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:c.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var v=document.createElement("div");v.innerHTML="123";var y=v.firstChild,g=l(document);g.appendChild(v),f.setStart(y,1),f.setEnd(y,2),f.deleteContents(),"13"==y.data&&(c.deleteContents=function(){
this.nativeRange.deleteContents(),n(this)},c.extractContents=function(){var e=this.nativeRange.extractContents();return n(this),e}),g.removeChild(v),g=null,o.isHostMethod(f,"createContextualFragment")&&(c.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),l(document).removeChild(p),c.getName=function(){return"WrappedRange"},e.WrappedRange=r,e.createNativeRange=function(e){return e=u(e,t,"createNativeRange"),e.createRange()}}(),e.features.implementsTextRange){var h=function(e){var t=e.parentElement(),r=e.duplicate();r.collapse(!0);var n=r.parentElement();r=e.duplicate(),r.collapse(!1);var o=r.parentElement(),a=n==o?n:i.getCommonAncestor(n,o);return a==t?a:i.getCommonAncestor(t,a)},d=function(e){return 0==e.compareEndPoints("StartToEnd",e)},p=function(e,t,r,n,o){var s=e.duplicate();s.collapse(r);var l=s.parentElement();if(i.isOrIsAncestorOf(t,l)||(l=t),!l.canHaveHTML){var u=new a(l.parentNode,i.getNodeIndex(l));return{boundaryPosition:u,nodeInfo:{nodeIndex:u.offset,containerElement:u.node}}}var h=i.getDocument(l).createElement("span");h.parentNode&&i.removeNode(h);for(var d,p,f,m,v,y=r?"StartToStart":"StartToEnd",g=o&&o.containerElement==l?o.nodeIndex:0,b=l.childNodes.length,w=b,_=w;;){if(_==b?l.appendChild(h):l.insertBefore(h,l.childNodes[_]),s.moveToElementText(h),d=s.compareEndPoints(y,e),0==d||g==w)break;if(d==-1){if(w==g+1)break;g=_}else w=w==g+1?g:_;_=Math.floor((g+w)/2),l.removeChild(h)}if(v=h.nextSibling,d==-1&&v&&c(v)){s.setEndPoint(r?"EndToStart":"EndToEnd",e);var E;if(/[\r\n]/.test(v.data)){var x=s.duplicate(),S=x.text.replace(/\r\n/g,"\r").length;for(E=x.moveStart("character",S);(d=x.compareEndPoints("StartToEnd",x))==-1;)E++,x.moveStart("character",1)}else E=s.text.length;m=new a(v,E)}else p=(n||!r)&&h.previousSibling,f=(n||r)&&h.nextSibling,m=f&&c(f)?new a(f,0):p&&c(p)?new a(p,p.data.length):new a(l,i.getNodeIndex(h));return i.removeNode(h),{boundaryPosition:m,nodeInfo:{nodeIndex:_,containerElement:l}}},f=function(e,t){var r,n,o,a,s=e.offset,u=i.getDocument(e.node),h=l(u).createTextRange(),d=c(e.node);return d?(r=e.node,n=r.parentNode):(a=e.node.childNodes,r=s<a.length?a[s]:null,n=e.node),o=u.createElement("span"),o.innerHTML="&#feff;",r?n.insertBefore(o,r):n.appendChild(o),h.moveToElementText(o),h.collapse(!t),n.removeChild(o),d&&h[t?"moveStart":"moveEnd"]("character",s),h};n=function(e){this.textRange=e,this.refresh()},n.prototype=new s(document),n.prototype.refresh=function(){var e,t,r,n=h(this.textRange);d(this.textRange)?t=e=p(this.textRange,n,!0,!0).boundaryPosition:(r=p(this.textRange,n,!0,!1),e=r.boundaryPosition,t=p(this.textRange,n,!1,!1,r.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},n.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(n);var m=function(e){if(e.collapsed)return f(new a(e.startContainer,e.startOffset),!0);var t=f(new a(e.startContainer,e.startOffset),!0),r=f(new a(e.endContainer,e.endOffset),!1),n=l(s.getRangeDocument(e)).createTextRange();return n.setEndPoint("StartToStart",t),n.setEndPoint("EndToEnd",r),n};if(n.rangeToTextRange=m,n.prototype.toTextRange=function(){return m(this)},e.WrappedTextRange=n,!e.features.implementsDomRange||e.config.preferTextRange){var v=function(e){return e("return this;")()}(Function);"undefined"==typeof v.Range&&(v.Range=n),e.createNativeRange=function(e){return e=u(e,t,"createNativeRange"),l(e).createTextRange()},e.WrappedRange=n}}e.createRange=function(r){return r=u(r,t,"createRange"),new e.WrappedRange(e.createNativeRange(r))},e.createRangyRange=function(e){return e=u(e,t,"createRangyRange"),new s(e)},o.createAliasForDeprecatedMethod(e,"createIframeRange","createRange"),o.createAliasForDeprecatedMethod(e,"createIframeRangyRange","createRangyRange"),e.addShimListener(function(t){var r=t.document;"undefined"==typeof r.createRange&&(r.createRange=function(){return e.createRange(r)}),r=t=null})}),I.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function r(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function n(e,r){if(e){if(P.isWindow(e))return e;if(e instanceof y)return e.win;var n=P.getContentDocument(e,t,r);return P.getWindow(n)}return window}function i(e){return n(e,"getWinSelection").getSelection()}function o(e){return n(e,"getDocSelection").document.selection}function a(e){var t=!1;return e.anchorNode&&(t=1==P.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}function s(e,t,r){var n=r?"end":"start",i=r?"start":"end";e.anchorNode=t[n+"Container"],e.anchorOffset=t[n+"Offset"],e.focusNode=t[i+"Container"],e.focusOffset=t[i+"Offset"]}function l(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function u(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function c(t){var r;return t instanceof R?(r=e.createNativeRange(t.getDocument()),r.setEnd(t.endContainer,t.endOffset),r.setStart(t.startContainer,t.startOffset)):t instanceof O?r=t.nativeRange:M.implementsDomRange&&t instanceof P.getWindow(t.startContainer).Range&&(r=t),r}function h(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,r=e.length;t<r;++t)if(!P.isAncestorOf(e[0],e[t]))return!1;return!0}function d(e){var r=e.getNodes();if(!h(r))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return r[0]}function p(e){return!!e&&"undefined"!=typeof e.text}function f(e,t){var r=new O(t);e._ranges=[r],s(e,r,!1),e.rangeCount=1,e.isCollapsed=r.collapsed}function m(t){if(t._ranges.length=0,"None"==t.docSelection.type)u(t);else{var r=t.docSelection.createRange();if(p(r))f(t,r);else{t.rangeCount=r.length;for(var n,i=j(r.item(0)),o=0;o<t.rangeCount;++o)n=e.createRange(i),n.selectNode(r.item(o)),t._ranges.push(n);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,s(t,t._ranges[t.rangeCount-1],!1)}}}function v(e,r){for(var n=e.docSelection.createRange(),i=d(r),o=j(n.item(0)),a=F(o).createControlRange(),s=0,l=n.length;s<l;++s)a.add(n.item(s));try{a.add(i)}catch(e){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}a.select(),m(e)}function y(e,t,r){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=r,this.refresh()}function g(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function b(e,t){for(var r,n,i=te.length;i--;)if(r=te[i],n=r.selection,"deleteAll"==t)g(n);else if(r.win==e)return"delete"==t?(te.splice(i,1),!0):n;return"deleteAll"==t&&(te.length=0),null}function w(e,r){for(var n,i=j(r[0].startContainer),o=F(i).createControlRange(),a=0,s=r.length;a<s;++a){n=d(r[a]);try{o.add(n)}catch(e){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}o.select(),m(e)}function _(e,t){if(e.win.document!=j(t))throw new I("WRONG_DOCUMENT_ERR")}function E(t){return function(r,n){var i;this.rangeCount?(i=this.getRangeAt(0),i["set"+(t?"Start":"End")](r,n)):(i=e.createRange(this.win.document),i.setStartAndEnd(r,n)),this.setSingleRange(i,this.isBackward())}}function x(e){var t=[],r=new D(e.anchorNode,e.anchorOffset),n=new D(e.focusNode,e.focusOffset),i="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var o=0,a=e.rangeCount;o<a;++o)t[o]=R.inspect(e.getRangeAt(o));return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+r.inspect()+", focus: "+n.inspect()+"]"}e.config.checkSelectionRanges=!0;var S,N,C="boolean",T="number",P=e.dom,k=e.util,A=k.isHostMethod,R=e.DomRange,O=e.WrappedRange,I=e.DOMException,D=P.DomPosition,M=e.features,L="Control",j=P.getDocument,F=P.getBody,B=R.rangesEqual,V=A(window,"getSelection"),H=k.isHostObject(document,"selection");M.implementsWinGetSelection=V,M.implementsDocSelection=H;var W=H&&(!V||e.config.preferTextRange);if(W)S=o,e.isSelectionValid=function(e){var t=n(e,"isSelectionValid").document,r=t.selection;return"None"!=r.type||j(r.createRange().parentElement())==t};else{if(!V)return t.fail("Neither document.selection or window.getSelection() detected."),!1;S=i,e.isSelectionValid=function(){return!0}}e.getNativeSelection=S;var $=S();if(!$)return t.fail("Native selection was null (possibly issue 138?)"),!1;var U=e.createNativeRange(document),q=F(document),z=k.areHostProperties($,["anchorNode","focusNode","anchorOffset","focusOffset"]);M.selectionHasAnchorAndFocus=z;var K=A($,"extend");M.selectionHasExtend=K;var G=typeof $.rangeCount==T;M.selectionHasRangeCount=G;var Q=!1,X=!0,Y=K?function(t,r){var n=R.getRangeDocument(r),i=e.createRange(n);i.collapseToPoint(r.endContainer,r.endOffset),t.addRange(c(i)),t.extend(r.startContainer,r.startOffset)}:null;k.areHostMethods($,["addRange","getRangeAt","removeAllRanges"])&&typeof $.rangeCount==T&&M.implementsDomRange&&!function(){var t=window.getSelection();if(t){for(var r=t.rangeCount,n=r>1,i=[],o=a(t),s=0;s<r;++s)i[s]=t.getRangeAt(s);var l=P.createTestElement(document,"",!1),u=l.appendChild(document.createTextNode("   ")),c=document.createRange();if(c.setStart(u,1),c.collapse(!0),t.removeAllRanges(),t.addRange(c),X=1==t.rangeCount,t.removeAllRanges(),!n){var h=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(h&&parseInt(h[1])>=36)Q=!1;else{var d=c.cloneRange();c.setStart(u,0),d.setEnd(u,3),d.setStart(u,2),t.addRange(c),t.addRange(d),Q=2==t.rangeCount}}for(P.removeNode(l),t.removeAllRanges(),s=0;s<r;++s)0==s&&o?Y?Y(t,i[s]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(i[s])):t.addRange(i[s])}}(),M.selectionSupportsMultipleRanges=Q,M.collapsedNonEditableSelectionsSupported=X;var Z,J=!1;q&&A(q,"createControlRange")&&(Z=q.createControlRange(),k.areHostProperties(Z,["item","add"])&&(J=!0)),M.implementsControlRange=J,N=z?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return!!e.rangeCount&&e.getRangeAt(e.rangeCount-1).collapsed};var ee;A($,"getRangeAt")?ee=function(e,t){try{return e.getRangeAt(t)}catch(e){return null}}:z&&(ee=function(t){var r=j(t.anchorNode),n=e.createRange(r);return n.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),n.collapsed!==this.isCollapsed&&n.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),n}),y.prototype=e.selectionPrototype;var te=[],re=function(e){if(e&&e instanceof y)return e.refresh(),e;e=n(e,"getNativeSelection");var t=b(e),r=S(e),i=H?o(e):null;return t?(t.nativeSelection=r,t.docSelection=i,t.refresh()):(t=new y(r,i,e),te.push({win:e,selection:t})),t};e.getSelection=re,k.createAliasForDeprecatedMethod(e,"getIframeSelection","getSelection");var ne=y.prototype;if(!W&&z&&k.areHostMethods($,["removeAllRanges","addRange"])){ne.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),u(this)};var ie=function(e,t){Y(e.nativeSelection,t),e.refresh()};G?ne.addRange=function(t,n){if(J&&H&&this.docSelection.type==L)v(this,t);else if(r(n)&&K)ie(this,t);else{var i;Q?i=this.rangeCount:(this.removeAllRanges(),i=0);var o=c(t).cloneRange();try{this.nativeSelection.addRange(o)}catch(e){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==i+1){if(e.config.checkSelectionRanges){var a=ee(this.nativeSelection,this.rangeCount-1);a&&!B(a,t)&&(t=new O(a))}this._ranges[this.rangeCount-1]=t,s(this,t,se(this.nativeSelection)),this.isCollapsed=N(this)}else this.refresh()}}:ne.addRange=function(e,t){r(t)&&K?ie(this,e):(this.nativeSelection.addRange(c(e)),this.refresh())},ne.setRanges=function(e){if(J&&H&&e.length>1)w(this,e);else{this.removeAllRanges();for(var t=0,r=e.length;t<r;++t)this.addRange(e[t])}}}else{if(!(A($,"empty")&&A(U,"select")&&J&&W))return t.fail("No means of selecting a Range or TextRange was found"),!1;ne.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=j(this.anchorNode);else if(this.docSelection.type==L){var t=this.docSelection.createRange();t.length&&(e=j(t.item(0)))}if(e){var r=F(e).createTextRange();r.select(),this.docSelection.empty()}}}catch(e){}u(this)},ne.addRange=function(t){this.docSelection.type==L?v(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,s(this,t,!1))},ne.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?w(this,e):t&&this.addRange(e[0])}}ne.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new I("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var oe;if(W)oe=function(t){var r;e.isSelectionValid(t.win)?r=t.docSelection.createRange():(r=F(t.win.document).createTextRange(),r.collapse(!0)),t.docSelection.type==L?m(t):p(r)?f(t,r):u(t)};else if(A($,"getRangeAt")&&typeof $.rangeCount==T)oe=function(t){if(J&&H&&t.docSelection.type==L)m(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var r=0,n=t.rangeCount;r<n;++r)t._ranges[r]=new e.WrappedRange(t.nativeSelection.getRangeAt(r));s(t,t._ranges[t.rangeCount-1],se(t.nativeSelection)),t.isCollapsed=N(t)}else u(t)};else{if(!z||typeof $.isCollapsed!=C||typeof U.collapsed!=C||!M.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;oe=function(e){var t,r=e.nativeSelection;r.anchorNode?(t=ee(r,0),e._ranges=[t],e.rangeCount=1,l(e),e.isCollapsed=N(e)):u(e)}}ne.refresh=function(e){var t=e?this._ranges.slice(0):null,r=this.anchorNode,n=this.anchorOffset;if(oe(this),e){var i=t.length;if(i!=this._ranges.length)return!0;if(this.anchorNode!=r||this.anchorOffset!=n)return!0;for(;i--;)if(!B(t[i],this._ranges[i]))return!0;return!1}};var ae=function(e,t){var r=e.getAllRanges();e.removeAllRanges();for(var n=0,i=r.length;n<i;++n)B(t,r[n])||e.addRange(r[n]);e.rangeCount||u(e)};J&&H?ne.removeRange=function(e){if(this.docSelection.type==L){for(var t,r=this.docSelection.createRange(),n=d(e),i=j(r.item(0)),o=F(i).createControlRange(),a=!1,s=0,l=r.length;s<l;++s)t=r.item(s),t!==n||a?o.add(r.item(s)):a=!0;o.select(),m(this)}else ae(this,e)}:ne.removeRange=function(e){ae(this,e)};var se;!W&&z&&M.implementsDomRange?(se=a,ne.isBackward=function(){return se(this)}):se=ne.isBackward=function(){return!1},ne.isBackwards=ne.isBackward,ne.toString=function(){for(var e=[],t=0,r=this.rangeCount;t<r;++t)e[t]=""+this._ranges[t];return e.join("")},ne.collapse=function(t,r){_(this,t);var n=e.createRange(t);n.collapseToPoint(t,r),this.setSingleRange(n),this.isCollapsed=!0},ne.collapseToStart=function(){if(!this.rangeCount)throw new I("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},ne.collapseToEnd=function(){if(!this.rangeCount)throw new I("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},ne.selectAllChildren=function(t){_(this,t);var r=e.createRange(t);r.selectNodeContents(t),this.setSingleRange(r)},ne.deleteFromDocument=function(){if(J&&H&&this.docSelection.type==L){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),P.removeNode(e);this.refresh()}else if(this.rangeCount){var r=this.getAllRanges();if(r.length){this.removeAllRanges();for(var n=0,i=r.length;n<i;++n)r[n].deleteContents();this.addRange(r[i-1])}}},ne.eachRange=function(e,t){for(var r=0,n=this._ranges.length;r<n;++r)if(e(this.getRangeAt(r)))return t},ne.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},ne.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},ne.callMethodOnEachRange=function(e,t){var r=[];return this.eachRange(function(n){r.push(n[e].apply(n,t||[]))}),r},ne.setStart=E(!0),ne.setEnd=E(!1),e.rangePrototype.select=function(e){re(this.getDocument()).setSingleRange(this,e)},ne.changeEachRange=function(e){var t=[],r=this.isBackward();this.eachRange(function(r){e(r),t.push(r)}),this.removeAllRanges(),r&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},ne.containsNode=function(e,t){return this.eachRange(function(r){return r.containsNode(e,t)},!0)||!1},ne.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},ne.moveToBookmark=function(t){for(var r,n,i=[],o=0;r=t.rangeBookmarks[o++];)n=e.createRange(this.win),n.moveToBookmark(r),i.push(n);t.backward?this.setSingleRange(i[0],"backward"):this.setRanges(i)},ne.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},ne.restoreRanges=function(e){this.removeAllRanges();for(var t,r=0;t=e.ranges[r];++r)this.addRange(t,e.backward&&0==r)},ne.toHtml=function(){var e=[];return this.eachRange(function(t){e.push(R.toHtml(t))}),e.join("")},M.implementsTextRange&&(ne.getNativeTextRange=function(){var r;if(r=this.docSelection){var n=r.createRange();if(p(n))return n;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),ne.getName=function(){return"WrappedSelection"},ne.inspect=function(){return x(this)},ne.detach=function(){b(this.win,"delete"),g(this)},y.detachAll=function(){b(null,"deleteAll")},y.inspect=x,y.isDirectionBackward=r,e.Selection=y,e.selectionPrototype=ne,e.addShimListener(function(e){"undefined"==typeof e.getSelection&&(e.getSelection=function(){return re(e)}),e=null})});var F=!1,B=function(e){F||(F=!0,!I.initialized&&I.config.autoInitialize&&h())};return R&&("complete"==document.readyState?B():(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",B,!1),M(window,"load",B))),I},this),function(e,t){"function"==typeof define&&define.amd?define("rangy-textrange",["./rangy-core"],e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e(require("rangy")):e(t.rangy)}(function(e){return e.createModule("TextRange",["WrappedSelection"],function(e,t){function r(e,t){function r(e,t,r){s.push({start:e,end:t,isWord:r})}for(var n,i,o,a=e.join(""),s=[],l=0;n=t.wordRegex.exec(a);){if(i=n.index,o=i+n[0].length,i>l&&r(l,i,!1),t.includeTrailingSpace)for(;Z.test(e[o]);)++o;r(i,o,!0),l=o}return l<e.length&&r(l,e.length,!1),s}function n(e,t){for(var r=e.slice(t.start,t.end),n={isWord:t.isWord,chars:r,toString:function(){return r.join("")}},i=0,o=r.length;i<o;++i)r[i].token=n;return n}function i(e,t,r){for(var i,o=r(e,t),a=[],s=0;i=o[s++];)a.push(n(e,i));return a}function o(e){var t=e||"",r="string"==typeof t?t.split(""):t;return r.sort(function(e,t){return e.charCodeAt(0)-t.charCodeAt(0)}),r.join("").replace(/(.)\1+/g,"$1")}function a(e){var t,r;return e?(t=e.language||J,r={},z(r,le[t]||le[J]),z(r,e),r):le[J]}function s(e,t){var r=K(e,t);return t.hasOwnProperty("wordOptions")&&(r.wordOptions=a(r.wordOptions)),t.hasOwnProperty("characterOptions")&&(r.characterOptions=K(r.characterOptions,ae)),r}function l(e,t){var r=pe(e,"display",t),n=e.tagName.toLowerCase();return"block"==r&&oe&&fe.hasOwnProperty(n)?fe[n]:r}function u(e){for(var t=f(e),r=0,n=t.length;r<n;++r)if(1==t[r].nodeType&&"none"==l(t[r]))return!0;return!1}function c(e){var t;return 3==e.nodeType&&(t=e.parentNode)&&"hidden"==pe(t,"visibility")}function h(e){return e&&(1==e.nodeType&&!/^(inline(-block|-table)?|none)$/.test(l(e))||9==e.nodeType||11==e.nodeType)}function d(e){return U.isCharacterDataNode(e)||!/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(e.nodeName)}function p(e){for(var t=[];e.parentNode;)t.unshift(e.parentNode),e=e.parentNode;return t}function f(e){return p(e).concat([e])}function m(e){for(;e&&!e.nextSibling;)e=e.parentNode;return e?e.nextSibling:null}function v(e,t){return!t&&e.hasChildNodes()?e.firstChild:m(e)}function y(e){var t=e.previousSibling;if(t){for(e=t;e.hasChildNodes();)e=e.lastChild;return e}var r=e.parentNode;return r&&1==r.nodeType?r:null}function g(e){if(!e||3!=e.nodeType)return!1;var t=e.data;if(""===t)return!0;var r=e.parentNode;if(!r||1!=r.nodeType)return!1;var n=pe(e.parentNode,"whiteSpace");return/^[\t\n\r ]+$/.test(t)&&/^(normal|nowrap)$/.test(n)||/^[\t\r ]+$/.test(t)&&"pre-line"==n}function b(e){if(""===e.data)return!0;if(!g(e))return!1;var t=e.parentNode;return!t||!!u(e)}function w(t){var r=t.nodeType,n=e.config.customIsCollapsedNode;return 7==r||8==r||u(t)||/^(script|style)$/i.test(t.nodeName)||c(t)||b(t)||n&&n(t)}function _(e,t){var r=e.nodeType;return 7==r||8==r||1==r&&"none"==l(e,t)}function E(){this.store={}}function x(e,t,r){return function(n){var i=this.cache;if(i.hasOwnProperty(e))return me++,i[e];ve++;var o=t.call(this,r?this[r]:this,n);return i[e]=o,o}}function S(e,t){this.node=e,this.session=t,this.cache=new E,this.positions=new E}function N(e,t){this.offset=t,this.nodeWrapper=e,this.node=e.node,this.session=e.session,this.cache=new E}function C(){return"[Position("+U.inspectNode(this.node)+":"+this.offset+")]"}function T(){return k(),ke=new Ae}function P(){return ke||T()}function k(){ke&&ke.detach(),ke=null}function A(e,r,n,i){function o(){var e=null;return r?(e=s,l||(s=s.previousVisible(),l=!s||n&&s.equals(n))):l||(e=s=s.nextVisible(),l=!s||n&&s.equals(n)),l&&(s=null),e}n&&(r?w(n.node)&&(n=e.previousVisible()):w(n.node)&&(n=n.nextVisible()));var a,s=e,l=!1,u=!1;return{next:function(){if(u)return u=!1,a;for(var e,t;e=o();)if(t=e.getCharacter(i))return a=e,e;return null},rewind:function(){if(!a)throw t.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.");u=!0},dispose:function(){e=n=null}}}function R(e,t,r){function n(e){for(var t,r,n=[],i=e?o:a,s=!1,l=!1;t=i.next();){if(r=t.character,Y.test(r))l&&(l=!1,s=!0);else{if(s){i.rewind();break}l=!0}n.push(t)}return n}var o=A(e,!1,null,t),a=A(e,!0,null,t),s=r.tokenizer,l=n(!0),u=n(!1).reverse(),c=i(u.concat(l),r,s),h=l.length?c.slice(Re(c,l[0].token)):[],d=u.length?c.slice(0,Re(c,u.pop().token)+1):[];return{nextEndToken:function(){for(var e,t;1==h.length&&!(e=h[0]).isWord&&(t=n(!0)).length>0;)h=i(e.chars.concat(t),r,s);return h.shift()},previousStartToken:function(){for(var e,t;1==d.length&&!(e=d[0]).isWord&&(t=n(!1)).length>0;)d=i(t.reverse().concat(e.chars),r,s);return d.pop()},dispose:function(){o.dispose(),a.dispose(),h=d=null}}}function O(e,t,r,n,i){var o,a,s,l,u=0,c=e,h=Math.abs(r);if(0!==r){var d=r<0;switch(t){case W:for(a=A(e,d,null,n);(o=a.next())&&u<h;)++u,c=o;s=o,a.dispose();break;case $:for(var p=R(e,n,i),f=d?p.previousStartToken:p.nextEndToken;(l=f())&&u<h;)l.isWord&&(++u,c=d?l.chars[0]:l.chars[l.chars.length-1]);break;default:throw new Error("movePositionBy: unit '"+t+"' not implemented")}d?(c=c.previousVisible(),u=-u):c&&c.isLeadingSpace&&!c.isTrailingSpace&&(t==$&&(a=A(e,!1,null,n),s=a.next(),a.dispose()),s&&(c=s.previousVisible()))}return{position:c,unitsMoved:u}}function I(e,t,r,n){var i=e.getRangeBoundaryPosition(t,!0),o=e.getRangeBoundaryPosition(t,!1),a=n?o:i,s=n?i:o;return A(a,!!n,s,r)}function D(e,t,r){for(var n,i=[],o=I(e,t,r);n=o.next();)i.push(n);return o.dispose(),i}function M(t,r,n){var i=e.createRange(t.node);return i.setStartAndEnd(t.node,t.offset,r.node,r.offset),!i.expand("word",{wordOptions:n})}function L(e,t,r,n,i){function o(e,t){var r=m[e].previousVisible(),n=m[t-1],o=!i.wholeWordsOnly||M(r,n,i.wordOptions);return{startPos:r,endPos:n,valid:o}}for(var a,s,l,u,c,h,d=ee(i.direction),p=A(e,d,e.session.getRangeBoundaryPosition(n,d),i.characterOptions),f="",m=[],v=null;a=p.next();)if(s=a.character,r||i.caseSensitive||(s=s.toLowerCase()),d?(m.unshift(a),f=s+f):(m.push(a),f+=s),r){if(c=t.exec(f))if(l=c.index,u=l+c[0].length,h){if(!d&&u<f.length||d&&l>0){v=o(l,u);break}}else h=!0}else if((l=f.indexOf(t))!=-1){v=o(l,l+t.length);break}return h&&(v=o(l,u)),p.dispose(),v}function j(e){return function(){var t=!!ke,r=P(),n=[r].concat(q.toArray(arguments)),i=e.apply(this,n);return t||k(),i}}function F(e,t){return j(function(r,n,i,o){typeof i==H&&(i=n,n=W),o=s(o,ce);var a=e;t&&(a=i>=0,this.collapse(!a));var l=O(r.getRangeBoundaryPosition(this,a),n,i,o.characterOptions,o.wordOptions),u=l.position;return this[a?"setStart":"setEnd"](u.node,u.offset),l.unitsMoved})}function B(e){return j(function(t,r){r=K(r,ae);for(var n,i=I(t,this,r,!e),o=0;(n=i.next())&&Y.test(n.character);)++o;i.dispose();var a=o>0;return a&&this[e?"moveStart":"moveEnd"]("character",e?o:-o,{characterOptions:r}),a})}function V(e){return j(function(t,r){var n=!1;return this.changeEachRange(function(t){n=t[e](r)||n}),n})}var H="undefined",W="character",$="word",U=e.dom,q=e.util,z=q.extend,K=q.createOptions,G=U.getBody,Q=/^[ \t\f\r\n]+$/,X=/^[ \t\f\r]+$/,Y=/^[\t-\r \u0085\u00A0\u1680\u180E\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]+$/,Z=/^[\t \u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000]+$/,J="en",ee=e.Selection.isDirectionBackward,te=!1,re=!1,ne=!1,ie=!0;!function(){var t=U.createTestElement(document,"<p>1 </p><p></p>",!0),r=t.firstChild,n=e.getSelection();n.collapse(r.lastChild,2),n.setStart(r.firstChild,0),te=1==(""+n).length,t.innerHTML="1 <br />",n.collapse(t,2),n.setStart(t.firstChild,0),re=1==(""+n).length,t.innerHTML="1 <p>1</p>",n.collapse(t,2),n.setStart(t.firstChild,0),ne=1==(""+n).length,U.removeNode(t),n.removeAllRanges()}();var oe,ae={includeBlockContentTrailingSpace:!0,includeSpaceBeforeBr:!0,includeSpaceBeforeBlock:!0,includePreLineTrailingSpace:!0,ignoreCharacters:""},se={includeBlockContentTrailingSpace:!ie,includeSpaceBeforeBr:!re,includeSpaceBeforeBlock:!ne,includePreLineTrailingSpace:!0},le={en:{wordRegex:/[a-z0-9]+('[a-z0-9]+)*/gi,includeTrailingSpace:!1,tokenizer:r}},ue={caseSensitive:!1,withinRange:null,wholeWordsOnly:!1,wrap:!1,direction:"forward",wordOptions:null,characterOptions:null},ce={wordOptions:null,characterOptions:null},he={wordOptions:null,characterOptions:null,trim:!1,trimStart:!0,trimEnd:!0},de={wordOptions:null,characterOptions:null,direction:"forward"},pe=U.getComputedStyleProperty;!function(){var e=document.createElement("table"),t=G(document);t.appendChild(e),oe="block"==pe(e,"display"),t.removeChild(e)}();var fe={table:"table",caption:"table-caption",colgroup:"table-column-group",col:"table-column",thead:"table-header-group",tbody:"table-row-group",tfoot:"table-footer-group",tr:"table-row",td:"table-cell",th:"table-cell"};E.prototype={get:function(e){return this.store.hasOwnProperty(e)?this.store[e]:null},set:function(e,t){return this.store[e]=t}};var me=0,ve=0,ye={getPosition:function(e){var t=this.positions;return t.get(e)||t.set(e,new N(this,e))},toString:function(){return"[NodeWrapper("+U.inspectNode(this.node)+")]"}};S.prototype=ye;var ge="EMPTY",be="NON_SPACE",we="UNCOLLAPSIBLE_SPACE",_e="COLLAPSIBLE_SPACE",Ee="TRAILING_SPACE_BEFORE_BLOCK",xe="TRAILING_SPACE_IN_BLOCK",Se="TRAILING_SPACE_BEFORE_BR",Ne="PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK",Ce="TRAILING_LINE_BREAK_AFTER_BR",Te="INCLUDED_TRAILING_LINE_BREAK_AFTER_BR";z(ye,{isCharacterDataNode:x("isCharacterDataNode",U.isCharacterDataNode,"node"),getNodeIndex:x("nodeIndex",U.getNodeIndex,"node"),getLength:x("nodeLength",U.getNodeLength,"node"),containsPositions:x("containsPositions",d,"node"),isWhitespace:x("isWhitespace",g,"node"),isCollapsedWhitespace:x("isCollapsedWhitespace",b,"node"),getComputedDisplay:x("computedDisplay",l,"node"),isCollapsed:x("collapsed",w,"node"),isIgnored:x("ignored",_,"node"),next:x("nextPos",v,"node"),previous:x("previous",y,"node"),getTextNodeInfo:x("textNodeInfo",function(e){var t=null,r=!1,n=pe(e.parentNode,"whiteSpace"),i="pre-line"==n;return i?(t=X,r=!0):"normal"!=n&&"nowrap"!=n||(t=Q,r=!0),{node:e,text:e.data,spaceRegex:t,collapseSpaces:r,preLine:i}},"node"),hasInnerText:x("hasInnerText",function(e,t){for(var r=this.session,n=r.getPosition(e.parentNode,this.getNodeIndex()+1),i=r.getPosition(e,0),o=t?n:i,a=t?i:n;o!==a;){if(o.prepopulateChar(),o.isDefinitelyNonEmpty())return!0;o=t?o.previousVisible():o.nextVisible()}return!1},"node"),isRenderedBlock:x("isRenderedBlock",function(e){for(var t=e.getElementsByTagName("br"),r=0,n=t.length;r<n;++r)if(!w(t[r]))return!0;return this.hasInnerText()},"node"),getTrailingSpace:x("trailingSpace",function(e){if("br"==e.tagName.toLowerCase())return"";switch(this.getComputedDisplay()){case"inline":for(var t=e.lastChild;t;){if(!_(t))return 1==t.nodeType?this.session.getNodeWrapper(t).getTrailingSpace():"";t=t.previousSibling}break;case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":break;case"table-cell":return"\t";default:return this.isRenderedBlock(!0)?"\n":""}return""},"node"),getLeadingSpace:x("leadingSpace",function(e){switch(this.getComputedDisplay()){case"inline":case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":case"table-cell":break;default:return this.isRenderedBlock(!1)?"\n":""}return""},"node")});var Pe={character:"",characterType:ge,isBr:!1,prepopulateChar:function(){var e=this;if(!e.prepopulatedChar){var t=e.node,r=e.offset,n="",i=ge,o=!1;if(r>0)if(3==t.nodeType){var a=t.data,s=a.charAt(r-1),l=e.nodeWrapper.getTextNodeInfo(),u=l.spaceRegex;l.collapseSpaces?u.test(s)?r>1&&u.test(a.charAt(r-2))||(l.preLine&&"\n"===a.charAt(r)?(n=" ",i=Ne):(n=" ",i=_e)):(n=s,i=be,o=!0):(n=s,i=we,o=!0)}else{var c=t.childNodes[r-1];if(c&&1==c.nodeType&&!w(c)&&("br"==c.tagName.toLowerCase()?(n="\n",e.isBr=!0,i=_e,o=!1):e.checkForTrailingSpace=!0),!n){var h=t.childNodes[r];h&&1==h.nodeType&&!w(h)&&(e.checkForLeadingSpace=!0)}}e.prepopulatedChar=!0,e.character=n,e.characterType=i,e.isCharInvariant=o}},isDefinitelyNonEmpty:function(){var e=this.characterType;return e==be||e==we},resolveLeadingAndTrailingSpaces:function(){if(this.prepopulatedChar||this.prepopulateChar(),this.checkForTrailingSpace){var e=this.session.getNodeWrapper(this.node.childNodes[this.offset-1]).getTrailingSpace();e&&(this.isTrailingSpace=!0,this.character=e,this.characterType=_e),this.checkForTrailingSpace=!1}if(this.checkForLeadingSpace){var t=this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace();t&&(this.isLeadingSpace=!0,this.character=t,this.characterType=_e),this.checkForLeadingSpace=!1}},getPrecedingUncollapsedPosition:function(e){for(var t,r=this;r=r.previousVisible();)if(t=r.getCharacter(e),""!==t)return r;return null},getCharacter:function(e){function t(){return p||(c=f.getPrecedingUncollapsedPosition(e),p=!0),c}this.resolveLeadingAndTrailingSpaces();var r,n=this.character,i=o(e.ignoreCharacters),a=""!==n&&i.indexOf(n)>-1;if(this.isCharInvariant)return r=a?"":n;var s=["character",e.includeSpaceBeforeBr,e.includeBlockContentTrailingSpace,e.includePreLineTrailingSpace,i].join("_"),l=this.cache.get(s);if(null!==l)return l;var u,c,h="",d=this.characterType==_e,p=!1,f=this;return d&&(this.type==Te?h="\n":" "==n&&(!t()||c.isTrailingSpace||"\n"==c.character||" "==c.character&&c.characterType==_e)||("\n"==n&&this.isLeadingSpace?t()&&"\n"!=c.character&&(h="\n"):(u=this.nextUncollapsed(),u&&(u.isBr?this.type=Se:u.isTrailingSpace&&"\n"==u.character?this.type=xe:u.isLeadingSpace&&"\n"==u.character&&(this.type=Ee),"\n"==u.character?(this.type!=Se||e.includeSpaceBeforeBr)&&(this.type!=Ee||e.includeSpaceBeforeBlock)&&(this.type==xe&&u.isTrailingSpace&&!e.includeBlockContentTrailingSpace||(this.type!=Ne||u.type!=be||e.includePreLineTrailingSpace)&&("\n"==n?u.isTrailingSpace?this.isTrailingSpace||this.isBr&&(u.type=Ce,t()&&c.isLeadingSpace&&!c.isTrailingSpace&&"\n"==c.character?u.character="":u.type=Te):h="\n":" "==n&&(h=" "))):h=n)))),i.indexOf(h)>-1&&(h=""),this.cache.set(s,h),h},equals:function(e){return!!e&&this.node===e.node&&this.offset===e.offset},inspect:C,toString:function(){return this.character}};N.prototype=Pe,z(Pe,{next:x("nextPos",function(e){var t=e.nodeWrapper,r=e.node,n=e.offset,i=t.session;if(!r)return null;var o,a,s;return n==t.getLength()?(o=r.parentNode,a=o?t.getNodeIndex()+1:0):t.isCharacterDataNode()?(o=r,
a=n+1):(s=r.childNodes[n],i.getNodeWrapper(s).containsPositions()?(o=s,a=0):(o=r,a=n+1)),o?i.getPosition(o,a):null}),previous:x("previous",function(e){var t,r,n,i=e.nodeWrapper,o=e.node,a=e.offset,s=i.session;return 0==a?(t=o.parentNode,r=t?i.getNodeIndex():0):i.isCharacterDataNode()?(t=o,r=a-1):(n=o.childNodes[a-1],s.getNodeWrapper(n).containsPositions()?(t=n,r=U.getNodeLength(n)):(t=o,r=a-1)),t?s.getPosition(t,r):null}),nextVisible:x("nextVisible",function(e){var t=e.next();if(!t)return null;var r=t.nodeWrapper,n=t.node,i=t;return r.isCollapsed()&&(i=r.session.getPosition(n.parentNode,r.getNodeIndex()+1)),i}),nextUncollapsed:x("nextUncollapsed",function(e){for(var t=e;t=t.nextVisible();)if(t.resolveLeadingAndTrailingSpaces(),""!==t.character)return t;return null}),previousVisible:x("previousVisible",function(e){var t=e.previous();if(!t)return null;var r=t.nodeWrapper,n=t.node,i=t;return r.isCollapsed()&&(i=r.session.getPosition(n.parentNode,r.getNodeIndex())),i})});var ke=null,Ae=function(){function e(e){var t=new E;return{get:function(r){var n=t.get(r[e]);if(n)for(var i,o=0;i=n[o++];)if(i.node===r)return i;return null},set:function(r){var n=r.node[e],i=t.get(n)||t.set(n,[]);i.push(r)}}}function t(){this.initCaches()}var r=q.isHostProperty(document.documentElement,"uniqueID");return t.prototype={initCaches:function(){this.elementCache=r?function(){var e=new E;return{get:function(t){return e.get(t.uniqueID)},set:function(t){e.set(t.node.uniqueID,t)}}}():e("tagName"),this.textNodeCache=e("data"),this.otherNodeCache=e("nodeName")},getNodeWrapper:function(e){var t;switch(e.nodeType){case 1:t=this.elementCache;break;case 3:t=this.textNodeCache;break;default:t=this.otherNodeCache}var r=t.get(e);return r||(r=new S(e,this),t.set(r)),r},getPosition:function(e,t){return this.getNodeWrapper(e).getPosition(t)},getRangeBoundaryPosition:function(e,t){var r=t?"start":"end";return this.getPosition(e[r+"Container"],e[r+"Offset"])},detach:function(){this.elementCache=this.textNodeCache=this.otherNodeCache=null}},t}();z(U,{nextNode:v,previousNode:y});var Re=Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var r=0,n=e.length;r<n;++r)if(e[r]===t)return r;return-1};z(e.rangePrototype,{moveStart:F(!0,!1),moveEnd:F(!1,!1),move:F(!0,!0),trimStart:B(!0),trimEnd:B(!1),trim:j(function(e,t){var r=this.trimStart(t),n=this.trimEnd(t);return r||n}),expand:j(function(e,t,r){var n=!1;r=s(r,he);var i=r.characterOptions;if(t||(t=W),t==$){var o,a,l=r.wordOptions,u=e.getRangeBoundaryPosition(this,!0),c=e.getRangeBoundaryPosition(this,!1),h=R(u,i,l),d=h.nextEndToken(),p=d.chars[0].previousVisible();if(this.collapsed)o=d;else{var f=R(c,i,l);o=f.previousStartToken()}return a=o.chars[o.chars.length-1],p.equals(u)||(this.setStart(p.node,p.offset),n=!0),a&&!a.equals(c)&&(this.setEnd(a.node,a.offset),n=!0),r.trim&&(r.trimStart&&(n=this.trimStart(i)||n),r.trimEnd&&(n=this.trimEnd(i)||n)),n}return this.moveEnd(W,1,r)}),text:j(function(e,t){return this.collapsed?"":D(e,this,K(t,ae)).join("")}),selectCharacters:j(function(e,t,r,n,i){var o={characterOptions:i};t||(t=G(this.getDocument())),this.selectNodeContents(t),this.collapse(!0),this.moveStart("character",r,o),this.collapse(!0),this.moveEnd("character",n-r,o)}),toCharacterRange:j(function(e,t,r){t||(t=G(this.getDocument()));var n,i,o=t.parentNode,a=U.getNodeIndex(t),s=U.comparePoints(this.startContainer,this.endContainer,o,a)==-1,l=this.cloneRange();return s?(l.setStartAndEnd(this.startContainer,this.startOffset,o,a),n=-l.text(r).length):(l.setStartAndEnd(o,a,this.startContainer,this.startOffset),n=l.text(r).length),i=n+this.text(r).length,{start:n,end:i}}),findText:j(function(t,r,n){n=s(n,ue),n.wholeWordsOnly&&(n.wordOptions.includeTrailingSpace=!1);var i=ee(n.direction),o=n.withinRange;o||(o=e.createRange(),o.selectNodeContents(this.getDocument()));var a=r,l=!1;"string"==typeof a?n.caseSensitive||(a=a.toLowerCase()):l=!0;var u=t.getRangeBoundaryPosition(this,!i),c=o.comparePoint(u.node,u.offset);c===-1?u=t.getRangeBoundaryPosition(o,!0):1===c&&(u=t.getRangeBoundaryPosition(o,!1));for(var h,d=u,p=!1;;)if(h=L(d,a,l,o,n)){if(h.valid)return this.setStartAndEnd(h.startPos.node,h.startPos.offset,h.endPos.node,h.endPos.offset),!0;d=i?h.startPos:h.endPos}else{if(!n.wrap||p)return!1;o=o.cloneRange(),d=t.getRangeBoundaryPosition(o,!i),o.setBoundary(u.node,u.offset,i),p=!0}}),pasteHtml:function(e){if(this.deleteContents(),e){var t=this.createContextualFragment(e),r=t.lastChild;this.insertNode(t),this.collapseAfter(r)}}}),z(e.selectionPrototype,{expand:j(function(e,t,r){this.changeEachRange(function(e){e.expand(t,r)})}),move:j(function(e,t,r,n){var i=0;if(this.focusNode){this.collapse(this.focusNode,this.focusOffset);var o=this.getRangeAt(0);n||(n={}),n.characterOptions=K(n.characterOptions,se),i=o.move(t,r,n),this.setSingleRange(o)}return i}),trimStart:V("trimStart"),trimEnd:V("trimEnd"),trim:V("trim"),selectCharacters:j(function(t,r,n,i,o,a){var s=e.createRange(r);s.selectCharacters(r,n,i,a),this.setSingleRange(s,o)}),saveCharacterRanges:j(function(e,t,r){for(var n=this.getAllRanges(),i=n.length,o=[],a=1==i&&this.isBackward(),s=0,l=n.length;s<l;++s)o[s]={characterRange:n[s].toCharacterRange(t,r),backward:a,characterOptions:r};return o}),restoreCharacterRanges:j(function(t,r,n){this.removeAllRanges();for(var i,o,a,s=0,l=n.length;s<l;++s)o=n[s],a=o.characterRange,i=e.createRange(r),i.selectCharacters(r,a.start,a.end,o.characterOptions),this.addRange(i,o.backward)}),text:j(function(e,t){for(var r=[],n=0,i=this.rangeCount;n<i;++n)r[n]=this.getRangeAt(n).text(t);return r.join("")})}),e.innerText=function(t,r){var n=e.createRange(t);n.selectNodeContents(t);var i=n.text(r);return i},e.createWordIterator=function(e,t,r){var n=P();r=s(r,de);var i=n.getPosition(e,t),o=R(i,r.characterOptions,r.wordOptions),a=ee(r.direction);return{next:function(){return a?o.previousStartToken():o.nextEndToken()},dispose:function(){o.dispose(),this.next=function(){}}}},e.noMutation=function(e){var t=P();e(t),k()},e.noMutation.createEntryPointFunction=j,e.textRange={isBlockNode:h,isCollapsedWhitespaceNode:b,createPosition:j(function(e,t,r){return e.getPosition(t,r)})}}),e},this),define("wed/glue/rangy-glue",["require","exports","module","rangy","rangy-textrange"],function(e,t,r,n){"use strict";return n}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define("rxjs",["exports"],t):t(e.Rx=e.Rx||{})}(this,function(e){"use strict";function t(e,t){function r(){this.constructor=e}tr(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function r(e){return"function"==typeof e}function n(e){return null!=e&&"object"==typeof e}function i(){try{return nr.apply(this,arguments)}catch(e){return or.e=e,or}}function o(e){return nr=e,i}function a(e){return e.reduce(function(e,t){return e.concat(t instanceof ar?t.errors:t)},[])}function s(e,t,r){if(e){if(e instanceof hr)return e;if(e[cr])return e[cr]()}return e||t||r?new hr(e,t,r):new hr(lr)}function l(e){var t,r=e.Symbol;return"function"==typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}function u(e){var t=e.value,r=e.subject;r.next(t),r.complete()}function c(e){var t=e.err,r=e.subject;r.error(t)}function h(e){var t=this,r=e.source,n=e.subscriber,i=e.context,a=r,s=a.callbackFunc,l=a.args,u=a.scheduler,c=r.subject;if(!c){c=r.subject=new wr;var h=function e(){for(var r=[],n=0;n<arguments.length;n++)r[n-0]=arguments[n];var i=e.source,a=i.selector,s=i.subject,l=r.shift();if(l)s.error(l);else if(a){var c=o(a).apply(this,r);c===or?t.add(u.schedule(p,0,{err:or.e,subject:s})):t.add(u.schedule(d,0,{value:c,subject:s}))}else{var h=1===r.length?r[0]:r;t.add(u.schedule(d,0,{value:h,subject:s}))}};h.source=r;var f=o(s).apply(i,l.concat(h));f===or&&c.error(or.e)}t.add(c.subscribe(n))}function d(e){var t=e.value,r=e.subject;r.next(t),r.complete()}function p(e){var t=e.err,r=e.subject;r.error(t)}function f(e){return e&&"function"==typeof e.schedule}function m(e){return e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}function v(e){var t=e.Symbol;if("function"==typeof t)return t.iterator||(t.iterator=t("iterator polyfill")),t.iterator;var r=e.Set;if(r&&"function"==typeof(new r)["@@iterator"])return"@@iterator";var n=e.Map;if(n)for(var i=Object.getOwnPropertyNames(n.prototype),o=0;o<i.length;++o){var a=i[o];if("entries"!==a&&"size"!==a&&n.prototype[a]===n.prototype.entries)return a}return"@@iterator"}function y(e,t,r,i){var o=new Ar(e,r,i);if(o.closed)return null;if(t instanceof fr)return t._isScalar?(o.next(t.value),o.complete(),null):t.subscribe(o);if(ir(t)){for(var a=0,s=t.length;a<s&&!o.closed;a++)o.next(t[a]);o.closed||o.complete()}else{if(m(t))return t.then(function(e){o.closed||(o.next(e),o.complete())},function(e){return o.error(e)}).then(null,function(e){rr.setTimeout(function(){throw e})}),o;if(t&&"function"==typeof t[kr])for(var l=t[kr]();;){var u=l.next();if(u.done){o.complete();break}if(o.next(u.value),o.closed)break}else if(t&&"function"==typeof t[pr]){var c=t[pr]();if("function"==typeof c.subscribe)return c.subscribe(new Ar(e,r,i));o.error(new TypeError("Provided object does not correctly implement Symbol.observable"))}else{var h=n(t)?"an invalid object":"'"+t+"'",d="You provided "+h+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";o.error(new TypeError(d))}}return null}function g(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r=null;return"function"==typeof e[e.length-1]&&(r=e.pop()),1===e.length&&ir(e[0])&&(e=e[0].slice()),e.unshift(this),this.lift.call(new Tr(e),new Or(r))}function b(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r=null,n=null;return f(e[e.length-1])&&(n=e.pop()),"function"==typeof e[e.length-1]&&(r=e.pop()),1===e.length&&ir(e[0])&&(e=e[0]),new Tr(e,n).lift(new Or(r))}function w(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),this.lift(new Dr(e))}function _(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return this.lift.call(E.apply(void 0,[this].concat(e)))}function E(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r=null,n=e;return f(n[e.length-1])&&(r=n.pop()),null===r&&1===e.length?e[0]:new Tr(e,r).lift(new Dr(1))}function x(e){var t=e.value,r=e.subscriber;r.closed||(r.next(t),r.complete())}function S(e){var t=e.err,r=e.subscriber;r.closed||r.error(t)}function N(e){var t=e[kr];if(!t&&"string"==typeof e)return new zr(e);if(!t&&void 0!==e.length)return new Kr(e);if(!t)throw new TypeError("object is not iterable");return e[kr]()}function C(e){var t=+e.length;return isNaN(t)?0:0!==t&&T(t)?(t=P(t)*Math.floor(Math.abs(t)),t<=0?0:t>Gr?Gr:t):t}function T(e){return"number"==typeof e&&rr.isFinite(e)}function P(e){var t=+e;return 0===t?t:isNaN(t)?t:t<0?-1:1}function k(e,t){return void 0===t&&(t=0),this.lift(new Yr(e,t))}function A(e){return!!e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}function R(e){return!!e&&"function"==typeof e.on&&"function"==typeof e.off}function O(e){return!!e&&"[object NodeList]"===nn.call(e)}function I(e){return!!e&&"[object HTMLCollection]"===nn.call(e)}function D(e){return!!e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}function M(e){return!ir(e)&&e-parseFloat(e)+1>=0}function L(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return this.lift.call(j.apply(void 0,[this].concat(e)))}function j(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r=Number.POSITIVE_INFINITY,n=null,i=e[e.length-1];return f(i)?(n=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(r=e.pop())):"number"==typeof i&&(r=e.pop()),null===n&&1===e.length?e[0]:new Tr(e,n).lift(new Dr(r))}function F(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return 1===e.length&&ir(e[0])&&(e=e[0]),this.lift.call(B.apply(void 0,[this].concat(e)))}function B(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];if(1===e.length){if(!ir(e[0]))return e[0];e=e[0]}return new Tr(e).lift(new xn)}function V(){}function H(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return 1===e.length&&ir(e[0])&&(e=e[0]),this.lift(new Pn(e))}function W(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r=null;return 1===e.length&&ir(e[0])&&(e=e[0]),r=e.shift(),new tn(r,null).lift(new Pn(e))}function $(e){var t=e.obj,r=e.keys,n=e.length,i=e.index,o=e.subscriber;if(i===n)return void o.complete();var a=r[i];o.next([a,t[a]]),e.index=i+1,this.schedule(e)}function U(e){return e instanceof Date&&!isNaN(+e)}function q(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return this.lift.call(z.apply(void 0,[this].concat(e)))}function z(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r=e[e.length-1];return"function"==typeof r&&e.pop(),new Tr(e).lift(new Hn(r))}function K(e,t){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return this.lift(new Kn(e,t))}function G(){if(rr.XMLHttpRequest){var e=new rr.XMLHttpRequest;return"withCredentials"in e&&(e.withCredentials=!!this.withCredentials),e}if(rr.XDomainRequest)return new rr.XDomainRequest;throw new Error("CORS is not supported by your browser")}function Q(){if(rr.XMLHttpRequest)return new rr.XMLHttpRequest;var e=void 0;try{for(var t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],r=0;r<3;r++)try{if(e=t[r],new rr.ActiveXObject(e))break}catch(e){}return new rr.ActiveXObject(e)}catch(e){throw new Error("XMLHttpRequest is not supported by your browser")}}function X(e,t){return void 0===t&&(t=null),new Qn({method:"GET",url:e,headers:t})}function Y(e,t,r){return new Qn({method:"POST",url:e,body:t,headers:r})}function Z(e,t){return new Qn({method:"DELETE",url:e,headers:t})}function J(e,t,r){return new Qn({method:"PUT",url:e,body:t,headers:r})}function ee(e,t){return new Qn({method:"GET",url:e,responseType:"json",headers:t}).lift(new Kn(function(e,t){return e.response},null))}function te(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=t.length,i=0;i<n;i++){var o=t[i];for(var a in o)o.hasOwnProperty(a)&&(e[a]=o[a])}return e}function re(e){return e.Object.assign||te}function ne(e){return this.lift(new ui(e))}function ie(e,t){return void 0===t&&(t=null),this.lift(new hi(e,t))}function oe(e){var t=arguments.length,r=bn;f(arguments[arguments.length-1])&&(r=arguments[arguments.length-1],t--);var n=null;t>=2&&(n=arguments[1]);var i=Number.POSITIVE_INFINITY;return t>=3&&(i=arguments[2]),this.lift(new pi(e,n,i,r))}function ae(e){var t=e.subscriber,r=e.context;r&&t.closeContext(r),t.closed||(e.context=t.openContext(),e.context.closeAction=this.schedule(e,e.bufferTimeSpan))}function se(e){var t=e.bufferCreationInterval,r=e.bufferTimeSpan,n=e.subscriber,i=e.scheduler,o=n.openContext(),a=this;n.closed||(n.add(o.closeAction=i.schedule(le,r,{subscriber:n,context:o})),a.schedule(e,t))}function le(e){var t=e.subscriber,r=e.context;t.closeContext(r)}function ue(e,t){return this.lift(new vi(e,t))}function ce(e){return this.lift(new gi(e))}function he(e){var t=new wi(e),r=this.lift(t);return t.caught=r}function de(e){return this.lift(new Or(e))}function pe(){return this.lift(new Dr(1))}function fe(e,t,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),"number"==typeof t&&(r=t,t=null),this.lift(new Ei(e,t,r))}function me(e,t){return this.lift(new Ei(e,t,1))}function ve(e,t,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),"number"==typeof t&&(r=t,t=null),this.lift(new Si(e,t,r))}function ye(e,t){return this.lift(new Si(e,t,1))}function ge(e){return this.lift(new Ci(e,this))}function be(){return this.lift(new Pi)}function we(e){return this.lift(new Ai(e))}function _e(e,t){return void 0===t&&(t=bn),this.lift(new Oi(e,t))}function Ee(e){e.debouncedNext()}function xe(e){return void 0===e&&(e=null),this.lift(new Di(e))}function Se(e,t){void 0===t&&(t=bn);var r=U(e),n=r?+e-t.now():Math.abs(e);return this.lift(new Li(n,t))}function Ne(e,t){return t?new Hi(this,t).lift(new Bi(e)):this.lift(new Bi(e))}function Ce(){return function(){function e(){this._values=[]}return e.prototype.add=function(e){this.has(e)||this._values.push(e)},e.prototype.has=function(e){return this._values.indexOf(e)!==-1},Object.defineProperty(e.prototype,"size",{get:function(){return this._values.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._values.length=0},e}()}function Te(e,t){return this.lift(new Ui(e,t))}function Pe(e,t){return this.lift(new zi(e,t))}function ke(e,t){return Pe.call(this,function(r,n){return t?t(r[e],n[e]):r[e]===n[e]})}function Ae(e,t,r){return this.lift(new Gi(e,t,r))}function Re(){return this.lift(new Xi)}function Oe(e,t){return this.lift(new Zi(e,t))}function Ie(e,t,r){return void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===r&&(r=void 0),t=(t||0)<1?Number.POSITIVE_INFINITY:t,this.lift(new eo(e,t,r))}function De(e,t){return this.lift(new no(e,t))}function Me(e,t){return this.lift(new oo(e,t))}function Le(e){return this.lift(new so(e))}function je(e,t){if("function"!=typeof e)throw new TypeError("predicate is not a function");return this.lift(new uo(e,this,!1,t))}function Fe(e,t){return this.lift(new uo(e,this,!0,t))}function Be(e,t,r){return this.lift(new po(e,t,r,this))}function Ve(e,t,r,n){return this.lift(new go(e,t,r,n))}function He(){return this.lift(new xo)}function We(){return this.lift(new No)}function $e(e){return this.lift(new To(e))}function Ue(e,t){return void 0===t&&(t=bn),this.lift(new ko(e,t))}function qe(e){e.clearThrottle()}function ze(e,t,r){return this.lift(new Ro(e,t,r,this))}function Ke(e){return e(this)}function Ge(e,t){return this.lift(new Io(e,t,this))}function Qe(e){return this.lift(new Mo(e))}function Xe(){return this.lift(new jo)}function Ye(e,t){var r=!1;return arguments.length>=2&&(r=!0),this.lift(new Bo(e,t,r))}function Ze(e){var t="function"==typeof e?function(t,r){return e(t,r)>0?t:r}:function(e,t){return e>t?e:t};return this.lift(new Bo(t))}function Je(e,t,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),this.lift(new Ho(e,t,r))}function et(e){var t="function"==typeof e?function(t,r){return e(t,r)<0?t:r}:function(e,t){return e<t?e:t};return this.lift(new Bo(t))}function tt(e,t){var r;if(r="function"==typeof e?e:function(){return e},"function"==typeof t)return this.lift(new Go(r,t));var n=Object.create(this,Uo);return n.source=this,n.subjectFactory=r,n}function rt(){return this.lift(new Qo)}function nt(e,t){function r(){return!r.pred.apply(r.thisArg,arguments)}return r.pred=e,r.thisArg=t,r}function it(e,t){return[Me.call(this,e,t),Me.call(this,nt(e,t))]}function ot(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r=e.length;if(0===r)throw new Error("list of properties cannot be empty.");return K.call(this,at(e,r))}function at(e,t){var r=function(r){for(var n=r,i=0;i<t;i++){var o=n[e[i]];if("undefined"==typeof o)return;n=o}return n};return r}function st(e){return e?tt.call(this,function(){return new gr},e):tt.call(this,new gr)}function lt(e){return tt.call(this,new Yo(e))}function ut(e,t,r){return void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===t&&(t=Number.POSITIVE_INFINITY),tt.call(this,new ii(e,t,r))}function ct(){return tt.call(this,new wr)}function ht(e){return void 0===e&&(e=-1),0===e?new Cr:e<0?this.lift(new Zo(-1,this)):this.lift(new Zo(e-1,this))}function dt(e){return this.lift(new ea(e))}function pt(e){return void 0===e&&(e=-1),this.lift(new ra(e,this))}function ft(e){return this.lift(new ia(e,this))}function mt(e){return this.lift(new aa(e))}function vt(e,t){return void 0===t&&(t=bn),this.lift(new la(e,t))}function yt(e){var t=e.subscriber,r=e.period;t.notifyNext(),this.schedule(e,r)}function gt(e,t){var r=!1;return arguments.length>=2&&(r=!0),this.lift(new ca(e,t,r))}function bt(e,t){return this.lift(new da(e,t))}function wt(){return new gr}function _t(){return tt.call(this,wt).refCount()}function Et(e){return this.lift(new ma(e,this))}function xt(e){return this.lift(new ya(e))}function St(e){return this.lift(new ba(e))}function Nt(e){return this.lift(new _a(e))}function Ct(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r=e[e.length-1];f(r)?e.pop():r=null;var n=e.length;return 1===n?E(new Nr(e[0],r),this):n>1?E(new Tr(e,r),this):E(new Cr(r),this)}function Tt(e,t){return void 0===t&&(t=0),this.lift(new ka(e,t))}function Pt(){return this.lift(new Aa)}function kt(e,t){return this.lift(new Oa(e,t))}function At(e,t){return this.lift(new Da(e,t))}function Rt(e){return 0===e?new Cr:this.lift(new La(e))}function Ot(e){return 0===e?new Cr:this.lift(new Fa(e))}function It(e){return this.lift(new Va(e))}function Dt(e){return this.lift(new Wa(e))}function Mt(e){return this.lift(new Ua(e))}function Lt(e,t){return void 0===t&&(t=bn),this.lift(new za(e,t))}function jt(e){var t=e.subscriber;t.clearThrottle()}function Ft(e){return void 0===e&&(e=bn),this.lift(new Qa(e))}function Bt(e,t){void 0===t&&(t=bn);var r=U(e),n=r?+e-t.now():Math.abs(e);return this.lift(new Za(n,r,t,new Ya))}function Vt(e,t,r){void 0===r&&(r=bn);var n=U(e),i=n?+e-r.now():Math.abs(e);return this.lift(new es(i,n,t,r))}function Ht(e){return void 0===e&&(e=bn),this.lift(new ns(e))}function Wt(){return this.lift(new os)}function $t(e){var t=this;if(e||(rr.Rx&&rr.Rx.config&&rr.Rx.config.Promise?e=rr.Rx.config.Promise:rr.Promise&&(e=rr.Promise)),!e)throw new Error("no Promise impl found");return new e(function(e,r){var n;t.subscribe(function(e){return n=e},function(e){return r(e)},function(){return e(n)})})}function Ut(e){return this.lift(new ss(e))}function qt(e,t){return void 0===t&&(t=0),this.lift(new us(e,t))}function zt(e,t,r){return void 0===t&&(t=null),void 0===r&&(r=bn),this.lift(new hs(e,t,r))}function Kt(e){var t=e.subscriber,r=e.windowTimeSpan,n=e.window;n&&t.closeWindow(n),e.window=t.openWindow(),this.schedule(e,r)}function Gt(e){var t=e.windowTimeSpan,r=e.subscriber,n=e.scheduler,i=e.windowCreationInterval,o=r.openWindow(),a=this,s={action:a,subscription:null},l={subscriber:r,window:o,context:s};s.subscription=n.schedule(Qt,t,l),a.add(s.subscription),a.schedule(e,i)}function Qt(e){var t=e.subscriber,r=e.window,n=e.context;n&&n.action&&n.subscription&&n.action.remove(n.subscription),t.closeWindow(r)}function Xt(e,t){return this.lift(new ps(e,t))}function Yt(e){return this.lift(new ms(e))}function Zt(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var r;"function"==typeof e[e.length-1]&&(r=e.pop());var n=e;return this.lift(new ys(n,r))}function Jt(e){return this.lift(new Hn(e))}function er(e,t){for(var r=0,n=t.length;r<n;r++)for(var i=t[r],o=Object.getOwnPropertyNames(i.prototype),a=0,s=o.length;a<s;a++){var l=o[a];e.prototype[l]=i.prototype[l]}}var tr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},rr="object"==typeof window&&window.window===window&&window||"object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if(!rr)throw new Error("RxJS could not find any global context (window, self, global)");var nr,ir=Array.isArray||function(e){return e&&"number"==typeof e.length},or={e:{}},ar=function(e){function r(t){e.call(this),this.errors=t;var r=Error.call(this,t?t.length+" errors occurred during unsubscription:\n  "+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"");this.name=r.name="UnsubscriptionError",this.stack=r.stack,this.message=r.message}return t(r,e),r}(Error),sr=function(){function e(e){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var e,t=!1;if(!this.closed){var i=this,s=i._parent,l=i._parents,u=i._unsubscribe,c=i._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var h=-1,d=l?l.length:0;s;)s.remove(this),s=++h<d&&l[h]||null;if(r(u)){var p=o(u).call(this);p===or&&(t=!0,e=e||(or.e instanceof ar?a(or.e.errors):[or.e]))}if(ir(c))for(h=-1,d=c.length;++h<d;){var f=c[h];if(n(f)){var p=o(f.unsubscribe).call(f);if(p===or){t=!0,e=e||[];var m=or.e;m instanceof ar?e=e.concat(a(m.errors)):e.push(m)}}}if(t)throw new ar(e)}},e.prototype.add=function(t){if(!t||t===e.EMPTY)return e.EMPTY;if(t===this)return this;var r=t;switch(typeof t){case"function":r=new e(t);case"object":if(r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if("function"!=typeof r._addParent){var n=r;r=new e,r._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var i=this._subscriptions||(this._subscriptions=[]);return i.push(r),r._addParent(this),r},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var r=t.indexOf(e);r!==-1&&t.splice(r,1)}},e.prototype._addParent=function(e){var t=this,r=t._parent,n=t._parents;r&&r!==e?n?n.indexOf(e)===-1&&n.push(e):this._parents=[e]:this._parent=e},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}(),lr={closed:!0,next:function(e){},error:function(e){throw e},complete:function(){}},ur=rr.Symbol,cr="function"==typeof ur&&"function"==typeof ur.for?ur.for("rxSubscriber"):"@@rxSubscriber",hr=function(e){function r(t,n,i){switch(e.call(this),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=lr;break;case 1:if(!t){this.destination=lr;break}if("object"==typeof t){t instanceof r?(this.destination=t,this.destination.add(this)):(this.syncErrorThrowable=!0,this.destination=new dr(this,t));break}default:this.syncErrorThrowable=!0,this.destination=new dr(this,t,n,i)}}return t(r,e),r.prototype[cr]=function(){return this},r.create=function(e,t,n){var i=new r(e,t,n);return i.syncErrorThrowable=!1,i},r.prototype.next=function(e){this.isStopped||this._next(e)},r.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},r.prototype._next=function(e){this.destination.next(e)},r.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},r.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},r.prototype._unsubscribeAndRecycle=function(){var e=this,t=e._parent,r=e._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=t,this._parents=r,this},r}(sr),dr=function(e){function n(t,n,i,o){e.call(this),this._parentSubscriber=t;var a,s=this;r(n)?a=n:n&&(s=n,a=n.next,i=n.error,o=n.complete,r(s.unsubscribe)&&this.add(s.unsubscribe.bind(s)),s.unsubscribe=this.unsubscribe.bind(this)),this._context=s,this._next=a,this._error=i,this._complete=o}return t(n,e),n.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},n.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber;if(this._error)t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else{if(!t.syncErrorThrowable)throw this.unsubscribe(),e;t.syncErrorValue=e,t.syncErrorThrown=!0,this.unsubscribe()}}},n.prototype.complete=function(){if(!this.isStopped){var e=this._parentSubscriber;this._complete?e.syncErrorThrowable?(this.__tryOrSetError(e,this._complete),this.unsubscribe()):(this.__tryOrUnsub(this._complete),this.unsubscribe()):this.unsubscribe()}},n.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){throw this.unsubscribe(),e}},n.prototype.__tryOrSetError=function(e,t,r){try{t.call(this._context,r)}catch(t){return e.syncErrorValue=t,e.syncErrorThrown=!0,!0}return!1},n.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},n}(hr),pr=l(rr),fr=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var n=this.operator,i=s(e,t,r);if(n?n.call(i,this.source):i.add(this._trySubscribe(i)),i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.syncErrorThrown=!0,e.syncErrorValue=t,e.error(t)}},e.prototype.forEach=function(e,t){var r=this;if(t||(rr.Rx&&rr.Rx.config&&rr.Rx.config.Promise?t=rr.Rx.config.Promise:rr.Promise&&(t=rr.Promise)),!t)throw new Error("no Promise impl found");return new t(function(t,n){var i=r.subscribe(function(t){if(i)try{e(t)}catch(e){n(e),i.unsubscribe()}else e(t)},n,t)})},e.prototype._subscribe=function(e){return this.source.subscribe(e)},e.prototype[pr]=function(){return this},e.create=function(t){return new e(t)},e}(),mr=function(e){function r(){var t=e.call(this,"object unsubscribed");this.name=t.name="ObjectUnsubscribedError",this.stack=t.stack,this.message=t.message}return t(r,e),r}(Error),vr=function(e){function r(t,r){e.call(this),this.subject=t,this.subscriber=r,this.closed=!1}return t(r,e),r.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var r=t.indexOf(this.subscriber);r!==-1&&t.splice(r,1)}}},r}(sr),yr=function(e){function r(t){e.call(this,t),this.destination=t}return t(r,e),r}(hr),gr=function(e){function r(){e.call(this),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}return t(r,e),r.prototype[cr]=function(){return new yr(this)},r.prototype.lift=function(e){var t=new br(this,this);return t.operator=e,t},r.prototype.next=function(e){if(this.closed)throw new mr;if(!this.isStopped)for(var t=this.observers,r=t.length,n=t.slice(),i=0;i<r;i++)n[i].next(e)},r.prototype.error=function(e){if(this.closed)throw new mr;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,r=t.length,n=t.slice(),i=0;i<r;i++)n[i].error(e);this.observers.length=0},r.prototype.complete=function(){if(this.closed)throw new mr;this.isStopped=!0;for(var e=this.observers,t=e.length,r=e.slice(),n=0;n<t;n++)r[n].complete();this.observers.length=0},r.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},r.prototype._trySubscribe=function(t){if(this.closed)throw new mr;return e.prototype._trySubscribe.call(this,t)},r.prototype._subscribe=function(e){if(this.closed)throw new mr;return this.hasError?(e.error(this.thrownError),sr.EMPTY):this.isStopped?(e.complete(),sr.EMPTY):(this.observers.push(e),new vr(this,e))},r.prototype.asObservable=function(){var e=new fr;return e.source=this,e},r.create=function(e,t){return new br(e,t)},r}(fr),br=function(e){function r(t,r){e.call(this),this.destination=t,this.source=r}return t(r,e),r.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},r.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},r.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},r.prototype._subscribe=function(e){var t=this.source;return t?this.source.subscribe(e):sr.EMPTY},r}(gr),wr=function(e){function r(){e.apply(this,arguments),this.value=null,this.hasNext=!1,this.hasCompleted=!1}return t(r,e),r.prototype._subscribe=function(t){return this.hasError?(t.error(this.thrownError),sr.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),sr.EMPTY):e.prototype._subscribe.call(this,t)},r.prototype.next=function(e){this.hasCompleted||(this.value=e,this.hasNext=!0)},r.prototype.error=function(t){this.hasCompleted||e.prototype.error.call(this,t)},r.prototype.complete=function(){
this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},r}(gr),_r=function(e){function r(t,r,n,i,o){e.call(this),this.callbackFunc=t,this.selector=r,this.args=n,this.context=i,this.scheduler=o}return t(r,e),r.create=function(e,t,n){return void 0===t&&(t=void 0),function(){for(var i=[],o=0;o<arguments.length;o++)i[o-0]=arguments[o];return new r(e,t,i,this,n)}},r.prototype._subscribe=function(e){var t=this.callbackFunc,n=this.args,i=this.scheduler,a=this.subject;if(i)return i.schedule(r.dispatch,0,{source:this,subscriber:e,context:this.context});if(!a){a=this.subject=new wr;var s=function e(){for(var t=[],r=0;r<arguments.length;r++)t[r-0]=arguments[r];var n=e.source,i=n.selector,a=n.subject;if(i){var s=o(i).apply(this,t);s===or?a.error(or.e):(a.next(s),a.complete())}else a.next(1===t.length?t[0]:t),a.complete()};s.source=this;var l=o(t).apply(this.context,n.concat(s));l===or&&a.error(or.e)}return a.subscribe(e)},r.dispatch=function(e){var t=this,r=e.source,n=e.subscriber,i=e.context,a=r.callbackFunc,s=r.args,l=r.scheduler,h=r.subject;if(!h){h=r.subject=new wr;var d=function e(){for(var r=[],n=0;n<arguments.length;n++)r[n-0]=arguments[n];var i=e.source,a=i.selector,s=i.subject;if(a){var h=o(a).apply(this,r);h===or?t.add(l.schedule(c,0,{err:or.e,subject:s})):t.add(l.schedule(u,0,{value:h,subject:s}))}else{var d=1===r.length?r[0]:r;t.add(l.schedule(u,0,{value:d,subject:s}))}};d.source=r;var p=o(a).apply(i,s.concat(d));p===or&&h.error(or.e)}t.add(h.subscribe(n))},r}(fr),Er=_r.create;fr.bindCallback=Er;var xr=function(e){function r(t,r,n,i,o){e.call(this),this.callbackFunc=t,this.selector=r,this.args=n,this.context=i,this.scheduler=o}return t(r,e),r.create=function(e,t,n){return void 0===t&&(t=void 0),function(){for(var i=[],o=0;o<arguments.length;o++)i[o-0]=arguments[o];return new r(e,t,i,this,n)}},r.prototype._subscribe=function(e){var t=this.callbackFunc,r=this.args,n=this.scheduler,i=this.subject;if(n)return n.schedule(h,0,{source:this,subscriber:e,context:this.context});if(!i){i=this.subject=new wr;var a=function e(){for(var t=[],r=0;r<arguments.length;r++)t[r-0]=arguments[r];var n=e.source,i=n.selector,a=n.subject,s=t.shift();if(s)a.error(s);else if(i){var l=o(i).apply(this,t);l===or?a.error(or.e):(a.next(l),a.complete())}else a.next(1===t.length?t[0]:t),a.complete()};a.source=this;var s=o(t).apply(this.context,r.concat(a));s===or&&i.error(or.e)}return i.subscribe(e)},r}(fr),Sr=xr.create;fr.bindNodeCallback=Sr;var Nr=function(e){function r(t,r){e.call(this),this.value=t,this.scheduler=r,this._isScalar=!0,r&&(this._isScalar=!1)}return t(r,e),r.create=function(e,t){return new r(e,t)},r.dispatch=function(e){var t=e.done,r=e.value,n=e.subscriber;return t?void n.complete():(n.next(r),void(n.closed||(e.done=!0,this.schedule(e))))},r.prototype._subscribe=function(e){var t=this.value,n=this.scheduler;return n?n.schedule(r.dispatch,0,{done:!1,value:t,subscriber:e}):(e.next(t),void(e.closed||e.complete()))},r}(fr),Cr=function(e){function r(t){e.call(this),this.scheduler=t}return t(r,e),r.create=function(e){return new r(e)},r.dispatch=function(e){var t=e.subscriber;t.complete()},r.prototype._subscribe=function(e){var t=this.scheduler;return t?t.schedule(r.dispatch,0,{subscriber:e}):void e.complete()},r}(fr),Tr=function(e){function r(t,r){e.call(this),this.array=t,this.scheduler=r,r||1!==t.length||(this._isScalar=!0,this.value=t[0])}return t(r,e),r.create=function(e,t){return new r(e,t)},r.of=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var n=e[e.length-1];f(n)?e.pop():n=null;var i=e.length;return i>1?new r(e,n):1===i?new Nr(e[0],n):new Cr(n)},r.dispatch=function(e){var t=e.array,r=e.index,n=e.count,i=e.subscriber;return r>=n?void i.complete():(i.next(t[r]),void(i.closed||(e.index=r+1,this.schedule(e))))},r.prototype._subscribe=function(e){var t=0,n=this.array,i=n.length,o=this.scheduler;if(o)return o.schedule(r.dispatch,0,{array:n,index:t,count:i,subscriber:e});for(var a=0;a<i&&!e.closed;a++)e.next(n[a]);e.complete()},r}(fr),Pr=function(e){function r(){e.apply(this,arguments)}return t(r,e),r.prototype.notifyNext=function(e,t,r,n,i){this.destination.next(t)},r.prototype.notifyError=function(e,t){this.destination.error(e)},r.prototype.notifyComplete=function(e){this.destination.complete()},r}(hr),kr=v(rr),Ar=function(e){function r(t,r,n){e.call(this),this.parent=t,this.outerValue=r,this.outerIndex=n,this.index=0}return t(r,e),r.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},r.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},r}(hr),Rr={},Or=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new Ir(e,this.project))},e}(),Ir=function(e){function r(t,r){e.call(this,t),this.project=r,this.active=0,this.values=[],this.observables=[]}return t(r,e),r.prototype._next=function(e){this.values.push(Rr),this.observables.push(e)},r.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var r=0;r<t;r++){var n=e[r];this.add(y(this,n,n,r))}}},r.prototype.notifyComplete=function(e){0===(this.active-=1)&&this.destination.complete()},r.prototype.notifyNext=function(e,t,r,n,i){var o=this.values,a=o[r],s=this.toRespond?a===Rr?--this.toRespond:this.toRespond:0;o[r]=t,0===s&&(this.project?this._tryProject(o):this.destination.next(o.slice()))},r.prototype._tryProject=function(e){var t;try{t=this.project.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},r}(Pr);fr.combineLatest=b;var Dr=function(){function e(e){this.concurrent=e}return e.prototype.call=function(e,t){return t.subscribe(new Mr(e,this.concurrent))},e}(),Mr=function(e){function r(t,r){e.call(this,t),this.concurrent=r,this.hasCompleted=!1,this.buffer=[],this.active=0}return t(r,e),r.prototype._next=function(e){this.active<this.concurrent?(this.active++,this.add(y(this,e))):this.buffer.push(e)},r.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete()},r.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},r}(Pr),Lr=E;fr.concat=Lr;var jr=function(e){function r(t){e.call(this),this.observableFactory=t}return t(r,e),r.create=function(e){return new r(e)},r.prototype._subscribe=function(e){return new Fr(e,this.observableFactory)},r}(fr),Fr=function(e){function r(t,r){e.call(this,t),this.factory=r,this.tryDefer()}return t(r,e),r.prototype.tryDefer=function(){try{this._callFactory()}catch(e){this._error(e)}},r.prototype._callFactory=function(){var e=this.factory();e&&this.add(y(this,e))},r}(Pr),Br=jr.create;fr.defer=Br;var Vr=Cr.create;fr.empty=Vr;var Hr=function(e){function r(t,r){e.call(this),this.sources=t,this.resultSelector=r}return t(r,e),r.create=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];if(null===e||0===arguments.length)return new Cr;var n=null;return"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&ir(e[0])&&(e=e[0]),0===e.length?new Cr:new r(e,n)},r.prototype._subscribe=function(e){return new Wr(e,this.sources,this.resultSelector)},r}(fr),Wr=function(e){function r(t,r,n){e.call(this,t),this.sources=r,this.resultSelector=n,this.completed=0,this.haveValues=0;var i=r.length;this.total=i,this.values=new Array(i);for(var o=0;o<i;o++){var a=r[o],s=y(this,a,null,o);s&&(s.outerIndex=o,this.add(s))}}return t(r,e),r.prototype.notifyNext=function(e,t,r,n,i){this.values[r]=t,i._hasValue||(i._hasValue=!0,this.haveValues++)},r.prototype.notifyComplete=function(e){var t=this.destination,r=this,n=r.haveValues,i=r.resultSelector,o=r.values,a=o.length;if(!e._hasValue)return void t.complete();if(this.completed++,this.completed===a){if(n===a){var s=i?i.apply(this,o):o;t.next(s)}t.complete()}},r}(Pr),$r=Hr.create;fr.forkJoin=$r;var Ur=function(e){function r(t,r){e.call(this),this.promise=t,this.scheduler=r}return t(r,e),r.create=function(e,t){return new r(e,t)},r.prototype._subscribe=function(e){var t=this,r=this.promise,n=this.scheduler;if(null==n)this._isScalar?e.closed||(e.next(this.value),e.complete()):r.then(function(r){t.value=r,t._isScalar=!0,e.closed||(e.next(r),e.complete())},function(t){e.closed||e.error(t)}).then(null,function(e){rr.setTimeout(function(){throw e})});else if(this._isScalar){if(!e.closed)return n.schedule(x,0,{value:this.value,subscriber:e})}else r.then(function(r){t.value=r,t._isScalar=!0,e.closed||e.add(n.schedule(x,0,{value:r,subscriber:e}))},function(t){e.closed||e.add(n.schedule(S,0,{err:t,subscriber:e}))}).then(null,function(e){rr.setTimeout(function(){throw e})})},r}(fr),qr=function(e){function r(t,r){if(e.call(this),this.scheduler=r,null==t)throw new Error("iterator cannot be null.");this.iterator=N(t)}return t(r,e),r.create=function(e,t){return new r(e,t)},r.dispatch=function(e){var t=e.index,r=e.hasError,n=e.iterator,i=e.subscriber;if(r)return void i.error(e.error);var o=n.next();return o.done?void i.complete():(i.next(o.value),e.index=t+1,i.closed?void("function"==typeof n.return&&n.return()):void this.schedule(e))},r.prototype._subscribe=function(e){var t=0,n=this,i=n.iterator,o=n.scheduler;if(o)return o.schedule(r.dispatch,0,{index:t,iterator:i,subscriber:e});for(;;){var a=i.next();if(a.done){e.complete();break}if(e.next(a.value),e.closed){"function"==typeof i.return&&i.return();break}}},r}(fr),zr=function(){function e(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length),this.str=e,this.idx=t,this.len=r}return e.prototype[kr]=function(){return this},e.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.str.charAt(this.idx++)}:{done:!0,value:void 0}},e}(),Kr=function(){function e(e,t,r){void 0===t&&(t=0),void 0===r&&(r=C(e)),this.arr=e,this.idx=t,this.len=r}return e.prototype[kr]=function(){return this},e.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.arr[this.idx++]}:{done:!0,value:void 0}},e}(),Gr=Math.pow(2,53)-1,Qr=function(e){function r(t,r){e.call(this),this.arrayLike=t,this.scheduler=r,r||1!==t.length||(this._isScalar=!0,this.value=t[0])}return t(r,e),r.create=function(e,t){var n=e.length;return 0===n?new Cr:1===n?new Nr(e[0],t):new r(e,t)},r.dispatch=function(e){var t=e.arrayLike,r=e.index,n=e.length,i=e.subscriber;if(!i.closed){if(r>=n)return void i.complete();i.next(t[r]),e.index=r+1,this.schedule(e)}},r.prototype._subscribe=function(e){var t=0,n=this,i=n.arrayLike,o=n.scheduler,a=i.length;if(o)return o.schedule(r.dispatch,0,{arrayLike:i,index:t,length:a,subscriber:e});for(var s=0;s<a&&!e.closed;s++)e.next(i[s]);e.complete()},r}(fr),Xr=function(){function e(e,t,r){this.kind=e,this.value=t,this.error=r,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,r){var n=this.kind;switch(n){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return r&&r()}},e.prototype.accept=function(e,t,r){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,r)},e.prototype.toObservable=function(){var e=this.kind;switch(e){case"N":return fr.of(this.value);case"E":return fr.throw(this.error);case"C":return fr.empty()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return"undefined"!=typeof t?new e("N",t):this.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return this.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}(),Yr=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new Zr(e,this.scheduler,this.delay))},e}(),Zr=function(e){function r(t,r,n){void 0===n&&(n=0),e.call(this,t),this.scheduler=r,this.delay=n}return t(r,e),r.dispatch=function(e){var t=e.notification,r=e.destination;t.observe(r),this.unsubscribe()},r.prototype.scheduleMessage=function(e){this.add(this.scheduler.schedule(r.dispatch,this.delay,new Jr(e,this.destination)))},r.prototype._next=function(e){this.scheduleMessage(Xr.createNext(e))},r.prototype._error=function(e){this.scheduleMessage(Xr.createError(e))},r.prototype._complete=function(){this.scheduleMessage(Xr.createComplete())},r}(hr),Jr=function(){function e(e,t){this.notification=e,this.destination=t}return e}(),en=function(e){return e&&"number"==typeof e.length},tn=function(e){function r(t,r){e.call(this,null),this.ish=t,this.scheduler=r}return t(r,e),r.create=function(e,t){if(null!=e){if("function"==typeof e[pr])return e instanceof fr&&!t?e:new r(e,t);if(ir(e))return new Tr(e,t);if(m(e))return new Ur(e,t);if("function"==typeof e[kr]||"string"==typeof e)return new qr(e,t);if(en(e))return new Qr(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")},r.prototype._subscribe=function(e){var t=this.ish,r=this.scheduler;return null==r?t[pr]().subscribe(e):t[pr]().subscribe(new Zr(e,r,0))},r}(fr),rn=tn.create;fr.from=rn;var nn=Object.prototype.toString,on=function(e){function n(t,r,n,i){e.call(this),this.sourceObj=t,this.eventName=r,this.selector=n,this.options=i}return t(n,e),n.create=function(e,t,i,o){return r(i)&&(o=i,i=void 0),new n(e,t,o,i)},n.setupSubscription=function(e,t,r,i,o){var a;if(O(e)||I(e))for(var s=0,l=e.length;s<l;s++)n.setupSubscription(e[s],t,r,i,o);else if(D(e)){var u=e;e.addEventListener(t,r,o),a=function(){return u.removeEventListener(t,r)}}else if(R(e)){var c=e;e.on(t,r),a=function(){return c.off(t,r)}}else{if(!A(e))throw new TypeError("Invalid event target");var h=e;e.addListener(t,r),a=function(){return h.removeListener(t,r)}}i.add(new sr(a))},n.prototype._subscribe=function(e){var t=this.sourceObj,r=this.eventName,i=this.options,a=this.selector,s=a?function(){for(var t=[],r=0;r<arguments.length;r++)t[r-0]=arguments[r];var n=o(a).apply(void 0,t);n===or?e.error(or.e):e.next(n)}:function(t){return e.next(t)};n.setupSubscription(t,r,s,e,i)},n}(fr),an=on.create;fr.fromEvent=an;var sn=function(e){function n(t,r,n){e.call(this),this.addHandler=t,this.removeHandler=r,this.selector=n}return t(n,e),n.create=function(e,t,r){return new n(e,t,r)},n.prototype._subscribe=function(e){var t=this,n=this.removeHandler,i=this.selector?function(){for(var r=[],n=0;n<arguments.length;n++)r[n-0]=arguments[n];t._callSelector(e,r)}:function(t){e.next(t)},o=this._callAddHandler(i,e);r(n)&&e.add(new sr(function(){n(i,o)}))},n.prototype._callSelector=function(e,t){try{var r=this.selector.apply(this,t);e.next(r)}catch(t){e.error(t)}},n.prototype._callAddHandler=function(e,t){try{return this.addHandler(e)||null}catch(e){t.error(e)}},n}(fr),ln=sn.create;fr.fromEventPattern=ln;var un=Ur.create;fr.fromPromise=un;var cn=function(e){return e},hn=function(e){function r(t,r,n,i,o){e.call(this),this.initialState=t,this.condition=r,this.iterate=n,this.resultSelector=i,this.scheduler=o}return t(r,e),r.create=function(e,t,n,i,o){return 1==arguments.length?new r(e.initialState,e.condition,e.iterate,e.resultSelector||cn,e.scheduler):void 0===i||f(i)?new r(e,t,n,cn,i):new r(e,t,n,i,o)},r.prototype._subscribe=function(e){var t=this.initialState;if(this.scheduler)return this.scheduler.schedule(r.dispatch,0,{subscriber:e,iterate:this.iterate,condition:this.condition,resultSelector:this.resultSelector,state:t});for(var n=this,i=n.condition,o=n.resultSelector,a=n.iterate;;){if(i){var s=void 0;try{s=i(t)}catch(t){return void e.error(t)}if(!s){e.complete();break}}var l=void 0;try{l=o(t)}catch(t){return void e.error(t)}if(e.next(l),e.closed)break;try{t=a(t)}catch(t){return void e.error(t)}}},r.dispatch=function(e){var t=e.subscriber,r=e.condition;if(!t.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(e){return void t.error(e)}else e.needIterate=!0;if(r){var n=void 0;try{n=r(e.state)}catch(e){return void t.error(e)}if(!n)return void t.complete();if(t.closed)return}var i;try{i=e.resultSelector(e.state)}catch(e){return void t.error(e)}if(!t.closed&&(t.next(i),!t.closed))return this.schedule(e)}},r}(fr);fr.generate=hn.create;var dn=function(e){function r(t,r,n){e.call(this),this.condition=t,this.thenSource=r,this.elseSource=n}return t(r,e),r.create=function(e,t,n){return new r(e,t,n)},r.prototype._subscribe=function(e){var t=this,r=t.condition,n=t.thenSource,i=t.elseSource;return new pn(e,r,n,i)},r}(fr),pn=function(e){function r(t,r,n,i){e.call(this,t),this.condition=r,this.thenSource=n,this.elseSource=i,this.tryIf()}return t(r,e),r.prototype.tryIf=function(){var e,t=this,r=t.condition,n=t.thenSource,i=t.elseSource;try{e=r();var o=e?n:i;o?this.add(y(this,o)):this._complete()}catch(e){this._error(e)}},r}(Pr),fn=dn.create;fr.if=fn;var mn=function(e){function r(t,r){e.call(this)}return t(r,e),r.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},r}(sr),vn=function(e){function r(t,r){e.call(this,t,r),this.scheduler=t,this.work=r,this.pending=!1}return t(r,e),r.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e,this.pending=!0;var r=this.id,n=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(n,r,t)),this.delay=t,this.id=this.id||this.requestAsyncId(n,this.id,t),this},r.prototype.requestAsyncId=function(e,t,r){return void 0===r&&(r=0),rr.setInterval(e.flush.bind(e,this),r)},r.prototype.recycleAsyncId=function(e,t,r){return void 0===r&&(r=0),null!==r&&this.delay===r?t:rr.clearInterval(t)&&void 0||void 0},r.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(e,t);return r?r:void(this.pending===!1&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null)))},r.prototype._execute=function(e,t){var r=!1,n=void 0;try{this.work(e)}catch(e){r=!0,n=!!e&&e||new Error(e)}if(r)return this.unsubscribe(),n},r.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,r=t.actions,n=r.indexOf(this);this.work=null,this.delay=null,this.state=null,this.pending=!1,this.scheduler=null,n!==-1&&r.splice(n,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null))},r}(mn),yn=function(){function e(t,r){void 0===r&&(r=e.now),this.SchedulerAction=t,this.now=r}return e.prototype.schedule=function(e,t,r){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(r,t)},e.now=Date.now?Date.now:function(){return+new Date},e}(),gn=function(e){function r(){e.apply(this,arguments),this.actions=[],this.active=!1,this.scheduled=void 0}return t(r,e),r.prototype.flush=function(e){var t=this.actions;if(this.active)return void t.push(e);var r;this.active=!0;do if(r=e.execute(e.state,e.delay))break;while(e=t.shift());if(this.active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}},r}(yn),bn=new gn(vn),wn=function(e){function r(t,r){void 0===t&&(t=0),void 0===r&&(r=bn),e.call(this),this.period=t,this.scheduler=r,(!M(t)||t<0)&&(this.period=0),r&&"function"==typeof r.schedule||(this.scheduler=bn)}return t(r,e),r.create=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=bn),new r(e,t)},r.dispatch=function(e){var t=e.index,r=e.subscriber,n=e.period;r.next(t),r.closed||(e.index+=1,this.schedule(e,n))},r.prototype._subscribe=function(e){var t=0,n=this.period,i=this.scheduler;e.add(i.schedule(r.dispatch,n,{index:t,subscriber:e,period:n}))},r}(fr),_n=wn.create;fr.interval=_n;var En=j;fr.merge=En;var xn=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Sn(e))},e}(),Sn=function(e){function r(t){e.call(this,t),this.hasFirst=!1,this.observables=[],this.subscriptions=[]}return t(r,e),r.prototype._next=function(e){this.observables.push(e)},r.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{for(var r=0;r<t&&!this.hasFirst;r++){var n=e[r],i=y(this,n,n,r);this.subscriptions&&this.subscriptions.push(i),this.add(i)}this.observables=null}},r.prototype.notifyNext=function(e,t,r,n,i){if(!this.hasFirst){this.hasFirst=!0;for(var o=0;o<this.subscriptions.length;o++)if(o!==r){var a=this.subscriptions[o];a.unsubscribe(),this.remove(a)}this.subscriptions=null}this.destination.next(t)},r}(Pr);fr.race=B;var Nn=function(e){function r(){e.call(this)}return t(r,e),r.create=function(){return new r},r.prototype._subscribe=function(e){V()},r}(fr),Cn=Nn.create;fr.never=Cn;var Tn=Tr.of;fr.of=Tn;var Pn=function(){function e(e){this.nextSources=e}return e.prototype.call=function(e,t){return t.subscribe(new kn(e,this.nextSources))},e}(),kn=function(e){function r(t,r){e.call(this,t),this.destination=t,this.nextSources=r}return t(r,e),r.prototype.notifyError=function(e,t){this.subscribeToNextSource()},r.prototype.notifyComplete=function(e){this.subscribeToNextSource()},r.prototype._error=function(e){this.subscribeToNextSource()},r.prototype._complete=function(){this.subscribeToNextSource()},r.prototype.subscribeToNextSource=function(){var e=this.nextSources.shift();e?this.add(y(this,e)):this.destination.complete()},r}(Pr);fr.onErrorResumeNext=W;var An=function(e){function r(t,r){e.call(this),this.obj=t,this.scheduler=r,this.keys=Object.keys(t)}return t(r,e),r.create=function(e,t){return new r(e,t)},r.prototype._subscribe=function(e){var t=this,r=t.keys,n=t.scheduler,i=r.length;if(n)return n.schedule($,0,{obj:this.obj,keys:r,length:i,index:0,subscriber:e});for(var o=0;o<i;o++){var a=r[o];e.next([a,this.obj[a]])}e.complete()},r}(fr),Rn=An.create;fr.pairs=Rn;var On=function(e){function r(t,r,n){e.call(this),this.start=t,this._count=r,this.scheduler=n}return t(r,e),r.create=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=0),new r(e,t,n)},r.dispatch=function(e){var t=e.start,r=e.index,n=e.count,i=e.subscriber;return r>=n?void i.complete():(i.next(t),void(i.closed||(e.index=r+1,e.start=t+1,this.schedule(e))))},r.prototype._subscribe=function(e){var t=0,n=this.start,i=this._count,o=this.scheduler;if(o)return o.schedule(r.dispatch,0,{index:t,count:i,start:n,subscriber:e});for(;;){if(t++>=i){e.complete();break}if(e.next(n++),e.closed)break}},r}(fr),In=On.create;fr.range=In;var Dn=function(e){function r(t,r){e.call(this),this.resourceFactory=t,this.observableFactory=r}return t(r,e),r.create=function(e,t){return new r(e,t)},r.prototype._subscribe=function(e){var t,r=this,n=r.resourceFactory,i=r.observableFactory;try{return t=n(),new Mn(e,t,i)}catch(t){e.error(t)}},r}(fr),Mn=function(e){function r(t,r,n){e.call(this,t),this.resource=r,this.observableFactory=n,t.add(r),this.tryUse()}return t(r,e),r.prototype.tryUse=function(){try{var e=this.observableFactory.call(this,this.resource);e&&this.add(y(this,e))}catch(e){this._error(e)}},r}(Pr),Ln=Dn.create;fr.using=Ln;var jn=function(e){function r(t,r){e.call(this),this.error=t,this.scheduler=r}return t(r,e),r.create=function(e,t){return new r(e,t)},r.dispatch=function(e){var t=e.error,r=e.subscriber;r.error(t)},r.prototype._subscribe=function(e){var t=this.error,n=this.scheduler;return n?n.schedule(r.dispatch,0,{error:t,subscriber:e}):void e.error(t)},r}(fr),Fn=jn.create;fr.throw=Fn;var Bn=function(e){function r(t,r,n){void 0===t&&(t=0),e.call(this),this.period=-1,this.dueTime=0,M(r)?this.period=Number(r)<1&&1||Number(r):f(r)&&(n=r),f(n)||(n=bn),this.scheduler=n,this.dueTime=U(t)?+t-this.scheduler.now():t}return t(r,e),r.create=function(e,t,n){return void 0===e&&(e=0),new r(e,t,n)},r.dispatch=function(e){var t=e.index,r=e.period,n=e.subscriber,i=this;if(n.next(t),!n.closed){if(r===-1)return n.complete();e.index=t+1,i.schedule(e,r)}},r.prototype._subscribe=function(e){var t=0,n=this,i=n.period,o=n.dueTime,a=n.scheduler;return a.schedule(r.dispatch,o,{index:t,period:i,subscriber:e})},r}(fr),Vn=Bn.create;fr.timer=Vn;var Hn=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new Wn(e,this.project))},e}(),Wn=function(e){function r(t,r,n){void 0===n&&(n=Object.create(null)),e.call(this,t),this.iterators=[],this.active=0,this.project="function"==typeof r?r:null,this.values=n}return t(r,e),r.prototype._next=function(e){var t=this.iterators;ir(e)?t.push(new Un(e)):"function"==typeof e[kr]?t.push(new $n(e[kr]())):t.push(new qn(this.destination,this,e))},r.prototype._complete=function(){var e=this.iterators,t=e.length;this.active=t;for(var r=0;r<t;r++){var n=e[r];n.stillUnsubscribed?this.add(n.subscribe(n,r)):this.active--}},r.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},r.prototype.checkIterators=function(){for(var e=this.iterators,t=e.length,r=this.destination,n=0;n<t;n++){var i=e[n];if("function"==typeof i.hasValue&&!i.hasValue())return}for(var o=!1,a=[],n=0;n<t;n++){var i=e[n],s=i.next();if(i.hasCompleted()&&(o=!0),s.done)return void r.complete();a.push(s.value)}this.project?this._tryProject(a):r.next(a),o&&r.complete()},r.prototype._tryProject=function(e){var t;try{t=this.project.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},r}(hr),$n=function(){function e(e){this.iterator=e,this.nextResult=e.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e},e.prototype.hasCompleted=function(){var e=this.nextResult;return e&&e.done},e}(),Un=function(){function e(e){this.array=e,this.index=0,this.length=0,this.length=e.length}return e.prototype[kr]=function(){return this},e.prototype.next=function(e){var t=this.index++,r=this.array;return t<this.length?{value:r[t],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),qn=function(e){function r(t,r,n){e.call(this,t),this.parent=r,this.observable=n,this.stillUnsubscribed=!0,this.buffer=[],this.isComplete=!1}return t(r,e),r.prototype[kr]=function(){return this},r.prototype.next=function(){var e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}},r.prototype.hasValue=function(){return this.buffer.length>0},r.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},r.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},r.prototype.notifyNext=function(e,t,r,n,i){this.buffer.push(t),this.parent.checkIterators()},r.prototype.subscribe=function(e,t){return y(this,this.observable,this,t)},r}(Pr),zn=z;fr.zip=zn;var Kn=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new Gn(e,this.project,this.thisArg))},e}(),Gn=function(e){function r(t,r,n){e.call(this,t),this.project=r,this.count=0,this.thisArg=n||this}return t(r,e),r.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},r}(hr),Qn=function(e){function r(t){e.call(this);var r={async:!0,createXHR:function(){return this.crossDomain?G.call(this):Q()},crossDomain:!1,withCredentials:!1,headers:{},method:"GET",responseType:"json",timeout:0};if("string"==typeof t)r.url=t;else for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);this.request=r}return t(r,e),r.prototype._subscribe=function(e){return new Xn(e,this.request)},r.create=function(){var e=function(e){return new r(e)};return e.get=X,e.post=Y,e.delete=Z,e.put=J,e.getJSON=ee,e}(),r}(fr),Xn=function(e){function r(t,r){e.call(this,t),this.request=r,this.done=!1;var n=r.headers=r.headers||{};r.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest"),"Content-Type"in n||rr.FormData&&r.body instanceof rr.FormData||"undefined"==typeof r.body||(n["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"),r.body=this.serializeBody(r.body,r.headers["Content-Type"]),this.send()}return t(r,e),r.prototype.next=function(e){this.done=!0;var t=this,r=t.xhr,n=t.request,i=t.destination,o=new Yn(e,r,n);i.next(o)},r.prototype.send=function(){var e=this,t=e.request,r=e.request,n=r.user,i=r.method,a=r.url,s=r.async,l=r.password,u=r.headers,c=r.body,h=t.createXHR,d=o(h).call(t);if(d===or)this.error(or.e);else{this.xhr=d,this.setupEvents(d,t);var p=void 0;if(p=n?o(d.open).call(d,i,a,s,n,l):o(d.open).call(d,i,a,s),p===or)return this.error(or.e),null;if(d.timeout=t.timeout,d.responseType=t.responseType,this.setHeaders(d,u),p=c?o(d.send).call(d,c):o(d.send).call(d),p===or)return this.error(or.e),null}return d},r.prototype.serializeBody=function(e,t){if(!e||"string"==typeof e)return e;if(rr.FormData&&e instanceof rr.FormData)return e;if(t){var r=t.indexOf(";");r!==-1&&(t=t.substring(0,r))}switch(t){case"application/x-www-form-urlencoded":return Object.keys(e).map(function(t){return encodeURI(t)+"="+encodeURI(e[t])}).join("&");case"application/json":return JSON.stringify(e);default:return e}},r.prototype.setHeaders=function(e,t){for(var r in t)t.hasOwnProperty(r)&&e.setRequestHeader(r,t[r])},r.prototype.setupEvents=function(e,t){function r(e){var t=r,n=t.subscriber,i=t.progressSubscriber,o=t.request;i&&i.error(e),n.error(new Jn(this,o))}function n(e){var t=n,r=t.subscriber,i=t.progressSubscriber,o=t.request;if(4===this.readyState){var a=1223===this.status?204:this.status,s="text"===this.responseType?this.response||this.responseText:this.response;0===a&&(a=s?200:0),200<=a&&a<300?(i&&i.complete(),r.next(e),r.complete()):(i&&i.error(e),r.error(new Zn("ajax error "+a,this,o)))}}var i=t.progressSubscriber;if(e.ontimeout=r,r.request=t,r.subscriber=this,r.progressSubscriber=i,e.upload&&"withCredentials"in e){if(i){var o;o=function(e){var t=o.progressSubscriber;t.next(e)},rr.XDomainRequest?e.onprogress=o:e.upload.onprogress=o,o.progressSubscriber=i}var a;a=function(e){var t=a,r=t.progressSubscriber,n=t.subscriber,i=t.request;r&&r.error(e),n.error(new Zn("ajax error",this,i))},e.onerror=a,a.request=t,a.subscriber=this,a.progressSubscriber=i}e.onreadystatechange=n,n.subscriber=this,n.progressSubscriber=i,n.request=t},r.prototype.unsubscribe=function(){var t=this,r=t.done,n=t.xhr;!r&&n&&4!==n.readyState&&"function"==typeof n.abort&&n.abort(),e.prototype.unsubscribe.call(this)},r}(hr),Yn=function(){function e(e,t,r){switch(this.originalEvent=e,this.xhr=t,this.request=r,this.status=t.status,this.responseType=t.responseType||r.responseType,this.responseType){case"json":"response"in t?this.response=t.responseType?t.response:JSON.parse(t.response||t.responseText||"null"):this.response=JSON.parse(t.responseText||"null");break;case"xml":this.response=t.responseXML;break;case"text":default:this.response="response"in t?t.response:t.responseText}}return e}(),Zn=function(e){function r(t,r,n){e.call(this,t),this.message=t,this.xhr=r,this.request=n,this.status=r.status}return t(r,e),r}(Error),Jn=function(e){function r(t,r){e.call(this,"ajax timeout",t,r)}return t(r,e),r}(Zn),ei=Qn.create;fr.ajax=ei;var ti=function(e){function r(t,r){e.call(this,t,r),this.scheduler=t,this.work=r}return t(r,e),r.prototype.schedule=function(t,r){return void 0===r&&(r=0),r>0?e.prototype.schedule.call(this,t,r):(this.delay=r,this.state=t,this.scheduler.flush(this),this)},r.prototype.execute=function(t,r){return r>0||this.closed?e.prototype.execute.call(this,t,r):this._execute(t,r)},r.prototype.requestAsyncId=function(t,r,n){return void 0===n&&(n=0),null!==n&&n>0||null===n&&this.delay>0?e.prototype.requestAsyncId.call(this,t,r,n):t.flush(this)},r}(vn),ri=function(e){function r(){e.apply(this,arguments)}return t(r,e),r}(gn),ni=new ri(ti),ii=function(e){function r(t,r,n){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===r&&(r=Number.POSITIVE_INFINITY),e.call(this),this.scheduler=n,this._events=[],this._bufferSize=t<1?1:t,this._windowTime=r<1?1:r}return t(r,e),r.prototype.next=function(t){
var r=this._getNow();this._events.push(new oi(r,t)),this._trimBufferThenGetEvents(),e.prototype.next.call(this,t)},r.prototype._subscribe=function(e){var t,r=this._trimBufferThenGetEvents(),n=this.scheduler;if(this.closed)throw new mr;this.hasError?t=sr.EMPTY:this.isStopped?t=sr.EMPTY:(this.observers.push(e),t=new vr(this,e)),n&&e.add(e=new Zr(e,n));for(var i=r.length,o=0;o<i&&!e.closed;o++)e.next(r[o].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),t},r.prototype._getNow=function(){return(this.scheduler||ni).now()},r.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,r=this._windowTime,n=this._events,i=n.length,o=0;o<i&&!(e-n[o].time<r);)o++;return i>t&&(o=Math.max(o,i-t)),o>0&&n.splice(0,o),n},r}(gr),oi=function(){function e(e,t){this.time=e,this.value=t}return e}(),ai=re(rr),si=function(e){function r(t,r){if(t instanceof fr)e.call(this,r,t);else{if(e.call(this),this.WebSocketCtor=rr.WebSocket,this._output=new gr,"string"==typeof t?this.url=t:ai(this,t),!this.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new ii}}return t(r,e),r.prototype.resultSelector=function(e){return JSON.parse(e.data)},r.create=function(e){return new r(e)},r.prototype.lift=function(e){var t=new r(this,this.destination);return t.operator=e,t},r.prototype._resetState=function(){this.socket=null,this.source||(this.destination=new ii),this._output=new gr},r.prototype.multiplex=function(e,t,r){var n=this;return new fr(function(i){var a=o(e)();a===or?i.error(or.e):n.next(a);var s=n.subscribe(function(e){var t=o(r)(e);t===or?i.error(or.e):t&&i.next(e)},function(e){return i.error(e)},function(){return i.complete()});return function(){var e=o(t)();e===or?i.error(or.e):n.next(e),s.unsubscribe()}})},r.prototype._connectSocket=function(){var e=this,t=this.WebSocketCtor,r=this._output,n=null;try{n=this.protocol?new t(this.url,this.protocol):new t(this.url),this.socket=n}catch(e){return void r.error(e)}var i=new sr(function(){e.socket=null,n&&1===n.readyState&&n.close()});n.onopen=function(t){var o=e.openObserver;o&&o.next(t);var a=e.destination;e.destination=hr.create(function(e){return 1===n.readyState&&n.send(e)},function(t){var i=e.closingObserver;i&&i.next(void 0),t&&t.code?n.close(t.code,t.reason):r.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),e._resetState()},function(){var t=e.closingObserver;t&&t.next(void 0),n.close(),e._resetState()}),a&&a instanceof ii&&i.add(a.subscribe(e.destination))},n.onerror=function(t){e._resetState(),r.error(t)},n.onclose=function(t){e._resetState();var n=e.closeObserver;n&&n.next(t),t.wasClean?r.complete():r.error(t)},n.onmessage=function(t){var n=o(e.resultSelector)(t);n===or?r.error(or.e):r.next(n)}},r.prototype._subscribe=function(e){var t=this,r=this.source;if(r)return r.subscribe(e);this.socket||this._connectSocket();var n=new sr;return n.add(this._output.subscribe(e)),n.add(function(){var e=t.socket;0===t._output.observers.length&&(e&&1===e.readyState&&e.close(),t._resetState())}),n},r.prototype.unsubscribe=function(){var t=this,r=t.source,n=t.socket;n&&1===n.readyState&&(n.close(),this._resetState()),e.prototype.unsubscribe.call(this),r||(this.destination=new ii)},r}(br),li=si.create;fr.webSocket=li;var ui=function(){function e(e){this.closingNotifier=e}return e.prototype.call=function(e,t){return t.subscribe(new ci(e,this.closingNotifier))},e}(),ci=function(e){function r(t,r){e.call(this,t),this.buffer=[],this.add(y(this,r))}return t(r,e),r.prototype._next=function(e){this.buffer.push(e)},r.prototype.notifyNext=function(e,t,r,n,i){var o=this.buffer;this.buffer=[],this.destination.next(o)},r}(Pr);fr.prototype.buffer=ne;var hi=function(){function e(e,t){this.bufferSize=e,this.startBufferEvery=t}return e.prototype.call=function(e,t){return t.subscribe(new di(e,this.bufferSize,this.startBufferEvery))},e}(),di=function(e){function r(t,r,n){e.call(this,t),this.bufferSize=r,this.startBufferEvery=n,this.buffers=[],this.count=0}return t(r,e),r.prototype._next=function(e){var t=this.count++,r=this,n=r.destination,i=r.bufferSize,o=r.startBufferEvery,a=r.buffers,s=null==o?i:o;t%s===0&&a.push([]);for(var l=a.length;l--;){var u=a[l];u.push(e),u.length===i&&(a.splice(l,1),n.next(u))}},r.prototype._complete=function(){for(var t=this.destination,r=this.buffers;r.length>0;){var n=r.shift();n.length>0&&t.next(n)}e.prototype._complete.call(this)},r}(hr);fr.prototype.bufferCount=ie;var pi=function(){function e(e,t,r,n){this.bufferTimeSpan=e,this.bufferCreationInterval=t,this.maxBufferSize=r,this.scheduler=n}return e.prototype.call=function(e,t){return t.subscribe(new mi(e,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},e}(),fi=function(){function e(){this.buffer=[]}return e}(),mi=function(e){function r(t,r,n,i,o){e.call(this,t),this.bufferTimeSpan=r,this.bufferCreationInterval=n,this.maxBufferSize=i,this.scheduler=o,this.contexts=[];var a=this.openContext();if(this.timespanOnly=null==n||n<0,this.timespanOnly){var s={subscriber:this,context:a,bufferTimeSpan:r};this.add(a.closeAction=o.schedule(ae,r,s))}else{var l={subscriber:this,context:a},u={bufferTimeSpan:r,bufferCreationInterval:n,subscriber:this,scheduler:o};this.add(a.closeAction=o.schedule(le,r,l)),this.add(o.schedule(se,n,u))}}return t(r,e),r.prototype._next=function(e){for(var t,r=this.contexts,n=r.length,i=0;i<n;i++){var o=r[i],a=o.buffer;a.push(e),a.length==this.maxBufferSize&&(t=o)}t&&this.onBufferFull(t)},r.prototype._error=function(t){this.contexts.length=0,e.prototype._error.call(this,t)},r.prototype._complete=function(){for(var t=this,r=t.contexts,n=t.destination;r.length>0;){var i=r.shift();n.next(i.buffer)}e.prototype._complete.call(this)},r.prototype._unsubscribe=function(){this.contexts=null},r.prototype.onBufferFull=function(e){this.closeContext(e);var t=e.closeAction;if(t.unsubscribe(),this.remove(t),!this.closed&&this.timespanOnly){e=this.openContext();var r=this.bufferTimeSpan,n={subscriber:this,context:e,bufferTimeSpan:r};this.add(e.closeAction=this.scheduler.schedule(ae,r,n))}},r.prototype.openContext=function(){var e=new fi;return this.contexts.push(e),e},r.prototype.closeContext=function(e){this.destination.next(e.buffer);var t=this.contexts,r=t?t.indexOf(e):-1;r>=0&&t.splice(t.indexOf(e),1)},r}(hr);fr.prototype.bufferTime=oe;var vi=function(){function e(e,t){this.openings=e,this.closingSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new yi(e,this.openings,this.closingSelector))},e}(),yi=function(e){function r(t,r,n){e.call(this,t),this.openings=r,this.closingSelector=n,this.contexts=[],this.add(y(this,r))}return t(r,e),r.prototype._next=function(e){for(var t=this.contexts,r=t.length,n=0;n<r;n++)t[n].buffer.push(e)},r.prototype._error=function(t){for(var r=this.contexts;r.length>0;){var n=r.shift();n.subscription.unsubscribe(),n.buffer=null,n.subscription=null}this.contexts=null,e.prototype._error.call(this,t)},r.prototype._complete=function(){for(var t=this.contexts;t.length>0;){var r=t.shift();this.destination.next(r.buffer),r.subscription.unsubscribe(),r.buffer=null,r.subscription=null}this.contexts=null,e.prototype._complete.call(this)},r.prototype.notifyNext=function(e,t,r,n,i){e?this.closeBuffer(e):this.openBuffer(t)},r.prototype.notifyComplete=function(e){this.closeBuffer(e.context)},r.prototype.openBuffer=function(e){try{var t=this.closingSelector,r=t.call(this,e);r&&this.trySubscribe(r)}catch(e){this._error(e)}},r.prototype.closeBuffer=function(e){var t=this.contexts;if(t&&e){var r=e.buffer,n=e.subscription;this.destination.next(r),t.splice(t.indexOf(e),1),this.remove(n),n.unsubscribe()}},r.prototype.trySubscribe=function(e){var t=this.contexts,r=[],n=new sr,i={buffer:r,subscription:n};t.push(i);var o=y(this,e,i);!o||o.closed?this.closeBuffer(i):(o.context=i,this.add(o),n.add(o))},r}(Pr);fr.prototype.bufferToggle=ue;var gi=function(){function e(e){this.closingSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new bi(e,this.closingSelector))},e}(),bi=function(e){function r(t,r){e.call(this,t),this.closingSelector=r,this.subscribing=!1,this.openBuffer()}return t(r,e),r.prototype._next=function(e){this.buffer.push(e)},r.prototype._complete=function(){var t=this.buffer;t&&this.destination.next(t),e.prototype._complete.call(this)},r.prototype._unsubscribe=function(){this.buffer=null,this.subscribing=!1},r.prototype.notifyNext=function(e,t,r,n,i){this.openBuffer()},r.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},r.prototype.openBuffer=function(){var e=this.closingSubscription;e&&(this.remove(e),e.unsubscribe());var t=this.buffer;this.buffer&&this.destination.next(t),this.buffer=[];var r=o(this.closingSelector)();r===or?this.error(or.e):(e=new sr,this.closingSubscription=e,this.add(e),this.subscribing=!0,e.add(y(this,r)),this.subscribing=!1)},r}(Pr);fr.prototype.bufferWhen=ce;var wi=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new _i(e,this.selector,this.caught))},e}(),_i=function(e){function r(t,r,n){e.call(this,t),this.selector=r,this.caught=n}return t(r,e),r.prototype.error=function(t){if(!this.isStopped){var r=void 0;try{r=this.selector(t,this.caught)}catch(t){return void e.prototype.error.call(this,t)}this._unsubscribeAndRecycle(),this.add(y(this,r))}},r}(Pr);fr.prototype.catch=he,fr.prototype._catch=he,fr.prototype.combineAll=de,fr.prototype.combineLatest=g,fr.prototype.concat=_,fr.prototype.concatAll=pe;var Ei=function(){function e(e,t,r){void 0===r&&(r=Number.POSITIVE_INFINITY),this.project=e,this.resultSelector=t,this.concurrent=r}return e.prototype.call=function(e,t){return t.subscribe(new xi(e,this.project,this.resultSelector,this.concurrent))},e}(),xi=function(e){function r(t,r,n,i){void 0===i&&(i=Number.POSITIVE_INFINITY),e.call(this,t),this.project=r,this.resultSelector=n,this.concurrent=i,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}return t(r,e),r.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},r.prototype._tryNext=function(e){var t,r=this.index++;try{t=this.project(e,r)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(t,e,r)},r.prototype._innerSub=function(e,t,r){this.add(y(this,e,t,r))},r.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete()},r.prototype.notifyNext=function(e,t,r,n,i){this.resultSelector?this._notifyResultSelector(e,t,r,n):this.destination.next(t)},r.prototype._notifyResultSelector=function(e,t,r,n){var i;try{i=this.resultSelector(e,t,r,n)}catch(e){return void this.destination.error(e)}this.destination.next(i)},r.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},r}(Pr);fr.prototype.concatMap=me;var Si=function(){function e(e,t,r){void 0===r&&(r=Number.POSITIVE_INFINITY),this.ish=e,this.resultSelector=t,this.concurrent=r}return e.prototype.call=function(e,t){return t.subscribe(new Ni(e,this.ish,this.resultSelector,this.concurrent))},e}(),Ni=function(e){function r(t,r,n,i){void 0===i&&(i=Number.POSITIVE_INFINITY),e.call(this,t),this.ish=r,this.resultSelector=n,this.concurrent=i,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}return t(r,e),r.prototype._next=function(e){if(this.active<this.concurrent){var t=this.resultSelector,r=this.index++,n=this.ish,i=this.destination;this.active++,this._innerSub(n,i,t,e,r)}else this.buffer.push(e)},r.prototype._innerSub=function(e,t,r,n,i){this.add(y(this,e,n,i))},r.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete()},r.prototype.notifyNext=function(e,t,r,n,i){var o=this,a=o.resultSelector,s=o.destination;a?this.trySelectResult(e,t,r,n):s.next(t)},r.prototype.trySelectResult=function(e,t,r,n){var i,o=this,a=o.resultSelector,s=o.destination;try{i=a(e,t,r,n)}catch(e){return void s.error(e)}s.next(i)},r.prototype.notifyError=function(e){this.destination.error(e)},r.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},r}(Pr);fr.prototype.concatMapTo=ye;var Ci=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Ti(e,this.predicate,this.source))},e}(),Ti=function(e){function r(t,r,n){e.call(this,t),this.predicate=r,this.source=n,this.count=0,this.index=0}return t(r,e),r.prototype._next=function(e){this.predicate?this._tryPredicate(e):this.count++},r.prototype._tryPredicate=function(e){var t;try{t=this.predicate(e,this.index++,this.source)}catch(e){return void this.destination.error(e)}t&&this.count++},r.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()},r}(hr);fr.prototype.count=ge;var Pi=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new ki(e))},e}(),ki=function(e){function r(t){e.call(this,t)}return t(r,e),r.prototype._next=function(e){e.observe(this.destination)},r}(hr);fr.prototype.dematerialize=be;var Ai=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new Ri(e,this.durationSelector))},e}(),Ri=function(e){function r(t,r){e.call(this,t),this.durationSelector=r,this.hasValue=!1,this.durationSubscription=null}return t(r,e),r.prototype._next=function(e){try{var t=this.durationSelector.call(this,e);t&&this._tryNext(e,t)}catch(e){this.destination.error(e)}},r.prototype._complete=function(){this.emitValue(),this.destination.complete()},r.prototype._tryNext=function(e,t){var r=this.durationSubscription;this.value=e,this.hasValue=!0,r&&(r.unsubscribe(),this.remove(r)),r=y(this,t),r.closed||this.add(this.durationSubscription=r)},r.prototype.notifyNext=function(e,t,r,n,i){this.emitValue()},r.prototype.notifyComplete=function(){this.emitValue()},r.prototype.emitValue=function(){if(this.hasValue){var t=this.value,r=this.durationSubscription;r&&(this.durationSubscription=null,r.unsubscribe(),this.remove(r)),this.value=null,this.hasValue=!1,e.prototype._next.call(this,t)}},r}(Pr);fr.prototype.debounce=we;var Oi=function(){function e(e,t){this.dueTime=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new Ii(e,this.dueTime,this.scheduler))},e}(),Ii=function(e){function r(t,r,n){e.call(this,t),this.dueTime=r,this.scheduler=n,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}return t(r,e),r.prototype._next=function(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(Ee,this.dueTime,this))},r.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},r.prototype.debouncedNext=function(){this.clearDebounce(),this.hasValue&&(this.destination.next(this.lastValue),this.lastValue=null,this.hasValue=!1)},r.prototype.clearDebounce=function(){var e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)},r}(hr);fr.prototype.debounceTime=_e;var Di=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new Mi(e,this.defaultValue))},e}(),Mi=function(e){function r(t,r){e.call(this,t),this.defaultValue=r,this.isEmpty=!0}return t(r,e),r.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},r.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},r}(hr);fr.prototype.defaultIfEmpty=xe;var Li=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new ji(e,this.delay,this.scheduler))},e}(),ji=function(e){function r(t,r,n){e.call(this,t),this.delay=r,this.scheduler=n,this.queue=[],this.active=!1,this.errored=!1}return t(r,e),r.dispatch=function(e){for(var t=e.source,r=t.queue,n=e.scheduler,i=e.destination;r.length>0&&r[0].time-n.now()<=0;)r.shift().notification.observe(i);if(r.length>0){var o=Math.max(0,r[0].time-n.now());this.schedule(e,o)}else t.active=!1},r.prototype._schedule=function(e){this.active=!0,this.add(e.schedule(r.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},r.prototype.scheduleNotification=function(e){if(this.errored!==!0){var t=this.scheduler,r=new Fi(t.now()+this.delay,e);this.queue.push(r),this.active===!1&&this._schedule(t)}},r.prototype._next=function(e){this.scheduleNotification(Xr.createNext(e))},r.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e)},r.prototype._complete=function(){this.scheduleNotification(Xr.createComplete())},r}(hr),Fi=function(){function e(e,t){this.time=e,this.notification=t}return e}();fr.prototype.delay=Se;var Bi=function(){function e(e){this.delayDurationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new Vi(e,this.delayDurationSelector))},e}(),Vi=function(e){function r(t,r){e.call(this,t),this.delayDurationSelector=r,this.completed=!1,this.delayNotifierSubscriptions=[],this.values=[]}return t(r,e),r.prototype.notifyNext=function(e,t,r,n,i){this.destination.next(e),this.removeSubscription(i),this.tryComplete()},r.prototype.notifyError=function(e,t){this._error(e)},r.prototype.notifyComplete=function(e){var t=this.removeSubscription(e);t&&this.destination.next(t),this.tryComplete()},r.prototype._next=function(e){try{var t=this.delayDurationSelector(e);t&&this.tryDelay(t,e)}catch(e){this.destination.error(e)}},r.prototype._complete=function(){this.completed=!0,this.tryComplete()},r.prototype.removeSubscription=function(e){e.unsubscribe();var t=this.delayNotifierSubscriptions.indexOf(e),r=null;return t!==-1&&(r=this.values[t],this.delayNotifierSubscriptions.splice(t,1),this.values.splice(t,1)),r},r.prototype.tryDelay=function(e,t){var r=y(this,e,t);this.add(r),this.delayNotifierSubscriptions.push(r),this.values.push(t)},r.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},r}(Pr),Hi=function(e){function r(t,r){e.call(this),this.source=t,this.subscriptionDelay=r}return t(r,e),r.prototype._subscribe=function(e){this.subscriptionDelay.subscribe(new Wi(e,this.source))},r}(fr),Wi=function(e){function r(t,r){e.call(this),this.parent=t,this.source=r,this.sourceSubscribed=!1}return t(r,e),r.prototype._next=function(e){this.subscribeToSource()},r.prototype._error=function(e){this.unsubscribe(),this.parent.error(e)},r.prototype._complete=function(){this.subscribeToSource()},r.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},r}(hr);fr.prototype.delayWhen=Ne;var $i=rr.Set||Ce(),Ui=function(){function e(e,t){this.keySelector=e,this.flushes=t}return e.prototype.call=function(e,t){return t.subscribe(new qi(e,this.keySelector,this.flushes))},e}(),qi=function(e){function r(t,r,n){e.call(this,t),this.keySelector=r,this.values=new $i,n&&this.add(y(this,n))}return t(r,e),r.prototype.notifyNext=function(e,t,r,n,i){this.values.clear()},r.prototype.notifyError=function(e,t){this._error(e)},r.prototype._next=function(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)},r.prototype._useKeySelector=function(e){var t,r=this.destination;try{t=this.keySelector(e)}catch(e){return void r.error(e)}this._finalizeNext(t,e)},r.prototype._finalizeNext=function(e,t){var r=this.values;r.has(e)||(r.add(e),this.destination.next(t))},r}(Pr);fr.prototype.distinct=Te;var zi=function(){function e(e,t){this.compare=e,this.keySelector=t}return e.prototype.call=function(e,t){return t.subscribe(new Ki(e,this.compare,this.keySelector))},e}(),Ki=function(e){function r(t,r,n){e.call(this,t),this.keySelector=n,this.hasKey=!1,"function"==typeof r&&(this.compare=r)}return t(r,e),r.prototype.compare=function(e,t){return e===t},r.prototype._next=function(e){var t=this.keySelector,r=e;if(t&&(r=o(this.keySelector)(e),r===or))return this.destination.error(or.e);var n=!1;if(this.hasKey){if(n=o(this.compare)(this.key,r),n===or)return this.destination.error(or.e)}else this.hasKey=!0;Boolean(n)===!1&&(this.key=r,this.destination.next(e))},r}(hr);fr.prototype.distinctUntilChanged=Pe,fr.prototype.distinctUntilKeyChanged=ke;var Gi=function(){function e(e,t,r){this.nextOrObserver=e,this.error=t,this.complete=r}return e.prototype.call=function(e,t){return t.subscribe(new Qi(e,this.nextOrObserver,this.error,this.complete))},e}(),Qi=function(e){function r(t,r,n,i){e.call(this,t);var o=new hr(r,n,i);o.syncErrorThrowable=!0,this.add(o),this.safeSubscriber=o}return t(r,e),r.prototype._next=function(e){var t=this.safeSubscriber;t.next(e),t.syncErrorThrown?this.destination.error(t.syncErrorValue):this.destination.next(e)},r.prototype._error=function(e){var t=this.safeSubscriber;t.error(e),t.syncErrorThrown?this.destination.error(t.syncErrorValue):this.destination.error(e)},r.prototype._complete=function(){var e=this.safeSubscriber;e.complete(),e.syncErrorThrown?this.destination.error(e.syncErrorValue):this.destination.complete()},r}(hr);fr.prototype.do=Ae,fr.prototype._do=Ae;var Xi=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Yi(e))},e}(),Yi=function(e){function r(t){e.call(this,t),this.hasCompleted=!1,this.hasSubscription=!1}return t(r,e),r.prototype._next=function(e){this.hasSubscription||(this.hasSubscription=!0,this.add(y(this,e)))},r.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},r.prototype.notifyComplete=function(e){this.remove(e),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},r}(Pr);fr.prototype.exhaust=Re;var Zi=function(){function e(e,t){this.project=e,this.resultSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new Ji(e,this.project,this.resultSelector))},e}(),Ji=function(e){function r(t,r,n){e.call(this,t),this.project=r,this.resultSelector=n,this.hasSubscription=!1,this.hasCompleted=!1,this.index=0}return t(r,e),r.prototype._next=function(e){this.hasSubscription||this.tryNext(e)},r.prototype.tryNext=function(e){var t=this.index++,r=this.destination;try{var n=this.project(e,t);this.hasSubscription=!0,this.add(y(this,n,e,t))}catch(e){r.error(e)}},r.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},r.prototype.notifyNext=function(e,t,r,n,i){var o=this,a=o.resultSelector,s=o.destination;a?this.trySelectResult(e,t,r,n):s.next(t)},r.prototype.trySelectResult=function(e,t,r,n){var i=this,o=i.resultSelector,a=i.destination;try{var s=o(e,t,r,n);a.next(s)}catch(e){a.error(e)}},r.prototype.notifyError=function(e){this.destination.error(e)},r.prototype.notifyComplete=function(e){this.remove(e),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},r}(Pr);fr.prototype.exhaustMap=Oe;var eo=function(){function e(e,t,r){this.project=e,this.concurrent=t,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new to(e,this.project,this.concurrent,this.scheduler))},e}(),to=function(e){function r(t,r,n,i){e.call(this,t),this.project=r,this.concurrent=n,this.scheduler=i,this.index=0,this.active=0,this.hasCompleted=!1,n<Number.POSITIVE_INFINITY&&(this.buffer=[])}return t(r,e),r.dispatch=function(e){var t=e.subscriber,r=e.result,n=e.value,i=e.index;t.subscribeToProjection(r,n,i)},r.prototype._next=function(e){var t=this.destination;if(t.closed)return void this._complete();var n=this.index++;if(this.active<this.concurrent){t.next(e);var i=o(this.project)(e,n);if(i===or)t.error(or.e);else if(this.scheduler){var a={subscriber:this,result:i,value:e,index:n};this.add(this.scheduler.schedule(r.dispatch,0,a))}else this.subscribeToProjection(i,e,n)}else this.buffer.push(e)},r.prototype.subscribeToProjection=function(e,t,r){this.active++,this.add(y(this,e,t,r))},r.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete()},r.prototype.notifyNext=function(e,t,r,n,i){this._next(t)},r.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t&&t.length>0&&this._next(t.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},r}(Pr);fr.prototype.expand=Ie;var ro=function(e){function r(){var t=e.call(this,"argument out of range");this.name=t.name="ArgumentOutOfRangeError",this.stack=t.stack,this.message=t.message}return t(r,e),r}(Error),no=function(){function e(e,t){if(this.index=e,this.defaultValue=t,e<0)throw new ro}return e.prototype.call=function(e,t){return t.subscribe(new io(e,this.index,this.defaultValue))},e}(),io=function(e){function r(t,r,n){e.call(this,t),this.index=r,this.defaultValue=n}return t(r,e),r.prototype._next=function(e){0===this.index--&&(this.destination.next(e),this.destination.complete())},r.prototype._complete=function(){var e=this.destination;this.index>=0&&("undefined"!=typeof this.defaultValue?e.next(this.defaultValue):e.error(new ro)),e.complete()},r}(hr);fr.prototype.elementAt=De;var oo=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new ao(e,this.predicate,this.thisArg))},e}(),ao=function(e){function r(t,r,n){e.call(this,t),this.predicate=r,this.thisArg=n,this.count=0,this.predicate=r}return t(r,e),r.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},r}(hr);fr.prototype.filter=Me;var so=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new lo(e,this.callback))},e}(),lo=function(e){function r(t,r){e.call(this,t),this.add(new sr(r))}return t(r,e),r}(hr);fr.prototype.finally=Le,fr.prototype._finally=Le;var uo=function(){function e(e,t,r,n){this.predicate=e,this.source=t,this.yieldIndex=r,this.thisArg=n}return e.prototype.call=function(e,t){return t.subscribe(new co(e,this.predicate,this.source,this.yieldIndex,this.thisArg))},e}(),co=function(e){function r(t,r,n,i,o){e.call(this,t),this.predicate=r,this.source=n,this.yieldIndex=i,this.thisArg=o,this.index=0}return t(r,e),r.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete()},r.prototype._next=function(e){var t=this,r=t.predicate,n=t.thisArg,i=this.index++;try{var o=r.call(n||this,e,i,this.source);o&&this.notifyComplete(this.yieldIndex?i:e)}catch(e){this.destination.error(e)}},r.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)},r}(hr);fr.prototype.find=je,fr.prototype.findIndex=Fe;var ho=function(e){function r(){var t=e.call(this,"no elements in sequence");this.name=t.name="EmptyError",this.stack=t.stack,this.message=t.message}return t(r,e),r}(Error),po=function(){function e(e,t,r,n){this.predicate=e,this.resultSelector=t,this.defaultValue=r,this.source=n}return e.prototype.call=function(e,t){return t.subscribe(new fo(e,this.predicate,this.resultSelector,this.defaultValue,this.source))},e}(),fo=function(e){function r(t,r,n,i,o){e.call(this,t),this.predicate=r,this.resultSelector=n,this.defaultValue=i,this.source=o,this.index=0,this.hasCompleted=!1,this._emitted=!1}return t(r,e),r.prototype._next=function(e){var t=this.index++;this.predicate?this._tryPredicate(e,t):this._emit(e,t)},r.prototype._tryPredicate=function(e,t){var r;try{r=this.predicate(e,t,this.source)}catch(e){return void this.destination.error(e)}r&&this._emit(e,t)},r.prototype._emit=function(e,t){return this.resultSelector?void this._tryResultSelector(e,t):void this._emitFinal(e)},r.prototype._tryResultSelector=function(e,t){var r;try{r=this.resultSelector(e,t)}catch(e){return void this.destination.error(e)}this._emitFinal(r)},r.prototype._emitFinal=function(e){var t=this.destination;this._emitted||(this._emitted=!0,t.next(e),t.complete(),this.hasCompleted=!0)},r.prototype._complete=function(){var e=this.destination;this.hasCompleted||"undefined"==typeof this.defaultValue?this.hasCompleted||e.error(new ho):(e.next(this.defaultValue),e.complete())},r}(hr);fr.prototype.first=Be;var mo=function(){function e(){this.size=0,this._values=[],this._keys=[]}return e.prototype.get=function(e){var t=this._keys.indexOf(e);return t===-1?void 0:this._values[t]},e.prototype.set=function(e,t){var r=this._keys.indexOf(e);return r===-1?(this._keys.push(e),this._values.push(t),this.size++):this._values[r]=t,this},e.prototype.delete=function(e){var t=this._keys.indexOf(e);return t!==-1&&(this._values.splice(t,1),this._keys.splice(t,1),this.size--,!0)},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this.size=0},e.prototype.forEach=function(e,t){for(var r=0;r<this.size;r++)e.call(t,this._values[r],this._keys[r])},e}(),vo=rr.Map||function(){return mo}(),yo=function(){function e(){this.values={}}return e.prototype.delete=function(e){return this.values[e]=null,!0},e.prototype.set=function(e,t){return this.values[e]=t,this},e.prototype.get=function(e){return this.values[e]},e.prototype.forEach=function(e,t){var r=this.values;for(var n in r)r.hasOwnProperty(n)&&null!==r[n]&&e.call(t,r[n],n)},e.prototype.clear=function(){this.values={}},e}(),go=function(){function e(e,t,r,n){this.keySelector=e,this.elementSelector=t,this.durationSelector=r,this.subjectSelector=n}return e.prototype.call=function(e,t){return t.subscribe(new bo(e,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))},e}(),bo=function(e){function r(t,r,n,i,o){e.call(this,t),this.keySelector=r,this.elementSelector=n,this.durationSelector=i,this.subjectSelector=o,this.groups=null,this.attemptedToUnsubscribe=!1,this.count=0}return t(r,e),r.prototype._next=function(e){var t;try{t=this.keySelector(e)}catch(e){return void this.error(e)}this._group(e,t)},r.prototype._group=function(e,t){var r=this.groups;r||(r=this.groups="string"==typeof t?new yo:new vo);var n,i=r.get(t);if(this.elementSelector)try{n=this.elementSelector(e)}catch(e){this.error(e)}else n=e;if(!i){i=this.subjectSelector?this.subjectSelector():new gr,r.set(t,i);var o=new _o(t,i,this);if(this.destination.next(o),this.durationSelector){var a=void 0;try{a=this.durationSelector(new _o(t,i))}catch(e){return void this.error(e)}this.add(a.subscribe(new wo(t,i,this)))}}i.closed||i.next(n)},r.prototype._error=function(e){var t=this.groups;t&&(t.forEach(function(t,r){t.error(e)}),t.clear()),this.destination.error(e)},r.prototype._complete=function(){var e=this.groups;e&&(e.forEach(function(e,t){e.complete()}),e.clear()),this.destination.complete()},r.prototype.removeGroup=function(e){this.groups.delete(e)},r.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&e.prototype.unsubscribe.call(this))},r}(hr),wo=function(e){function r(t,r,n){e.call(this),this.key=t,this.group=r,this.parent=n}return t(r,e),r.prototype._next=function(e){this._complete()},r.prototype._error=function(e){var t=this.group;t.closed||t.error(e),this.parent.removeGroup(this.key)},r.prototype._complete=function(){var e=this.group;e.closed||e.complete(),this.parent.removeGroup(this.key)},r}(hr),_o=function(e){function r(t,r,n){e.call(this),this.key=t,this.groupSubject=r,this.refCountSubscription=n}return t(r,e),r.prototype._subscribe=function(e){var t=new sr,r=this,n=r.refCountSubscription,i=r.groupSubject;return n&&!n.closed&&t.add(new Eo(n)),t.add(i.subscribe(e)),t},r}(fr),Eo=function(e){function r(t){e.call(this),this.parent=t,t.count++}return t(r,e),r.prototype.unsubscribe=function(){var t=this.parent;t.closed||this.closed||(e.prototype.unsubscribe.call(this),t.count-=1,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())},r}(sr);fr.prototype.groupBy=Ve;
var xo=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new So(e))},e}(),So=function(e){function r(){e.apply(this,arguments)}return t(r,e),r.prototype._next=function(e){V()},r}(hr);fr.prototype.ignoreElements=He;var No=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Co(e))},e}(),Co=function(e){function r(t){e.call(this,t)}return t(r,e),r.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete()},r.prototype._next=function(e){this.notifyComplete(!1)},r.prototype._complete=function(){this.notifyComplete(!0)},r}(hr);fr.prototype.isEmpty=We;var To=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new Po(e,this.durationSelector))},e}(),Po=function(e){function r(t,r){e.call(this,t),this.durationSelector=r,this.hasValue=!1}return t(r,e),r.prototype._next=function(e){if(this.value=e,this.hasValue=!0,!this.throttled){var t=o(this.durationSelector)(e);t===or?this.destination.error(or.e):this.add(this.throttled=y(this,t))}},r.prototype.clearThrottle=function(){var e=this,t=e.value,r=e.hasValue,n=e.throttled;n&&(this.remove(n),this.throttled=null,n.unsubscribe()),r&&(this.value=null,this.hasValue=!1,this.destination.next(t))},r.prototype.notifyNext=function(e,t,r,n){this.clearThrottle()},r.prototype.notifyComplete=function(){this.clearThrottle()},r}(Pr);fr.prototype.audit=$e;var ko=function(){function e(e,t){this.duration=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new Ao(e,this.duration,this.scheduler))},e}(),Ao=function(e){function r(t,r,n){e.call(this,t),this.duration=r,this.scheduler=n,this.hasValue=!1}return t(r,e),r.prototype._next=function(e){this.value=e,this.hasValue=!0,this.throttled||this.add(this.throttled=this.scheduler.schedule(qe,this.duration,this))},r.prototype.clearThrottle=function(){var e=this,t=e.value,r=e.hasValue,n=e.throttled;n&&(this.remove(n),this.throttled=null,n.unsubscribe()),r&&(this.value=null,this.hasValue=!1,this.destination.next(t))},r}(hr);fr.prototype.auditTime=Ue;var Ro=function(){function e(e,t,r,n){this.predicate=e,this.resultSelector=t,this.defaultValue=r,this.source=n}return e.prototype.call=function(e,t){return t.subscribe(new Oo(e,this.predicate,this.resultSelector,this.defaultValue,this.source))},e}(),Oo=function(e){function r(t,r,n,i,o){e.call(this,t),this.predicate=r,this.resultSelector=n,this.defaultValue=i,this.source=o,this.hasValue=!1,this.index=0,"undefined"!=typeof i&&(this.lastValue=i,this.hasValue=!0)}return t(r,e),r.prototype._next=function(e){var t=this.index++;if(this.predicate)this._tryPredicate(e,t);else{if(this.resultSelector)return void this._tryResultSelector(e,t);this.lastValue=e,this.hasValue=!0}},r.prototype._tryPredicate=function(e,t){var r;try{r=this.predicate(e,t,this.source)}catch(e){return void this.destination.error(e)}if(r){if(this.resultSelector)return void this._tryResultSelector(e,t);this.lastValue=e,this.hasValue=!0}},r.prototype._tryResultSelector=function(e,t){var r;try{r=this.resultSelector(e,t)}catch(e){return void this.destination.error(e)}this.lastValue=r,this.hasValue=!0},r.prototype._complete=function(){var e=this.destination;this.hasValue?(e.next(this.lastValue),e.complete()):e.error(new ho)},r}(hr);fr.prototype.last=ze,fr.prototype.let=Ke,fr.prototype.letBind=Ke;var Io=function(){function e(e,t,r){this.predicate=e,this.thisArg=t,this.source=r}return e.prototype.call=function(e,t){return t.subscribe(new Do(e,this.predicate,this.thisArg,this.source))},e}(),Do=function(e){function r(t,r,n,i){e.call(this,t),this.predicate=r,this.thisArg=n,this.source=i,this.index=0,this.thisArg=n||this}return t(r,e),r.prototype.notifyComplete=function(e){this.destination.next(e),this.destination.complete()},r.prototype._next=function(e){var t=!1;try{t=this.predicate.call(this.thisArg,e,this.index++,this.source)}catch(e){return void this.destination.error(e)}t||this.notifyComplete(!1)},r.prototype._complete=function(){this.notifyComplete(!0)},r}(hr);fr.prototype.every=Ge,fr.prototype.map=K;var Mo=function(){function e(e){this.value=e}return e.prototype.call=function(e,t){return t.subscribe(new Lo(e,this.value))},e}(),Lo=function(e){function r(t,r){e.call(this,t),this.value=r}return t(r,e),r.prototype._next=function(e){this.destination.next(this.value)},r}(hr);fr.prototype.mapTo=Qe;var jo=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Fo(e))},e}(),Fo=function(e){function r(t){e.call(this,t)}return t(r,e),r.prototype._next=function(e){this.destination.next(Xr.createNext(e))},r.prototype._error=function(e){var t=this.destination;t.next(Xr.createError(e)),t.complete()},r.prototype._complete=function(){var e=this.destination;e.next(Xr.createComplete()),e.complete()},r}(hr);fr.prototype.materialize=Xe;var Bo=function(){function e(e,t,r){void 0===r&&(r=!1),this.accumulator=e,this.seed=t,this.hasSeed=r}return e.prototype.call=function(e,t){return t.subscribe(new Vo(e,this.accumulator,this.seed,this.hasSeed))},e}(),Vo=function(e){function r(t,r,n,i){e.call(this,t),this.accumulator=r,this.hasSeed=i,this.index=0,this.hasValue=!1,this.acc=n,this.hasSeed||this.index++}return t(r,e),r.prototype._next=function(e){this.hasValue||(this.hasValue=this.hasSeed)?this._tryReduce(e):(this.acc=e,this.hasValue=!0)},r.prototype._tryReduce=function(e){var t;try{t=this.accumulator(this.acc,e,this.index++)}catch(e){return void this.destination.error(e)}this.acc=t},r.prototype._complete=function(){(this.hasValue||this.hasSeed)&&this.destination.next(this.acc),this.destination.complete()},r}(hr);fr.prototype.max=Ze,fr.prototype.merge=L,fr.prototype.mergeAll=w,fr.prototype.mergeMap=fe,fr.prototype.flatMap=fe,fr.prototype.flatMapTo=ve,fr.prototype.mergeMapTo=ve;var Ho=function(){function e(e,t,r){this.accumulator=e,this.seed=t,this.concurrent=r}return e.prototype.call=function(e,t){return t.subscribe(new Wo(e,this.accumulator,this.seed,this.concurrent))},e}(),Wo=function(e){function r(t,r,n,i){e.call(this,t),this.accumulator=r,this.acc=n,this.concurrent=i,this.hasValue=!1,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}return t(r,e),r.prototype._next=function(e){if(this.active<this.concurrent){var t=this.index++,r=o(this.accumulator)(this.acc,e),n=this.destination;r===or?n.error(or.e):(this.active++,this._innerSub(r,e,t))}else this.buffer.push(e)},r.prototype._innerSub=function(e,t,r){this.add(y(this,e,t,r))},r.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(this.hasValue===!1&&this.destination.next(this.acc),this.destination.complete())},r.prototype.notifyNext=function(e,t,r,n,i){var o=this.destination;this.acc=t,this.hasValue=!0,o.next(t)},r.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&(this.hasValue===!1&&this.destination.next(this.acc),this.destination.complete())},r}(Pr);fr.prototype.mergeScan=Je,fr.prototype.min=et;var $o=function(e){function r(t,r){e.call(this),this.source=t,this.subjectFactory=r,this._refCount=0}return t(r,e),r.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},r.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},r.prototype.connect=function(){var e=this._connection;return e||(e=this._connection=new sr,e.add(this.source.subscribe(new qo(this.getSubject(),this))),e.closed?(this._connection=null,e=sr.EMPTY):this._connection=e),e},r.prototype.refCount=function(){return this.lift(new zo(this))},r}(fr),Uo={operator:{value:null},_refCount:{value:0,writable:!0},_subscribe:{value:$o.prototype._subscribe},getSubject:{value:$o.prototype.getSubject},connect:{value:$o.prototype.connect},refCount:{value:$o.prototype.refCount}},qo=function(e){function r(t,r){e.call(this,t),this.connectable=r}return t(r,e),r.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},r.prototype._complete=function(){this._unsubscribe(),e.prototype._complete.call(this)},r.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},r}(yr),zo=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var r=this.connectable;r._refCount++;var n=new Ko(e,r),i=t.subscribe(n);return n.closed||(n.connection=r.connect()),i},e}(),Ko=function(e){function r(t,r){e.call(this,t),this.connectable=r}return t(r,e),r.prototype._unsubscribe=function(){var e=this.connectable;if(!e)return void(this.connection=null);this.connectable=null;var t=e._refCount;if(t<=0)return void(this.connection=null);if(e._refCount=t-1,t>1)return void(this.connection=null);var r=this.connection,n=e._connection;this.connection=null,!n||r&&n!==r||n.unsubscribe()},r}(hr),Go=function(){function e(e,t){this.subjectFactory=e,this.selector=t}return e.prototype.call=function(e,t){var r=this.selector,n=this.subjectFactory(),i=r(n).subscribe(e);return i.add(t.subscribe(n)),i},e}();fr.prototype.multicast=tt,fr.prototype.observeOn=k,fr.prototype.onErrorResumeNext=H;var Qo=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Xo(e))},e}(),Xo=function(e){function r(t){e.call(this,t),this.hasPrev=!1}return t(r,e),r.prototype._next=function(e){this.hasPrev?this.destination.next([this.prev,e]):this.hasPrev=!0,this.prev=e},r}(hr);fr.prototype.pairwise=rt,fr.prototype.partition=it,fr.prototype.pluck=ot,fr.prototype.publish=st;var Yo=function(e){function r(t){e.call(this),this._value=t}return t(r,e),Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),r.prototype._subscribe=function(t){var r=e.prototype._subscribe.call(this,t);return r&&!r.closed&&t.next(this._value),r},r.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new mr;return this._value},r.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},r}(gr);fr.prototype.publishBehavior=lt,fr.prototype.publishReplay=ut,fr.prototype.publishLast=ct,fr.prototype.race=F,fr.prototype.reduce=Ye;var Zo=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Jo(e,this.count,this.source))},e}(),Jo=function(e){function r(t,r,n){e.call(this,t),this.count=r,this.source=n}return t(r,e),r.prototype.complete=function(){if(!this.isStopped){var t=this,r=t.source,n=t.count;if(0===n)return e.prototype.complete.call(this);n>-1&&(this.count=n-1),r.subscribe(this._unsubscribeAndRecycle())}},r}(hr);fr.prototype.repeat=ht;var ea=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new ta(e,this.notifier,t))},e}(),ta=function(e){function r(t,r,n){e.call(this,t),this.notifier=r,this.source=n,this.sourceIsBeingSubscribedTo=!0}return t(r,e),r.prototype.notifyNext=function(e,t,r,n,i){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)},r.prototype.notifyComplete=function(t){if(this.sourceIsBeingSubscribedTo===!1)return e.prototype.complete.call(this)},r.prototype.complete=function(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries){if(this.retriesSubscription.closed)return e.prototype.complete.call(this)}else this.subscribeToRetries();this._unsubscribeAndRecycle(),this.notifications.next()}},r.prototype._unsubscribe=function(){var e=this,t=e.notifications,r=e.retriesSubscription;t&&(t.unsubscribe(),this.notifications=null),r&&(r.unsubscribe(),this.retriesSubscription=null),this.retries=null},r.prototype._unsubscribeAndRecycle=function(){var t=this,r=t.notifications,n=t.retries,i=t.retriesSubscription;return this.notifications=null,this.retries=null,this.retriesSubscription=null,e.prototype._unsubscribeAndRecycle.call(this),this.notifications=r,this.retries=n,this.retriesSubscription=i,this},r.prototype.subscribeToRetries=function(){this.notifications=new gr;var t=o(this.notifier)(this.notifications);return t===or?e.prototype.complete.call(this):(this.retries=t,void(this.retriesSubscription=y(this,t)))},r}(Pr);fr.prototype.repeatWhen=dt;var ra=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new na(e,this.count,this.source))},e}(),na=function(e){function r(t,r,n){e.call(this,t),this.count=r,this.source=n}return t(r,e),r.prototype.error=function(t){if(!this.isStopped){var r=this,n=r.source,i=r.count;if(0===i)return e.prototype.error.call(this,t);i>-1&&(this.count=i-1),n.subscribe(this._unsubscribeAndRecycle())}},r}(hr);fr.prototype.retry=pt;var ia=function(){function e(e,t){this.notifier=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new oa(e,this.notifier,this.source))},e}(),oa=function(e){function r(t,r,n){e.call(this,t),this.notifier=r,this.source=n}return t(r,e),r.prototype.error=function(t){if(!this.isStopped){var r=this.errors,n=this.retries,i=this.retriesSubscription;if(n)this.errors=null,this.retriesSubscription=null;else{if(r=new gr,n=o(this.notifier)(r),n===or)return e.prototype.error.call(this,or.e);i=y(this,n)}this._unsubscribeAndRecycle(),this.errors=r,this.retries=n,this.retriesSubscription=i,r.next(t)}},r.prototype._unsubscribe=function(){var e=this,t=e.errors,r=e.retriesSubscription;t&&(t.unsubscribe(),this.errors=null),r&&(r.unsubscribe(),this.retriesSubscription=null),this.retries=null},r.prototype.notifyNext=function(e,t,r,n,i){var o=this,a=o.errors,s=o.retries,l=o.retriesSubscription;this.errors=null,this.retries=null,this.retriesSubscription=null,this._unsubscribeAndRecycle(),this.errors=a,this.retries=s,this.retriesSubscription=l,this.source.subscribe(this)},r}(Pr);fr.prototype.retryWhen=ft;var aa=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var r=new sa(e),n=t.subscribe(r);return n.add(y(r,this.notifier)),n},e}(),sa=function(e){function r(){e.apply(this,arguments),this.hasValue=!1}return t(r,e),r.prototype._next=function(e){this.value=e,this.hasValue=!0},r.prototype.notifyNext=function(e,t,r,n,i){this.emitValue()},r.prototype.notifyComplete=function(){this.emitValue()},r.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))},r}(Pr);fr.prototype.sample=mt;var la=function(){function e(e,t){this.period=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new ua(e,this.period,this.scheduler))},e}(),ua=function(e){function r(t,r,n){e.call(this,t),this.period=r,this.scheduler=n,this.hasValue=!1,this.add(n.schedule(yt,r,{subscriber:this,period:r}))}return t(r,e),r.prototype._next=function(e){this.lastValue=e,this.hasValue=!0},r.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))},r}(hr);fr.prototype.sampleTime=vt;var ca=function(){function e(e,t,r){void 0===r&&(r=!1),this.accumulator=e,this.seed=t,this.hasSeed=r}return e.prototype.call=function(e,t){return t.subscribe(new ha(e,this.accumulator,this.seed,this.hasSeed))},e}(),ha=function(e){function r(t,r,n,i){e.call(this,t),this.accumulator=r,this._seed=n,this.hasSeed=i,this.index=0}return t(r,e),Object.defineProperty(r.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e},enumerable:!0,configurable:!0}),r.prototype._next=function(e){return this.hasSeed?this._tryNext(e):(this.seed=e,void this.destination.next(e))},r.prototype._tryNext=function(e){var t,r=this.index++;try{t=this.accumulator(this.seed,e,r)}catch(e){this.destination.error(e)}this.seed=t,this.destination.next(t)},r}(hr);fr.prototype.scan=gt;var da=function(){function e(e,t){this.compareTo=e,this.comparor=t}return e.prototype.call=function(e,t){return t.subscribe(new pa(e,this.compareTo,this.comparor))},e}(),pa=function(e){function r(t,r,n){e.call(this,t),this.compareTo=r,this.comparor=n,this._a=[],this._b=[],this._oneComplete=!1,this.add(r.subscribe(new fa(t,this)))}return t(r,e),r.prototype._next=function(e){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(e),this.checkValues())},r.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0},r.prototype.checkValues=function(){for(var e=this,t=e._a,r=e._b,n=e.comparor;t.length>0&&r.length>0;){var i=t.shift(),a=r.shift(),s=!1;n?(s=o(n)(i,a),s===or&&this.destination.error(or.e)):s=i===a,s||this.emit(!1)}},r.prototype.emit=function(e){var t=this.destination;t.next(e),t.complete()},r.prototype.nextB=function(e){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(e),this.checkValues())},r}(hr),fa=function(e){function r(t,r){e.call(this,t),this.parent=r}return t(r,e),r.prototype._next=function(e){this.parent.nextB(e)},r.prototype._error=function(e){this.parent.error(e)},r.prototype._complete=function(){this.parent._complete()},r}(hr);fr.prototype.sequenceEqual=bt,fr.prototype.share=_t;var ma=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new va(e,this.predicate,this.source))},e}(),va=function(e){function r(t,r,n){e.call(this,t),this.predicate=r,this.source=n,this.seenValue=!1,this.index=0}return t(r,e),r.prototype.applySingleValue=function(e){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=e)},r.prototype._next=function(e){var t=this.predicate;this.index++,t?this.tryNext(e):this.applySingleValue(e)},r.prototype.tryNext=function(e){try{var t=this.predicate(e,this.index,this.source);t&&this.applySingleValue(e)}catch(e){this.destination.error(e)}},r.prototype._complete=function(){var e=this.destination;this.index>0?(e.next(this.seenValue?this.singleValue:void 0),e.complete()):e.error(new ho)},r}(hr);fr.prototype.single=Et;var ya=function(){function e(e){this.total=e}return e.prototype.call=function(e,t){return t.subscribe(new ga(e,this.total))},e}(),ga=function(e){function r(t,r){e.call(this,t),this.total=r,this.count=0}return t(r,e),r.prototype._next=function(e){++this.count>this.total&&this.destination.next(e)},r}(hr);fr.prototype.skip=xt;var ba=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new wa(e,this.notifier))},e}(),wa=function(e){function r(t,r){e.call(this,t),this.hasValue=!1,this.isInnerStopped=!1,this.add(y(this,r))}return t(r,e),r.prototype._next=function(t){this.hasValue&&e.prototype._next.call(this,t)},r.prototype._complete=function(){this.isInnerStopped?e.prototype._complete.call(this):this.unsubscribe()},r.prototype.notifyNext=function(e,t,r,n,i){this.hasValue=!0},r.prototype.notifyComplete=function(){this.isInnerStopped=!0,this.isStopped&&e.prototype._complete.call(this)},r}(Pr);fr.prototype.skipUntil=St;var _a=function(){function e(e){this.predicate=e}return e.prototype.call=function(e,t){return t.subscribe(new Ea(e,this.predicate))},e}(),Ea=function(e){function r(t,r){e.call(this,t),this.predicate=r,this.skipping=!0,this.index=0}return t(r,e),r.prototype._next=function(e){var t=this.destination;this.skipping&&this.tryCallPredicate(e),this.skipping||t.next(e)},r.prototype.tryCallPredicate=function(e){try{var t=this.predicate(e,this.index++);this.skipping=Boolean(t)}catch(e){this.destination.error(e)}},r}(hr);fr.prototype.skipWhile=Nt,fr.prototype.startWith=Ct;var xa=function(){function e(e){if(this.root=e,e.setImmediate&&"function"==typeof e.setImmediate)this.setImmediate=e.setImmediate.bind(e),this.clearImmediate=e.clearImmediate.bind(e);else{this.nextHandle=1,this.tasksByHandle={},this.currentlyRunningATask=!1,this.canUseProcessNextTick()?this.setImmediate=this.createProcessNextTickSetImmediate():this.canUsePostMessage()?this.setImmediate=this.createPostMessageSetImmediate():this.canUseMessageChannel()?this.setImmediate=this.createMessageChannelSetImmediate():this.canUseReadyStateChange()?this.setImmediate=this.createReadyStateChangeSetImmediate():this.setImmediate=this.createSetTimeoutSetImmediate();var t=function e(t){delete e.instance.tasksByHandle[t]};t.instance=this,this.clearImmediate=t}}return e.prototype.identify=function(e){return this.root.Object.prototype.toString.call(e)},e.prototype.canUseProcessNextTick=function(){return"[object process]"===this.identify(this.root.process)},e.prototype.canUseMessageChannel=function(){return Boolean(this.root.MessageChannel)},e.prototype.canUseReadyStateChange=function(){var e=this.root.document;return Boolean(e&&"onreadystatechange"in e.createElement("script"))},e.prototype.canUsePostMessage=function(){var e=this.root;if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}return!1},e.prototype.partiallyApplied=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=function e(){var t=e,r=t.handler,n=t.args;"function"==typeof r?r.apply(void 0,n):new Function(""+r)()};return n.handler=e,n.args=t,n},e.prototype.addFromSetImmediateArguments=function(e){return this.tasksByHandle[this.nextHandle]=this.partiallyApplied.apply(void 0,e),this.nextHandle++},e.prototype.createProcessNextTickSetImmediate=function(){var e=function e(){var t=e.instance,r=t.addFromSetImmediateArguments(arguments);return t.root.process.nextTick(t.partiallyApplied(t.runIfPresent,r)),r};return e.instance=this,e},e.prototype.createPostMessageSetImmediate=function(){var e=this.root,t="setImmediate$"+e.Math.random()+"$",r=function r(n){var i=r.instance;n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&i.runIfPresent(+n.data.slice(t.length))};r.instance=this,e.addEventListener("message",r,!1);var n=function e(){var t=e,r=t.messagePrefix,n=t.instance,i=n.addFromSetImmediateArguments(arguments);return n.root.postMessage(r+i,"*"),i};return n.instance=this,n.messagePrefix=t,n},e.prototype.runIfPresent=function(e){if(this.currentlyRunningATask)this.root.setTimeout(this.partiallyApplied(this.runIfPresent,e),0);else{var t=this.tasksByHandle[e];if(t){this.currentlyRunningATask=!0;try{t()}finally{this.clearImmediate(e),this.currentlyRunningATask=!1}}}},e.prototype.createMessageChannelSetImmediate=function(){var e=this,t=new this.root.MessageChannel;t.port1.onmessage=function(t){var r=t.data;e.runIfPresent(r)};var r=function e(){var t=e,r=t.channel,n=t.instance,i=n.addFromSetImmediateArguments(arguments);return r.port2.postMessage(i),i};return r.channel=t,r.instance=this,r},e.prototype.createReadyStateChangeSetImmediate=function(){var e=function e(){var t=e.instance,r=t.root,n=r.document,i=n.documentElement,o=t.addFromSetImmediateArguments(arguments),a=n.createElement("script");return a.onreadystatechange=function(){t.runIfPresent(o),a.onreadystatechange=null,i.removeChild(a),a=null},i.appendChild(a),o};return e.instance=this,e},e.prototype.createSetTimeoutSetImmediate=function(){var e=function e(){var t=e.instance,r=t.addFromSetImmediateArguments(arguments);return t.root.setTimeout(t.partiallyApplied(t.runIfPresent,r),0),r};return e.instance=this,e},e}(),Sa=new xa(rr),Na=function(e){function r(t,r){e.call(this,t,r),this.scheduler=t,this.work=r}return t(r,e),r.prototype.requestAsyncId=function(t,r,n){return void 0===n&&(n=0),null!==n&&n>0?e.prototype.requestAsyncId.call(this,t,r,n):(t.actions.push(this),t.scheduled||(t.scheduled=Sa.setImmediate(t.flush.bind(t,null))))},r.prototype.recycleAsyncId=function(t,r,n){return void 0===n&&(n=0),null!==n&&n>0||null===n&&this.delay>0?e.prototype.recycleAsyncId.call(this,t,r,n):void(0===t.actions.length&&(Sa.clearImmediate(r),t.scheduled=void 0))},r}(vn),Ca=function(e){function r(){e.apply(this,arguments)}return t(r,e),r.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,r=this.actions,n=-1,i=r.length;e=e||r.shift();do if(t=e.execute(e.state,e.delay))break;while(++n<i&&(e=r.shift()));if(this.active=!1,t){for(;++n<i&&(e=r.shift());)e.unsubscribe();throw t}},r}(gn),Ta=new Ca(Na),Pa=function(e){function r(t,r,n){void 0===r&&(r=0),void 0===n&&(n=Ta),e.call(this),this.source=t,this.delayTime=r,this.scheduler=n,(!M(r)||r<0)&&(this.delayTime=0),n&&"function"==typeof n.schedule||(this.scheduler=Ta)}return t(r,e),r.create=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=Ta),new r(e,t,n)},r.dispatch=function(e){var t=e.source,r=e.subscriber;return this.add(t.subscribe(r))},r.prototype._subscribe=function(e){var t=this.delayTime,n=this.source,i=this.scheduler;return i.schedule(r.dispatch,t,{source:n,subscriber:e})},r}(fr),ka=function(){function e(e,t){this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return new Pa(t,this.delay,this.scheduler).subscribe(e)},e}();fr.prototype.subscribeOn=Tt;var Aa=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Ra(e))},e}(),Ra=function(e){function r(t){e.call(this,t),this.active=0,this.hasCompleted=!1}return t(r,e),r.prototype._next=function(e){this.unsubscribeInner(),this.active++,this.add(this.innerSubscription=y(this,e))},r.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&this.destination.complete()},r.prototype.unsubscribeInner=function(){this.active=this.active>0?this.active-1:0;var e=this.innerSubscription;e&&(e.unsubscribe(),this.remove(e))},r.prototype.notifyNext=function(e,t,r,n,i){this.destination.next(t)},r.prototype.notifyError=function(e){this.destination.error(e)},r.prototype.notifyComplete=function(){this.unsubscribeInner(),this.hasCompleted&&0===this.active&&this.destination.complete()},r}(Pr);fr.prototype.switch=Pt,fr.prototype._switch=Pt;var Oa=function(){function e(e,t){this.project=e,this.resultSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new Ia(e,this.project,this.resultSelector))},e}(),Ia=function(e){function r(t,r,n){e.call(this,t),this.project=r,this.resultSelector=n,this.index=0}return t(r,e),r.prototype._next=function(e){var t,r=this.index++;try{t=this.project(e,r)}catch(e){return void this.destination.error(e)}this._innerSub(t,e,r)},r.prototype._innerSub=function(e,t,r){var n=this.innerSubscription;n&&n.unsubscribe(),this.add(this.innerSubscription=y(this,e,t,r))},r.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this)},r.prototype._unsubscribe=function(){this.innerSubscription=null},r.prototype.notifyComplete=function(t){this.remove(t),this.innerSubscription=null,this.isStopped&&e.prototype._complete.call(this)},r.prototype.notifyNext=function(e,t,r,n,i){this.resultSelector?this._tryNotifyNext(e,t,r,n):this.destination.next(t)},r.prototype._tryNotifyNext=function(e,t,r,n){var i;try{i=this.resultSelector(e,t,r,n)}catch(e){return void this.destination.error(e)}this.destination.next(i)},r}(Pr);fr.prototype.switchMap=kt;var Da=function(){function e(e,t){this.observable=e,this.resultSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new Ma(e,this.observable,this.resultSelector))},e}(),Ma=function(e){function r(t,r,n){e.call(this,t),this.inner=r,this.resultSelector=n,this.index=0}return t(r,e),r.prototype._next=function(e){var t=this.innerSubscription;t&&t.unsubscribe(),this.add(this.innerSubscription=y(this,this.inner,e,this.index++))},r.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this)},r.prototype._unsubscribe=function(){this.innerSubscription=null},r.prototype.notifyComplete=function(t){this.remove(t),this.innerSubscription=null,this.isStopped&&e.prototype._complete.call(this)},r.prototype.notifyNext=function(e,t,r,n,i){var o=this,a=o.resultSelector,s=o.destination;a?this.tryResultSelector(e,t,r,n):s.next(t)},r.prototype.tryResultSelector=function(e,t,r,n){var i,o=this,a=o.resultSelector,s=o.destination;try{i=a(e,t,r,n)}catch(e){return void s.error(e)}s.next(i)},r}(Pr);fr.prototype.switchMapTo=At;var La=function(){function e(e){if(this.total=e,this.total<0)throw new ro}return e.prototype.call=function(e,t){return t.subscribe(new ja(e,this.total))},e}(),ja=function(e){function r(t,r){e.call(this,t),this.total=r,this.count=0}return t(r,e),r.prototype._next=function(e){var t=this.total,r=++this.count;r<=t&&(this.destination.next(e),r===t&&(this.destination.complete(),this.unsubscribe()))},r}(hr);fr.prototype.take=Rt;var Fa=function(){function e(e){if(this.total=e,this.total<0)throw new ro}return e.prototype.call=function(e,t){return t.subscribe(new Ba(e,this.total))},e}(),Ba=function(e){function r(t,r){e.call(this,t),this.total=r,this.ring=new Array,this.count=0}return t(r,e),r.prototype._next=function(e){var t=this.ring,r=this.total,n=this.count++;if(t.length<r)t.push(e);else{var i=n%r;t[i]=e}},r.prototype._complete=function(){var e=this.destination,t=this.count;if(t>0)for(var r=this.count>=this.total?this.total:this.count,n=this.ring,i=0;i<r;i++){var o=t++%r;e.next(n[o])}e.complete()},r}(hr);fr.prototype.takeLast=Ot;var Va=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new Ha(e,this.notifier))},e}(),Ha=function(e){function r(t,r){e.call(this,t),this.notifier=r,this.add(y(this,r))}return t(r,e),r.prototype.notifyNext=function(e,t,r,n,i){this.complete()},r.prototype.notifyComplete=function(){},r}(Pr);fr.prototype.takeUntil=It;var Wa=function(){function e(e){this.predicate=e}return e.prototype.call=function(e,t){return t.subscribe(new $a(e,this.predicate))},e}(),$a=function(e){function r(t,r){e.call(this,t),this.predicate=r,this.index=0}return t(r,e),r.prototype._next=function(e){var t,r=this.destination;try{t=this.predicate(e,this.index++)}catch(e){return void r.error(e)}this.nextOrComplete(e,t)},r.prototype.nextOrComplete=function(e,t){var r=this.destination;Boolean(t)?r.next(e):r.complete()},r}(hr);fr.prototype.takeWhile=Dt;var Ua=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new qa(e,this.durationSelector))},e}(),qa=function(e){function r(t,r){e.call(this,t),this.destination=t,this.durationSelector=r}return t(r,e),r.prototype._next=function(e){this.throttled||this.tryDurationSelector(e)},r.prototype.tryDurationSelector=function(e){var t=null;try{t=this.durationSelector(e)}catch(e){return void this.destination.error(e)}this.emitAndThrottle(e,t)},r.prototype.emitAndThrottle=function(e,t){this.add(this.throttled=y(this,t)),this.destination.next(e)},r.prototype._unsubscribe=function(){var e=this.throttled;e&&(this.remove(e),this.throttled=null,e.unsubscribe())},r.prototype.notifyNext=function(e,t,r,n,i){this._unsubscribe()},r.prototype.notifyComplete=function(){this._unsubscribe()},r}(Pr);fr.prototype.throttle=Mt;var za=function(){function e(e,t){this.duration=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new Ka(e,this.duration,this.scheduler))},e}(),Ka=function(e){function r(t,r,n){e.call(this,t),this.duration=r,this.scheduler=n}return t(r,e),r.prototype._next=function(e){this.throttled||(this.add(this.throttled=this.scheduler.schedule(jt,this.duration,{subscriber:this})),this.destination.next(e))},r.prototype.clearThrottle=function(){var e=this.throttled;e&&(e.unsubscribe(),this.remove(e),this.throttled=null)},r}(hr);fr.prototype.throttleTime=Lt;var Ga=function(){function e(e,t){this.value=e,this.interval=t}return e}(),Qa=function(){function e(e){this.scheduler=e}return e.prototype.call=function(e,t){return t.subscribe(new Xa(e,this.scheduler))},e}(),Xa=function(e){function r(t,r){e.call(this,t),this.scheduler=r,this.lastTime=0,this.lastTime=r.now()}return t(r,e),r.prototype._next=function(e){var t=this.scheduler.now(),r=t-this.lastTime;this.lastTime=t,this.destination.next(new Ga(e,r))},r}(hr);fr.prototype.timeInterval=Ft;var Ya=function(e){function r(){var t=e.call(this,"Timeout has occurred");this.name=t.name="TimeoutError",this.stack=t.stack,this.message=t.message}return t(r,e),r}(Error),Za=function(){function e(e,t,r,n){this.waitFor=e,this.absoluteTimeout=t,this.scheduler=r,
this.errorInstance=n}return e.prototype.call=function(e,t){return t.subscribe(new Ja(e,this.absoluteTimeout,this.waitFor,this.scheduler,this.errorInstance))},e}(),Ja=function(e){function r(t,r,n,i,o){e.call(this,t),this.absoluteTimeout=r,this.waitFor=n,this.scheduler=i,this.errorInstance=o,this.index=0,this._previousIndex=0,this._hasCompleted=!1,this.scheduleTimeout()}return t(r,e),Object.defineProperty(r.prototype,"previousIndex",{get:function(){return this._previousIndex},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hasCompleted",{get:function(){return this._hasCompleted},enumerable:!0,configurable:!0}),r.dispatchTimeout=function(e){var t=e.subscriber,r=e.index;t.hasCompleted||t.previousIndex!==r||t.notifyTimeout()},r.prototype.scheduleTimeout=function(){var e=this.index;this.scheduler.schedule(r.dispatchTimeout,this.waitFor,{subscriber:this,index:e}),this.index++,this._previousIndex=e},r.prototype._next=function(e){this.destination.next(e),this.absoluteTimeout||this.scheduleTimeout()},r.prototype._error=function(e){this.destination.error(e),this._hasCompleted=!0},r.prototype._complete=function(){this.destination.complete(),this._hasCompleted=!0},r.prototype.notifyTimeout=function(){this.error(this.errorInstance)},r}(hr);fr.prototype.timeout=Bt;var es=function(){function e(e,t,r,n){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=r,this.scheduler=n}return e.prototype.call=function(e,t){return t.subscribe(new ts(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),ts=function(e){function r(t,r,n,i,o){e.call(this),this.destination=t,this.absoluteTimeout=r,this.waitFor=n,this.withObservable=i,this.scheduler=o,this.timeoutSubscription=void 0,this.index=0,this._previousIndex=0,this._hasCompleted=!1,t.add(this),this.scheduleTimeout()}return t(r,e),Object.defineProperty(r.prototype,"previousIndex",{get:function(){return this._previousIndex},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hasCompleted",{get:function(){return this._hasCompleted},enumerable:!0,configurable:!0}),r.dispatchTimeout=function(e){var t=e.subscriber,r=e.index;t.hasCompleted||t.previousIndex!==r||t.handleTimeout()},r.prototype.scheduleTimeout=function(){var e=this.index,t={subscriber:this,index:e};this.scheduler.schedule(r.dispatchTimeout,this.waitFor,t),this.index++,this._previousIndex=e},r.prototype._next=function(e){this.destination.next(e),this.absoluteTimeout||this.scheduleTimeout()},r.prototype._error=function(e){this.destination.error(e),this._hasCompleted=!0},r.prototype._complete=function(){this.destination.complete(),this._hasCompleted=!0},r.prototype.handleTimeout=function(){if(!this.closed){var e=this.withObservable;this.unsubscribe(),this.destination.add(this.timeoutSubscription=y(this,e))}},r}(Pr);fr.prototype.timeoutWith=Vt;var rs=function(){function e(e,t){this.value=e,this.timestamp=t}return e}(),ns=function(){function e(e){this.scheduler=e}return e.prototype.call=function(e,t){return t.subscribe(new is(e,this.scheduler))},e}(),is=function(e){function r(t,r){e.call(this,t),this.scheduler=r}return t(r,e),r.prototype._next=function(e){var t=this.scheduler.now();this.destination.next(new rs(e,t))},r}(hr);fr.prototype.timestamp=Ht;var os=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new as(e))},e}(),as=function(e){function r(t){e.call(this,t),this.array=[]}return t(r,e),r.prototype._next=function(e){this.array.push(e)},r.prototype._complete=function(){this.destination.next(this.array),this.destination.complete()},r}(hr);fr.prototype.toArray=Wt,fr.prototype.toPromise=$t;var ss=function(){function e(e){this.windowBoundaries=e}return e.prototype.call=function(e,t){var r=new ls(e),n=t.subscribe(r);return n.closed||r.add(y(r,this.windowBoundaries)),n},e}(),ls=function(e){function r(t){e.call(this,t),this.window=new gr,t.next(this.window)}return t(r,e),r.prototype.notifyNext=function(e,t,r,n,i){this.openWindow()},r.prototype.notifyError=function(e,t){this._error(e)},r.prototype.notifyComplete=function(e){this._complete()},r.prototype._next=function(e){this.window.next(e)},r.prototype._error=function(e){this.window.error(e),this.destination.error(e)},r.prototype._complete=function(){this.window.complete(),this.destination.complete()},r.prototype._unsubscribe=function(){this.window=null},r.prototype.openWindow=function(){var e=this.window;e&&e.complete();var t=this.destination,r=this.window=new gr;t.next(r)},r}(Pr);fr.prototype.window=Ut;var us=function(){function e(e,t){this.windowSize=e,this.startWindowEvery=t}return e.prototype.call=function(e,t){return t.subscribe(new cs(e,this.windowSize,this.startWindowEvery))},e}(),cs=function(e){function r(t,r,n){e.call(this,t),this.destination=t,this.windowSize=r,this.startWindowEvery=n,this.windows=[new gr],this.count=0,t.next(this.windows[0])}return t(r,e),r.prototype._next=function(e){for(var t=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,r=this.destination,n=this.windowSize,i=this.windows,o=i.length,a=0;a<o&&!this.closed;a++)i[a].next(e);var s=this.count-n+1;if(s>=0&&s%t===0&&!this.closed&&i.shift().complete(),++this.count%t===0&&!this.closed){var l=new gr;i.push(l),r.next(l)}},r.prototype._error=function(e){var t=this.windows;if(t)for(;t.length>0&&!this.closed;)t.shift().error(e);this.destination.error(e)},r.prototype._complete=function(){var e=this.windows;if(e)for(;e.length>0&&!this.closed;)e.shift().complete();this.destination.complete()},r.prototype._unsubscribe=function(){this.count=0,this.windows=null},r}(hr);fr.prototype.windowCount=qt;var hs=function(){function e(e,t,r){this.windowTimeSpan=e,this.windowCreationInterval=t,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new ds(e,this.windowTimeSpan,this.windowCreationInterval,this.scheduler))},e}(),ds=function(e){function r(t,r,n,i){e.call(this,t),this.destination=t,this.windowTimeSpan=r,this.windowCreationInterval=n,this.scheduler=i,this.windows=[];var o=this.openWindow();if(null!==n&&n>=0){var a={subscriber:this,window:o,context:null},s={windowTimeSpan:r,windowCreationInterval:n,subscriber:this,scheduler:i};this.add(i.schedule(Qt,r,a)),this.add(i.schedule(Gt,n,s))}else{var l={subscriber:this,window:o,windowTimeSpan:r};this.add(i.schedule(Kt,r,l))}}return t(r,e),r.prototype._next=function(e){for(var t=this.windows,r=t.length,n=0;n<r;n++){var i=t[n];i.closed||i.next(e)}},r.prototype._error=function(e){for(var t=this.windows;t.length>0;)t.shift().error(e);this.destination.error(e)},r.prototype._complete=function(){for(var e=this.windows;e.length>0;){var t=e.shift();t.closed||t.complete()}this.destination.complete()},r.prototype.openWindow=function(){var e=new gr;this.windows.push(e);var t=this.destination;return t.next(e),e},r.prototype.closeWindow=function(e){e.complete();var t=this.windows;t.splice(t.indexOf(e),1)},r}(hr);fr.prototype.windowTime=zt;var ps=function(){function e(e,t){this.openings=e,this.closingSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new fs(e,this.openings,this.closingSelector))},e}(),fs=function(e){function r(t,r,n){e.call(this,t),this.openings=r,this.closingSelector=n,this.contexts=[],this.add(this.openSubscription=y(this,r,r))}return t(r,e),r.prototype._next=function(e){var t=this.contexts;if(t)for(var r=t.length,n=0;n<r;n++)t[n].window.next(e)},r.prototype._error=function(t){var r=this.contexts;if(this.contexts=null,r)for(var n=r.length,i=-1;++i<n;){var o=r[i];o.window.error(t),o.subscription.unsubscribe()}e.prototype._error.call(this,t)},r.prototype._complete=function(){var t=this.contexts;if(this.contexts=null,t)for(var r=t.length,n=-1;++n<r;){var i=t[n];i.window.complete(),i.subscription.unsubscribe()}e.prototype._complete.call(this)},r.prototype._unsubscribe=function(){var e=this.contexts;if(this.contexts=null,e)for(var t=e.length,r=-1;++r<t;){var n=e[r];n.window.unsubscribe(),n.subscription.unsubscribe()}},r.prototype.notifyNext=function(e,t,r,n,i){if(e===this.openings){var a=this.closingSelector,s=o(a)(t);if(s===or)return this.error(or.e);var l=new gr,u=new sr,c={window:l,subscription:u};this.contexts.push(c);var h=y(this,s,c);h.closed?this.closeWindow(this.contexts.length-1):(h.context=c,u.add(h)),this.destination.next(l)}else this.closeWindow(this.contexts.indexOf(e))},r.prototype.notifyError=function(e){this.error(e)},r.prototype.notifyComplete=function(e){e!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(e.context))},r.prototype.closeWindow=function(e){if(e!==-1){var t=this.contexts,r=t[e],n=r.window,i=r.subscription;t.splice(e,1),n.complete(),i.unsubscribe()}},r}(Pr);fr.prototype.windowToggle=Xt;var ms=function(){function e(e){this.closingSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new vs(e,this.closingSelector))},e}(),vs=function(e){function r(t,r){e.call(this,t),this.destination=t,this.closingSelector=r,this.openWindow()}return t(r,e),r.prototype.notifyNext=function(e,t,r,n,i){this.openWindow(i)},r.prototype.notifyError=function(e,t){this._error(e)},r.prototype.notifyComplete=function(e){this.openWindow(e)},r.prototype._next=function(e){this.window.next(e)},r.prototype._error=function(e){this.window.error(e),this.destination.error(e),this.unsubscribeClosingNotification()},r.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},r.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},r.prototype.openWindow=function(e){void 0===e&&(e=null),e&&(this.remove(e),e.unsubscribe());var t=this.window;t&&t.complete();var r=this.window=new gr;this.destination.next(r);var n=o(this.closingSelector)();if(n===or){var i=or.e;this.destination.error(i),this.window.error(i)}else this.add(this.closingNotification=y(this,n))},r}(Pr);fr.prototype.windowWhen=Yt;var ys=function(){function e(e,t){this.observables=e,this.project=t}return e.prototype.call=function(e,t){return t.subscribe(new gs(e,this.observables,this.project))},e}(),gs=function(e){function r(t,r,n){e.call(this,t),this.observables=r,this.project=n,this.toRespond=[];var i=r.length;this.values=new Array(i);for(var o=0;o<i;o++)this.toRespond.push(o);for(var o=0;o<i;o++){var a=r[o];this.add(y(this,a,a,o))}}return t(r,e),r.prototype.notifyNext=function(e,t,r,n,i){this.values[r]=t;var o=this.toRespond;if(o.length>0){var a=o.indexOf(r);a!==-1&&o.splice(a,1)}},r.prototype.notifyComplete=function(){},r.prototype._next=function(e){if(0===this.toRespond.length){var t=[e].concat(this.values);this.project?this._tryProject(t):this.destination.next(t)}},r.prototype._tryProject=function(e){var t;try{t=this.project.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},r}(Pr);fr.prototype.withLatestFrom=Zt,fr.prototype.zip=q,fr.prototype.zipAll=Jt;var bs=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.subscribedFrame=e,this.unsubscribedFrame=t}return e}(),ws=function(){function e(){this.subscriptions=[]}return e.prototype.logSubscribedFrame=function(){return this.subscriptions.push(new bs(this.scheduler.now())),this.subscriptions.length-1},e.prototype.logUnsubscribedFrame=function(e){var t=this.subscriptions,r=t[e];t[e]=new bs(r.subscribedFrame,this.scheduler.now())},e}(),_s=function(e){function r(t,r){e.call(this,function(e){var t=this,r=t.logSubscribedFrame();return e.add(new sr(function(){t.logUnsubscribedFrame(r)})),t.scheduleMessages(e),e}),this.messages=t,this.subscriptions=[],this.scheduler=r}return t(r,e),r.prototype.scheduleMessages=function(e){for(var t=this.messages.length,r=0;r<t;r++){var n=this.messages[r];e.add(this.scheduler.schedule(function(e){var t=e.message,r=e.subscriber;t.notification.observe(r)},n.frame,{message:n,subscriber:e}))}},r}(fr);er(_s,[ws]);var Es=function(e){function r(t,r){e.call(this),this.messages=t,this.subscriptions=[],this.scheduler=r}return t(r,e),r.prototype._subscribe=function(t){var r=this,n=r.logSubscribedFrame();return t.add(new sr(function(){r.logUnsubscribedFrame(n)})),e.prototype._subscribe.call(this,t)},r.prototype.setup=function(){for(var e=this,t=e.messages.length,r=0;r<t;r++)!function(){var t=e.messages[r];e.scheduler.schedule(function(){t.notification.observe(e)},t.frame)}()},r}(gr);er(Es,[ws]);var xs=function(e){function r(t,r){var n=this;void 0===t&&(t=Ss),void 0===r&&(r=Number.POSITIVE_INFINITY),e.call(this,t,function(){return n.frame}),this.maxFrames=r,this.frame=0,this.index=-1}return t(r,e),r.prototype.flush=function(){for(var e,t,r=this,n=r.actions,i=r.maxFrames;(t=n.shift())&&(this.frame=t.delay)<=i&&!(e=t.execute(t.state,t.delay)););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},r.frameTimeFactor=10,r}(gn),Ss=function(e){function r(t,r,n){void 0===n&&(n=t.index+=1),e.call(this,t,r),this.scheduler=t,this.work=r,this.index=n,this.index=t.index=n}return t(r,e),r.prototype.schedule=function(t,n){if(void 0===n&&(n=0),!this.id)return e.prototype.schedule.call(this,t,n);var i=new r(this.scheduler,this.work);return this.add(i),i.schedule(t,n)},r.prototype.requestAsyncId=function(e,t,n){void 0===n&&(n=0),this.delay=e.frame+n;var i=e.actions;return i.push(this),i.sort(r.sortActions),!0},r.prototype.recycleAsyncId=function(e,t,r){void 0===r&&(r=0)},r.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},r}(vn),Ns=750,Cs=function(e){function r(t){e.call(this,Ss,Ns),this.assertDeepEqual=t,this.hotObservables=[],this.coldObservables=[],this.flushTests=[]}return t(r,e),r.prototype.createTime=function(e){var t=e.indexOf("|");if(t===-1)throw new Error('marble diagram for time should have a completion marker "|"');return t*r.frameTimeFactor},r.prototype.createColdObservable=function(e,t,n){if(e.indexOf("^")!==-1)throw new Error('cold observable cannot have subscription offset "^"');if(e.indexOf("!")!==-1)throw new Error('cold observable cannot have unsubscription marker "!"');var i=r.parseMarbles(e,t,n),o=new _s(i,this);return this.coldObservables.push(o),o},r.prototype.createHotObservable=function(e,t,n){if(e.indexOf("!")!==-1)throw new Error('hot observable cannot have unsubscription marker "!"');var i=r.parseMarbles(e,t,n),o=new Es(i,this);return this.hotObservables.push(o),o},r.prototype.materializeInnerObservable=function(e,t){var r=this,n=[];return e.subscribe(function(e){n.push({frame:r.frame-t,notification:Xr.createNext(e)})},function(e){n.push({frame:r.frame-t,notification:Xr.createError(e)})},function(){n.push({frame:r.frame-t,notification:Xr.createComplete()})}),n},r.prototype.expectObservable=function(e,t){var n=this;void 0===t&&(t=null);var i,o=[],a={actual:o,ready:!1},s=r.parseMarblesAsSubscriptions(t).unsubscribedFrame;return this.schedule(function(){i=e.subscribe(function(e){var t=e;e instanceof fr&&(t=n.materializeInnerObservable(t,n.frame)),o.push({frame:n.frame,notification:Xr.createNext(t)})},function(e){o.push({frame:n.frame,notification:Xr.createError(e)})},function(){o.push({frame:n.frame,notification:Xr.createComplete()})})},0),s!==Number.POSITIVE_INFINITY&&this.schedule(function(){return i.unsubscribe()},s),this.flushTests.push(a),{toBe:function(e,t,n){a.ready=!0,a.expected=r.parseMarbles(e,t,n,!0)}}},r.prototype.expectSubscriptions=function(e){var t={actual:e,ready:!1};return this.flushTests.push(t),{toBe:function(e){var n="string"==typeof e?[e]:e;t.ready=!0,t.expected=n.map(function(e){return r.parseMarblesAsSubscriptions(e)})}}},r.prototype.flush=function(){for(var t=this.hotObservables;t.length>0;)t.shift().setup();e.prototype.flush.call(this);for(var r=this.flushTests.filter(function(e){return e.ready});r.length>0;){var n=r.shift();this.assertDeepEqual(n.actual,n.expected)}},r.parseMarblesAsSubscriptions=function(e){if("string"!=typeof e)return new bs(Number.POSITIVE_INFINITY);for(var t=e.length,r=-1,n=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,o=0;o<t;o++){var a=o*this.frameTimeFactor,s=e[o];switch(s){case"-":case" ":break;case"(":r=a;break;case")":r=-1;break;case"^":if(n!==Number.POSITIVE_INFINITY)throw new Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");n=r>-1?r:a;break;case"!":if(i!==Number.POSITIVE_INFINITY)throw new Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");i=r>-1?r:a;break;default:throw new Error("there can only be '^' and '!' markers in a subscription marble diagram. Found instead '"+s+"'.")}}return i<0?new bs(n):new bs(n,i)},r.parseMarbles=function(e,t,r,n){if(void 0===n&&(n=!1),e.indexOf("!")!==-1)throw new Error('conventional marble diagrams cannot have the unsubscription marker "!"');for(var i=e.length,o=[],a=e.indexOf("^"),s=a===-1?0:a*-this.frameTimeFactor,l="object"!=typeof t?function(e){return e}:function(e){return n&&t[e]instanceof _s?t[e].messages:t[e]},u=-1,c=0;c<i;c++){var h=c*this.frameTimeFactor+s,d=void 0,p=e[c];switch(p){case"-":case" ":break;case"(":u=h;break;case")":u=-1;break;case"|":d=Xr.createComplete();break;case"^":break;case"#":d=Xr.createError(r||"error");break;default:d=Xr.createNext(l(p))}d&&o.push({frame:u>-1?u:h,notification:d})}return o},r}(xs),Ts=function(){function e(e){e.requestAnimationFrame?(this.cancelAnimationFrame=e.cancelAnimationFrame.bind(e),this.requestAnimationFrame=e.requestAnimationFrame.bind(e)):e.mozRequestAnimationFrame?(this.cancelAnimationFrame=e.mozCancelAnimationFrame.bind(e),this.requestAnimationFrame=e.mozRequestAnimationFrame.bind(e)):e.webkitRequestAnimationFrame?(this.cancelAnimationFrame=e.webkitCancelAnimationFrame.bind(e),this.requestAnimationFrame=e.webkitRequestAnimationFrame.bind(e)):e.msRequestAnimationFrame?(this.cancelAnimationFrame=e.msCancelAnimationFrame.bind(e),this.requestAnimationFrame=e.msRequestAnimationFrame.bind(e)):e.oRequestAnimationFrame?(this.cancelAnimationFrame=e.oCancelAnimationFrame.bind(e),this.requestAnimationFrame=e.oRequestAnimationFrame.bind(e)):(this.cancelAnimationFrame=e.clearTimeout.bind(e),this.requestAnimationFrame=function(t){return e.setTimeout(t,1e3/60)})}return e}(),Ps=new Ts(rr),ks=function(e){function r(t,r){e.call(this,t,r),this.scheduler=t,this.work=r}return t(r,e),r.prototype.requestAsyncId=function(t,r,n){return void 0===n&&(n=0),null!==n&&n>0?e.prototype.requestAsyncId.call(this,t,r,n):(t.actions.push(this),t.scheduled||(t.scheduled=Ps.requestAnimationFrame(t.flush.bind(t,null))))},r.prototype.recycleAsyncId=function(t,r,n){return void 0===n&&(n=0),null!==n&&n>0||null===n&&this.delay>0?e.prototype.recycleAsyncId.call(this,t,r,n):void(0===t.actions.length&&(Ps.cancelAnimationFrame(r),t.scheduled=void 0))},r}(vn),As=function(e){function r(){e.apply(this,arguments)}return t(r,e),r.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,r=this.actions,n=-1,i=r.length;e=e||r.shift();do if(t=e.execute(e.state,e.delay))break;while(++n<i&&(e=r.shift()));if(this.active=!1,t){for(;++n<i&&(e=r.shift());)e.unsubscribe();throw t}},r}(gn),Rs=new As(ks),Os={asap:Ta,queue:ni,animationFrame:Rs,async:bn},Is={rxSubscriber:cr,observable:pr,iterator:kr};e.Scheduler=Os,e.Symbol=Is,e.Subject=gr,e.AnonymousSubject=br,e.Observable=fr,e.Subscription=sr,e.Subscriber=hr,e.AsyncSubject=wr,e.ReplaySubject=ii,e.BehaviorSubject=Yo,e.ConnectableObservable=$o,e.Notification=Xr,e.EmptyError=ho,e.ArgumentOutOfRangeError=ro,e.ObjectUnsubscribedError=mr,e.TimeoutError=Ya,e.UnsubscriptionError=ar,e.TimeInterval=Ga,e.Timestamp=rs,e.TestScheduler=Cs,e.VirtualTimeScheduler=xs,e.AjaxResponse=Yn,e.AjaxError=Zn,e.AjaxTimeoutError=Jn,Object.defineProperty(e,"__esModule",{value:!0})}),define("wed/browsers",["require","exports","module"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CHROME=navigator.userAgent.indexOf(" Chrome/")!==-1,t.MSIE_TO_10=navigator.userAgent.indexOf(" MSIE ")!==-1;var n=" like Gecko";t.MSIE_11_AND_UP=navigator.userAgent.indexOf(n,navigator.userAgent.length-n.length)!==-1,t.MSIE=t.MSIE_11_AND_UP||t.MSIE_TO_10,t.FIREFOX=navigator.userAgent.indexOf(" Firefox/")!==-1,t.FIREFOX_24=navigator.userAgent.indexOf(" Firefox/24")!==-1,t.GECKO=navigator.userAgent.indexOf(" Gecko/")!==-1,t.OSX=0===navigator.platform.lastIndexOf("Mac",0),t.WINDOWS="Win32"===navigator.platform}),define("wed/domtypeguards",["require","exports","module"],function(e,t,r){"use strict";function n(e){return null!=e&&"number"==typeof e.nodeType}function i(e){return null!=e&&e.nodeType===Node.ELEMENT_NODE}function o(e){return null!=e&&e.nodeType===Node.TEXT_NODE}function a(e){return e instanceof Attr||e.nodeType===c}function s(e){return e instanceof Attr}function l(e){return null!=e&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE}function u(e){return null!=e&&e.nodeType===Node.DOCUMENT_NODE}Object.defineProperty(t,"__esModule",{value:!0}),t.isNode=n,t.isElement=i,t.isText=o;var c=Node.ATTRIBUTE_NODE,h=void 0===c?s:a;t.isAttr=h,t.isDocumentFragment=l,t.isDocument=u}),define("wed/util",["require","exports","module"],function(e,t,r){"use strict";function n(e,t){return Math.sqrt(e*e+t*t)}function i(e,t,r,i,o,a){var s=t-i,l=e-r,u=t-a,c=e-o,h=s<0,d=u>0,p=l<0,f=c>0,m=p?l:f?c:0,v=h?s:d?u:0;return n(m,v)}function o(e,t,r,n,i,o){var a=t-n,s=e-r,l=t-o,u=e-i,c=a<0,h=l>0,d=s<0,p=u>0,f=d?s:p?u:0,m=c?a:h?l:0;return{x:Math.abs(f),y:Math.abs(m)}}function a(e){return e.replace(/([\][\\\/!"#$%&'()*+,.:;<=>?@^`{|}~])/g,"\\$1")}function s(e){return e.classList[0]}function l(e,t){if("*"===e)return"._real";var r=e.split(":"),n=r[0],i=r[1];void 0===i&&(i=n,n="");var o=t[n];if(void 0===o)throw new Error("prefix "+n+" is not defined in namespaces");return"._local_"+a(i)+"._xmlns_"+a(o)+"._real"}function u(e){return e.slice(9).replace(/---/,":").replace(/---(-+)/g,"--$1")}function c(e,t){var r=e.replace(/--(-+)/g,"---$1").replace(/:/,"---");return t=void 0===t?"":"-"+t+"-","data-wed-"+t+r}function h(e){return/^data-wed-(?!-)/.test(e)}function d(e){for(var t=Object.create(null),r=e.attributes,n=0;n<r.length;++n){var i=r[n],o=i.localName;h(o)&&(t[u(o)]=i.value)}return t}function p(){return"WED-ID-"+ ++E}function f(e){var t=e;return t.altKey||t.ctrlKey||t.metaKey}function m(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=window;void 0===r.selenium_log&&(r.selenium_log=[]),r.selenium_log.push.apply(r.selenium_log,e)}function v(e){try{throw e}catch(e){return e.stack}}function y(){var e=new Error;return null!=e.stack?e.stack:v(e)}function g(e,t){if(null!=e.a&&null!=e.b)return"("+g(e.a,t)+") or ("+g(e.b,t)+")";var r;if("AnyName"===e.pattern)r="*:*";else{if(void 0===e.ns)throw new Error("unexpected undefined obj.ns");if(void 0!==e.name)r=t.unresolveName(e.ns,e.name),void 0===r&&(r="{"+e.ns+"}"+e.name);else{var n=t.prefixFromURI(e.ns);r=void 0===n?"{"+e.ns+"}":""!==n?n+":":n,r+="*"}}return null!=e.except&&(r+=" except ("+g(e.except,t)+")"),r}function b(e){var t=new FileReader;return new Promise(function(r,n){t.onload=function(){r(t.result)},t.onerror=n,t.readAsText(e)})}function w(e,t){var r=void 0!==Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__;r!==t&&(void 0!==Object.setPrototypeOf?Object.setPrototypeOf(e,t.prototype):e.__proto__=t.prototype)}function _(e){var t=e;return t.suppressUnhandledRejections&&t.suppressUnhandledRejections(),e}Object.defineProperty(t,"__esModule",{value:!0}),t.distFromDeltas=n,t.distFromRect=i,t.distsFromRect=o,t.escapeCSSClass=a,t.getOriginalName=s,t.classFromOriginalName=l,t.decodeAttrName=u,t.encodeAttrName=c,t.isXMLAttrName=h,t.getOriginalAttributes=d;var E=0;t.newGenericID=p,t.anySpecialKeyHeld=f,t.seleniumLog=m,t.stackTrace=y,t.convertPatternObj=g,t.readFile=b,t.fixPrototype=w,t.suppressUnhandledRejections=_}),define("wed/domutil",["require","exports","module","jquery","rangy","./domtypeguards","./util"],function(e,t,r,n,i,o,a){"use strict";function s(e,t){for(var r=e.length,n=0;n<r;++n)if(e[n]===t)return n;return-1}function l(e){var t=i.getSelection(e);if(!(void 0===t||t.rangeCount<1))return t.getRangeAt(0)}function u(e,t,r,n){var o=i.createRange(e.ownerDocument),a=!1;return i.dom.comparePoints(e,t,r,n)<=0?(o.setStart(e,t),o.setEnd(r,n)):(o.setStart(r,n),o.setEnd(e,t),a=!0),{range:o,reversed:a}}function c(e){var t=null!=e?e.nodeType:void 0;switch(t){case Node.TEXT_NODE:if(null==e.parentNode)throw new Error("detached node");e.parentNode.focus();break;case Node.ELEMENT_NODE:e.focus();break;default:throw new Error("tried to focus something other than a text node or an element.")}}function h(e,t,r){var n=e[0],i=e[1],a=!1;if(!t.contains(n))return null;var l,u=o.isDocument(n)?n:n.ownerDocument,c=u.defaultView;e:for(;!a;)switch(l=n.parentNode,n.nodeType){case Node.TEXT_NODE:if(i>=n.length||null!=l&&l.lastChild===n&&"normal"===c.getComputedStyle(l,void 0).whiteSpace&&/^\s+$/.test(n.data.slice(i))){if(null==l||n===t)break e;i=s(l.childNodes,n)+1,n=l}else i++,a=!0;break;case Node.ELEMENT_NODE:if(i>=n.childNodes.length){if(null==l||n===t)break e;i=s(l.childNodes,n)+1,n=l,a=!0}else n=n.childNodes[i],i=0,a=!(n.childNodes.length>0&&o.isText(n.childNodes[i]))}if(!a)return null;if(r&&o.isText(n)){if(l=n.parentNode,null==l)throw new Error("detached node");i=s(l.childNodes,n),n=l}return!t.contains(n)||n===t&&i>=n.childNodes.length?null:[n,i]}function d(e,t,r){var n=e[0],i=e[1],a=!1;if(!t.contains(n))return null;var l,u=o.isDocument(n)?n:n.ownerDocument,c=u.defaultView;e:for(;!a;){if(i--,n===t&&i<0)return null;switch(l=n.parentNode,n.nodeType){case Node.TEXT_NODE:if(i<0||null!=l&&l.firstChild===n&&"normal"===c.getComputedStyle(l,void 0).whiteSpace&&/^\s+$/.test(n.data.slice(0,i))){if(null===l||n===t)break e;i=s(l.childNodes,n),n=l}else a=!0;break;case Node.ELEMENT_NODE:if(i<0||0===n.childNodes.length){if(null==l||n===t)break e;i=s(l.childNodes,n),n=l,a=!0}else n=n.childNodes[i],o.isElement(n)?(i=n.childNodes.length,a=!(n.childNodes.length>0&&o.isText(n.childNodes[i-1]))):i=n.length+1}}if(!a)return null;if(r&&o.isText(n)){if(l=n.parentNode,null==l)throw new Error("detached node");i=s(l.childNodes,n),n=l}return!t.contains(n)||n===t&&i<0?null:[n,i]}function p(e,t,r){for(var n=[],i=r;i!==e;){var o=i.parentNode;if(null==o)throw new Error("nodeInA is not treeA or a child of treeA");n.unshift(s(o.childNodes,i)),i=o}for(var a=t;0!==n.length;)a=a.childNodes[n.shift()];return a}function f(e){var t=document.createElement("span");return t.className="_placeholder",t.setAttribute("contenteditable","true"),t.textContent=void 0!==e?e:" ",t}function m(e,t,r,n){if(void 0===n&&(n=!0),!o.isText(e))throw new Error("insertIntoText called on non-text");var i,a;void 0===n&&(n=!0),t<0?t=0:t>e.length&&(t=e.length);var l,u,c=o.isDocumentFragment(r),h=e.parentNode;if(null==h)throw new Error("detached node");var d=s(h.childNodes,e);if(n&&(null==r||c&&0===r.childNodes.length))i=a=[e,t];else{var p=document.createDocumentFragment();l=document.createTextNode(e.data.slice(0,t)),p.appendChild(l),null!=r&&p.appendChild(r),u=document.createTextNode(e.data.slice(t));var f=u.length;if(p.appendChild(u),n&&p.normalize(),i=n&&0===t?[h,d]:[p.firstChild,t],a=n&&t===e.length?[h,d+p.childNodes.length]:[p.lastChild,p.lastChild.length-f],this.deleteNode(e),void 0!==this.insertFragAt)this.insertFragAt(h,d,p);else for(;null!=p.firstChild;)this.insertNodeAt(h,d++,p.firstChild)}return[i,a]}function v(e,t,r){if(null==r)throw new Error("must pass an actual node to insert");return m.call(this,e,t,r)}function y(e,t,r,n){if(void 0===n&&(n=!0),""===r)return{node:void 0,isNew:!1,caret:[e,t]};var i,a,s=!1;e:for(;;)switch(e.nodeType){case Node.ELEMENT_NODE:var l=e.childNodes[t];if(o.isText(l)){e=l,t=0;continue e}var u=e.childNodes[t-1];if(o.isText(u)){e=u,t=u.length;continue e}i=document.createTextNode(r),s=!0,this.insertNodeAt(e,t,i),a=[i,n?r.length:0];break e;case Node.TEXT_NODE:i=e;var c=i.data.slice(0,t),h=i.data.slice(t);this.setTextNodeValue(i,c+r+h),a=[i,n?t+r.length:t];break e;default:throw new Error("unexpected node type: "+e.nodeType)}return{node:i,isNew:s,caret:a}}function g(e,t,r){if(!o.isText(e))throw new Error("deleteText called on non-text");if(e.deleteData(t,r),0===e.length){if(null==e.parentNode)throw new Error("detached node");e.parentNode.removeChild(e)}}function b(e,t){n.data(e,"wed_mirror_node",t),n.data(t,"wed_mirror_node",e);for(var r=0;r<e.children.length;++r){var i=e.children[r],o=t.children[r];b(i,o)}}function w(e){n.removeData(e,"wed_mirror_node");for(var t=0;t<e.children.length;++t)w(e.children[t])}function _(e){for(void 0===e&&(e=null);null!==e&&null!==e.firstChild;)e=e.firstChild;return e}function E(e){for(void 0===e&&(e=null);null!==e&&null!==e.lastChild;)e=e.lastChild;return e}function x(e){if(null==e.parentNode)throw new Error("detached node");e.parentNode.removeChild(e)}function S(e,t,r){var n=e.childNodes[t];e.insertBefore(r,null!=n?n:null)}function N(e,t,r,n){return y.call({insertNodeAt:S,setTextNodeValue:function(e,t){e.data=t}},e,t,r,n)}function C(e,t,r,n){return void 0===n&&(n=!0),m.call(Y,e,t,r,n)}function T(e,t,r){return v.call(Y,e,t,r)}function P(e,t){var r=C(e,t,void 0,!1);return[r[0][0],r[1][0]]}function k(e){var t=e.nextSibling;if(o.isText(e)&&o.isText(t)){var r=e.length;return e.appendData(t.data),t.parentNode.removeChild(t),[e,r]}var n=e.parentNode;if(null==n)throw new Error("detached node");return[n,s(n.childNodes,e)+1]}function A(e){var t;switch(e.startContainer.nodeType){case Node.TEXT_NODE:if(t=e.startContainer.parentNode,null==t)throw new Error("detached node");break;case Node.ELEMENT_NODE:t=e.startContainer;break;default:throw new Error("unexpected node type: "+e.startContainer.nodeType)}var r;switch(e.endContainer.nodeType){case Node.TEXT_NODE:if(r=e.endContainer.parentNode,null==r)throw new Error("detached node");break;case Node.ELEMENT_NODE:r=e.endContainer;break;default:throw new Error("unexpected node type: "+e.endContainer.nodeType)}return[t,r]}function R(e){var t=A(e);return t[0]===t[1]}function O(e,t){if(!R({startContainer:e[0],startOffset:e[1],endContainer:t[0],endOffset:t[1]}))throw new Error("range is not well-formed");var r=e[0],n=e[1],i=t[0],a=t[1],l=r.parentNode;if(null==l)throw new Error("detached node");var u,c;if(o.isText(r)&&0===n&&(n=s(l.childNodes,r),r=l,l=r.parentNode,null==l))throw new Error("detached node");if(o.isText(r)){var h=r===i,d=s(l.childNodes,r),p=h?a:r.length;if(c=l.ownerDocument.createTextNode(r.data.slice(n,p)),this.deleteText(r,n,c.length),u=null!=r.parentNode?[r,n]:[l,d],h)return[u,[c]];n=null!=r.parentNode?d+1:d,r=l}else u=[r,n];var f;if(o.isText(i)){if(l=i.parentNode,null==l)throw new Error("detached node");var m=s(l.childNodes,i);f=l.ownerDocument.createTextNode(i.data.slice(0,a)),this.deleteText(i,0,a),a=m,i=l}if(r!==i)throw new Error("internal error in cut: containers unequal");if(!o.isElement(r))throw new Error("internal error in cut: not an element");var v=[];for(a--;a>=n;)v.unshift(i.childNodes[a]),this.deleteNode(i.childNodes[a]),a--;return null!=c&&v.unshift(c),null!=f&&v.push(f),null!=i.childNodes[a]&&this.mergeTextNodes(i.childNodes[a]),[u,v]}function I(e,t){null==t?console.log(e,"no range"):console.log(e,t.startContainer,t.startOffset,t.endContainer,t.endOffset)}function D(e,t){I(e,l(t))}function M(e,t){var r;return r=null==t?[e,"no range"]:[e,t.startContainer.outerHTML,t.startOffset,t.endContainer.outerHTML,t.endOffset],r.join(", ")}function L(e,t,r){var n=e.ownerDocument.body,i=e.getBoundingClientRect();return t-=i.left+n.scrollLeft,r-=i.top+n.scrollTop,t>=0&&r>=0&&t<e.clientWidth&&r<e.clientHeight}function j(e,t,r){if(null==e)return null;for(o.isText(e)&&(e=e.parentNode);null!=e;){if(!o.isElement(e))return null;if(e.matches(t))break;if(e===r){e=null;break}e=e.parentNode}return e}function F(e,t,r){if(null==e)return null;for(o.isText(e)&&(e=e.parentNode);null!=e;){if(!o.isElement(e))return null;if(e.classList.contains(t))break;if(e===r){e=null;break}e=e.parentNode}return e}function B(e,t){if(!o.isElement(e))return null;var r=e.parentNode;if(null==r)return null;for(var n=r.firstElementChild;null!=n&&!n.classList.contains(t);)n=n.nextElementSibling;
return n}function V(e,t){if(!o.isElement(e))return[];for(var r=[],n=e.firstElementChild;null!=n;)n.classList.contains(t)&&r.push(n),n=n.nextElementSibling;return r}function H(e,t){if(!o.isElement(e))return null;for(var r=e.firstElementChild;null!=r&&!r.classList.contains(t);)r=r.nextElementSibling;return r}function W(e){return null==Z&&(Z=document.createElement("span")),Z.textContent=e,Z.innerHTML}function $(e,t){if(/[\]['"()]/.test(e))throw new Error("selector is too complex");if(/\\:/.test(e))throw new Error("we do not accept escaped colons for now");for(var r=e.split(ee),n=[],i=0,o=r;i<o.length;i++){var s=o[i];if(0!==s.length)if(J.indexOf(s)>-1)n.push(s);else if(/[a-zA-Z]/.test(s[0])){s=s.trim();var l=s.split(/(.#)/);n.push(a.classFromOriginalName(l[0],t)),n=n.concat(l.slice(1))}else n.push(s)}return n.join("")}function U(e,t,r){var i=$(t,r),o=n.data(e,"wed_mirror_node"),a=o.querySelector(i);if(null==a)return null;var s=n.data(a,"wed_mirror_node");return null!=s?s:null}function q(e,t,r){for(var i=$(t,r),o=n.data(e,"wed_mirror_node"),a=o.querySelectorAll(i),s=[],l=0;l<a.length;++l)s.push(n.data(a[l],"wed_mirror_node"));return s}function z(e,t){var r=null!=t?t:window.document,n=r.createDocumentFragment(),i=r.createElement("div");n.appendChild(i),i.innerHTML=e;for(var o=Array.prototype.slice.call(i.childNodes);null!==i.firstChild;)i.removeChild(i.firstChild);return o}function K(e){var t=e[0],r=e[1];switch(t.nodeType){case Node.TEXT_NODE:var n=t.data;return n[r-1];case Node.ELEMENT_NODE:var i=t.childNodes[r-1];if(o.isText(i))return i.data[i.data.length-1];break;default:throw new Error("unexpected node type: "+t.nodeType)}}function G(e){var t=e[0],r=e[1];switch(t.nodeType){case Node.TEXT_NODE:var n=t.data;return n[r];case Node.ELEMENT_NODE:var i=t.childNodes[r];if(o.isText(i))return i.data[0];break;default:throw new Error("unexpected node type: "+t.nodeType)}}function Q(e,t){for(var r=e.ownerDocument.defaultView;null!=e&&e!==t;){if("none"===e.style.display)return!0;var n=r.getComputedStyle(e).getPropertyValue("display");if("none"===n)return!0;e=e.parentNode}return!1}function X(e,t){return o.isAttr(t)&&(t=t.ownerElement),e.contains(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.isAttr=o.isAttr,t.indexOf=s,t.getSelectionRange=l,t.rangeFromPoints=u,t.focusNode=c,t.nextCaretPosition=h,t.prevCaretPosition=d,t.correspondingNode=p,t.makePlaceholder=f,t.genericInsertIntoText=v,t.genericInsertText=y,t.deleteText=g,t.linkTrees=b,t.unlinkTree=w,t.firstDescendantOrSelf=_,t.lastDescendantOrSelf=E,t.deleteNode=x,t.insertText=N;var Y={insertNodeAt:S,insertFragAt:S,deleteNode:x};t.insertIntoText=T,t.splitTextNode=P,t.mergeTextNodes=k,t.isWellFormedRange=R,t.genericCutFunction=O,t.dumpRange=I,t.dumpCurrentSelection=D,t.dumpRangeToString=M,t.pointInContents=L,t.closest=j,t.closestByClass=F,t.siblingByClass=B,t.childrenByClass=V,t.childByClass=H;var Z;t.textToHTML=W;var J=",>+~ ",ee=new RegExp("(["+J+"]+)");t.toGUISelector=$,t.dataFind=U,t.dataFindAll=q,t.htmlToElements=z,t.getCharacterImmediatelyBefore=K,t.getCharacterImmediatelyAt=G,t.isNotDisplayed=Q,t.contains=X}),define("wed/dloc",["require","exports","module","jquery","rangy","./domtypeguards","./domutil"],function(e,t,r,n,i,o,a){"use strict";function s(e){var t;if(o.isAttr(e))t=e.value.length;else switch(e.nodeType){case Node.TEXT_NODE:t=e.data.length;break;case Node.DOCUMENT_NODE:case Node.ELEMENT_NODE:t=e.childNodes.length;break;default:throw new Error("unexpected node type")}return t}function l(e,t,r){for(var n=e.firstChild,i=0;null!==n&&!n.contains(r);)i++,n=n.nextSibling;return t-i<=0?-1:1}function u(e){for(;null!=e;){if(o.isElement(e)||o.isDocument(e)){var t=n.data(e,"wed-dloc-root");if(null!=t)return t}e=e.parentNode}}function c(e){var t=u(e);if(null==t)throw new Error("no root found");return t}Object.defineProperty(t,"__esModule",{value:!0});var h=function(){function e(e){if(this.node=e,null!=n.data(e,"wed-dloc-root"))throw new Error("node already marked as root");n.data(e,"wed-dloc-root",this)}return e.prototype.nodeToPath=function(e){if(null==e)throw new Error("invalid node parameter");var t=this.node;if(t===e)return"";if(!a.contains(t,e))throw new Error("node is not a descendant of root");for(var r=[];e!==t;){var n=void 0;if(o.isAttr(e))n=e.ownerElement,r.unshift("@"+e.name);else{var i=0;n=e.parentNode;for(var s=e.previousSibling;null!==s;){var l=s.nodeType;l!==Node.TEXT_NODE&&l!==Node.ELEMENT_NODE||i++,s=s.previousSibling}r.unshift(String(i))}e=n}return r.join("/")},e.prototype.pathToNode=function(e){var t=this.node;if(""===e)return t;var r,n=e.split(/\//),i=t;"@"===n[n.length-1][0]&&(r=n.pop());for(var a=0,s=n;a<s.length;a++){var l=s[a];if(!/^(\d+)$/.test(l))throw new Error("malformed path expression");for(var u=parseInt(l),c=null,h=i.firstChild;null!==h&&null===c;){var d=h.nodeType;(d===Node.TEXT_NODE||d===Node.ELEMENT_NODE)&&--u<0&&(c=h),h=h.nextSibling}if(null===c)return null;i=c}if(void 0===r)return i;if(!o.isElement(i))throw new Error("parent must be an element since we are looking for an attribute");return i.getAttributeNode(r.slice(1))},e}();t.DLocRoot=h;var d=function(){function e(e,t,r){this.root=e,this.node=t,this.offset=r}return Object.defineProperty(e.prototype,"pointedNode",{get:function(){return o.isElement(this.node)?this.node.childNodes[this.offset]:this.node},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.root,this.node,this.offset)},e.makeDLoc=function(t,r,i,o){if(r instanceof Array&&(o=i,c=r,r=c[0],i=c[1]),void 0===o&&(o=!1),null!=r){if(void 0===i){var l=r.parentNode;if(null===l)throw new Error("trying to get parent of a detached node");i=a.indexOf(l.childNodes,r),r=l}else{if("number"!=typeof i)throw new Error("offset is not a number, somehow");if(i<0){if(!o)throw new Error("negative offsets are not allowed");i=0}}if(t instanceof h)t=t.node;else if(null==n.data(t,"wed-dloc-root"))throw new Error("root has not been marked as a root");if(!a.contains(t,r))throw new Error("node not in root");var u=s(r);if(i>u){if(!o)throw new Error("offset greater than allowable value");i=u}return new e(t,r,i);var c}},e.mustMakeDLoc=function(e,t,r,n){var i=t;if(i instanceof Array&&(i=i[0]),null==i)throw new Error("called mustMakeDLoc with an absent node");return this.makeDLoc.apply(this,arguments)},e.prototype.make=function(t,r){if(t instanceof Array)return e.mustMakeDLoc(this.root,t);if(void 0!==r&&"number"!=typeof r)throw new Error("if the 1st argument is a node, the 2nd must be a number or undefined");return e.mustMakeDLoc(this.root,t,r)},e.prototype.makeWithOffset=function(e){return e===this.offset?this:this.make(this.node,e)},e.prototype.getLocationInParent=function(){var e=this.node,t=e.parentNode;if(null===t)throw new Error("trying to get parent of a detached node");return this.make(t,a.indexOf(t.childNodes,e))},e.prototype.getLocationAfterInParent=function(){var e=this.node,t=e.parentNode;if(null===t)throw new Error("trying to get parent of a detached node");return this.make(t,a.indexOf(t.childNodes,e)+1)},e.prototype.toArray=function(){return[this.node,this.offset]},e.prototype.makeRange=function(e){if(o.isAttr(this.node))throw new Error("cannot make range from attribute node");if(this.isValid()){if(void 0===e){var t=i.createRange(this.node.ownerDocument);return t.setStart(this.node,this.offset),t}if(o.isAttr(e.node))throw new Error("cannot make range from attribute node");if(e.isValid())return a.rangeFromPoints(this.node,this.offset,e.node,e.offset)}},e.prototype.makeDLocRange=function(e){if(this.isValid()){if(void 0===e)return new p(this,this);if(e.isValid())return new p(this,e)}},e.prototype.mustMakeDLocRange=function(e){var t=void 0!==e?this.makeDLocRange(e):this.makeDLocRange();if(void 0===t)throw new Error("cannot make a range");return t},e.prototype.isValid=function(){var e=this.node;return this.root.contains(o.isAttr(e)?e.ownerElement:e)&&this.offset<=s(e)},e.prototype.normalizeOffset=function(){var e=this.node,t=s(e);return this.offset>t?this.make(e,t):this},e.prototype.equals=function(e){return null!=e&&(this===e||this.node===e.node&&this.offset===e.offset)},e.prototype.compare=function(e){if(this.equals(e))return 0;var t=this,r=t.node,n=t.offset,i=e.node,s=e.offset;if(o.isAttr(r)){if(o.isAttr(i)&&r.ownerElement===i.ownerElement){var u=[r.name,i.name].sort();return u[0]===r.name?-1:1}var c=r.ownerElement;if(c===e.pointedNode)return 1;r=c.parentNode,n=a.indexOf(r.childNodes,c)}if(o.isAttr(i)){var c=i.ownerElement;if(c===this.pointedNode)return-1;i=c.parentNode,s=a.indexOf(i.childNodes,c)}if(r===i){var h=n-s;return 0===h?0:h<0?-1:1}var d=r.compareDocumentPosition(i);if(0!==(d&Node.DOCUMENT_POSITION_DISCONNECTED))throw new Error("cannot compare disconnected nodes");if(0!==(d&Node.DOCUMENT_POSITION_CONTAINED_BY))return l(r,n,i);if(0!==(d&Node.DOCUMENT_POSITION_CONTAINS))return l(i,s,r)<0?1:-1;if(0!==(d&Node.DOCUMENT_POSITION_PRECEDING))return 1;if(0!==(d&Node.DOCUMENT_POSITION_FOLLOWING))return-1;throw new Error("neither preceding nor following: this should not happen")},e}();t.DLoc=d,t.findRoot=u,t.getRoot=c;var p=function(){function e(e,t){if(this.start=e,this.end=t,e.root!==t.root)throw new Error("the start and end must be in the same document")}return Object.defineProperty(e.prototype,"collapsed",{get:function(){return this.start.equals(this.end)},enumerable:!0,configurable:!0}),e.prototype.makeDOMRange=function(){if(o.isAttr(this.start.node))throw new Error("cannot make range from attribute node");if(this.start.isValid()){if(o.isAttr(this.end.node))throw new Error("cannot make range from attribute node");if(this.end.isValid())return a.rangeFromPoints(this.start.node,this.start.offset,this.end.node,this.end.offset).range}},e.prototype.mustMakeDOMRange=function(){var e=this.makeDOMRange();if(void 0===e)throw new Error("cannot make a range");return e},e.prototype.equals=function(e){return null!=e&&(this===e||this.start.equals(e.start)&&this.end.equals(e.end))},e.prototype.isValid=function(){return this.start.isValid()&&this.end.isValid()},e.prototype.contains=function(e){var t=this.start.compare(e),r=this.end.compare(e);return t*r<=0},e}();t.DLocRange=p});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/guiroot",["require","exports","module","./dloc","./domtypeguards","./domutil","./util"],function(e,t,r,n,i,o,a){"use strict";function s(e){if(!i.isElement(e)||!e.classList.contains("_phantom_wrap"))throw new Error("the node should be a _phantom_wrap element");for(var t=0,r=e.firstChild;null!==r;){if(i.isElement(r)){if(r.classList.contains("_phantom_wrap"))t+=s(r);else if(r.classList.contains("_real"))t+=1;else if(!r.classList.contains("_phantom"))throw new Error("unexpected element in _phantom_wrap")}else if(r.nodeType!==Node.TEXT_NODE)throw new Error("unexpected node in _phantom_wrap");r=r.nextSibling}return t}function l(e,t){if(!i.isElement(e)||!e.classList.contains("_phantom_wrap"))throw new Error("the node should be a _phantom_wrap element");for(var r=t,n=null,o=e.firstChild;null===n&&null!==o;){if(i.isElement(o)){if(o.classList.contains("_phantom_wrap")){var a=l(o,t);null!==a.found&&(n=a.found),t-=a.count}else if(o.classList.contains("_real"))t-=1,t<0&&(n=o);else if(!o.classList.contains("_phantom"))throw new Error("unexpected element in _phantom_wrap")}else if(o.nodeType!==Node.TEXT_NODE)throw new Error("unexpected node in _phantom_wrap");o=o.nextSibling}return{found:n,count:r-t}}Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(r){var n=e.call(this,r)||this;return a.fixPrototype(n,t),n}return __extends(t,e),t}(Error);t.AttributeNotFound=u;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.nodeToPath=function(e){var t=this.node;if(null!==o.closestByClass(e,"_placeholder",t))throw new Error("cannot provide path to node because it is a placeholder node");if(t===e)return"";if(!t.contains(e))throw new Error("node is not a descendant of root");for(var r=[];e!==t;){var n=void 0;if(i.isElement(e)&&!e.matches("._real, ._phantom_wrap, ._attribute_value"))throw new Error("only nodes of class ._real, ._phantom_wrap, and ._attribute_value are supported");var a=o.closestByClass(e,"_attribute_value",t);if(null!==a){var l=o.siblingByClass(a,"_attribute_name");if(null===l)throw new Error("no attribute name found");if(r.unshift("@"+l.textContent),n=o.closestByClass(a,"_real",t),null===n)throw new Error("attribute is detached from real element")}else{if(n=e.parentNode,null===n)throw new Error("detached node");for(var u=0,c=o.indexOf(n.childNodes,e),h=0;h<c;++h){var l=n.childNodes[h];i.isText(l)||i.isElement(l)&&l.classList.contains("_real")?u++:i.isElement(l)&&l.classList.contains("_phantom_wrap")&&(u+=s(l))}i.isElement(n)&&n.classList.contains("_phantom_wrap")||r.unshift(String(u))}e=n}return r.join("/")},t.prototype.pathToNode=function(e){var t=this.node;if(""===e)return t;var r,n=e.split(/\//),a=t;"@"===n[n.length-1][0]&&(r=n.pop());for(var s=null,c=0,h=n;c<h.length;c++){var d=h[c],p=/^(\d+)$/.exec(d);if(null===p)throw new Error("malformed path expression");s=null;for(var f=parseInt(p[1]),m=0;null===s&&m<a.childNodes.length;m++){var v=a.childNodes[m];if((i.isText(v)||i.isElement(v)&&v.classList.contains("_real"))&&--f<0)s=v;else if(i.isElement(v)&&v.classList.contains("_phantom_wrap")){var y=l(v,f);null!==y.found&&(s=y.found),f-=y.count}}if(null===s)return null;a=s}if(void 0!==r){var g=r.slice(1);if(!i.isElement(a))throw new Error("looking for attribute on something which is not an element");var b=a.getElementsByClassName("_attribute_name");s=null;for(var w=0;w<b.length;++w){var _=b[w];if(_.textContent===g){s=_;break}}if(null===s)throw new u("could not find attribute with name: "+g);a=o.siblingByClass(s,"_attribute_value")}return a},t}(n.DLocRoot);t.GUIRoot=c}),define("wed/wed-util",["require","exports","module","./dloc","./domtypeguards","./guiroot"],function(e,t,r,n,i,o){"use strict";function a(e,t){var r=e.parentNode;return t.contains(r)?s(n.DLoc.mustMakeDLoc(t,e)):{left:0,top:0,bottom:0}}function s(e){var t,r=e.node,n=e.offset,o=i.isElement(r),s=i.isText(r);if(o)t=r.childNodes.length;else{if(!s)throw new Error("unexpected node type: "+r.nodeType);t=r.length}if(0===t)return a(r,e.root);for(var l,u,c=r.ownerDocument.createRange();n<t;){if(u=r.childNodes[n],i.isElement(u)?l=u.getClientRects()[0]:(c.setStart(r,n),c.setEnd(r,n+1),l=c.getClientRects()[0]),null!=l&&(0!==l.left||0!==l.right||0!==l.top||0!==l.bottom))return{left:l.left,top:l.top,bottom:l.bottom};n++}n=e.offset;for(var h=r.ownerDocument.defaultView;0!==n;){n--,u=void 0;var d=void 0;if(s)d=!0;else{if(!o)throw new Error("unexpected node type: "+r.nodeType);if(u=r.childNodes[n],i.isText(u))d=!0;else{if(!i.isElement(u))throw new Error("unexpected node type: "+u.nodeType);var p=h.getComputedStyle(u).getPropertyValue("display");d="inline"===p||"inline-block"===p}}var f=void 0;if(i.isElement(u)?f=u.getClientRects():(c.setStart(r,n),c.setEnd(r,n+1),f=c.getClientRects()),l=f[f.length-1],null!=l)return d?{left:l.right,top:l.top,bottom:l.bottom}:{left:l.left,top:l.top,bottom:l.bottom}}return a(r,e.root)}function l(e){if(!e.classList.contains("_attribute_value"))throw new Error("getAttrValueNode operates only on attribute values");var t=e,r=e.firstChild;if(null!==r){for(;null!==r&&!i.isText(r);)r=r.nextSibling;null!==r&&(t=r)}return t}function u(e,t){if(null!=t)try{var r=e.caretManager.fromDataLocation(t,0);return null!=r?r.node:void 0}catch(e){if(e instanceof o.AttributeNotFound)return;throw e}}Object.defineProperty(t,"__esModule",{value:!0}),t.boundaryXY=s,t.getAttrValueNode=l,t.getGUINodeIfExists=u}),define("wed/caret-mark",["require","exports","module","jquery","./domtypeguards","./wed-util"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,r,i,o){this.manager=e,this.layer=r,this.inputField=i,this.scroller=o,this.suspended=0,this.pendingRefresh=!1;var a=this.el=t.createElement("span");a.className="_wed_caret",a.setAttribute("contenteditable","false"),a.textContent=" ";var s=this.dummy=t.createElement("span");s.textContent=" ",s.style.height="100%",s.style.width="1px",s.style.maxWidth="1px",this.$dummy=n(s),this.boundRefresh=this.refresh.bind(this)}return e.prototype.suspend=function(){this.suspended++},e.prototype.resume=function(){if(this.suspended--,this.suspended<0)throw new Error("too many calls to resume");this.pendingRefresh&&(this.refresh(),this.pendingRefresh=!1)},e.prototype.refresh=function(){if(this.suspended>0)return void(this.pendingRefresh=!0);var e=this.manager.caret;if(null!=e){var t=o.boundaryXY(e),r=this.scroller.getBoundingClientRect(),n=t.top-r.top+this.scroller.scrollTop,a=t.left-r.left+this.scroller.scrollLeft,s=e.node,l=i.isElement(s)?s:s.parentNode,u=getComputedStyle(l).lineHeight,c=this.el,h=n+"px",d=a+"px";c.style.top=h,c.style.left=d,c.style.height=u,c.style.maxHeight=u,c.style.minHeight=u,null===c.parentNode&&this.layer.append(this.el);var p=this.inputField;Number(p.style.zIndex)>0?(p.style.top=h,p.style.left=d):(p.style.top="",p.style.left="")}},e.prototype.getPositionFromScroller=function(){var e=this.el,t={left:Number(e.style.left.replace("px","")),top:Number(e.style.top.replace("px",""))};if(isNaN(t.left)||isNaN(t.top))throw new Error("NAN for left or top");return t},Object.defineProperty(e.prototype,"inDOM",{get:function(){return null!==this.el.parentNode},enumerable:!0,configurable:!0}),e.prototype.scrollIntoView=function(){var e=this.getPositionFromScroller(),t=this.getBoundingClientRect();this.scroller.scrollIntoView(e.left,e.top,e.left+t.width,e.top+t.height)},e.prototype.getBoundingClientRect=function(){return this.el.getBoundingClientRect()},e}();t.CaretMark=a}),define("wed/caret-movement",["require","exports","module","./domtypeguards","./domutil","./wed-util"],function(e,t,r,n,i,o){"use strict";function a(e,t){return"edit"===t.getAttributeHandling(e)}function s(e,t,r){var n=i.closestByClass(e.node,"_placeholder",t);if(null!==n){var o=n.parentNode,a=i.indexOf(o.childNodes,n);r&&a++,e=e.make(o,a)}return e}function l(e){var t=e.firstChild;if(!n.isElement(t))throw new Error("docRoot does not contain an element");return t.classList.contains("_placeholder")&&(t=e),t}function u(e,t,r){var n=r.getMode(e),o=n.nodesAroundEditableContents(e),a=o[0],s=o[1];return!(null!==a&&i.indexOf(e.childNodes,a)>=t)&&!(null!==s&&i.indexOf(e.childNodes,s)<t)}function c(e,t){if(void 0===t||void 0===e)return!1;var r=t.firstChild,i=e.lastChild;return n.isElement(r)&&r.classList.contains("_gui")&&!r.classList.contains("_invisible")&&n.isElement(i)&&i.classList.contains("_gui")&&!i.classList.contains("_invisible")}function h(e,t){for(var r=Array.prototype.slice.call(e),n=0,i=r;n<i.length;n++){var o=i[n];if(0!==(o.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_PRECEDING))return o}}function d(e,t,r,n){var i=y[t];if(void 0===i)throw new Error("cannot resolve direction: "+t);return i(e,r,n)}function p(e,t,r){if(null!=e){var d=e.root;e=s(e,d,!0);for(var p=l(t);;){var f=i.closestByClass(e.node,"_gui",d),m=i.nextCaretPosition(e.toArray(),p,!1);if(null===m){e=null;break}e=e.make(m);var v=e.node,y=e.offset,g=i.closest(v,"._gui:not(._invisible)",d);if(null!==g){var b=g.classList.contains("__start_label");if(b&&a(i.closestByClass(g,"_real",d),r)){if(null!==i.closestByClass(v,"_attribute_value",d))break;if(null!==i.closest(v,"._element_name, ._attribute",d)){var w=h(g.getElementsByClassName("_attribute"),v);if(void 0!==w){var _=o.getAttrValueNode(i.childByClass(w,"_attribute_value"));e=e.make(_,0);break}}}if(f===g){e=e.make(g,g.childNodes.length);continue}e=e.make(b||null!==i.closestByClass(v,"_label",g)?v.getElementsByClassName("_element_name")[0]:g,0);break}var E=i.closestByClass(v,"_phantom",d);if(null===E){var x=i.closestByClass(v,"_placeholder",d);if(!(null!==x&&y>0)){if(n.isElement(v)){var S=v.childNodes[y];if(n.isText(S))continue;var N=v.childNodes[y-1];if(c(N,S))break;if(n.isElement(N)&&(n.isElement(S)&&!S.classList.contains("_end_wrapper")&&!N.classList.contains("_start_wrapper")||N.matches("._wed-validation-error, ._gui.__end_label")))continue;if(!u(v,y,r))continue}break}e=e.make(x,x.childNodes.length)}else e=e.make(E,E.childNodes.length)}return null!==e?e:void 0}}function f(e,t,r){if(null!=e){var o=e.root;e=s(e,o,!1);for(var h=l(t);;){var d=i.closestByClass(e.node,"_element_name",o),p=e.node===d&&0===e.offset,f=i.prevCaretPosition(e.toArray(),h,!1);if(null===f){e=null;break}e=e.make(f);var m=e.node,v=e.offset,y=i.closest(m,"._gui:not(._invisible)",o);if(null===y){var g=i.closestByClass(m,"_placeholder",o);if(null!==g){e=e.make(g.firstChild,0);break}var b=i.closestByClass(m,"_phantom",o);if(null===b){if(n.isElement(m)){var w=m.childNodes[v-1];if(n.isText(w))continue;var _=m.childNodes[v];if(c(w,_))break;if(n.isElement(_)&&(n.isElement(w)&&!w.classList.contains("_start_wrapper")&&!_.classList.contains("_end_wrapper")||_.matches("._gui.__start_label, .wed-validation-error")))continue;if(!u(m,v,r))continue}break}e=e.make(b,0)}else{var E=y.classList.contains("__start_label");if(E&&!p&&a(i.closestByClass(y,"_real",o),r)){if(null!==i.closestByClass(m,"_attribute_value",y))break;var x=i.closestByClass(m,"_attribute",y);null===x&&n.isElement(m)&&null!==m.nextElementSibling&&m.nextElementSibling.classList.contains("_attribute")&&(x=m.nextElementSibling),null===x&&(d=i.closestByClass(m,"_element_name",y),x=null!==d?d.nextElementSibling:null);var S=null!==x?x.previousElementSibling:null;if(null===S){var N=y.getElementsByClassName("_attribute");N.length>0&&(S=N[N.length-1])}if(null===S||S.classList.contains("_attribute")||(S=null),null!==S){var C=i.childByClass(S,"_attribute_value");if(v=0,null!==C.lastChild)if(C=C.lastChild,n.isElement(C)&&C.classList.contains("_placeholder"))v=0;else{if(!n.isText(C))throw new Error("unexpected content in attribute value");v=C.length}e=e.make(C,v);break}}if(!p){e=e.make(E||null!==i.closestByClass(m,"_label",y)?y.getElementsByClassName("_element_name")[0]:y,0);break}e=e.make(y,0)}}return null!==e?e:void 0}}function m(e,t,r){if(null!=e){for(var n=o.boundaryXY(e),i=n;n.bottom>i.top;){if(e=p(e,t,r),void 0===e)return;i=o.boundaryXY(e)}for(var a,s=i.bottom,l=1/0;void 0!==e;){var u=Math.abs(i.left-n.left);if(u>l)break;if(s<=i.top)break;l=u,a=e,e=p(e,t,r),void 0!==e&&(i=o.boundaryXY(e))}return a}}function v(e,t,r){if(null!=e){for(var n=o.boundaryXY(e),i=n;n.top<i.bottom;){if(e=f(e,t,r),void 0===e)return;i=o.boundaryXY(e)}for(var a,s=i.top,l=1/0;void 0!==e;){var u=Math.abs(i.left-n.left);if(u>l)break;if(i.bottom<=s)break;l=u,a=e,e=f(e,t,r),void 0!==e&&(i=o.boundaryXY(e))}return a}}Object.defineProperty(t,"__esModule",{value:!0});var y={right:p,left:f,up:v,down:m};t.newPosition=d,t.positionRight=p,t.positionLeft=f,t.positionDown=m,t.positionUp=v}),define("wed/object-check",["require","exports","module"],function(e,t,r){"use strict";function n(e,t){var r=e[t];if("object"==typeof r){for(var i in r)if(n(r,i))return!0;return!1}return r}function i(e,t,r,o){for(var a in e)if(n(e,a)){var s=void 0!==r?[r,a].join("."):a;if(a in t){var l=t[a],u=e[a];l instanceof Array||"object"!=typeof l||"object"!=typeof u||i(u,l,s,o)}else o.missing.push(s)}for(var c in t)if(!(c in e)){var s=void 0!==r?[r,c].join("."):c;o.extra.push(s)}}function o(e,t){var r={missing:[],extra:[]};i(e,t,void 0,r);var n=r;for(var o in n)0===n[o].length&&delete n[o];return n}Object.defineProperty(t,"__esModule",{value:!0}),t.check=o,t.check=o}),define("wed/wed-selection",["require","exports","module","./domutil"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,r){this.converter=e,this.anchor=t,this.focus=void 0===r?t:r}return Object.defineProperty(e.prototype,"range",{get:function(){var e=this.rangeInfo;if(void 0!==e)return e.range},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rangeInfo",{get:function(){return this.anchor.makeRange(this.focus)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"collapsed",{get:function(){return this.anchor.equals(this.focus)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wellFormed",{get:function(){var e=this.range;return void 0!==e&&n.isWellFormedRange(e)},enumerable:!0,configurable:!0}),e.prototype.asDataCarets=function(){var e=this.range;if(void 0!==e){var t=this.converter.toDataLocation(e.startContainer,e.startOffset),r=this.converter.toDataLocation(e.endContainer,e.endOffset);if(void 0!==t&&void 0!==r)return[t,r]}},e.prototype.mustAsDataCarets=function(){var e=this.asDataCarets();if(void 0===e)throw new Error("cannot get the selection as data carets");return e},e.prototype.equals=function(e){return null!=e&&(this.focus.equals(e.focus)&&this.anchor.equals(e.anchor))},e}();t.WedSelection=i}),define("wed/caret-manager",["require","exports","module","jquery","rangy","rxjs","./browsers","./caret-mark","./caret-movement","./dloc","./domtypeguards","./domutil","./object-check","./wed-selection","./wed-util"],function(e,t,r,n,i,o,a,s,l,u,c,h,d,p,f){"use strict";function m(e){if(!c.isElement(e))return null;for(var t=e.previousSibling;null!==t&&!(c.isText(t)||c.isElement(t)&&t.classList.contains("_real"));)t=t.previousSibling;return t}Object.defineProperty(t,"__esModule",{value:!0});var v={textEdit:!1,focus:!1},y=function(){function e(e,t,r,i,a,l,u){var c=this;this.guiRoot=e,this.dataRoot=t,this.inputField=r,this.guiUpdater=i,this.layer=a,this.scroller=l,this.modeTree=u,this.selectionStack=[],this.mark=new s.CaretMark(this,e.node.ownerDocument,a,r,l);var h=this.guiRootEl=e.node;this.dataRootEl=t.node,this.doc=h.ownerDocument,this.win=this.doc.defaultView,this.$inputField=n(this.inputField),this._events=new o.Subject,this.events=this._events.asObservable(),n(this.guiRootEl).on("focus",function(e){c.focusInputField(),e.preventDefault(),e.stopPropagation()}),n(this.win).on("blur.wed",this.onBlur.bind(this)),n(this.win).on("focus.wed",this.onFocus.bind(this))}return Object.defineProperty(e.prototype,"caret",{get:function(){return this.focus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sel",{get:function(){return this._sel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"focus",{get:function(){if(void 0!==this._sel)return this._sel.focus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){if(void 0!==this._sel)return this._sel.anchor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"range",{get:function(){var e=this.rangeInfo;return void 0!==e?e.range:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rangeInfo",{get:function(){var e=this._sel;if(void 0!==e)return e.rangeInfo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minCaret",{get:function(){return u.DLoc.mustMakeDLoc(this.guiRoot,this.guiRootEl,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxCaret",{get:function(){return u.DLoc.mustMakeDLoc(this.guiRoot,this.guiRootEl,this.guiRootEl.childNodes.length)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"docDLocRange",{get:function(){return new u.DLocRange(this.minCaret,this.maxCaret)},enumerable:!0,configurable:!0}),e.prototype.getNormalizedCaret=function(){var e=this.caret;if(void 0===e)return e;if(this.guiRootEl.contains(e.node)){if(!e.isValid()){var t=new p.WedSelection(this,this.anchor,e.normalizeOffset());this._sel=t,e=t.focus}var r=this._normalizeCaret(e);return null==r?void 0:r}},e.prototype.mustGetNormalizedCaret=function(){var e=this.getNormalizedCaret();if(void 0===e)throw new Error("cannot get a normalized caret");return e},e.prototype.normalizeToEditableRange=function(e){if(e.root!==this.guiRootEl)throw new Error("DLoc object must be for the GUI tree");var t=e.offset,r=e.node;if(c.isElement(r)){var n=this.modeTree.getMode(r),i=n.nodesAroundEditableContents(r),o=i[0],a=i[1],s=null!==o?h.indexOf(r.childNodes,o):-1;if(t<=s)t=s+1;else{var l=null!==a?h.indexOf(r.childNodes,a):r.childNodes.length;t>=l&&(t=l)}return e.makeWithOffset(t)}return e},e.prototype.getDataCaret=function(e){var t=this.getNormalizedCaret();if(void 0!==t)return this.toDataLocation(t,e)},e.prototype.fromDataLocation=function(e,t){if(e instanceof u.DLoc&&(t=e.offset,e=e.node),void 0===t)throw new Error("offset is undefined");var r=this.guiUpdater.fromDataLocation(e,t);if(null!==r){var n=r.offset;if(e=r.node,c.isElement(e)){var i=this.modeTree.getMode(e),o=i.nodesAroundEditableContents(e),a=o[0],s=o[1],l=null!==a?h.indexOf(e.childNodes,a):-1;if(n<=l)n=l+1;else{var d=null!==s?h.indexOf(e.childNodes,s):e.childNodes.length;n>=d&&(n=d)}return r.makeWithOffset(n)}return r}},e.prototype.mustFromDataLocation=function(e,t){var r=this.fromDataLocation.apply(this,arguments);if(void 0===r)throw new Error("cannot convert to a data location");return r},e.prototype.toDataLocation=function(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=!1);var n,i;if(e instanceof u.DLoc){if("boolean"!=typeof t)throw new Error("2nd argument must be a boolean");r=t,t=e.offset,n=e.node,i=e.root}else n=e;if("number"!=typeof t)throw new Error("offset must be a number");var o=this.makeCaret(n,t);if(null===h.closestByClass(n,"_attribute_value",i)){var a=h.closestByClass(n,"_phantom_wrap",i);if(null!==a)o=this.makeCaret(a.getElementsByClassName("_real")[0]);else{for(var s=void 0,l=c.isText(n)?n.parentNode:n;null!==l&&l!==this.guiRootEl;){if(l.classList.contains("_phantom")||l.classList.contains("_gui")){if(!r)return;s=l}l=l.parentNode}void 0!==s&&(o=this.makeCaret(s))}}var d=this._normalizeCaret(o);if(null!=d){n=d.node,t=d.offset;var p=this.dataRoot.pathToNode(this.guiRoot.nodeToPath(n));if(c.isText(n))return this.makeCaret(p,t,!0);if(t>=n.childNodes.length)return null===p?void 0:this.makeCaret(p,p.childNodes.length);var f=n.childNodes[t];if(c.isElement(f)&&!f.classList.contains("_real")){var v=m(f);if(null===v)return this.makeCaret(p,0);if(p=this.dataRoot.pathToNode(this.guiRoot.nodeToPath(v)),null===p)return;var y=p.parentNode;return this.makeCaret(y,h.indexOf(y.childNodes,p)+1)}return p=this.dataRoot.pathToNode(this.guiRoot.nodeToPath(f)),this.makeCaret(p,c.isAttr(p)?t:void 0)}},e.prototype._normalizeCaret=function(e){if(null==e)return e;var t=h.closestByClass(e.node,"_placeholder",e.root);return null!==t?e.make(t):e},e.prototype.makeCaret=function(e,t,r){if(void 0===r&&(r=!1),null!=e){var n;if(this.guiRootEl.contains(e)?n=this.guiRoot:h.contains(this.dataRootEl,e)&&(n=this.dataRoot),void 0!==n)return u.DLoc.mustMakeDLoc(n,e,t,r)}},e.prototype.setRange=function(e,t,r,n){var i,o;if(e instanceof u.DLoc&&t instanceof u.DLoc?(i=e,o=t):(i=this.makeCaret(e,t),o=this.makeCaret(r,n)),void 0===i||void 0===o)throw new Error("must provide both anchor and focus");if(i.root===this.dataRootEl&&(i=this.fromDataLocation(i),o=this.fromDataLocation(o),void 0===i||void 0===o))throw new Error("cannot find GUI anchor and focus");var a=this._sel=new p.WedSelection(this,i,o);if(void 0===this.prevCaret||!this.prevCaret.equals(o)){this.mark.refresh();var s=a.rangeInfo;if(void 0===s)throw new Error("unable to make a range");this._setDOMSelectionRange(s.range,s.reversed)}this._caretChange()},e.prototype.newPosition=function(e,t){return l.newPosition(e,t,this.guiRootEl,this.modeTree)},e.prototype.newCaretPosition=function(e){return this.newPosition(this.caret,e)},e.prototype.move=function(e,t){void 0===t&&(t=!1);var r=this.newCaretPosition(e);if(void 0!==r)if(t){var n=this.anchor;void 0!==n&&this.setRange(n,r)}else this.setCaret(r)},e.prototype.setCaret=function(e,t,r){var n;if(e instanceof u.DLoc){if(n=e,"number"==typeof t)throw new Error("2nd argument must be options");r=t,
t=void 0}else{if(void 0!==t&&"number"!=typeof t)throw new Error("2nd argument must be number");var i=this.makeCaret(e,t);if(void 0===i)return;n=i}if(void 0!==r){var o=d.check(v,r);if(void 0!==o.missing)throw new Error("there are missing options");if(void 0!==o.extra)throw new Error("unknown options passed to setCaret: "+o.extra.join(","))}else r={};this._setGUICaret(n.root===this.guiRootEl?n:this.fromDataLocation(n),r)},e.prototype.setCaretToLabelPosition=function(e,t,r){var n,i=0,o=h.closestByClass(e,"_attribute",t);null!==o?null!==h.closestByClass(r.node,"_attribute_value",t)?(n=r.node,i=r.offset):n=f.getAttrValueNode(o.getElementsByClassName("_attribute_value")[0]):n=t.getElementsByClassName("_element_name")[0],this.setCaret(n,i)},e.prototype.pushSelection=function(){this.selectionStack.push(this._sel),a.MSIE_TO_10&&this._clearDOMSelection()},e.prototype.popSelection=function(){this._sel=this.selectionStack.pop(),this._restoreCaretAndSelection(!1)},e.prototype.popSelectionAndDiscard=function(){this.selectionStack.pop()},e.prototype._restoreCaretAndSelection=function(e){if(void 0!==this.caret&&void 0!==this.anchor&&this.guiRootEl.contains(this.anchor.node)){var t=this.rangeInfo;if(void 0===t)throw new Error("could not make a range");this._setDOMSelectionRange(t.range,t.reversed),t.range.collapsed&&this.focusInputField(),this.mark.refresh(),this._caretChange({gainingFocus:e})}else this.clearSelection()},e.prototype.clearSelection=function(){this._sel=void 0,this.mark.refresh();var e=this._getDOMSelection();e.rangeCount>0&&this.guiRootEl.contains(e.focusNode)&&e.removeAllRanges(),this._caretChange()},e.prototype._getDOMSelectionRange=function(){var e=h.getSelectionRange(this.win);if(void 0!==e&&this.guiRootEl.contains(e.startContainer)&&this.guiRootEl.contains(e.endContainer))return e},e.prototype._setDOMSelectionRange=function(e,t){if(e.collapsed)return void this._clearDOMSelection();a.FIREFOX&&h.focusNode(e.endContainer),a.MSIE_TO_10&&this._clearDOMSelection();var r=this._getDOMSelection();r.setSingleRange(e,t)},e.prototype._setGUICaret=function(e,t){var r=e.offset,n=e.node;if(c.isElement(n)){if(n.classList.contains("_attribute_value")){var i=f.getAttrValueNode(n);n!==i&&(n=i,e=e.make(n,r))}var o=h.childByClass(n,"_placeholder");null===o||o.classList.contains("_dying")||(n=o,r=0,e=e.make(n,r))}void 0!==this.caret&&this.anchor===this.caret&&this.caret.node===n&&this.caret.offset===r||(t.focus!==!1&&this._clearDOMSelection(!0),this._sel=new p.WedSelection(this,e),this.mark.refresh(),t.focus!==!1&&this.focusInputField(),this._caretChange(t))},e.prototype._caretChange=function(e){void 0===e&&(e={});var t=this.prevCaret,r=this.caret;void 0!==t&&t.equals(r)||(this._events.next({manager:this,caret:r,prevCaret:t,options:e}),this.prevCaret=r)},e.prototype._clearDOMSelection=function(e){void 0===e&&(e=!1),this._getDOMSelection().removeAllRanges(),e||this.focusInputField()},e.prototype._getDOMSelection=function(){return i.getSelection(this.win)},e.prototype.focusInputField=function(){this.win.focus(),this.$inputField.blur(),this.$inputField.focus()},e.prototype.onBlur=function(){void 0!==this.caret&&(this.selAtBlur=this._sel,this.$inputField.blur(),this._sel=void 0,this.mark.refresh())},e.prototype.onFocus=function(){void 0!==this.selAtBlur&&(this._sel=this.selAtBlur,this._restoreCaretAndSelection(!0),this.selAtBlur=void 0)},e.prototype.highlightRange=function(e){for(var t=e.mustMakeDOMRange(),r=this.scroller.getBoundingClientRect(),n=this.scroller.scrollTop-r.top,i=this.scroller.scrollLeft-r.left,o=this.doc.createElement("div"),a=0,s=Array.from(t.nativeRange.getClientRects());a<s.length;a++){var l=s[a],u=this.doc.createElement("div");u.className="_wed_highlight",u.style.top=l.top+n+"px",u.style.left=l.left+i+"px",u.style.height=l.height+"px",u.style.width=l.width+"px",o.appendChild(u)}return this.layer.append(o),o},e.prototype.dumpCaretInfo=function(){var e=this.getDataCaret();void 0!==e?console.log("data caret",e.node,e.offset):console.log("no data caret"),void 0!==this.anchor?console.log("selection anchor",this.anchor.node,this.anchor.offset):console.log("no selection anchor");var t=this.caret;if(void 0!==t){var r=t.node,n=t.offset;if(console.log("selection focus",r,n),console.log("selection focus closest real",h.closestByClass(r,"_real",this.guiRootEl)),c.isText(r)&&n<r.data.length){var i=this.doc.createRange();i.setStart(r,n),i.setEnd(r,n+1);var o=i.getBoundingClientRect();console.log("rectangle around character at caret:",o)}}else console.log("no selection focus");h.dumpRange("DOM range: ",this._getDOMSelectionRange()),console.log("input field location",this.inputField.style.top,this.inputField.style.left),console.log("document.activeElement",document.activeElement)},e}();t.CaretManager=y}),define("wed/domlistener",["require","exports","module","./domtypeguards"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var r=this;this.root=e,this.updater=t,this.eventHandlers={"included-element":[],"added-element":[],"excluded-element":[],"excluding-element":[],"removed-element":[],"removing-element":[],"children-changed":[],"children-changing":[],"text-changed":[],"attribute-changed":[]},this.triggerHandlers=Object.create(null),this.triggersToFire=Object.create(null),this.stopped=!0,this.updater.events.subscribe(function(e){switch(e.name){case"InsertNodeAt":r._insertNodeAtHandler(e);break;case"SetTextNodeValue":r._setTextNodeValueHandler(e);break;case"BeforeDeleteNode":r._beforeDeleteNodeHandler(e);break;case"DeleteNode":r._deleteNodeHandler(e);break;case"SetAttributeNS":r._setAttributeNSHandler(e)}})}return e.prototype.startListening=function(){this.stopped=!1},e.prototype.stopListening=function(){this.stopped=!0},e.prototype.processImmediately=function(){void 0!==this.scheduledProcessTriggers&&(this.clearPending(),this._processTriggers())},e.prototype.clearPending=function(){void 0!==this.scheduledProcessTriggers&&(window.clearTimeout(this.scheduledProcessTriggers),this.scheduledProcessTriggers=void 0)},e.prototype.addHandler=function(e,t,r){if("trigger"===e){var n=this.triggerHandlers[t];void 0===n&&(n=this.triggerHandlers[t]=[]),n.push(r)}else{var i=this.eventHandlers[e];if(void 0===i)throw new Error("invalid eventType: "+e);i.push([t,r])}},e.prototype.trigger=function(e){this.triggersToFire[e]=1},e.prototype._processTriggers=function(){for(var e=Object.keys(this.triggersToFire);e.length>0;){this.triggersToFire=Object.create(null);for(var t=this.triggerHandlers,r=0,n=e;r<n.length;r++){var i=n[r],o=t[i];if(void 0!==o)for(var a=0,s=o;a<s.length;a++){var l=s[a];this._callHandler(l)}}e=Object.keys(this.triggersToFire)}},e.prototype._callHandler=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];t.unshift(this.root),e.apply(void 0,t)},e.prototype._insertNodeAtHandler=function(e){if(!this.stopped){var t=e.parent,r=e.node,i=this._childrenCalls("children-changed",t,[r],[],r.previousSibling,r.nextSibling),o=[],a=[];n.isElement(r)&&(o=this._addRemCalls("added-element",r,t),a=this._incExcCalls("included-element",r,t));for(var s=i.concat(o,a),l=0,u=s;l<u.length;l++){var c=u[l];(h=this._callHandler).call.apply(h,[this,c.fn].concat(c.params))}this._scheduleProcessTriggers();var h}},e.prototype._beforeDeleteNodeHandler=function(e){if(!this.stopped){var t=e.node,r=t.parentNode,i=this._childrenCalls("children-changing",r,[],[t],t.previousSibling,t.nextSibling),o=[],a=[];n.isElement(t)&&(o=this._addRemCalls("removing-element",t,r),a=this._incExcCalls("excluding-element",t,r));for(var s=i.concat(o,a),l=0,u=s;l<u.length;l++){var c=u[l];(h=this._callHandler).call.apply(h,[this,c.fn].concat(c.params))}this._scheduleProcessTriggers();var h}},e.prototype._deleteNodeHandler=function(e){if(!this.stopped){var t=e.node,r=e.formerParent,i=this._childrenCalls("children-changed",r,[],[t],null,null),o=[],a=[];n.isElement(t)&&(o=this._addRemCalls("removed-element",t,r),a=this._incExcCalls("excluded-element",t,r));for(var s=i.concat(o,a),l=0,u=s;l<u.length;l++){var c=u[l];(h=this._callHandler).call.apply(h,[this,c.fn].concat(c.params))}this._scheduleProcessTriggers();var h}},e.prototype._childrenCalls=function(e,t,r,n,i,o){if(0!==r.length&&0!==n.length)throw new Error("we do not support having nodes added and removed in the same event");for(var a=this.eventHandlers[e],s=[],l=0,u=a;l<u.length;l++){var c=u[l],h=c[0],d=c[1];t.matches(h)&&s.push({fn:d,params:[r,n,i,o,t]})}return s},e.prototype._setTextNodeValueHandler=function(e){if(!this.stopped){for(var t=this.eventHandlers["text-changed"],r=e.node,n=r.parentNode,i=0,o=t;i<o.length;i++){var a=o[i],s=a[0],l=a[1];n.matches(s)&&this._callHandler(l,r,e.oldValue)}this._scheduleProcessTriggers()}},e.prototype._setAttributeNSHandler=function(e){if(!this.stopped){for(var t=e.node,r=this.eventHandlers["attribute-changed"],n=0,i=r;n<i.length;n++){var o=i[n],a=o[0],s=o[1];t.matches(a)&&this._callHandler(s,t,e.ns,e.attribute,e.oldValue)}this._scheduleProcessTriggers()}},e.prototype._scheduleProcessTriggers=function(){var e=this;void 0===this.scheduledProcessTriggers&&(this.scheduledProcessTriggers=window.setTimeout(function(){e.scheduledProcessTriggers=void 0,e._processTriggers()},0))},e.prototype._addRemCalls=function(e,t,r){for(var n=this.eventHandlers[e],i=[],o=t.previousSibling,a=t.nextSibling,s=0,l=n;s<l.length;s++){var u=l[s],c=u[0],h=u[1];t.matches(c)&&i.push({fn:h,params:[r,o,a,t]})}return i},e.prototype._incExcCalls=function(e,t,r){for(var n=this.eventHandlers[e],i=t.previousSibling,o=t.nextSibling,a=[],s=0,l=n;s<l.length;s++){var u=l[s],c=u[0],h=u[1];t.matches(c)&&a.push({fn:h,params:[t,r,i,o,t]});for(var d=t.querySelectorAll(c),p=0,f=Array.prototype.slice.call(d);p<f.length;p++){var m=f[p];a.push({fn:h,params:[t,r,i,o,m]})}}return a},e}();t.Listener=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/exceptions",["require","exports","module","./util"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(r){var i=e.call(this,r)||this;return n.fixPrototype(i,t),i}return __extends(t,e),t}(Error);t.AbortTransformationException=i}),define("wed/convert",["require","exports","module","./domtypeguards","./util"],function(e,t,r,n,i){"use strict";function o(e){return null===e&&(e=""),e}function a(e,t){var r;if(n.isElement(t)){r=e.createElement("div"),r.className=t.tagName+" _local_"+t.localName+" _xmlns_"+o(t.namespaceURI)+" _real";for(var u=0;u<t.attributes.length;++u){var c=t.attributes[u];r.setAttribute(i.encodeAttrName(c.name),c.value);var h=c.namespaceURI;null!==h&&h!==s&&h!==l&&r.setAttribute(i.encodeAttrName(c.name,"ns"),h)}for(var d=t.firstChild;null!==d;)r.appendChild(a(e,d)),d=d.nextSibling}else{if(!n.isText(t))throw new Error("unhandled node type: "+t.nodeType);r=document.createTextNode(t.data)}return r}Object.defineProperty(t,"__esModule",{value:!0});var s="http://www.w3.org/XML/1998/namespace",l="http://www.w3.org/2000/xmlns/";t.toHTMLTree=a});var __assign=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};define("wed/tree-updater",["require","exports","module","rxjs","./dloc","./domtypeguards","./domutil"],function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a.indexOf,l=function(){function e(e){this.tree=e;var t=i.findRoot(e);if(void 0===t)throw new Error("the tree must have a DLocRoot");this.dlocRoot=t,this._events=new n.Subject,this.events=this._events.asObservable()}return e.prototype._emit=function(e){this._events.next(e),this._events.next({name:"Changed"})},e.prototype.insertAt=function(e,t,r){var n,a;if(e instanceof i.DLoc){if(n=e.node,a=e.offset,"number"==typeof t)throw new Error("incorrect call on insertAt: offset cannot be a number");r=t}else{if(n=e,"number"!=typeof t)throw new Error("incorrect call on insertAt: offset must be a number");a=t}if(r instanceof Array||r instanceof NodeList)for(var s=0;s<r.length;++s,++a){var l=r[s];if("string"!=typeof l&&!o.isElement(l)&&!o.isText(l))throw new Error("Array or NodeList element of the wrong type");this.insertAt(n,a,l)}else if("string"==typeof r)this.insertText(n,a,r);else if(o.isText(r))switch(n.nodeType){case Node.TEXT_NODE:this.insertText(n,a,r.data);break;case Node.ELEMENT_NODE:this.insertNodeAt(n,a,r);break;default:throw new Error("unexpected node type: "+n.nodeType)}else{if(!o.isElement(r))throw new Error("unexpected value for what: "+r);switch(n.nodeType){case Node.TEXT_NODE:this.insertIntoText(n,a,r);break;case Node.DOCUMENT_NODE:case Node.ELEMENT_NODE:this.insertNodeAt(n,a,r);break;default:throw new Error("unexpected node type: "+n.nodeType)}}},e.prototype.splitAt=function(e,t,r){var n;if(t instanceof i.DLoc?(n=t.node,r=t.offset):n=t,void 0===r)throw new Error("splitAt was called with undefined index");if(n===e&&n.nodeType===Node.TEXT_NODE)throw new Error("splitAt called in a way that would result in two adjacent text nodes");if(!e.contains(n))throw new Error("split location is not inside top");var o=e.cloneNode(!0),l=a.correspondingNode(e,o,n),u=this._splitAt(o,l,r),c=u[0],h=u[1],d=e.parentNode;if(null===d)throw new Error("called with detached top");var p=s(d.childNodes,e);return this.deleteNode(e),null!==c&&this.insertNodeAt(d,p,c),null!==h&&this.insertNodeAt(d,p+1,h),u},e.prototype._splitAt=function(e,t,r){var n,i=t===e,a=t.parentNode;if(o.isText(t))if(0===r)n=[null,t];else if(r===t.length)n=[t,null];else{var l=t.data.slice(r);t.deleteData(r,t.length-r),null!==a&&a.insertBefore(a.ownerDocument.createTextNode(l),t.nextSibling),n=[t,t.nextSibling]}else{if(!o.isElement(t))throw new Error("unexpected node type: "+t.nodeType);r<0?r=0:r>t.childNodes.length&&(r=t.childNodes.length);for(var u=t.cloneNode(!0);null!=t.childNodes[r];)t.removeChild(t.childNodes[r]);for(;0!==r--;)u.removeChild(u.firstChild);null!==a&&a.insertBefore(u,t.nextSibling),n=[t,u]}if(i)return n;if(null===a)throw new Error("unable to reach the top");return this._splitAt(e,a,s(a.childNodes,t)+1)},e.prototype.insertBefore=function(e,t,r){var n=null==r?e.childNodes.length:s(e.childNodes,r);if(n===-1)throw new Error("insertBefore called with a beforeThis value which is not a child of parent");this.insertAt(e,n,t)},e.prototype.insertText=function(e,t,r,n){void 0===r&&(r=!0),void 0===n&&(n=!0);var o;if(e instanceof i.DLoc){if("string"!=typeof t)throw new Error("text must be a string");if("boolean"!=typeof r)throw new Error("caretAtEnd must be a boolean");n=r,r=t,o=e.node,t=e.offset}else o=e;var s=a.genericInsertText.call(this,o,t,r,n);return __assign({},s,{caret:i.DLoc.makeDLoc(this.dlocRoot,s.caret[0],s.caret[1])})},e.prototype.deleteText=function(e,t,r){var n;if(e instanceof i.DLoc)r=t,n=e.node,t=e.offset;else if(n=e,void 0===r)throw new Error("length cannot be undefined");if(!o.isText(n))throw new Error("deleteText called on non-text");this.setTextNode(n,n.data.slice(0,t)+n.data.slice(t+r))},e.prototype.insertIntoText=function(e,t,r){var n;if(e instanceof i.DLoc){if(!o.isNode(t))throw new Error("must pass a node as the 2nd argument");r=t,t=e.offset,n=e.node}else n=e;var s=a.genericInsertIntoText.call(this,n,t,r);return[i.DLoc.mustMakeDLoc(this.tree,s[0]),i.DLoc.mustMakeDLoc(this.tree,s[1])]},e.prototype.insertNodeAt=function(e,t,r){var n;if(e instanceof i.DLoc){if(!o.isNode(t))throw new Error("the 2nd argument must be a Node");r=t,t=e.offset,n=e.node}else if(n=e,"number"!=typeof t)throw new Error("index must be a number");if(null==r)throw new Error("called insertNodeAt with absent node");if(o.isDocumentFragment(r))throw new Error("document fragments cannot be passed to insertNodeAt");this._emit({name:"BeforeInsertNodeAt",parent:n,index:t,node:r});var a=n.childNodes[t];n.insertBefore(r,null!=a?a:null),this._emit({name:"InsertNodeAt",parent:n,index:t,node:r})},e.prototype.setTextNode=function(e,t){if(!o.isText(e))throw new Error("setTextNode called on non-text");""!==t?this.setTextNodeValue(e,t):this.deleteNode(e)},e.prototype.setTextNodeValue=function(e,t){if(!o.isText(e))throw new Error("setTextNodeValue called on non-text");var r=e.data;e.data=t,this._emit({name:"SetTextNodeValue",node:e,value:t,oldValue:r})},e.prototype.removeNode=function(e){if(null==e)throw new Error("called without a node value");var t=e.previousSibling,r=e.parentNode;if(null===r)throw new Error("called with detached node");var n=s(r.childNodes,e);return this.deleteNode(e),null===t?i.DLoc.mustMakeDLoc(this.tree,r,n):this.mergeTextNodes(t)},e.prototype.removeNodeNF=function(e){if(null!=e)return this.removeNode(e)},e.prototype.removeNodes=function(e){if(0!==e.length){var t=e[0].previousSibling,r=e[0].parentNode;if(null===r)throw new Error("called with detached node");for(var n=s(r.childNodes,e[0]),o=0;o<e.length;++o){if(o<e.length-1&&e[o].nextSibling!==e[o+1])throw new Error("nodes are not immediately contiguous in document order");this.deleteNode(e[o])}return null===t?i.DLoc.makeDLoc(this.tree,r,n):this.mergeTextNodes(t)}},e.prototype.cut=function(e,t){var r=a.genericCutFunction.call(this,e.toArray(),t.toArray());return r[0]=e.make(r[0]),r},e.prototype.mergeTextNodes=function(e){var t=e.nextSibling;if(o.isText(e)&&null!==t&&o.isText(t)){var r=e.length;return this.setTextNodeValue(e,e.data+t.data),this.deleteNode(t),i.DLoc.mustMakeDLoc(this.tree,e,r)}var n=e.parentNode;if(null===n)throw new Error("called with detached node");return i.DLoc.mustMakeDLoc(this.tree,n,s(n.childNodes,e)+1)},e.prototype.mergeTextNodesNF=function(e){if(null!=e)return this.mergeTextNodes(e)},e.prototype.deleteNode=function(e){this._emit({name:"BeforeDeleteNode",node:e});var t=e.parentNode;if(null===t)throw new Error("called with detached node");t.removeChild(e),this._emit({name:"DeleteNode",node:e,formerParent:t})},e.prototype.setAttribute=function(e,t,r){this.setAttributeNS(e,"",t,r)},e.prototype.setAttributeNS=function(e,t,r,n){if(void 0===n&&(n=null),!o.isElement(e))throw new Error("setAttribute called on non-element");var i=e.getAttributeNS(t,r);""!==i||e.hasAttributeNS(t,r)||(i=null),null!=n?e.setAttributeNS(t,r,n):e.removeAttributeNS(t,r),this._emit({name:"SetAttributeNS",node:e,ns:t,attribute:r,oldValue:i,newValue:n})},e.prototype.nodeToPath=function(e){return this.dlocRoot.nodeToPath(e)},e.prototype.pathToNode=function(e){return this.dlocRoot.pathToNode(e)},e}();t.TreeUpdater=l});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/gui-updater",["require","exports","module","jquery","./convert","./dloc","./domtypeguards","./domutil","./tree-updater","./util"],function(e,t,r,n,i,o,a,s,l,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(t,r){var n=e.call(this,t)||this;return n.treeUpdater=r,n.treeUpdater.events.subscribe(function(e){switch(e.name){case"InsertNodeAt":n._insertNodeAtHandler(e);break;case"SetTextNodeValue":n._setTextNodeValueHandler(e);break;case"BeforeDeleteNode":n._beforeDeleteNodeHandler(e);break;case"SetAttributeNS":n._setAttributeNSHandler(e)}}),n}return __extends(t,e),t.prototype._insertNodeAtHandler=function(e){var t=this.fromDataLocation(e.parent,e.index);if(null===t)throw new Error("cannot find gui tree position");var r=i.toHTMLTree(this.tree.ownerDocument,e.node);a.isElement(e.node)&&s.linkTrees(e.node,r),this.insertNodeAt(t,r)},t.prototype._setTextNodeValueHandler=function(e){var t=this.fromDataLocation(e.node,0);if(null===t)throw new Error("cannot find gui tree position");this.setTextNodeValue(t.node,e.value)},t.prototype._beforeDeleteNodeHandler=function(e){var t,r=e.node,i=!1;switch(r.nodeType){case Node.TEXT_NODE:var o=this.fromDataLocation(r,0);if(null===o)throw new Error("cannot find gui tree position");t=o.node;break;case Node.ELEMENT_NODE:t=n.data(r,"wed_mirror_node"),i=!0}this.deleteNode(t),i&&(s.unlinkTree(r),s.unlinkTree(t))},t.prototype._setAttributeNSHandler=function(e){var t=this.fromDataLocation(e.node,0);if(null===t)throw new Error("cannot find gui tree position");this.setAttributeNS(t.node,"",u.encodeAttrName(e.attribute),e.newValue)},t.prototype.fromDataLocation=function(e,t){var r;if(e instanceof o.DLoc)r=e.node,t=e.offset;else if(r=e,void 0===t)throw new Error("must specify an offset");var n=this.pathToNode(this.treeUpdater.nodeToPath(r));if(null===n)return null;if(a.isText(r))return o.DLoc.mustMakeDLoc(this.tree,n,t);if(s.isAttr(r))return a.isText(n.firstChild)&&(n=n.firstChild),o.DLoc.mustMakeDLoc(this.tree,n,t);if(0===t)return o.DLoc.mustMakeDLoc(this.tree,n,0);if(t>=r.childNodes.length)return o.DLoc.mustMakeDLoc(this.tree,n,n.childNodes.length);var i=this.pathToNode(this.treeUpdater.nodeToPath(r.childNodes[t]));return null===i?o.DLoc.mustMakeDLoc(this.tree,n,n.childNodes.length):o.DLoc.mustMakeDLoc(this.tree,i)},t}(l.TreeUpdater);t.GUIUpdater=c}),define("wed/gui/interactivity",["require","exports","module","interactjs","../browsers"],function(e,t,r,n,i){"use strict";function o(e){var t=e.find(".modal-content")[0],r=e.find(".modal-body")[0];n(t).resizable({}).on("resizestart",function(){var t=e.data("bs.modal");null!=t&&(t.ignoreBackdropClick=!0)}).on("resizeend",function(){setTimeout(function(){var t=e.data("bs.modal");null!=t&&(t.ignoreBackdropClick=!1)},0)}).on("resizemove",function(e){var t=e.target,n=new s;n.updateElementRect(t,e.dx,e.dy),n.updateElementRect(r,e.dx,e.dy)})}function a(e){var t,r,i=e[0].ownerDocument.defaultView,o=e.find(".modal-header")[0],a=e.find(".modal-content")[0];n(o).draggable({restrict:{restriction:{left:0,top:0,right:i.innerWidth-10,bottom:i.innerHeight-10}}}).on("dragstart",function(){t=a.offsetLeft,r=a.offsetTop}).on("dragmove",function(e){a.style.left=t+e.clientX-e.clientX0+"px",a.style.top=r+e.clientY-e.clientY0+"px"})}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){this.changes=[],this.rolledback=!1}return e.prototype.updateElementRect=function(e,t,r){if(!this.rolledback){var n=e.getBoundingClientRect();i.MSIE&&(e.style.width=n.width+"px",e.style.height=n.height+"px",n=e.getBoundingClientRect());var o=n.width+t,a=n.height+r;e.style.width=o+"px",e.style.height=a+"px",this.changes.push({el:e,rect:n});var s=e.getBoundingClientRect();s.width===o&&s.height===a||this.rollback()}},e.prototype.rollback=function(){for(var e=this.changes,t=0,r=e;t<r.length;t++){var n=r[t],i=n.el,o=n.rect;i.style.width=o.width+"px",i.style.height=o.height+"px"}this.rolledback=!0},e}();t.makeResizable=o,t.makeDraggable=a}),define("wed/search",["require","exports","module","rangy","./dloc","./domtypeguards","./domutil"],function(e,t,r,n,i,o,a){"use strict";function s(e){throw new Error("unknown direction: "+e)}function l(e){var t=(r={},r[c.FORWARD]="forward",r[c.BACKWARDS]="backward",r)[e];return void 0===t?s(e):t;var r}function u(e,t,r){var i=n.createRange(e);return i.selectNode(t),i.compareBoundaryPoints(Range.START_TO_START,r)>=0&&i.compareBoundaryPoints(Range.END_TO_END,r)<=0}Object.defineProperty(t,"__esModule",{value:!0});var c;!function(e){e[e.FORWARD=0]="FORWARD",e[e.BACKWARDS=1]="BACKWARDS"}(c=t.Direction||(t.Direction={}));var h;!function(e){e[e.EVERYWHERE=0]="EVERYWHERE",e[e.TEXT=1]="TEXT",e[e.ATTRIBUTE_VALUES=2]="ATTRIBUTE_VALUES"}(h=t.Context||(t.Context={}));var d=function(){function e(e,t){this.values=e,this.direction=t,this.resetToStart()}return e.prototype.reset=function(e){this.current=e},e.prototype.resetToStart=function(){switch(this.direction){case c.FORWARD:this.current=0;break;case c.BACKWARDS:this.current=this.values.length-1;break;default:return s(this.direction)}},Object.defineProperty(e.prototype,"hasNext",{get:function(){switch(this.direction){case c.FORWARD:return this.current<this.values.length;case c.BACKWARDS:return this.current>=0;default:return s(this.direction)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"next",{get:function(){var e=this.values[this.current];return this.inc(),e},enumerable:!0,configurable:!0}),e.prototype.inc=function(){switch(this.direction){case c.FORWARD:this.current++;break;case c.BACKWARDS:this.current--;break;default:return s(this.direction)}},e}(),p=function(){function e(e,t,r,n){this.caretManager=e,this.guiRoot=t,this.start=r,this._pattern="",this.direction=c.FORWARD,this.context=h.EVERYWHERE,this.root=i.getRoot(t),this.setScope(n);var o=this.scope;if(o.start.compare(r)>0||o.end.compare(r)<0)throw new Error("the scope does not contain the start position");this.start=r}return Object.defineProperty(e.prototype,"pattern",{get:function(){return this._pattern},set:function(e){this._pattern=e},enumerable:!0,configurable:!0}),e.prototype.setScope=function(e){if(void 0===e)return void(this._scope=void 0);if(!e.isValid())throw new Error("passed an invalid range");var t=e.start,r=e.end;if(t.root!==this.root.node)throw new Error("the range does not use the search's root");this._scope=t.compare(r)>0?new i.DLocRange(r,t):new i.DLocRange(t,r)},Object.defineProperty(e.prototype,"scope",{get:function(){return void 0===this._scope&&(this._scope=new i.DLocRange(i.DLoc.mustMakeDLoc(this.root,this.guiRoot,0),i.DLoc.mustMakeDLoc(this.root,this.guiRoot,this.guiRoot.childNodes.length))),this._scope},enumerable:!0,configurable:!0}),e.prototype.updateCurrent=function(){this._next(!0)},e.prototype.next=function(){this._next(!1)},e.prototype._next=function(e){var t=null;if(""!==this.pattern){var r=void 0,n=void 0;switch(this.direction){case c.FORWARD:n=this.getForwardSearchStart(e),r=this.scope.start;break;case c.BACKWARDS:n=this.getBackwardSearchStart(e),r=this.scope.end;break;default:return s(this.direction)}var o=this.find(n,this.direction);null!==o?t=new i.DLocRange(i.DLoc.mustMakeDLoc(this.root,o.startContainer,o.startOffset),i.DLoc.mustMakeDLoc(this.root,o.endContainer,o.endOffset)):this.start=r}this.current=t},e.prototype.find=function(e,t){return this.context===h.ATTRIBUTE_VALUES?this.findAttributeValue(e,t):this.findText(e,l(t))},e.prototype.findText=function(e,t){var r=n.config,a=e.makeRange();this.context===h.TEXT&&(r.customIsCollapsedNode=function(e){return o.isElement(e)&&null!==e.closest("._phantom")});var s=a.findText(this.pattern,{withinRange:this.scope.mustMakeDOMRange(),direction:t});if(s){var l=i.DLoc.mustMakeDLoc(this.guiRoot,a.startContainer,a.startOffset);this.scope.contains(l)||(s=!1)}return r.customIsCollapsedNode=void 0,s?a:null},e.prototype.findAttributeValue=function(e,t){var r=this.guiRoot,n=Array.from(r.getElementsByClassName("_attribute_value")),o=this.caretManager,l=new d(n,t),h=a.closestByClass(e.node,"_attribute_value",r),p=r.ownerDocument,f=this.scope.mustMakeDOMRange();if(null===h){for(var m=void 0;l.hasNext;){var v=l.next;if(u(p,v,f)&&0!==(v.compareDocumentPosition(e.node)&Node.DOCUMENT_POSITION_PRECEDING)){m=v;break}}if(void 0===m)return null;e=e.make(m,0)}else{var y=n.indexOf(h);if(y===-1)throw new Error("internal error: cannot find value in array!");l.reset(y),l.inc()}for(var g=o.toDataLocation(e);;){var b=g.node,y=void 0;switch(t){case c.FORWARD:y=b.value.indexOf(this.pattern,g.offset);break;case c.BACKWARDS:var w=g.offset-this.pattern.length;y=w<0?-1:b.value.lastIndexOf(this.pattern,w);break;default:return s(t)}if(y!==-1){var _=o.mustFromDataLocation(g.makeWithOffset(y)),E=o.mustFromDataLocation(g.makeWithOffset(y+this.pattern.length));if(this.scope.contains(_)&&this.scope.contains(E))return new i.DLocRange(_,E).mustMakeDOMRange()}for(var x=null;null===x&&l.hasNext;)x=l.next,u(p,x,f)||(x=null);if(null===x)return null;var S=o.toDataLocation(x,0);switch(t){case c.FORWARD:break;case c.BACKWARDS:S=S.makeWithOffset(S.node.value.length);break;default:return s(t)}g=S}},e.prototype.getForwardSearchStart=function(e){return null!=this.current?e?this.current.start:this.current.end:this.start},e.prototype.getBackwardSearchStart=function(e){var t;return null!=this.current&&(t=e?this.prevEnd:this.current.start),void 0===t&&(t=this.start),this.prevEnd=t,t},e}();t.Search=p}),define("wed/gui/search-replace",["require","exports","module","../dloc","../domutil","../search"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Context=o.Context,t.Direction=o.Direction;var a;!function(e){e[e.START=0]="START",e[e.END=1]="END"}(a||(a={}));var s=function(){function e(e,t){this.editor=e,this.scroller=t,this.lastMatch=null,this.caretManager=this.editor.caretManager;var r=this.caretManager.sel,i=void 0===r||r.collapsed?void 0:new n.DLocRange(r.anchor,r.focus),a=void 0!==i?i.start:this.caretManager.caret;if(void 0===a)throw new Error("search without a caret!");this.search=new o.Search(this.caretManager,e.guiRoot,a,i)}return Object.defineProperty(e.prototype,"current",{get:function(){return this.search.current},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canReplace",{get:function(){var e=this.search.current;return null!=e&&(!e.collapsed&&i.isWellFormedRange(e.mustMakeDOMRange()))},enumerable:!0,configurable:!0}),e.prototype.updatePattern=function(e,t){this.search.pattern=e,this.search.direction=t.direction,this.search.context=t.context,this.search.updateCurrent(),this.updateHighlight()},e.prototype.next=function(e){this.search.direction=e.direction,this.search.context=e.context,this.search.next(),this.updateHighlight()},e.prototype.updateHighlight=function(){this.clearHighlight();var e=this.current;if(null!=e){this.lastMatch=e,this.setCaretToMatch();var t=e.start.mustMakeDLocRange(e.end),r=t.mustMakeDOMRange();this.highlight=this.caretManager.highlightRange(t);var n=this.scroller.getBoundingClientRect(),i=r.nativeRange.getBoundingClientRect(),o=this.scroller.scrollLeft-n.left,a=this.scroller.scrollTop-n.top;this.scroller.scrollIntoView(i.left+o,i.top+a,i.right+o,i.bottom+a)}},e.prototype.clearHighlight=function(){void 0!==this.highlight&&(this.highlight.parentNode.removeChild(this.highlight),this.highlight=void 0)},e.prototype.setCaretToMatch=function(){if(null!==this.lastMatch){var e=this.getDirectionalEnd(this.lastMatch);this.caretManager.setCaret(e,{focus:!1})}},e.prototype.getDirectionalEnd=function(e){return this.getDirectionalEdge(e,a.END)},e.prototype.getDirectionalStart=function(e){return this.getDirectionalEdge(e,a.START)},e.prototype.getDirectionalEdge=function(e,t){var r,n=this.search.direction,i=t===a.START;switch(n){case o.Direction.FORWARD:r=i?"start":"end";break;case o.Direction.BACKWARDS:r=i?"end":"start";break;default:var s=n;throw new Error("unknown direction: "+s)}return e[r]},e.prototype.replace=function(e){if(!this.canReplace)throw new Error("tried to replace when it is not possible");var t=this.current;if(null==t)throw new Error("no current match");var r=this.getDirectionalStart(t);this.caretManager.setCaret(r,{focus:!1}),this.editor.fireTransformation(this.editor.replaceRangeTr,{range:t,newText:e}),this.clearHighlight();var n=this.caretManager.caret;if(void 0===n)throw new Error("no caret after replacement!");this.search.current=n.mustMakeDLocRange()},e}();t.SearchReplace=s}),define("wed/gui/dialog-search-replace",["require","exports","module","bootbox","jquery","./interactivity","./search-replace"],function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Direction=a.Direction;var s="\n<form>\n <div class='form-group'>\n  <label>Search for:</label>\n  <input type='text' name='search' class='form-control'>\n </div>\n <div class='form-group'>\n  <label>Replace with:</label>\n  <input type='text' name='replace' class='form-control'>\n </div>\n <div class='radio'>\n  <span>Direction:</span>\n  <div>\n   <label class='radio-inline'>\n    <input type='radio' name='direction' value='forward'> Forward\n   </label>\n  </div>\n  <div>\n   <label class='radio-inline'>\n    <input type='radio' name='direction' value='backwards'> Backwards\n   </label>\n  <div>\n </div>\n <div class='radio'>\n  <span>Context:</span>\n  <div>\n   <label class='radio-inline'>\n    <input type='radio' name='context' value='text' checked>\n    Only element text\n   </label>\n  </div>\n  <div>\n   <label class='radio-inline'>\n    <input type='radio' name='context' value='attributes'>\n    Only attributes values\n   </label>\n  </div>\n </div>\n</form>",l=function(){
function e(e,t,r){var l=this;this.search=new a.SearchReplace(e,t);var u=i(s)[0],c=this.dialog=n.dialog({title:"Search/Replace",message:u,onEscape:!0,backdrop:!1,size:"small",buttons:{find:{label:"Find",className:"btn-primary",callback:this.onFind.bind(this)},replaceFind:{label:"Replace and Find",className:"btn-default replace-and-find",callback:this.onReplaceAndFind.bind(this)},replaceAll:{label:"Replace All",className:"btn-default replace-all",callback:this.onReplaceAll.bind(this)},close:{label:"Close"}}});o.makeResizable(c),o.makeDraggable(c);var h=u.elements.namedItem("direction");this.forwardRadioButton=h[0],this.backwardRadioButton=h[1];var d=u.elements.namedItem("context");this.textRadioButton=d[0],this.attributeRadioButton=d[1];var p;switch(r){case a.Direction.FORWARD:p=this.forwardRadioButton;break;case a.Direction.BACKWARDS:p=this.backwardRadioButton;break;default:var f=r;throw new Error("unknown direction: "+f)}p.checked=!0,c.on("hidden.bs.modal",function(){l.search.clearHighlight(),e.caretManager.focusInputField()});var m=this.searchField=u.elements.namedItem("search"),v=i(m);v.on("input",this.onSearchInput.bind(this));var y=this.replaceField=u.elements.namedItem("replace"),g=i(y);g.on("input",this.onReplaceInput.bind(this)),this.replaceButton=c[0].querySelector(".replace-and-find"),this.replaceAll=c[0].querySelector(".replace-all"),this.updateButtons()}return e.prototype.getSearchOptions=function(){var e;if(this.forwardRadioButton.checked)e=a.Direction.FORWARD;else{if(!this.backwardRadioButton.checked)throw new Error("cannot determine direction");e=a.Direction.BACKWARDS}var t;if(this.textRadioButton.checked)t=a.Context.TEXT;else{if(!this.attributeRadioButton.checked)throw new Error("cannot determine context");t=a.Context.ATTRIBUTE_VALUES}return{direction:e,context:t}},e.prototype.onFind=function(){return this.next(),this.updateButtons(),!1},e.prototype.updateButtons=function(){var e=""!==this.replaceField.value;this.replaceButton.disabled=!(e&&this.search.canReplace),this.replaceAll.disabled=!e},e.prototype.onReplaceAndFind=function(){return this.replace(),this.onFind(),!1},e.prototype.onReplaceAll=function(){for(void 0===this.search.current&&this.onFind();null!==this.search.current;)this.search.canReplace&&this.replace(),this.next();return this.updateButtons(),!1},e.prototype.replace=function(){this.search.replace(this.replaceField.value)},e.prototype.next=function(){this.search.next(this.getSearchOptions())},e.prototype.onSearchInput=function(){var e=this.searchField.value;e!==this.previousSearchValue&&(this.previousSearchValue=e,this.search.updatePattern(e,this.getSearchOptions()),this.updateButtons())},e.prototype.onReplaceInput=function(){this.updateButtons()},e}();t.DialogSearchReplace=l}),define("wed/gui/icon",["require","exports","module"],function(e,t,r){"use strict";function n(e){var t=i[e];if(void 0===t)throw new Error("unknown icon name: "+e);return'<i class="fa fa-fw '+t+'"></i>'}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.create(null);i.add="fa-plus",i.delete="fa-times",i.wrap="fa-caret-square-o-down",i.unwrap="fa-caret-square-o-up",i.documentation="fa-question-circle",i.transform="fa-cog",i.any="fa-asterisk",i.element="fa-angle-left",i.attribute="fa-at",i.other="fa-circle-thin",i.exclamation="fa-exclamation",t.makeHTML=n});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/transformation",["require","exports","module","lodash","./action","./domtypeguards","./domutil","./gui/icon"],function(e,t,r,n,i,o,a,s){"use strict";function l(e,t){if(void 0!==e)return e;var r=w[t];return void 0!==r?s.makeHTML(r):void 0}function u(e,t,r,n){var i=e.createElementNS(t,r);if(void 0!==n)for(var o=Object.keys(n).sort(),a=0,s=o;a<s.length;a++){var l=s[a];i.setAttribute(l,n[l])}return i}function c(e,t,r,n,i,a){var s=o.isDocument(t)?t:t.ownerDocument,l=u(s,n,i,a);return e.insertAt(t,r,l),l}function h(e,t,r,n,i,o,s){var l=t.data.slice(r,n),c=t.parentNode;if(null===c)throw new Error("detached node");var h=a.indexOf(c.childNodes,t);e.deleteText(t,r,l.length);var d=u(t.ownerDocument,i,o,s);return""!==l&&d.appendChild(t.ownerDocument.createTextNode(l)),null===t.parentNode?e.insertAt(c,h,d):e.insertAt(t,r,d),d}function d(e,t,r){var n=t.parentNode;if(null===n)throw new Error("detached node");var i=a.indexOf(n.childNodes,t);if(0===r)r=i;else if(r>=t.length)r=i+1;else{var o=t.data.slice(r);e.setTextNode(t,t.data.slice(0,r)),e.insertNodeAt(n,i+1,t.ownerDocument.createTextNode(o)),r=i+1}return[n,r]}function p(e,t,r,n,i,s,l,c){if(!a.isWellFormedRange({startContainer:t,startOffset:r,endContainer:n,endOffset:i}))throw new Error("malformed range");if(o.isText(t)){if(t===n)return h(e,t,r,i,s,l,c);m=d(e,t,r),t=m[0],r=m[1]}if(o.isText(n)&&(v=d(e,n,i),n=v[0],i=v[1]),t!==n)throw new Error("startContainer and endContainer are not the same;probably due to an algorithmic mistake");for(var p=u(t.ownerDocument,s,l,c);--i>=r;){var f=n.childNodes[i];e.deleteNode(f),p.insertBefore(f,p.firstChild)}return e.insertAt(t,r,p),p;var m,v}function f(e,t){var r=t.parentNode;if(null===r)throw new Error("detached node");var n=Array.prototype.slice.call(t.childNodes),i=t.previousSibling,o=t.nextSibling;e.deleteNode(t);for(var s=null!==o?a.indexOf(r.childNodes,o):r.childNodes.length,l=t.lastChild;null!=t.firstChild;)e.insertNodeAt(r,s++,t.firstChild);return null!==l&&e.mergeTextNodes(l),e.mergeTextNodesNF(i),n}function m(e,t){var r=e.caretManager.getDataCaret();if(void 0===r)throw new Error("no caret");if(!t.contains(r.node))throw new Error("caret outside node");var n=e.dataUpdater.splitAt(t,r);e.caretManager.setCaret(a.firstDescendantOrSelf(n[1]),0)}function v(e,t){var r=t.previousElementSibling;if(null!==r&&r.localName===t.localName&&r.namespaceURI===t.namespaceURI){for(var n=r.childNodes.length,i=r.lastChild,a=o.isText(i),s=a?i.length:0,l=r.childNodes.length,u=t.childNodes.length-1;u>=0;--u)e.dataUpdater.insertAt(r,l,t.childNodes[u].cloneNode(!0));a?(e.dataUpdater.mergeTextNodes(i),e.caretManager.setCaret(r.childNodes[n-1],s)):e.caretManager.setCaret(r,n),e.dataUpdater.removeNode(t)}}function y(e,t){var r=t.nextElementSibling;null!==r&&v(e,r)}function g(e,t){var r=t.previousElementSibling;if(null!==r&&r.localName===t.localName&&r.namespaceURI===t.namespaceURI){var n=r.parentNode;if(null===n)throw new Error("detached node");e.dataUpdater.removeNode(t),e.dataUpdater.insertBefore(n,t,r),e.caretManager.setCaret(t)}}function b(e,t){var r=t.nextElementSibling;null!==r&&g(e,r)}Object.defineProperty(t,"__esModule",{value:!0});var w=n.extend(Object.create(null),{add:"add",delete:"delete",transform:"transform",insert:"add","delete-element":"delete","delete-parent":"delete",wrap:"wrap","wrap-content":"wrap","merge-with-next":"transform","merge-with-previous":"transform","swap-with-next":"transform","swap-with-previous":"transform",split:"transform",append:"add",prepend:"add",unwrap:"unwrap","add-attribute":"add","delete-attribute":"delete"}),_=n.extend(Object.create(null),{add:"other",delete:"other",transform:"other",insert:"element","delete-element":"element","delete-parent":"element",wrap:"element","wrap-content":"element","merge-with-next":"element","merge-with-previous":"element","swap-with-next":"element","swap-with-previous":"element",split:"element",append:"element",prepend:"element",unwrap:"element","add-attribute":"attribute","delete-attribute":"attribute"}),E=function(e){function t(t,r,n,i,o,a,s){var u=this;if("function"==typeof i?(s=i,u=e.call(this,t,n,void 0,l(void 0,r),!1)||this):"function"==typeof o?(s=o,u=e.call(this,t,n,i,l(void 0,r),!1)||this):"function"==typeof a?(s=a,u=e.call(this,t,n,i,l(o,r),!1)||this):u=e.call(this,t,n,i,l(o,r),a)||this,void 0===s)throw new Error("did not specify a handler");return u.handler=s,u.transformationType=r,u.kind=w[r],u.nodeType=_[r],u}return __extends(t,e),t.prototype.getDescriptionFor=function(e){return void 0===e.name?this.desc:this.desc.replace(/<name>/,e.name)},t.prototype.execute=function(e){this.editor.fireTransformation(this,e)},t}(i.Action);t.Transformation=E,t.makeElement=u,t.insertElement=c,t.wrapTextInElement=h,t.wrapInElement=p,t.unwrap=f,t.splitNode=m,t.mergeWithPreviousHomogeneousSibling=v,t.mergeWithNextHomogeneousSibling=y,t.swapWithPreviousHomogeneousSibling=g,t.swapWithNextHomogeneousSibling=b}),define("wed/key",["require","exports","module","./browsers","jquery"],function(e,t,r,n){"use strict";function i(e,r,i,o,a,s,l,u){if(void 0===r&&(r=!0),void 0===a&&(a=!1),void 0===s&&(s=!1),void 0===l&&(l=!1),void 0===u&&(u=t.EITHER),"string"==typeof e){if(1!==e.length)throw new Error("when the first parameter is a string, a one-character string is required");e=e.charCodeAt(0)}else if("number"!=typeof e)throw new Error("the first parameter must be a string or number");return r=void 0===r||!!r,null==i&&(i=r&&n.GECKO?0:e),null==o&&(o=r?e:0),a=!!a,s=!!s,l=!!l,u!==t.EITHER&&(u=!!u),new c(e,r,i,o,a,s,l,u)}function o(e,r){return void 0===r&&(r=t.EITHER),i(e,!1,void 0,void 0,!0,!1,!1,r)}function a(e,r){return void 0===r&&(r=t.EITHER),i(e,!1,void 0,void 0,!1,!1,!0,r)}function s(e,r){return void 0===r&&(r=t.EITHER),n.OSX?a(e,r):o(e,r)}Object.defineProperty(t,"__esModule",{value:!0});var l=0,u=function(){function e(){}return e.prototype.toString=function(){return"EITHER"},e}();t.EITHER_=u,t.EITHER=new u;var c=function(){function e(r,n,i,o,a,s,u,c){void 0===n&&(n=!0),void 0===o&&(o=0),void 0===a&&(a=!1),void 0===s&&(s=!1),void 0===u&&(u=!1),void 0===c&&(c=t.EITHER);var h=[r,i,o,a,s,u,c,n].join(","),d=e.__cache[h];if(void 0!==d)return d;if(n&&c!==t.EITHER)throw new Error("shiftKey with key presses must be EITHER");this.which=r,this.keyCode=i,this.charCode=o,this.ctrlKey=a,this.altKey=s,this.metaKey=u,this.shiftKey=c,this.keypress=n,this.hashKey=h,this.id=l++,e.__cache[h]=this}return e.prototype.matchesEvent=function(e){return e.which===this.which&&e.keyCode===this.keyCode&&e.charCode===this.charCode&&e.ctrlKey===this.ctrlKey&&e.altKey===this.altKey&&e.metaKey===this.metaKey&&(this.shiftKey===t.EITHER||e.shiftKey===this.shiftKey)&&(this.keypress?"keypress"===e.type:"keydown"===e.type||"keyup"===e.type)},e.prototype.setEventToMatch=function(e){var r=e;r.which=this.which,r.keyCode=this.keyCode,r.charCode=this.charCode,r.ctrlKey=this.ctrlKey,r.altKey=this.altKey,r.metaKey=this.metaKey,this.shiftKey!==t.EITHER&&(r.shiftKey=this.shiftKey),this.keypress?r.type="keypress":r.type="keydown"},e.prototype.hash=function(){return this.id},e.prototype.anyModifier=function(){return this.ctrlKey||this.altKey||this.metaKey},e.__cache=Object.create(null),e}();t.Key=c,t.makeKey=i,t.makeCtrlKey=o,t.makeMetaKey=a,t.makeCtrlEqKey=s}),define("wed/key-constants",["require","exports","module","./key"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CTRLEQ_S=n.makeCtrlEqKey("S",!1),t.CTRLEQ_Z=n.makeCtrlEqKey("Z",!1),t.CTRLEQ_Y=n.makeCtrlEqKey("Y",!1),t.CTRLEQ_C=n.makeCtrlEqKey("C",!1),t.CTRLEQ_X=n.makeCtrlEqKey("X",!1),t.CTRLEQ_V=n.makeCtrlEqKey("V",!1),t.CTRLEQ_F=n.makeCtrlEqKey("F",!1),t.CTRLEQ_B=n.makeCtrlEqKey("B",!1),t.CTRLEQ_SHIFT_F=n.makeCtrlEqKey("F",!0),t.CTRLEQ_SHIFT_B=n.makeCtrlEqKey("B",!0),t.CTRLEQ_FORWARD_SLASH=n.makeCtrlEqKey(191,!1),t.CTRLEQ_PERIOD=n.makeCtrlEqKey(190,!1),t.CTRLEQ_BACKQUOTE=n.makeCtrlEqKey(192,!1),t.CTRLEQ_OPEN_BRACKET=n.makeCtrlEqKey(219,!1),t.CTRLEQ_CLOSE_BRACKET=n.makeCtrlEqKey(221,!1),t.LEFT_ARROW=n.makeKey(37,!1),t.UP_ARROW=n.makeKey(38,!1),t.RIGHT_ARROW=n.makeKey(39,!1),t.DOWN_ARROW=n.makeKey(40,!1),t.BACKSPACE=n.makeKey(8,!1),t.DELETE=n.makeKey(46,!1),t.ENTER=n.makeKey(13,!1),t.SPACE=n.makeKey(32,!1),t.ESCAPE=n.makeKey(27,!1),t.QUICKSEARCH_FORWARD=t.CTRLEQ_F,t.QUICKSEARCH_BACKWARDS=t.CTRLEQ_B,t.SEARCH_FORWARD=t.CTRLEQ_SHIFT_F,t.SEARCH_BACKWARDS=t.CTRLEQ_SHIFT_B,t.EDITING_KEYS=[t.LEFT_ARROW,t.RIGHT_ARROW,t.BACKSPACE,t.DELETE,t.ENTER]}),define("wed/gui/context-menu",["require","exports","module","jquery","../domutil","bootstrap"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t,r,i,o,a){void 0===a&&(a=!0),this.dismissCallback=o,this.dismissed=!1;var s=e.createElement("div");s.className="dropdown wed-context-menu",s.innerHTML="<a href='#' data-toggle='dropdown'></a><ul class='dropdown-menu' role='menu'></ul>";var l=s.lastElementChild;t-=5,r-=5,s.style.top=r+"px",s.style.left=t+"px",this.x=t,this.y=r;var u=n(l);this.menu=l,this.$menu=u,this.dropdown=s,this.backdrop=e.createElement("div"),this.backdrop.className="wed-context-menu-backdrop",n(this.backdrop).click(this.backdropClickHandler.bind(this)),u.on("click",this.contentsClickHandler.bind(this)),u.on("mousedown",function(e){e.stopPropagation()}),n(s).on("contextmenu mouseup",!1);var c=e.body;c.insertBefore(s,c.firstChild),c.insertBefore(this.backdrop,c.firstChild),a&&this.display(i)}return e.prototype.display=function(e){var t=this.dropdown,r=n(t.firstElementChild);this.render(e);var o=this.$menu,a=this.menu,s=t.ownerDocument,l=this.x,u=this.y,c=o.outerWidth(),h=n(s.defaultView).width();t.style.left=Math.max(0,Math.min(l,h-c))+"px",a.style.maxWidth=h+"px";var d=5*Number(o.css("line-height").replace("px","")),p=n(s.defaultView).height(),f=p-u;f<d&&(u-=d-f,f=d),t.style.top=u+"px",a.style.maxHeight=f+"px",r.focus(this.handleToggleFocus.bind(this)),r.dropdown("toggle");var m=i.childByClass(t,"dropdown-backdrop");null!==m&&t.removeChild(m)},e.prototype.handleToggleFocus=function(){},e.prototype.contentsClickHandler=function(e){return this.dismiss(),e.stopPropagation(),e.preventDefault(),!1},e.prototype.backdropClickHandler=function(){return this.dismiss(),!1},e.prototype.render=function(e){this.$menu.append(e)},e.prototype.dismiss=function(){this.dismissed||(this.$menu.dropdown("toggle"),null!==this.dropdown.parentNode&&this.dropdown.parentNode.removeChild(this.dropdown),null!==this.backdrop.parentNode&&this.backdrop.parentNode.removeChild(this.backdrop),void 0!==this.dismissCallback&&this.dismissCallback(),this.dismissed=!0)},e}();t.ContextMenu=o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/gui/action-context-menu",["require","exports","module","jquery","../browsers","../key","../key-constants","../transformation","./context-menu","./icon"],function(e,t,r,n,i,o,a,s,l,u){"use strict";function c(e,t){var r=null!==e.action&&e.action instanceof s.Transformation?e.action.kind:void 0,n=null!==t.action&&t.action instanceof s.Transformation?t.action.kind:void 0;if(r!==n){var i=p.indexOf(r),o=p.indexOf(n);return i-o}var a=e.item.textContent,l=t.item.textContent;return a===l?0:a<l?-1:1}Object.defineProperty(t,"__esModule",{value:!0});var h=["transform","add","delete","wrap","unwrap"],d=h.concat(void 0),p=[void 0].concat(h),f=["element","attribute"],m=f.concat(void 0),v="li:not(.divider):visible a",y=o.makeKey("+"),g=o.makeKey("-"),b=o.makeKey("."),w=o.makeKey(","),_=o.makeKey("?"),E=o.makeKey("<"),x=o.makeKey("@"),S=o.makeKey("!"),N=[{key:y,filter:"add",which:"kind"},{key:g,filter:"delete",which:"kind"},{key:w,filter:"wrap",which:"kind"},{key:b,filter:"unwrap",which:"kind"},{key:_,filter:void 0,which:"kind"},{key:E,filter:"element",which:"type"},{key:x,filter:"attribute",which:"type"},{key:S,filter:void 0,which:"type"}],C=function(e){function t(t,r,i,o,a){var s=e.call(this,t,r,i,[],a,!1)||this;s.filters={kind:null,type:null},s.actionTextFilter="",o.sort(c),s.actionItems=o;var l=t.createElement("li");l.className="wed-menu-filter",l.style.whiteSpace="nowrap";var u=t.createElement("div"),h=s.makeKindGroup(t),d=s.makeTypeGroup(t);n(l).on("click",!1),l.appendChild(u),u.appendChild(h),u.appendChild(t.createTextNode(" ")),u.appendChild(d);var p=t.createElement("input");p.className="form-control input-sm",p.setAttribute("placeholder","Filter choices by text.");var f=t.createElement("div");f.appendChild(p),l.appendChild(f);var m=n(p);m.on("input",s.inputChangeHandler.bind(s)),m.on("keydown",s.inputKeydownHandler.bind(s)),s.actionFilterItem=l,s.actionFilterInput=p;var v=s.$menu;return v.parent().on("hidden.bs.dropdown",function(){n(p).tooltip("destroy"),n(h).children().tooltip("destroy")}),v.on("keydown",s.actionKeydownHandler.bind(s)),v.on("keypress",s.actionKeypressHandler.bind(s)),s.display([]),p.focus(),s}return __extends(t,e),t.prototype.makeKindGroup=function(e){var t=e.createElement("div");t.className="btn-group btn-group-xs";for(var r=0,i=d;r<i.length;r++){var o=i[r],a=e.createElement("button");a.className="btn btn-default";var s=void 0;void 0!==o?(a.innerHTML=u.makeHTML(o),s="Show only "+o+" operations."):(a.innerHTML=u.makeHTML("other"),s="Show operations not covered by other filter buttons."),n(a).tooltip({title:s,container:"body",placement:"auto top",trigger:"hover"}),n(a).on("click",this.makeKindHandler(o)),t.appendChild(a)}return t},t.prototype.makeTypeGroup=function(e){var t=e.createElement("div");t.className="btn-group btn-group-xs";for(var r=0,i=m;r<i.length;r++){var o=i[r],a=e.createElement("button");a.className="btn btn-default";var s=void 0;void 0!==o?(a.innerHTML=u.makeHTML(o),s="Show only "+o+" operations."):(a.innerHTML=u.makeHTML("other"),s="Show operations not covered by other filter buttons."),n(a).tooltip({title:s,container:"body",placement:"auto top",trigger:"hover"}),n(a).on("click",this.makeTypeHandler(o)),t.appendChild(a)}return t},t.prototype.makeKindHandler=function(e){var t=this;return function(){t.filters.kind=e,t.render()}},t.prototype.makeTypeHandler=function(e){var t=this;return function(){t.filters.type=e,t.render()}},t.prototype.handleToggleFocus=function(){this.actionFilterInput.focus()},t.prototype.actionKeydownHandler=function(e){var t=this;return!a.ESCAPE.matchesEvent(e)||null===this.filters.kind&&null===this.filters.type&&""===this.actionTextFilter||(this.filters.kind=null,this.filters.type=null,this.actionTextFilter="",i.FIREFOX_24?setTimeout(function(){t.actionFilterInput.value="",t.render()},0):(this.actionFilterInput.value="",this.render()),e.stopPropagation(),e.preventDefault(),!1)},t.prototype.actionKeypressHandler=function(e){if(""!==this.actionTextFilter)return!0;for(var t=0,r=N;t<r.length;t++){var n=r[t],i=n.key;if(i.matchesEvent(e)){var o=n.which;if(null!==this.filters[o])continue;return this.filters[o]=n.filter,this.render(),e.stopPropagation(),e.preventDefault(),!1}}return!0},t.prototype.inputChangeHandler=function(e){var t=this.actionTextFilter,r=e.target.value;t!==r&&(this.actionTextFilter=r,this.render())},t.prototype.inputKeydownHandler=function(e){if(a.ENTER.matchesEvent(e))return this.$menu.find(v).first().focus().click(),e.stopPropagation(),e.preventDefault(),!1;for(var t,r=0,i=["UP_ARROW","DOWN_ARROW","ESCAPE"];r<i.length;r++){var o=i[r],s=a[o];if(s.matchesEvent(e)){t=s;break}}if(void 0!==t){var l=new n.Event("keydown");return t.setEventToMatch(l),this.$menu.trigger(l),!1}return!0},t.prototype.render=function(){for(var t=this.menu,r=this.actionFilterItem,n=this.filters.kind,i=this.filters.type;null!==t.lastChild&&t.lastChild!==r;)t.removeChild(t.lastChild);for(var o=r.firstElementChild.firstElementChild.firstElementChild,a=0,s=d;a<s.length;a++){var l=s[a],u=o.classList,c=n===l?u.add:u.remove;c.call(u,"active"),o=o.nextElementSibling}o=r.firstElementChild.lastElementChild.firstElementChild;for(var h=0,p=m;h<p.length;h++){var f=p[h],u=o.classList,c=i===f?u.add:u.remove;c.call(u,"active"),o=o.nextElementSibling}null===r.parentNode&&t.appendChild(r);var v=this.computeActionItemsToDisplay(this.actionItems);e.prototype.render.call(this,v)},t.prototype.computeActionItemsToDisplay=function(e){var t,r=this.filters.kind,n=this.filters.type,i=this.actionTextFilter;switch(r){case null:t=function(){return!0};break;case void 0:t=function(e){return!(e.action instanceof s.Transformation)||h.indexOf(e.action.kind)===-1};break;default:t=function(e){return e.action instanceof s.Transformation&&e.action.kind===r}}var o;switch(n){case null:o=function(){return!0};break;case void 0:o=function(e){return!(e.action instanceof s.Transformation)||f.indexOf(e.action.nodeType)===-1};break;default:o=function(e){return e.action instanceof s.Transformation&&e.action.nodeType===n}}var a;if(""!==i)if("^"===i[0]){var l=RegExp(i);a=function(e){var t=null!==e.data&&void 0!==e.data.name?e.data.name:e.item.textContent;return l.test(t)}}else a=function(e){var t=null!==e.data&&void 0!==e.data.name?e.data.name:e.item.textContent;return t.indexOf(i)!==-1};else a=function(){return!0};for(var u=[],c=0,d=e;c<d.length;c++){var p=d[c];t(p)&&o(p)&&a(p)&&u.push(p.item)}return u},t}(l.ContextMenu);t.ActionContextMenu=C});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/gui/completion-menu",["require","exports","module","jquery","../key-constants","./context-menu"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t,r,n,i,o,a,s){var l=e.call(this,r,n,i,[],s,!1)||this;return l._focused=!1,l.completionPrefix=o,l.completionItems=a,l.editor=t,l.dropdown.classList.add("wed-completion-menu"),null!==l.dropdown.firstElementChild.getAttribute("data-toggle")&&l.dropdown.removeChild(l.dropdown.firstChild),l.backdrop.parentNode.removeChild(l.backdrop),l.boundCompletionKeydownHandler=l.globalKeydownHandler.bind(l),t.pushGlobalKeydownHandler(l.boundCompletionKeydownHandler),t.caretManager.focusInputField(),l.display([]),l}return __extends(t,e),Object.defineProperty(t.prototype,"focused",{get:function(){return this._focused},enumerable:!0,configurable:!0}),t.prototype.globalKeydownHandler=function(e,t){return i.ENTER.matchesEvent(t)?(this.$menu.find("li:not(.divider):visible a").first().click(),!1):i.DOWN_ARROW.matchesEvent(t)?(this._focused=!0,this.$menu.find("li:not(.divider):visible a").first().focus(),this.$menu.trigger(t),!1):!i.ESCAPE.matchesEvent(t)||(this.dismiss(),!1)},t.prototype.render=function(){function t(e){r.type(e.data)}for(var r=this.editor,i=[],o=this.completionPrefix,a=r.doc,s=0,l=this.completionItems;s<l.length;s++){var u=l[s];if(""===o){var c=a.createElement("li");c.innerHTML="<a href='#'></a>",c.lastChild.textContent=u,i.push(c),n(c).click(u,t)}else if(0===u.lastIndexOf(o,0)){var c=a.createElement("li");c.innerHTML="<a href='#'><b></b></a>";var h=c.lastChild;h.firstChild.textContent=u.slice(0,o.length);var d=u.slice(o.length);h.appendChild(a.createTextNode(d)),i.push(c),n(c).click(d,t)}}0===i.length&&this.dismiss(),1===i.length&&this.completionItems[0]===o&&this.dismiss(),e.prototype.render.call(this,i)},t.prototype.dismiss=function(){this.dismissed||(this.editor.popGlobalKeydownHandler(this.boundCompletionKeydownHandler),e.prototype.dismiss.call(this))},t}(o.ContextMenu);t.CompletionMenu=a}),define("wed/gui/editing-menu-manager",["require","exports","module","../dloc","../domtypeguards","../domutil","../transformation","./action-context-menu","./completion-menu","./icon"],function(e,t,r,n,i,o,a,s,l,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c={undefined:"",true:" before this element",false:" after this element"},h=function(){function e(e){this.editor=e,this.caretManager=e.caretManager,this.modeTree=e.modeTree,this.guiRoot=e.guiRoot,this.dataRoot=e.dataRoot,this.doc=this.guiRoot.ownerDocument}return e.prototype.contextMenuHandler=function(e){var t=this.caretManager.sel;if(void 0===t||!t.collapsed&&!t.wellFormed)return!1;var r=t.focus.node,n=t.focus.offset;if(!i.isElement(r)){var a=r.parentNode;if(null===a)throw new Error("contextMenuHandler invoked on detached node");n=o.indexOf(a.childNodes,r),r=a}var l=o.closestByClass(r,"_placeholder",this.guiRoot);if(null!==l){var u=l.parentNode;if(null===u)throw new Error("contextMenuHandler invoked on detached node");n=o.indexOf(u.childNodes,l),r=u}var c=o.closestByClass(r,"_real",this.guiRoot),h=null!==c&&c.classList.contains("_readonly"),d=null!==o.closestByClass(r,"_attribute_value",this.guiRoot)?this.getMenuItemsForAttribute:this.getMenuItemsForElement,p=d.call(this,r,n,!t.collapsed);if(0===p.length)return!0;var f=this.computeMenuPosition(e);return this.displayContextMenu(s.ActionContextMenu,f.left,f.top,p,h),!1},e.prototype.dismiss=function(){void 0!==this.currentDropdown&&this.currentDropdown.dismiss()},e.prototype.displayContextMenu=function(e,t,r,n,i){var o=this,s=Object.create(null);n=n.filter(function(e){var t=(null!==e.action?e.action.getDescription():"")+"\0";null!==e.data&&(t+=e.data.name);var r=!s[t];return s[t]=!0,r&&i?!(e.action instanceof a.Transformation):r}),this.dismiss(),this.caretManager.pushSelection(),this.currentDropdown=new e(this.doc,t,r,n,function(){o.currentDropdown=void 0,o.caretManager.popSelection()})},e.prototype.getMenuItemsForAttribute=function(){return[]},e.prototype.getMenuItemsForElement=function(e,t,r){for(var i,o=this,a=e;null!==a&&a.classList.contains("_phantom");)i=a,a=a.parentNode;if(null===a||!this.guiRoot.contains(a))return[];void 0!==i&&(t=this.caretManager.normalizeToEditableRange(n.DLoc.mustMakeDLoc(this.guiRoot,i)).offset);var s=[],l=function(e,t){var r=o.makeMenuItemForAction(t,e);s.push({action:t,item:r,data:e})};if(!a.parentNode.classList.contains("_gui")){var u=this.caretManager.toDataLocation(a,t);if(void 0===u)throw new Error("cannot find tree caret");var c=u.node,h=c.tagName,d=this.modeTree.getMode(c);if(null!=h){var p=d.documentationLinkFor(h);if(null!=p){var f=this.makeDocumentationMenuItem(p);s.push({action:null,item:f,data:null})}}for(var m=this.editor.getElementTransformationsAt(u,r?"wrap":"insert"),v=0,y=m;v<y.length;v++){var g=y[v];l(void 0!==g.name?{name:g.name}:null,g.tr)}if(c!==this.dataRoot.firstChild&&c!==this.dataRoot)for(var b=d.getContextualActions(["unwrap","delete-parent","split"],h,c,0),w=0,_=b;w<_.length;w++){var E=_[w];l({node:c,name:h},E)}}var x=$(a).parents().addBack().siblings("[data-wed--separator-for]").first(),S=void 0!==x[0]?x[0].getAttribute("data-wed--separator-for"):null;if(null!==S)for(var N=x.siblings().filter(function(){return this.contains(a)})[0],d=this.modeTree.getMode(N),b=d.getContextualActions(["merge-with-next","merge-with-previous","append","prepend"],S,$.data(N,"wed_mirror_node"),0),C=0,T=b;C<T.length;C++){var E=T[C];l({node:N,name:S},E)}return s},e.prototype.makeMenuItemForAction=function(e,t,r){var n=e.getIcon(),i=o.htmlToElements("<li><a tabindex='0' href='#'>"+(void 0!==n?n+" ":"")+"</a></li>",this.doc)[0];e instanceof a.Transformation&&void 0!==e.kind&&i.setAttribute("data-kind",e.kind);var s=i.firstElementChild,l=this.doc.createTextNode(e.getDescriptionFor(t)+c[String(r)]);return s.appendChild(l),s.normalize(),$(s).click(t,e.boundTerminalHandler),i},e.prototype.makeDocumentationMenuItem=function(e){var t=this,r=u.makeHTML("documentation"),n=o.htmlToElements("<li><a tabindex='0' href='#'>"+r+" Element's documentation.</a></li>",this.doc)[0],i=n.firstElementChild;return $(i).click(function(){t.editor.openDocumentationLink(e)}),n},e.prototype.setupCompletionMenu=function(){var e=this;this.dismiss();var t=this.caretManager.sel;if(void 0!==t&&t.collapsed){var r=this.caretManager.getNormalizedCaret(),n=r.node,i=o.closestByClass(n,"_attribute_value",this.guiRoot);if(null!==i){if(o.isNotDisplayed(i,this.guiRoot))return;var a=n.ownerDocument,s=this.caretManager.getDataCaret(),u=s.node;if(s.offset!==u.value.length)return;var c=this.modeTree.getMode(u),h=c.getAttributeCompletions(u);if(0===h.length&&this.editor.validator.possibleAt(s.node,0).forEach(function(e){if("attributeValue"===e.params[0]){var t=e.params[1];t instanceof RegExp||h.push(t)}}),0===h.length)return;for(var d=[],p=0,f=h;p<f.length;p++){var m=f[p];0===m.lastIndexOf(u.value,0)&&d.push(m)}if(0===d.length||1===d.length&&d[0]===u.value)return;var v=this.computeMenuPosition(void 0,!0);this.caretManager.pushSelection();var y=this.currentDropdown=new l.CompletionMenu(this.editor,a,v.left,v.top,u.value,h,function(){e.currentDropdown=void 0,y.focused?e.caretManager.popSelection():e.caretManager.popSelectionAndDiscard()})}}},e.prototype.computeMenuPosition=function(e,t){if(void 0===t&&(t=!1),void 0===e&&(e={}),"mousedown"===e.type||"mouseup"===e.type||"click"===e.type||"contextmenu"===e.type)return{left:e.clientX,top:e.clientY};var r=this.caretManager.mark;if(r.inDOM){r.scrollIntoView(),r.refresh();var n=r.getBoundingClientRect();return{top:t?n.bottom:n.top+n.height/2,left:n.left}}var i=o.closestByClass(this.caretManager.caret.node,"_gui",this.guiRoot);if(null!==i){var n=i.getBoundingClientRect();return{top:t?n.bottom:n.top+n.height/2,left:n.left+n.width/2}}throw new Error("no position for displaying the menu")},e}();t.EditingMenuManager=h}),define("wed/gui/layer",["require","exports","module"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.el=e}return e.prototype.clear=function(){for(var e=this.el;null!==e.lastChild;)e.removeChild(e.lastChild)},e.prototype.append=function(e){this.el.appendChild(e)},e}();t.Layer=n});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/gui/error-layer",["require","exports","module","./layer"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){var r=e.call(this,t)||this;return r.el=t,r}return __extends(t,e),t.prototype.select=function(e){if(e.parentNode!==this.el)throw new Error("marker is not a child of the layer element");this.unselectAll(),e.classList.add("selected")},t.prototype.unselectAll=function(){for(var e=this.el.firstElementChild;null!==e;)e.classList.remove("selected"),e=e.nextElementSibling},t}(n.Layer);t.ErrorLayer=i}),define("wed/gui/minibuffer",["require","exports","module","jquery","rxjs","../key-constants"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){this._enabled=!1,this._events=new i.Subject,this.events=this._events.asObservable(),this.$top=n(e),this.$top.append("<label></label>&nbsp;<input type='text'>"),this.promptEl=e.getElementsByTagName("label")[0],this.input=e.getElementsByTagName("input")[0];var t=this.$input=n(this.input);t.on("input",this.onInput.bind(this)),t.on("keypress",this.onKeypress.bind(this)),t.on("keydown",this.onKeydown.bind(this)),this.disable()}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),e.prototype.enable=function(){this._enabled=!0,this.input.disabled=!1,this.input.style.display="",this.input.focus()},e.prototype.disable=function(){this._enabled=!1,this.input.disabled=!0,this.input.value="",this.input.style.display="none"},e.prototype.installClient=function(e){this.client=e,this.keydownHandler=e.onMinibufferKeydown.bind(e),this.clientSubscription=this.events.subscribe(e.onMinibufferChange.bind(e)),this.enable()},e.prototype.uninstallClient=function(){var e=this.client;void 0!==e&&(this.client=void 0,this.keydownHandler=void 0,this.clientSubscription.unsubscribe(),this.disable(),this.prompt="",this.previous=void 0,e.onUninstall());
},Object.defineProperty(e.prototype,"prompt",{get:function(){return this.promptEl.textContent},set:function(e){this.promptEl.textContent=e},enumerable:!0,configurable:!0}),e.prototype.forwardEvent=function(e){"keypress"===e.type&&(this.input.value+=String.fromCharCode(e.which)),this.$input.trigger(e)},e.prototype.onKeydown=function(e){return o.ESCAPE.matchesEvent(e)?(this.uninstallClient(),!1):(null==this.keydownHandler||this.keydownHandler(e)!==!1)&&void 0},e.prototype.onKeypress=function(e){var t=this.input.value;t!==this.previous&&(this.previous=t,this._events.next({name:"ChangeEvent",value:t}))},e.prototype.onInput=function(e){var t=this.input.value;t!==this.previous&&(this.previous=t,this._events.next({name:"ChangeEvent",value:t}))},e}();t.Minibuffer=a}),define("wed/gui/modal",["require","exports","module","jquery","./interactivity","bootstrap"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){var t=this;e=null!=e?e:{};var r=this._$dom=n('<div class="modal" style="position: absolute" tabindex="1">  <div class="modal-dialog">    <div class="modal-content">      <div class="modal-header">        <button type="button" class="close" data-dismiss="modal"          aria-hidden="true">&times;</button>        <h3 class="modal-title">Untitled</h3>      </div>      <div class="modal-body">        <p>No body.</p>      </div>      <div class="modal-footer">      </div>    </div>  </div></div>');this._$header=r.find(".modal-header"),this._$body=r.find(".modal-body"),this._$footer=r.find(".modal-footer"),r.on("click",".btn",function(e){return t._$clicked=n(e.currentTarget),!0}),r.on("shown.bs.modal.modal",this._handleShown.bind(this)),e.resizable&&(this._$body[0].style.overflow="auto",i.makeResizable(r)),e.draggable&&i.makeDraggable(r)}return e.prototype.getTopLevel=function(){return this._$dom},e.prototype.setTitle=function(e){var t=this._$header.find("h3");t.empty(),t.append(e)},e.prototype.setBody=function(e){this._$body.empty(),this._$body.append(e)},e.prototype.setFooter=function(e){this._$footer.empty(),this._$footer.append(e)},e.prototype.addButton=function(e,t){void 0===t&&(t=!1);var r=this._$dom[0].ownerDocument.createElement("a");return r.href="#",r.className="btn",r.setAttribute("data-dismiss","modal"),r.textContent=e,r.classList.add(t?"btn-primary":"btn-default"),this._$footer.append(r),n(r)},e.prototype.addOkCancel=function(){return[this.addButton("Ok",!0),this.addButton("Cancel")]},e.prototype.addYesNo=function(){return[this.addButton("Yes",!0),this.addButton("No")]},e.prototype.getPrimary=function(){return this._$footer.find(".btn-primary")},e.prototype.modal=function(e){this._$clicked=void 0,void 0!==e&&this._$dom.one("hidden.bs.modal.modal",e),this._$dom.modal()},e.prototype.getClicked=function(){return this._$clicked},e.prototype.getClickedAsText=function(){if(void 0!==this._$clicked)return this._$clicked.text()},e.prototype._handleShown=function(){var e=this._$dom[0].ownerDocument.defaultView,t=e.innerHeight,r=this._$dom.find(".modal-dialog")[0],n=r.getBoundingClientRect(),i=window.getComputedStyle(r),o=-n.top+(t-n.height)-parseInt(i.marginBottom),a=n.height+o;r.style.maxHeight=a+"px";var s=this._$dom.find(".modal-content")[0];s.style.maxHeight=a+"px"},e}();t.Modal=o}),define("is-plain-obj",["require","exports","module"],function(e,t,r){var n=Object.prototype.toString;return r.exports=function(e){var t;return"[object Object]"===n.call(e)&&(t=Object.getPrototypeOf(e),null===t||t===Object.getPrototypeOf({}))},r.exports}),define("merge-options",["require","exports","module","is-plain-obj"],function(e,t,r){function n(e){var t=[];for(var r in e)h.call(e,r)&&t.push(r);if(Object.getOwnPropertySymbols)for(var n=Object.getOwnPropertySymbols(e),i=0;i<n.length;i++)d.call(e,n[i])&&t.push(n[i]);return t}function i(e){return Array.isArray(e)?o(e):c(e)?a(e):e}function o(e){var t=e.slice(0,0);return n(e).forEach(function(r){t[r]=i(e[r])}),t}function a(e){var t=null===Object.getPrototypeOf(e)?Object.create(null):{};return n(e).forEach(function(r){t[r]=i(e[r])}),t}function s(e,t,r,n){return r.forEach(function(r){r in e?e[r]=u(e[r],t[r],n):e[r]=i(t[r])}),e}function l(e,t,r){var o=e.slice(0,0),a=0;return[e,t].forEach(function(t){for(var l=[],u=0;u<t.length;u++)h.call(t,u)&&(l.push(String(u)),t===e?o[a++]=t[u]:o[a++]=i(t[u]));o=s(o,t,n(t).filter(function(e){return l.indexOf(e)===-1}),r)}),o}function u(e,t,r){return r.concatArrays&&Array.isArray(e)&&Array.isArray(t)?l(e,t,r):c(t)&&c(e)?s(e,t,n(t),r):i(t)}var c=e("is-plain-obj"),h=Object.prototype.hasOwnProperty,d=Object.propertyIsEnumerable,p=this,f={concatArrays:!1};return r.exports=function(){for(var e=u(i(f),this!==p&&this||{},f),t={},r=0;r<arguments.length;r++){var n=arguments[r];if(void 0!==n){if(!c(n))throw new TypeError("`"+n+"` is not an Option Object");t=u(t,n,e)}}return t},r.exports}),define("wed/gui/notify",["require","exports","module","jquery","merge-options","bootstrap-notify"],function(e,t,r,n,i){"use strict";function o(e,t){var r=void 0===t?a:i(a,t);n.notify({message:e},r)}Object.defineProperty(t,"__esModule",{value:!0});var a={element:"body",type:"info",placement:{from:"top",align:"center"},delay:1e3};t.notify=o}),define("wed/gui/quick-search",["require","exports","module","../key-constants","./search-replace"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Direction=i.Direction;var o=function(){function e(e,t,r){this.editor=e,this.direction=r,this.search=new i.SearchReplace(e,t),e.minibuffer.installClient(this),this.updatePrompt()}return e.prototype.updatePrompt=function(){this.editor.minibuffer.prompt=(e={},e[i.Direction.FORWARD]="Search forward:",e[i.Direction.BACKWARDS]="Search backwards:",e)[this.direction];var e},e.prototype.onMinibufferKeydown=function(e){return n.QUICKSEARCH_FORWARD.matchesEvent(e)?(this.direction=i.Direction.FORWARD,this.next(),!1):n.QUICKSEARCH_BACKWARDS.matchesEvent(e)?(this.direction=i.Direction.BACKWARDS,this.next(),!1):void 0},e.prototype.getSearchOptions=function(){return{direction:this.direction,context:i.Context.TEXT}},e.prototype.next=function(){this.updatePrompt(),this.search.next(this.getSearchOptions())},e.prototype.onMinibufferChange=function(e){this.search.updatePattern(e.value,this.getSearchOptions())},e.prototype.onUninstall=function(){this.search.clearHighlight(),this.search.setCaretToMatch()},e}();t.QuickSearch=o}),define("wed/gui/scroller",["require","exports","module","rxjs","../domutil"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){var t=this;this.el=e,this._events=new n.Subject,this.events=this._events.asObservable(),$(e).on("scroll",function(){t._events.next({scroller:t})})}return Object.defineProperty(e.prototype,"scrollTop",{get:function(){return this.el.scrollTop},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollLeft",{get:function(){return this.el.scrollLeft},enumerable:!0,configurable:!0}),e.prototype.getBoundingClientRect=function(){return this.el.getBoundingClientRect()},e.prototype.coerceHeight=function(e){this.el.style.height=e+"px"},e.prototype.isPointInside=function(e,t){return i.pointInContents(this.el,e,t)},e.prototype.scrollIntoView=function(e,t,r,n){var i=this.el,o=i.scrollTop,a=i.clientHeight,s=o+a;(t<o||n>s)&&(o=t<o?t:n-a,i.scrollTop=o);var l=i.scrollLeft,u=i.clientWidth,c=l+u;(e<l||r>c)&&(l=e<l?e:r-u,i.scrollLeft=l);var h=i.getBoundingClientRect();e=e-l+h.left,r=r-l+h.left,t=t-o+h.top,n=n-o+h.top;var d=i.ownerDocument,p=d.body.scrollHeight,f=d.body.scrollWidth,m=0;(t<0||n>p)&&(m=t<0?t:n);var v=0;(e<0||r>f)&&(v=e<0?e:r),d.defaultView.scrollBy(v,m)},e}();t.Scroller=o}),define("wed/gui/tooltip",["require","exports","module","jquery","bootstrap"],function(e,t,r,n){"use strict";function i(e){var t=e.target,r=n.data(t,"bs.tooltip");n.data(r.tip()[0],"wed-tooltip-for",t)}function o(e,t){e.tooltip(t),e[0].classList.add("wed-has-tooltip"),e.on("show.bs.tooltip",i)}Object.defineProperty(t,"__esModule",{value:!0}),t.tooltip=o}),define("wed/gui/typeahead-popup",["require","exports","module","jquery","../domutil","../key-constants","bootstrap","typeahead"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,r,o,a,s,l){var u=this;this.dismissed=!1;var c=i.htmlToElements('<div class="wed-typeahead-popup"><input class="typeahead form-control" type="text"><span class="spinner"><i class="fa fa-spinner fa-spin"></i></span></div>',e)[0],h=c.firstElementChild;h.setAttribute("placeholder",a),this.taWrapper=c,this.dismissCallback=l,this.backdrop=document.createElement("div"),this.backdrop.className="wed-typeahead-popup-backdrop",n(this.backdrop).click(function(){return u.dismiss(),!1}),c.style.width=o+"px",c.style.left=t+"px",c.style.top=r+"px";var d=this.$ta=n(h);this.ta=h;var p=[s.options];null!=s.datasets&&s.datasets.length>0&&(p=p.concat(s.datasets)),d.typeahead.apply(d,p),d.on("keydown",this._keydownHandler.bind(this)),d.on("typeahead:selected",this._selectedHandler.bind(this));var f=e.body;f.insertBefore(c,f.firstChild),f.insertBefore(this.backdrop,f.firstChild);var m=c.offsetWidth,v=e.defaultView.innerWidth;c.style.left=Math.max(0,Math.min(t,v-m))+"px",c.style.maxWidth=v+"px";var y=e.defaultView.innerHeight,g=y-r;c.style.maxHeight=g+"px";var b=c.getElementsByClassName("tt-dropdown-menu")[0],w=n(b),_=b.style.display;b.style.display="block";var E=5*Number(w.css("line-height").replace("px","")),x=b.getBoundingClientRect(),S=y-x.top;S<E&&(r-=E-S,S=E,c.style.top=r+"px"),b.style.maxHeight=S+"px",b.style.display=_,w.off("mouseenter.tt",".tt-suggestion"),w.off("mouseleave.tt",".tt-suggestion"),w.on("click",!1),h.focus();var N=n.data(h,"ttTypeahead");N.isActivated=!0,N.input.off("blurred"),N._onBlurred=function(){this.isActivated=!1},N.input.onSync("blurred",N._onBlurred,N)}return e.prototype.dismiss=function(e){if(!this.dismissed){var t=this.taWrapper;void 0!==t&&null!==t.parentNode&&t.parentNode.removeChild(t);var r=this.backdrop;void 0!==r&&null!==r.parentNode&&r.parentNode.removeChild(r),void 0!==this.dismissCallback&&this.dismissCallback(e),this.dismissed=!0}},e.prototype._keydownHandler=function(e){if(o.ESCAPE.matchesEvent(e))return this.dismiss(),!1},e.prototype._selectedHandler=function(e,t){this.dismiss(t)},e.prototype.hideSpinner=function(){this.taWrapper.getElementsByClassName("spinner")[0].style.display="none"},e.prototype.setValue=function(e){this.$ta.typeahead("val",e)},e}();t.TypeaheadPopup=a}),define("wed/log",["require","exports","module","log4javascript"],function(e,t,r,n){"use strict";function i(){d.show()}function o(e){return e instanceof p?e:(h.fatal("Unhandled exception",e),"undefined"!=typeof console&&(console.log(e),console.log(e.stack)),new p(e))}function a(e){throw o(e)}function s(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];try{return e.apply(this,arguments)}catch(e){a(e)}}}function l(e,t){var r=new n.AjaxAppender(e);r.setThreshold(n.Level.ALL);var i=new n.XmlLayout;return r.setLayout(i),void 0!==t&&Object.keys(t).forEach(function(e){r.addHeader(e,t[e])}),c.addAppender(r),h.info("Ajax appender initialized"),r}function u(e){e.sendAll(),c.removeAppender(e)}Object.defineProperty(t,"__esModule",{value:!0}),n.setShowStackTraces(!0);var c=n.getLogger("wed");c.setLevel(n.Level.ALL);var h=n.getLogger("wed.common");h.setLevel(n.Level.ALL);var d=new n.PopUpAppender(!0);d.setThreshold(n.Level.ERROR),d.setInitiallyMinimized(!0),d.setNewestMessageAtTop(!0),h.addAppender(d),t.trace=h.trace.bind(h),t.debug=h.debug.bind(h),t.info=h.info.bind(h),t.warn=h.warn.bind(h),t.error=h.error.bind(h),t.fatal=h.fatal.bind(h),t.showPopup=i;var p=function(){function e(e){this.original=e}return e}();t.Handled=p,t.unhandled=o,t.handle=a,t.wrap=s,t.addURL=l,t.removeAppender=u});var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{l(n.next(e))}catch(e){o(e)}}function s(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}l((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return n([e,t])}}function n(r){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,o&&(a=o[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(o,r[1])).done)return a;switch(o=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,o=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){l.label=r[1];break}if(6===r[0]&&l.label<a[1]){l.label=a[1],a=r;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(r);break}a[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(e){r=[6,e],o=0}finally{i=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var i,o,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};define("wed/mode-loader",["require","exports","module"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.editor=e,this.runtime=t}return e.prototype.initMode=function(e,t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(i){switch(i.label){case 0:return[4,this.loadMode(e)];case 1:return r=i.sent(),n=new r.Mode(this.editor,t),[4,n.init()];case 2:return i.sent(),[2,n]}})})},e.prototype.loadMode=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,i;return __generator(this,function(o){switch(o.label){case 0:t=this.runtime,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,t.resolveModules(e)];case 2:return[2,o.sent()[0]];case 3:return r=o.sent(),[3,4];case 4:if(e.indexOf("/")!==-1)throw new Error("can't load mode "+e);e="./modes/"+e+"/"+e,o.label=5;case 5:return o.trys.push([5,7,,8]),[4,t.resolveModules(e)];case 6:return[2,o.sent()[0]];case 7:return n=o.sent(),[3,8];case 8:return o.trys.push([8,10,,11]),[4,t.resolveModules(e+"-mode")];case 9:return[2,o.sent()[0]];case 10:return i=o.sent(),[3,11];case 11:return[4,t.resolveModules(e+"_mode")];case 12:return[2,o.sent()[0]]}})})},e}();t.ModeLoader=n}),define("text",["module"],function(e){"use strict";var t,r,n,i,o,a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],s=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,u="undefined"!=typeof location&&location.href,c=u&&location.protocol&&location.protocol.replace(/\:/,""),h=u&&location.hostname,d=u&&(location.port||void 0),p={},f=e.config&&e.config()||{};return t={version:"2.0.12",strip:function(e){if(e){e=e.replace(s,"");var t=e.match(l);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:f.createXhr||function(){var e,t,r;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;t<3;t+=1){r=a[t];try{e=new ActiveXObject(r)}catch(e){}if(e){a=[r];break}}return e},parseName:function(e){var t,r,n,i=!1,o=e.indexOf("."),a=0===e.indexOf("./")||0===e.indexOf("../");return o!==-1&&(!a||o>1)?(t=e.substring(0,o),r=e.substring(o+1,e.length)):t=e,n=r||t,o=n.indexOf("!"),o!==-1&&(i="strip"===n.substring(o+1),n=n.substring(0,o),r?r=n:t=n),{moduleName:t,ext:r,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,r,n,i){var o,a,s,l=t.xdRegExp.exec(e);return!l||(o=l[2],a=l[3],a=a.split(":"),s=a[1],a=a[0],!(o&&o!==r||a&&a.toLowerCase()!==n.toLowerCase()||(s||a)&&s!==i))},finishLoad:function(e,r,n,i){n=r?t.strip(n):n,f.isBuild&&(p[e]=n),i(n)},load:function(e,r,n,i){if(i&&i.isBuild&&!i.inlineText)return void n();f.isBuild=i&&i.isBuild;var o=t.parseName(e),a=o.moduleName+(o.ext?"."+o.ext:""),s=r.toUrl(a),l=f.useXhr||t.useXhr;return 0===s.indexOf("empty:")?void n():void(!u||l(s,c,h,d)?t.get(s,function(r){t.finishLoad(e,o.strip,r,n)},function(e){n.error&&n.error(e)}):r([a],function(e){t.finishLoad(o.moduleName+"."+o.ext,o.strip,e,n)}))},write:function(e,r,n,i){if(p.hasOwnProperty(r)){var o=t.jsEscape(p[r]);n.asModule(e+"!"+r,"define(function () { return '"+o+"';});\n")}},writeFile:function(e,r,n,i,o){var a=t.parseName(r),s=a.ext?"."+a.ext:"",l=a.moduleName+s,u=n.toUrl(a.moduleName+s)+".js";t.load(l,n,function(r){var n=function(e){return i(u,e)};n.asModule=function(e,t){return i.asModule(e,u,t)},t.write(e,l,n,o)},o)}},"node"===f.env||!f.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(r=require.nodeRequire("fs"),t.get=function(e,t,n){try{var i=r.readFileSync(e,"utf8");0===i.indexOf("\ufeff")&&(i=i.substring(1)),t(i)}catch(e){n&&n(e)}}):"xhr"===f.env||!f.env&&t.createXhr()?t.get=function(e,r,n,i){var o,a=t.createXhr();if(a.open("GET",e,!0),i)for(o in i)i.hasOwnProperty(o)&&a.setRequestHeader(o.toLowerCase(),i[o]);f.onXhr&&f.onXhr(a,e),a.onreadystatechange=function(t){var i,o;4===a.readyState&&(i=a.status||0,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=a,n&&n(o)):r(a.responseText),f.onXhrComplete&&f.onXhrComplete(a,e))},a.send(null)}:"rhino"===f.env||!f.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var r,n,i="utf-8",o=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),i)),l="";try{for(r=new java.lang.StringBuffer,n=s.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&r.append(n);null!==(n=s.readLine());)r.append(a),r.append(n);l=String(r.toString())}finally{s.close()}t(l)}:("xpconnect"===f.env||!f.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(n=Components.classes,i=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),o="@mozilla.org/windows-registry-key;1"in n,t.get=function(e,t){var r,a,s,l={};o&&(e=e.replace(/\//g,"\\")),s=new FileUtils.File(e);try{r=n["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),r.init(s,1,0,!1),a=n["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),a.init(r,"utf-8",r.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),a.readString(r.available(),l),a.close(),r.close(),t(l.value)}catch(e){throw new Error((s&&s.path||"")+": "+e)}}),t}),define("json",["text"],function(e){"use strict";return{load:function(t,r,n,i){return i&&i.isBuild?void n():void e.get(r.toUrl(t),function(e){n(JSON.parse(e))},n.error)}}}),define("wed/wed-options-validation",["require","exports","module","ajv","./wed-options-schema.json"],function(e,t,r,n,i){"use strict";function o(){return void 0===s&&(s=(new n).compile(i)),s}function a(e){var t=[],r=o(),n=r(e);if(!n){if(void 0!==r.errors)for(var i=0,a=r.errors;i<a.length;i++){var s=a[i];t.push(s.dataPath+" "+s.message)}return t}var l=e.label_levels.max,u=e.label_levels.initial;if(u>l&&t.push("label_levels.initial must be <= label_levels.max"),void 0===e.attributes&&(e.attributes="hide"),"string"==typeof e.attributes){var c=e.attributes;e.attributes={handling:c}}return 0!==t.length?t:e}Object.defineProperty(t,"__esModule",{value:!0});var s;t.processWedOptions=a});var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{l(n.next(e))}catch(e){o(e)}}function s(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}l((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return n([e,t])}}function n(r){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,o&&(a=o[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(o,r[1])).done)return a;switch(o=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,o=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){l.label=r[1];break}if(6===r[0]&&l.label<a[1]){l.label=a[1],a=r;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(r);break}a[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(e){r=[6,e],o=0}finally{i=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var i,o,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};define("wed/mode-tree",["require","exports","module","merge-options","./domutil","./mode-loader","./wed-options-validation"],function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t,r,n,i){this.mode=e,this.editor=t,this.selector=r,this.submodes=n,this.wedOptions=i}return e.prototype.containingElement=function(e,t){if(!e.contains(t))return null;if(""===this.selector)return e;for(var r=e.querySelectorAll(this.selector),n=0,i=Array.from(r);n<i.length;n++){var o=i[n];if(o.contains(t))return o}return null},e.prototype.reduceTopFirst=function(e,t){for(var r=e(t,this),n=0,i=this.submodes;n<i.length;n++){var o=i[n];r=o.reduceTopFirst(e,r)}return r},e.prototype.eachTopFirst=function(e){e(this);for(var t=0,r=this.submodes;t<r.length;t++){var n=r[t];n.eachTopFirst(e)}},Object.defineProperty(e.prototype,"attributeHidingSpecs",{get:function(){if(void 0===this._attributeHidingSpecs){var e=this.wedOptions.attributes.autohide;if(void 0===e)this._attributeHidingSpecs=null;else{var t=e.method;if("selector"!==t)throw new Error("unknown attribute hiding method: "+t);for(var r={elements:[]},o=0,a=e.elements;o<a.length;o++){var s=a[o],l=n({},s);l.selector=i.toGUISelector(l.selector,this.mode.getAbsoluteNamespaceMappings()),r.elements.push(l)}this._attributeHidingSpecs=r}}return this._attributeHidingSpecs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"decorator",{get:function(){return void 0===this._decorator&&(this._decorator=this.mode.makeDecorator()),this._decorator},enumerable:!0,configurable:!0}),e}(),l=function(){function e(e,t){this.editor=e,this.option=t,this.loader=new o.ModeLoader(e,e.runtime)}return e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(r){switch(r.label){case 0:return e=[],t=this,[4,this.makeNodes("",this.option,function(t,r){for(var n=0,i=r;n<i.length;n++){var o=i[n];e.push("mode at path "+t+" has an error in its wed options: "+o)}})];case 1:if(t.root=r.sent(),e.length>0)throw new Error("wed options are incorrect: "+e.join(""));return[2,this]}})})},e.prototype.makeNodes=function(e,t,r){return __awaiter(this,void 0,void 0,function(){var n,o,l,u,c,h,d;return __generator(this,function(p){switch(p.label){case 0:return n=t.submode,[4,this.loader.initMode(t.path,t.options)];case 1:return o=p.sent(),void 0===n?[3,3]:[4,this.makeNodes(i.toGUISelector(n.selector,o.getAbsoluteNamespaceMappings()),n.mode,r)];case 2:return u=[p.sent()],[3,4];case 3:u=[],p.label=4;case 4:return l=u,c=o.getWedOptions(),h=a.processWedOptions(c),Array.isArray(h)?(r(t.path,h),d=c):d=h,[2,new s(o,this.editor,e,l,d)]}})})},e.prototype.getMode=function(e){return this.getModeNode(e).mode},e.prototype.getDecorator=function(e){return this.getModeNode(e).decorator},e.prototype.getWedOptions=function(e){var t=this.getModeNode(e);return t.wedOptions},e.prototype.getAttributeHandling=function(e){return this.getWedOptions(e).attributes.handling},e.prototype.getAttributeHidingSpecs=function(e){return this.getModeNode(e).attributeHidingSpecs},e.prototype.getModeNode=function(e){if(0===this.root.submodes.length)return this.root;if(i.contains(this.editor.dataRoot,e)){var t=this.editor.fromDataNode(e);null!==t&&(e=t)}if(!this.editor.guiRoot.contains(e))throw new Error("did not pass a node in the GUI or data tree");var r=this._getModeNode(this.root,this.editor.guiRoot,e);if(void 0===r)throw new Error("cannot find a mode for the node; something is wrong");return r},e.prototype._getModeNode=function(e,t,r){var n=e.containingElement(t,r);if(null!==n){for(var i=void 0,o=0,a=e.submodes;o<a.length;o++){var s=a[o];if(i=this._getModeNode(s,n,r),void 0!==i)return i}return e}},e.prototype.getStylesheets=function(){return Object.keys(this.root.reduceTopFirst(function(e,t){for(var r=0,n=t.mode.getStylesheets();r<n.length;r++){var i=n[r];e[i]=!0}return e},Object.create(null)))},e.prototype.getMaxLabelLevel=function(){return this.maxLabelLevelNode.wedOptions.label_levels.max},e.prototype.getInitialLabelLevel=function(){return this.maxLabelLevelNode.wedOptions.label_levels.initial},Object.defineProperty(e.prototype,"maxLabelLevelNode",{get:function(){return void 0===this.cachedMaxLabelNode&&(this.cachedMaxLabelNode=this.root.reduceTopFirst(function(e,t){var r=e.wedOptions.label_levels.max,n=t.wedOptions.label_levels.max;return n>r?t:e},this.root)),this.cachedMaxLabelNode},enumerable:!0,configurable:!0}),e.prototype.getValidators=function(){return this.root.reduceTopFirst(function(e,t){var r=t.mode.getValidator();return void 0!==r?e.concat(r):e},[])},e.prototype.addDecoratorHandlers=function(){this.root.eachTopFirst(function(e){e.decorator.addHandlers()})},e.prototype.startListening=function(){this.root.eachTopFirst(function(e){e.decorator.startListening()})},e}();t.ModeTree=l}),define("wed/onbeforeunload",["require","exports","module"],function(e,t,r){"use strict";function n(){return!0}function i(e,t,r){function i(){var e=t();return e?e:void 0}if(void 0===t&&(t=n),void 0===r&&(r=!1),null!=e.onbeforeunload&&e.onbeforeunload.installedByOnbeforeunload&&!r)throw new Error("reregistering window with `force` false");i.installedByOnbeforeunload=!0,e.onbeforeunload=i}Object.defineProperty(t,"__esModule",{value:!0});var o="undefined"!=typeof __WED_TESTING&&!!__WED_TESTING.testing;t.install=i,o||i(window)}),define("wed/onerror",["require","exports","module","./log","jquery"],function(e,t){"use strict";function r(){m=!1,u&&(c.clearTimeout(u),u=void 0),f.off(),f.modal("hide"),f.remove()}function n(){return m}function i(e,t){p(document.body).append(f),f.find(".save-messages")[0].innerHTML=e,f.find(".error-message")[0].textContent=t,f.on("hide.bs.modal.modal",function(){f.remove(),window.location.reload()}),f.modal()}function o(e){var t="";if("error"===e.type){var r=e.message,n=e.filename,i=e.lineno,o=e.colno,a=e.error;a?t=a.stack:(t=n+":"+i,o&&(t+="."+o),t+=": "+r)}else{t+="Unhandled promise rejection!\n";var s,l,u=e.promise?e:e.detail;u&&(s=u.reason,l=u.promise),s?(t+="Reason: ",t+=s.stack?"\n"+s.stack:s):l&&(t+="Promise: "+l)}return t}function a(e,t){var r=["<p>",e||"Your editor"];switch(r.push(" experienced a severe error."),t){case!0:r.push(" However, it successfully saved the latest state of your data to the server. Please reload.");break;default:r.push(" It was not able to save your data to the server before terminating.")}return r.push("</p>"),r.join("")}function s(e){function t(){if(u&&p.clearTimeout(u),1===s)h.push(a(void 0,l[0]?l[0][1]:void 0));else for(var e=0;e<l.length;++e){var t=l[e];h.push(a(v[t[0]].name,t[1]))}i(h.join(""),n)}function r(e){l.push([this,e])}if(e.preventDefault(),m)return!1;m=!0;var n=o(e),s=v.length,l=[],h=[],p=window;u=p.setTimeout(t,y),c=p;var f=[];console.error(n),d.error(n);for(var g=0;g<v.length;++g){var b=v[g],w=b.saver;if(w){var _=r.bind(b);f.push(w.recover().then(_,_))}}return Promise.all(f).then(t),!1}function l(e){try{try{s(e)}catch(e){i("","Error while trying to handle fatal error: "+e.toString())}}catch(e){console.error("Error while trying to handle fatal error:"),console.error(e)}}var u,c,h="undefined"!=typeof __WED_TESTING&&__WED_TESTING.testing,d=e("./log"),p=e("jquery"),f=p('<div class="modal wed-fatal-modal" style="position: absolute" tabindex="1">  <div class="modal-dialog">    <div class="modal-content">      <div class="modal-header">        <button type="button" class="close" data-dismiss="modal"aria-hidden="true">&times;</button>        <h3>Fatal Error</h3>      </div>      <div class="modal-body">        <div class="save-messages"></div>        <div class="error-message"></div>      </div>      <div class="modal-footer">        <a href="#" class="btn btn-primary" data-dismiss="modal">Reload</a>      </div>    </div>  </div></div>'),m=!1;t.is_terminating=n,h&&(t.__test={$modal:f,reset:r});var v=[],y=5e3;t.handler=l,t.editors=v}),define("wed/preferences",["require","exports","module","lodash","./object-check"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={tooltips:!1},a=function(){function e(e){return void 0===e?(this.prefs=Object.create(null),void this._validatePrefs(this.prefs)):(this._validatePrefs(e),void(this.prefs=n.extend(Object.create(null),e)))}return e.prototype._validatePrefs=function(e){var t=i.check(o,e);if(void 0!==t.missing)throw new Error("missing option: "+t.missing[0]);if(void 0!==t.extra)throw new Error("extra option: "+t.extra[0])},e.prototype.get=function(e){for(var t=e.split("."),r=0,n=this.prefs;r<t.length;){var i=t[r];if(""===i)throw new Error("empty part in "+e);if(n=n[i],void 0===n)return;++r}return n},e.prototype.set=function(e,t){for(var r=e.split("."),n=0,i=this.prefs;n<r.length-1;){var o=r[n];if(""===o)throw new Error("empty part in "+e);i=i[o],void 0===i&&(i=i[o]=Object.create(null)),++n}i[r[n]]=t,this._validatePrefs(this.prefs)},e}();t.Preferences=a}),define("wed/ajax",["require","exports","module","bluejax","jquery","./util","bootstrap"],function(e,t,r,n,i,o){"use strict";function a(e){function t(t){if(arguments.length>1)throw new Error("we do not support passing the URL as a separate argument; please use a single settings argument");var r=i.call(void 0,t);return r.promise=r.promise.catch(n.ConnectivityError,function(t){document.body.appendChild(l);var n=l.querySelector("span.reason");n.textContent=t.message,s.on("hide.bs.modal.modal",function(t){t.stopPropagation(),t.preventDefault(),o.suppressUnhandledRejections(a(e.diagnose.serverURL).then(function(){window.location.reload()}))}),s.modal(),r.promise.cancel()}),r}function r(e){return t(e).promise}var i=n.make(e),a=n.make({diagnose:{on:!0,knownServers:e.diagnose.knownServers}},"promise");return{ajax:r,ajax$:t}}Object.defineProperty(t,"__esModule",{value:!0});var s=i("<div class='modal btw-fatal-modal' style='position: absolute' tabindex='1'>  <div class='modal-dialog'>    <div class='modal-content'>      <div class='modal-header'>        <button type='button' class='close' data-dismiss='modal'aria-hidden='true'>&times;</button>        <h3>Connectivity Problem</h3>      </div>      <div class='modal-body'>        <p>We have detected a connectivity problem:            <span class='reason'></span>.</p>        <p>When you click the Ok button, we will recheck the connectivity.            If there is still a problem, this dialog will remain. Otherwise,            the window will be reloaded. If you were modifying information            on the            site when the outage occurred, please verify that what you were            trying to do actually happened.</p>      </div>      <div class='modal-footer'>        <a href='#' class='btn btn-primary' data-dismiss='modal'>Ok</a>      </div>    </div>  </div></div>"),l=s[0];t.make=a}),define("wed/runtime",["require","exports","module","dexie","merge-options","./ajax","./util"],function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0
});var s=function(){function t(e){e=i({},e),this.options=e;var t=null!=e.bluejaxOptions?e.bluejaxOptions:{tries:3,delay:100,diagnose:{on:!0,knownServers:["http://www.google.com/","http://www.cloudfront.com/"]}},r=o.make(t);this.ajax=r.ajax,this.ajax$=r.ajax$}return t.prototype.resolve=function(e){var t=this;return Promise.resolve().then(function(){var r=e.indexOf("://");if(r===-1)return t.ajax({url:e,dataType:"text"});var i=e.substr(0,r);if("indexeddb"===i){var o=e.substr(r+3),a=o.split("/"),s=a[0],l=a[1],u=a[2],c=a[3],h=a[4],d=a[5];if("v1"!==s)throw new Error("unsupported version number: "+s);switch(c){case"string":break;case"number":h=Number(h);break;default:throw new Error("unknown type: "+c)}var p=new n.Dexie(l);return p.open().then(function(){return p.table(u).get(h)}).then(function(t){if(null==t)throw Error("cannot resolve key from: "+e);if(void 0===d)return t;if(!(d in t))throw Error("cannot resolve property in the record of: "+e);return t[d]})}throw new Error("unknown scheme: "+i)})},t.prototype.resolveToString=function(e){return this.resolve(e).then(function(e){return"string"==typeof e?e:e instanceof File?a.readFile(e):String(e)})},t.prototype.resolveModules=function(t){return Promise.resolve().then(function(){return t instanceof Array||(t=[t]),new Promise(function(r,n){e(t,function(){r(Array.prototype.slice.call(arguments))},n)})})},t}();t.Runtime=s}),define("wed/serializer",["require","exports","module"],function(e,t,r){"use strict";function n(e,t){var r=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return t&&(r=r.replace(/"/g,"&quot;")),r}function i(e,t){if(t.childNodes.length>1)throw new Error("cannot serialize a document with more than one child node");if(null===t.firstChild)throw new Error("cannot serialize an empty document");s(e,t.firstChild)}function o(e,t){e.push("<",t.tagName);for(var r=t.attributes,i=0;i<r.length;++i){var o=r[i];e.push(" ",o.name,'="',n(o.value,!0),'"')}if(0===t.childNodes.length)e.push("/>");else{e.push(">");for(var a=t.firstChild;null!==a;)s(e,a),a=a.nextSibling;e.push("</",t.tagName,">")}}function a(e,t){e.push(n(t.textContent,!1))}function s(e,t){var r=u[t.nodeType];if(void 0===r)throw new Error("can't handle node of type: "+t.nodeType);r(e,t)}function l(e){var t=[];return s(t,e),t.join("")}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.create(null);u[Node.DOCUMENT_NODE]=i,u[Node.DOCUMENT_FRAGMENT_NODE]=i,u[Node.ELEMENT_NODE]=o,u[Node.TEXT_NODE]=a,t.serialize=l}),define("wed/saver",["require","exports","module","rxjs","./browsers","./serializer"],function(e,t,r,n,i,o){"use strict";function a(e){e=Math.round(e/1e3);var t="moments ago";return e>0&&(t=" ≈ ",t+=e>86400?Math.round(e/8640)/10+"d":e>3600?Math.round(e/360)/10+"h":e>60?Math.round(e/6)/10+"m":e+"s",t+=" ago"),t}Object.defineProperty(t,"__esModule",{value:!0});var s;!function(e){e[e.AUTO=1]="AUTO",e[e.MANUAL=2]="MANUAL"}(s=t.SaveKind||(t.SaveKind={}));var l=function(){function e(e,t,r,i,o){var a=this;this.runtime=e,this.version=t,this.dataUpdater=r,this.dataTree=i,this.options=o,this.initialized=!1,this.currentGeneration=0,this.savedGeneration=0,r.events.subscribe(function(e){"Changed"===e.name&&(a.lastModification=Date.now(),a.savedGeneration===a.currentGeneration&&(a.currentGeneration++,a._events.next({name:"Changed"})))}),this._boundAutosave=this._autosave.bind(this),this._events=new n.Subject,this.events=this._events.asObservable(),void 0!==o.autosave&&this.setAutosaveInterval(1e3*o.autosave)}return e.prototype.save=function(){return this._save(!1)},e.prototype.getData=function(){var e=this.dataTree.firstChild;return i.MSIE?o.serialize(e):e.outerHTML},e.prototype._saveSuccess=function(e,t){this.savedGeneration=t,this.lastSave=Date.now(),this.lastSaveKind=e?s.AUTO:s.MANUAL,this._events.next(e?{name:"Autosaved"}:{name:"Saved"}),this.setAutosaveInterval(this.autosaveInterval)},e.prototype._fail=function(e){this.failed=!0,void 0!==e&&this._events.next({name:"Failed",error:e})},e.prototype._autosave=function(){var e=this;this.autosaveTimeout=void 0;var t=function(){e.setAutosaveInterval(e.autosaveInterval)};this.currentGeneration!==this.savedGeneration?this._save(!0).then(t):t()},e.prototype.setAutosaveInterval=function(e){this.autosaveInterval=e;var t=this.autosaveTimeout;void 0!==t&&clearTimeout(t),this.autosaveTimeout=0!==e?setTimeout(this._boundAutosave,e):void 0},e.prototype.recover=function(){var e=this;return Promise.resolve().then(function(){return!e.initialized||e.failed?Promise.resolve(void 0):e._recover()})},e.prototype.getModifiedWhen=function(){return this.savedGeneration!==this.currentGeneration&&a(Date.now()-this.lastModification)},e.prototype.getSavedWhen=function(){if(void 0!==this.lastSaveKind)return a(Date.now()-this.lastSave)},e.prototype.getLastSaveKind=function(){return this.lastSaveKind},e}();t.Saver=l}),define("wed/build-info",[],function(){return{desc:"v0.30.0",date:"Thu Oct 19 2017 10:56:37 GMT-0400 (EDT)"}}),define("wed/stock-modals",["require","exports","module","./build-info"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.maker=e,this.modals=new Map}return e.prototype.getModal=function(e){var t=this.modals.get(e);return void 0===t&&(t=this.make(e),this.modals.set(e,t)),t},e.prototype.make=function(e){var t=this.maker.makeModal();switch(e){case"limitation":t.setTitle("Cannot proceed");break;case"paste":t.setTitle("Invalid structure"),t.setBody("<p>The data you are trying to paste appears to be XML. However, pasting it here will result in a structurally invalid document. Do you want to paste it as text instead? (If you answer negatively, the data won't be pasted at all.)<p>"),t.addYesNo();break;case"straddling":t.setTitle("Invalid modification"),t.setBody("<p>The text selected straddles disparate elements of the document. You may be able to achieve what you want to do by selecting smaller sections.<p>"),t.addButton("Ok",!0);break;case"help":var r=this.maker.docLink;t.setTitle("Help"),t.setBody("\n<p>Click <a href='"+r+"' target='_blank'>this link</a> to see\nwed's generic help. The link by default will open in a new tab.</p>\n<p>The key combinations with Ctrl below are done with Command in OS X.</p>\n<ul>\n  <li>Clicking the right mouse button on the document contents brings up a\ncontextual menu.</li>\n  <li>F1: help</li>\n  <li>Ctrl-[: Decrease the label visibility level.</li>\n  <li>Ctrl-]: Increase the label visibility level.</li>\n  <li>Ctrl-s: Save</li>\n  <li>Ctrl-x: Cut</li>\n  <li>Ctrl-v: Paste</li>\n  <li>Ctrl-c: Copy</li>\n  <li>Ctrl-z: Undo</li>\n  <li>Ctrl-y: Redo</li>\n  <li>Ctrl-/: Bring up a contextual menu.</li>\n  <li>Ctrl-f: Quick search forward.</li>\n  <li>Ctrl-b: Quick search backwards.</li>\n  <li>Ctrl-Shift-f: Search forward.</li>\n  <li>Ctrl-Shift-b: Search backwards.</li>\n</ul>\n<p class='wed-build-info'>Build descriptor: "+n.desc+"<br/>\nBuild date: "+n.date+"</p>"),t.addButton("Close",!0);break;case"disconnect":t.setTitle("Disconnected from server!"),t.setBody("It appears your browser is disconnected from the server. Editing is frozen until the connection is reestablished. Dismissing this dialog will retry saving. If the operation is successful, you'll be able to continue editing. If not, this message will reappear."),t.addButton("Retry",!0);break;case"editedByOther":t.setTitle("Edited by another!"),t.setBody("Your document was edited by someone else since you last loaded or saved it. You must reload it before trying to edit further."),t.addButton("Reload",!0);break;case"tooOld":t.setTitle("Newer version!"),t.setBody("There is a newer version of the editor. You must reload it before trying to edit further."),t.addButton("Reload",!0);break;default:var i=e;throw new Error("cannot handle name "+i)}return t},e}();t.StockModals=i});var __assign=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};define("wed/task-runner",["require","exports","module","rxjs"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){void 0===t&&(t={}),this.task=e,this._timeout=0,this._maxTimespan=100,this._boundWrapper=this._workWrapper.bind(this);for(var r=["timeout","maxTimespan"],i=0,o=r;i<o.length;i++){var a=o[i],s=t[a];if(void 0!==s){if(s<0)throw new Error("the value for "+a+" cannot be negative");this["_"+a]=t[a]}}this._state=new n.BehaviorSubject({running:!1,completed:!1,terminated:!1}),this.state=this._state.asObservable()}return Object.defineProperty(e.prototype,"running",{get:function(){return this._state.value.running},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"completed",{get:function(){return this._state.value.completed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"terminated",{get:function(){return this._state.value.terminated},enumerable:!0,configurable:!0}),e.prototype.onCompleted=function(){return this.state.first(function(e){return e.completed}).toPromise()},e.prototype._stateFieldChange=function(e,t){var r=this._state.value,n=__assign({},this._state.value);n[e]=t,n[e]!==r[e]&&this._state.next(n)},e.prototype._setTimeoutId=function(e){this._timeoutId=e,this._stateFieldChange("running",void 0!==this._timeoutId)},e.prototype.start=function(){this.reset(),this.resume()},e.prototype.reset=function(){this._stateFieldChange("completed",!1),this.task.reset(this)},e.prototype.resume=function(){this.completed||(void 0!==this._timeoutId&&this.stop(),this._setTimeoutId(setTimeout(this._boundWrapper,0)))},e.prototype._workWrapper=function(){this._work()?this._setTimeoutId(setTimeout(this._boundWrapper,this._timeout)):this._stateFieldChange("completed",!0)},e.prototype._work=function(){for(var e=Date.now();;){if(this._maxTimespan>0&&Date.now()-e>=this._maxTimespan)return!0;var t=this.task.cycle(this);if(!t)return!1}},e.prototype.stop=function(){void 0!==this._timeoutId&&clearTimeout(this._timeoutId),this._setTimeoutId(void 0)},e.prototype.terminate=function(){this.stop(),this._stateFieldChange("terminated",!0),this._state.complete()},e}();t.TaskRunner=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/undo",["require","exports","module"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.stack=[],this.list=[],this.index=-1,this._undoingOrRedoing=!1}return e.prototype.record=function(e){this.stack.length>0?this.stack[0].record(e):(this.list=this.list.splice(0,this.index+1),this.list.push(e),this.index++)},e.prototype.undo=function(){if(this._undoingOrRedoing)throw new Error("calling undo while undoing or redoing");for(this._undoingOrRedoing=!0;this.stack.length>0;)this.endGroup();this.index>=0&&this.list[this.index--].undo(),this._undoingOrRedoing=!1},e.prototype.redo=function(){if(this._undoingOrRedoing)throw new Error("calling redo while undoing or redoing");this._undoingOrRedoing=!0,this.index<this.list.length-1&&this.list[++this.index].redo(),this._undoingOrRedoing=!1},e.prototype.undoingOrRedoing=function(){return this._undoingOrRedoing},e.prototype.canUndo=function(){return this.index>-1||this.stack.length>0},e.prototype.canRedo=function(){return this.index<this.list.length-1},e.prototype.startGroup=function(e){this.stack.unshift(e)},e.prototype.endGroup=function(){var e=this.stack.shift();if(void 0===e)throw new Error("ending a non-existent group.");e.end(),this.record(e)},e.prototype.endAllGroups=function(){for(;this.stack.length>0;)this.endGroup()},e.prototype.getGroup=function(){return this.stack[0]},e.prototype.toString=function(){var e=[];e.push("Start of list\n");for(var t=0,r=this.list;t<r.length;t++){var n=r[t];e.push(n.toString())}e.push("End of list\n"),e.push("Unfinished groups:\n");for(var i=this.stack.length-1;i>=0;--i){var o=this.stack[i];e.push(o.toString())}return e.push("End of unfinished groups\n"),e.join("")},e}();t.UndoList=n;var i=function(){function e(e){this.desc=e}return e.prototype.toString=function(){return this.desc+"\n"},e}();t.Undo=i;var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.list=[],t}return __extends(t,e),t.prototype.undo=function(){for(var e=this.list.length-1;e>=0;--e)this.list[e].undo()},t.prototype.redo=function(){for(var e=0,t=this.list;e<t.length;e++){var r=t[e];r.redo()}},t.prototype.record=function(e){this.list.push(e)},t.prototype.end=function(){},t.prototype.toString=function(){var e=[];e.push("Start of "+this.desc+"\n");for(var t=0,r=this.list;t<r.length;t++){var n=r[t];e.push(n.toString().replace(/(^|\n)/g,"$1 ").slice(0,-1))}return e.push("End of "+this.desc+"\n"),e.join("")},t}(i);t.UndoGroup=o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/undo-recorder",["require","exports","module","./domutil","./undo"],function(e,t,r,n,i){"use strict";function o(e){return null==e?"undefined":e.outerHTML}Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t,r,n){var i=e.call(this,"InsertNodeAtUndo")||this;return i.treeUpdater=t,i.index=n,i.parentPath=t.nodeToPath(r),i}return __extends(t,e),t.prototype.undo=function(){if(void 0!==this.node)throw new Error("undo called twice in a row");var e=this.treeUpdater.pathToNode(this.parentPath);this.node=e.childNodes[this.index].cloneNode(!0),this.treeUpdater.deleteNode(e.childNodes[this.index])},t.prototype.redo=function(){if(void 0===this.node)throw new Error("redo called twice in a row");var e=this.treeUpdater.pathToNode(this.parentPath);this.treeUpdater.insertNodeAt(e,this.index,this.node),this.node=void 0},t.prototype.toString=function(){return[this.desc,"\n"," Parent path: ",this.parentPath,"\n"," Index: ",this.index,"\n"," Node: ",o(this.node),"\n"].join("")},t}(i.Undo),s=function(e){function t(t,r,n,i){var o=e.call(this,"SetTextNodeValueUndo")||this;return o.treeUpdater=t,o.value=n,o.oldValue=i,o.nodePath=t.nodeToPath(r),o}return __extends(t,e),t.prototype.undo=function(){var e=this.treeUpdater.pathToNode(this.nodePath);this.treeUpdater.setTextNodeValue(e,this.oldValue)},t.prototype.redo=function(){var e=this.treeUpdater.pathToNode(this.nodePath);this.treeUpdater.setTextNodeValue(e,this.value)},t.prototype.toString=function(){return[this.desc,"\n"," Node path: ",this.nodePath,"\n"," Value: ",this.value,"\n"," Old value: ",this.oldValue,"\n"].join("")},t}(i.Undo),l=function(e){function t(t,r){var i=e.call(this,"DeleteNodeUndo")||this;i.treeUpdater=t;var o=r.parentNode;return i.parentPath=t.nodeToPath(o),i.index=n.indexOf(o.childNodes,r),i.node=r.cloneNode(!0),i}return __extends(t,e),t.prototype.undo=function(){if(void 0===this.node)throw new Error("undo called twice in a row");var e=this.treeUpdater.pathToNode(this.parentPath);this.treeUpdater.insertNodeAt(e,this.index,this.node),this.node=void 0},t.prototype.redo=function(){if(void 0!==this.node)throw new Error("redo called twice in a row");var e=this.treeUpdater.pathToNode(this.parentPath);this.node=e.childNodes[this.index].cloneNode(!0),this.treeUpdater.deleteNode(e.childNodes[this.index])},t.prototype.toString=function(){return[this.desc,"\n"," Parent path: ",this.parentPath,"\n"," Index: ",this.index,"\n"," Node: ",o(this.node),"\n"].join("")},t}(i.Undo),u=function(e){function t(t,r,n,i,o,a){var s=e.call(this,"SetAttributeNSUndo")||this;return s.treeUpdater=t,s.ns=n,s.attribute=i,s.oldValue=o,s.newValue=a,s.nodePath=t.nodeToPath(r),s}return __extends(t,e),t.prototype.undo=function(){var e=this.treeUpdater.pathToNode(this.nodePath);this.treeUpdater.setAttributeNS(e,this.ns,this.attribute,this.oldValue)},t.prototype.redo=function(){var e=this.treeUpdater.pathToNode(this.nodePath);this.treeUpdater.setAttributeNS(e,this.ns,this.attribute,this.newValue)},t.prototype.toString=function(){return[this.desc,"\n"," Node path: ",this.nodePath,"\n"," Namespace: ",this.ns,"\n"," Attribute Name: ",this.attribute,"\n"," New value: ",this.newValue,"\n"," Old value: ",this.oldValue,"\n"].join("")},t}(i.Undo),c=function(){function e(e,t){var r=this;this.editor=e,this.treeUpdater=t,this.suppress=!1,t.events.subscribe(function(e){switch(e.name){case"InsertNodeAt":r.insertNodeAtHandler(e);break;case"SetTextNodeValue":r.setTextNodeValueHandler(e);break;case"BeforeDeleteNode":r.beforeDeleteNodeHandler(e);break;case"SetAttributeNS":r.setAttributeNSHandler(e)}})}return e.prototype.suppressRecording=function(e){if(e===this.suppress)throw new Error("spurious call to suppressRecording");this.suppress=e},e.prototype.insertNodeAtHandler=function(e){this.suppress||this.editor.recordUndo(new a(this.treeUpdater,e.parent,e.index))},e.prototype.setTextNodeValueHandler=function(e){this.suppress||this.editor.recordUndo(new s(this.treeUpdater,e.node,e.value,e.oldValue))},e.prototype.beforeDeleteNodeHandler=function(e){this.suppress||this.editor.recordUndo(new l(this.treeUpdater,e.node))},e.prototype.setAttributeNSHandler=function(e){this.suppress||this.editor.recordUndo(new u(this.treeUpdater,e.node,e.ns,e.attribute,e.oldValue,e.newValue))},e}();t.UndoRecorder=c}),define("wed/tasks/process-validation-errors",["require","exports","module"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.controller=e}return e.prototype.reset=function(){this.errors=this.controller.copyErrorList()},e.prototype.cycle=function(){var e=this.controller,t=this.errors;if(0===t.length)return!1;for(var r=Math.min(t.length,30),n=[],i=[],o=0;0!==r;){r--;var a=t[o];if(e.processError(a)){t.splice(o,1);var s=a.item;if(void 0===s)throw new Error("there should be an item");n.push(s);var l=a.marker;null!=l&&i.push(l)}else++o}return e.appendItems(n),e.appendMarkers(i),0!==t.length},e}();t.ProcessValidationErrors=n}),define("wed/tasks/refresh-validation-errors",["require","exports","module"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.controller=e}return e.prototype.reset=function(){this.errors=this.controller.copyErrorList(),this.resumeAt=0},e.prototype.cycle=function(){for(var e=this.resumeAt,t=Math.min(this.errors.length,this.resumeAt+20),r=this.errors;e<t;){var n=r[e];null!=n.marker&&this.controller.processError(n),e++}return this.resumeAt=e,e<r.length},e}();t.RefreshValidationErrors=n}),define("wed/validation-controller",["require","exports","module","salve","salve-dom","./dloc","./domtypeguards","./domutil","./guiroot","./task-runner","./tasks/process-validation-errors","./tasks/refresh-validation-errors","./util","./wed-util"],function(e,t,r,n,i,o,a,s,l,u,c,h,d,p){"use strict";function f(e,t,r){var n=e.caretManager;try{return n.fromDataLocation(t,r)}catch(e){if(e instanceof l.AttributeNotFound)return n.fromDataLocation(t.ownerElement,0);throw e}}function m(e,t){for(var r=e.createDocumentFragment(),n=0,i=t;n<i.length;n++){var o=i[n];r.appendChild(o)}return r}function v(e,t){for(var r=[],n=e.getNames(),i=0,o=n;i<o.length;i++){var a=o[i],s=a.toArray(),l="";if(null!==s){for(var u=[],c=0,h=s;c<h.length;c++){var p=h[c];u.push(t.unresolveName(p.ns,p.name))}l=u.join(" or ")}else l=d.convertPatternObj(a.toObject(),t);r.push(l)}return r}Object.defineProperty(t,"__esModule",{value:!0});var y={};y[i.WorkingState.INCOMPLETE]="stopped",y[i.WorkingState.WORKING]="working",y[i.WorkingState.INVALID]="invalid",y[i.WorkingState.VALID]="valid";var g={};g[i.WorkingState.INCOMPLETE]="info",g[i.WorkingState.WORKING]="info",g[i.WorkingState.INVALID]="danger",g[i.WorkingState.VALID]="success";var b=function(){function e(e,t,r,n,i,o,a,s,l,d){this.editor=e,this.validator=t,this.resolver=r,this.scroller=n,this.guiRoot=i,this.progressBar=o,this.validationMessage=a,this.errorLayer=s,this.errorList=l,this.errorItemHandler=d,this.lastDoneShown=0,this.processErrorsDelay=500,this._errors=[],this.processedErrorsUpTo=-1,this.document=i.ownerDocument,this.$errorList=$(l),this.refreshErrorsRunner=new u.TaskRunner(new h.RefreshValidationErrors(this)),this.processErrorsRunner=new u.TaskRunner(new c.ProcessValidationErrors(this)),this.validator.events.addEventListener("state-update",this.onValidatorStateChange.bind(this)),this.validator.events.addEventListener("error",this.onValidatorError.bind(this)),this.validator.events.addEventListener("reset-errors",this.onResetErrors.bind(this))}return e.prototype.copyErrorList=function(){return this._errors.slice()},e.prototype.stop=function(){this.refreshErrorsRunner.stop(),this.processErrorsRunner.stop(),this.validator.stop()},e.prototype.resume=function(){this.refreshErrorsRunner.resume(),this.processErrorsRunner.resume(),this.validator.start()},e.prototype.onValidatorStateChange=function(e){var t=e.state,r=e.partDone;if(t===i.WorkingState.WORKING){if(r-this.lastDoneShown<.05)return}else t!==i.WorkingState.VALID&&t!==i.WorkingState.INVALID||this.processErrors();this.lastDoneShown=r;var n=100*r,o=this.progressBar;o.style.width=n+"%",o.classList.remove("progress-bar-info","progress-bar-success","progress-bar-danger"),o.classList.add("progress-bar-"+g[t]),this.validationMessage.textContent=y[t]},e.prototype.onValidatorError=function(e){this._errors.push({ev:e,marker:void 0,item:void 0}),void 0===this.processErrorsTimeout&&(this.processErrorsTimeout=setTimeout(this.processErrors.bind(this),this.processErrorsDelay))},e.prototype.onResetErrors=function(e){if(0!==e.at)throw new Error("internal error: wed does not yet support resetting errors at an arbitrary location");this.lastDoneShown=0,this.clearErrors()},e.prototype.processErrors=function(){void 0!==this.processErrorsTimeout&&(clearTimeout(this.processErrorsTimeout),this.processErrorsTimeout=void 0),this.processErrorsRunner.reset(),this.editor.resumeTaskWhenPossible(this.processErrorsRunner)},e.prototype.findInsertionPoint=function(e){var t=e.error,r=e.node,i=e.index;if(null==r)throw new Error("error without a node");if(void 0===i)throw new Error("error without an index");var s,l=t instanceof n.AttributeNameError;if(l){var u=p.getGUINodeIfExists(this.editor,r);if(void 0===u)return;if(!a.isElement(u))throw new Error("attribute name errors should be associated with elements");var c=u.querySelector("._gui.__start_label ._greater_than");s=o.DLoc.mustMakeDLoc(this.guiRoot,c,0)}else{if(s=f(this.editor,r,i),void 0===s)return;s=this.editor.caretManager.normalizeToEditableRange(s)}return s},e.prototype.processError=function(e){var t=this;this.editor.expandErrorPanelWhenNoNavigation();var r=e.ev,n=r.error,i=r.node,o=this.findInsertionPoint(r);if(void 0===o)return!1;var l,u=e.marker;if(null==i)throw new Error("error without a node");if(void 0===u){var c=o.node.ownerDocument,h=!1;if(a.isAttr(i)){var f=o.node;if(f.nodeType===Node.TEXT_NODE&&(f=f.parentNode),!a.isElement(f))throw new Error("we should be landing on an element");h=s.isNotDisplayed(f,o.root)}var m=v(n,this.resolver);l=c.createElement("li");var y=l.id=d.newGenericID();if(h)l.textContent=n.toStringWithNames(m),l.title="This error belongs to an attribute which is not currently displayed.";else{u=c.createElement("span"),u.className="_phantom wed-validation-error",u.innerText=" ";var g=$(u);g.mousedown(function(){t.$errorList.parents(".panel-collapse").collapse("show");var e=$(t.errorList.querySelector("#"+y)),r=t.$errorList.parent(".panel-body");return r.animate({scrollTop:e.offset().top-r.offset().top+r[0].scrollTop}),t.errorLayer.select(u),e.siblings().removeClass("selected"),e.addClass("selected"),t.editor.caretManager.setCaret(o),!1});var b=u.id=d.newGenericID(),w=c.createElement("a");w.href="#"+b,w.textContent=n.toStringWithNames(m),l.appendChild(w),$(l.firstElementChild).click(this.errorItemHandler)}}if(void 0!==u){var _=p.boundaryXY(o),E=this.scroller,x=E.getBoundingClientRect();u.style.top=_.top-x.top+E.scrollTop+"px",u.style.left=_.left-x.left+E.scrollLeft+"px"}return void 0===e.item&&(e.item=l),e.marker=u,!0},e.prototype.clearErrors=function(){this._errors=[],this.processedErrorsUpTo=-1,this.refreshErrorsRunner.stop(),this.processErrorsRunner.stop(),this.errorLayer.clear();for(var e=this.errorList;null!=e.lastChild;)e.removeChild(e.lastChild);this.refreshErrorsRunner.reset(),this.processErrorsRunner.reset()},e.prototype.terminate=function(){void 0!==this.processErrorsTimeout&&clearTimeout(this.processErrorsTimeout),this.stop()},e.prototype.refreshErrors=function(){this.refreshErrorsRunner.reset(),this.editor.resumeTaskWhenPossible(this.refreshErrorsRunner)},e.prototype.recreateErrors=function(){this.errorLayer.clear();for(var e=this.errorList;null!==e.lastChild;)e.removeChild(e.lastChild);for(var t=0,r=this._errors;t<r.length;t++){var n=r[t];n.marker=void 0,n.item=void 0}this.processedErrorsUpTo=-1,this.processErrors()},e.prototype.appendItems=function(e){this.errorList.appendChild(m(this.document,e))},e.prototype.appendMarkers=function(e){this.errorLayer.append(m(this.document,e))},e}();t.ValidationController=b});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/validator",["require","exports","module","salve-dom","./dloc","./domtypeguards"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INCOMPLETE=n.WorkingState.INCOMPLETE,t.WORKING=n.WorkingState.WORKING,t.INVALID=n.WorkingState.INVALID,t.VALID=n.WorkingState.VALID;var a=function(e){function t(t,r,n){var i=e.call(this,t,r,{timeout:0,maxTimespan:100})||this;return i.modeValidators=n,i}return __extends(t,e),t.prototype._runDocumentValidation=function(){for(var e=0,t=this.modeValidators;e<t.length;e++)for(var r=t[e],n=r.validateDocument(),i=0,o=n;i<o.length;i++){var a=o[i];this._processError(a)}},t.prototype.possibleAt=function(t,r,n){if(void 0===r&&(r=!1),void 0===n&&(n=!1),t instanceof i.DLoc){if("boolean"!=typeof r)throw new Error("2nd parameter must be boolean");n=r,r=t.offset,t=t.node}if("number"!=typeof r)throw new Error("index must be a number");return e.prototype.possibleAt.call(this,t,r,n)},t.prototype.speculativelyValidate=function(t,r,n){if(t instanceof i.DLoc){if(!(o.isNode(r)||r instanceof Array))throw new Error("2nd argument must be a Node or an array of Nodes");n=r,r=t.offset,t=t.node}if("number"!=typeof r)throw new Error("index must be a number");if(void 0===n)throw new Error("toParse must be defined");return e.prototype.speculativelyValidate.call(this,t,r,n)},t.prototype.speculativelyValidateFragment=function(t,r,n){if(t instanceof i.DLoc){if("number"==typeof r||!o.isElement(r))throw new Error("toParse is not an element");n=r,r=t.offset,t=t.node}if("number"!=typeof r)throw new Error("index must be a number");if(void 0===n)throw new Error("toParse must be defined");return e.prototype.speculativelyValidateFragment.call(this,t,r,n)},t}(n.Validator);t.Validator=a});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/wundo",["require","exports","module","./undo"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,r){var n=e.call(this,t)||this;return n.editor=r,n.caretAsPathBefore=n.getDataCaretAsPath(),n}return __extends(t,e),t.prototype.undo=function(){e.prototype.undo.call(this),this.setDataCaretAsPath(this.caretAsPathBefore)},t.prototype.redo=function(){if(e.prototype.redo.call(this),void 0===this.caretAsPathAfter)throw new Error("caretAsPathAfter is undefined, this indicates a corrupted state and thus an internal error");this.setDataCaretAsPath(this.caretAsPathAfter)},t.prototype.getDataCaretAsPath=function(){var e=this.editor.caretManager.getDataCaret(!0);return void 0===e?[void 0,void 0]:[this.editor.dataUpdater.nodeToPath(e.node),e.offset]},t.prototype.setDataCaretAsPath=function(e){void 0===e[0]&&void 0===e[1]||this.editor.caretManager.setCaret(this.editor.dataUpdater.pathToNode(e[0]),e[1])},t.prototype.recordCaretAfter=function(){this.caretAsPathAfter=this.getDataCaretAsPath()},t.prototype.end=function(){void 0===this.caretAsPathAfter&&this.recordCaretAfter()},t}(n.UndoGroup);t.UndoGroup=i;var o=function(e){function t(t,r,n,i){var o=e.call(this,t,r)||this;return o.undoList=n,o.limit=i,o}return __extends(t,e),t.prototype.record=function(t){if(this.list.length>=this.limit)throw new Error("TextUndoGroup.record called beyond the limit");e.prototype.record.call(this,t),this.list.length===this.limit&&this.undoList.endGroup()},t}(i);t.TextUndoGroup=o;var a=function(e){function t(t){return e.call(this,"*** MARKER *** "+t)||this}return __extends(t,e),t.prototype.undo=function(){},t.prototype.redo=function(){},t}(n.Undo);t.MarkerUndo=a});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{l(n.next(e))}catch(e){o(e)}}function s(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}l((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return n([e,t])}}function n(r){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,o&&(a=o[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(o,r[1])).done)return a;switch(o=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,o=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){l.label=r[1];break}if(6===r[0]&&l.label<a[1]){l.label=a[1],a=r;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(r);break}a[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(e){r=[6,e],o=0}finally{i=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var i,o,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};define("wed/wed",["require","exports","module","ajv","jquery","salve","salve-dom","./action","./caret-manager","./dloc","./domlistener","./domtypeguards","./domutil","./domutil","./exceptions","./gui-updater","./gui/dialog-search-replace","./gui/editing-menu-manager","./gui/error-layer","./gui/icon","./gui/layer","./gui/minibuffer","./gui/modal","./gui/notify","./gui/quick-search","./gui/scroller","./gui/tooltip","./gui/typeahead-popup","./guiroot","./key","./key-constants","./log","./mode-tree","./onbeforeunload","./onerror","./options-schema.json","./preferences","./runtime","./saver","./stock-modals","./task-runner","./transformation","./tree-updater","./undo","./undo-recorder","./util","./validation-controller","./validator","./wed-util","./wundo","bootstrap"],function(e,t,r,n,i,o,a,s,l,u,c,h,d,p,f,m,v,y,g,b,w,_,E,x,S,N,C,T,P,k,A,R,O,I,D,M,L,j,F,B,V,H,W,$,U,q,z,K,G,Q){
"use strict";function X(e,t){return t.name===e}Object.defineProperty(t,"__esModule",{value:!0}),t.version="0.30.0";var Y,Z=k.makeKey(27),J=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"modal",{get:function(){if(void 0===this._modal){var e=this._modal=this.editor.makeModal();e.setTitle("Complex Name Pattern Encountered"),e.setBody("<p>The schema contains here a complex name pattern modal. While wed has no problem validating such cases. It does not currently have facilities to add elements or attributes that match such patterns. You can continue editing your document but you will not be able to take advantage of the possibilities provided by the complex pattern here.</p>"),e.addButton("Ok",!0)}return this._modal},enumerable:!0,configurable:!0}),t.prototype.execute=function(){this.modal.modal()},t}(s.Action);!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.MINIBUFFER=1]="MINIBUFFER"}(Y=t.WedEventTarget||(t.WedEventTarget={}));var ee="<div class='row'> <div class='wed-frame col-sm-push-2 col-lg-10 col-md-10 col-sm-10'>  <div class='row'>   <div class='progress'>    <span></span>    <div class='wed-validation-progress progress-bar' style='width: 0%'></div>   </div>  </div>  <div class='row'>   <div class='wed-cut-buffer' contenteditable='true'></div>   <div class='wed-document-constrainer'>    <input class='wed-comp-field' type='text'></input>    <div class='wed-scroller'>     <div class='wed-caret-layer'></div>     <div class='wed-error-layer'></div>     <div class='wed-document'><span class='root-here'></span></div>    </div>   </div>   <div class='wed-minibuffer'></div>   <div class='wed-location-bar'>@&nbsp;<span>&nbsp;</span></div>  </div> </div> <div class='wed-sidebar col-sm-pull-10 col-lg-2 col-md-2 col-sm-2'>  <div class='wed-save-and-modification-status'>   <span class='wed-modification-status label label-success'          title='Modification status'>    <i class='fa fa-asterisk'></i>   </span>   <span class='wed-save-status label label-default'>    <i class='fa fa-cloud-upload'></i> <span></span>   </span>  </div>  <div id='sidebar-panel' class='panel-group wed-sidebar-panel'>   <div class='panel panel-info wed-navigation-panel'>    <div class='panel-heading'>     <div class='panel-title'>      <a class='accordion-toggle' data-toggle='collapse'          data-parent='#sidebar-panel' href='#sb-nav-collapse'>Navigation</a>     </div>    </div>   <div id='sb-nav-collapse' data-parent='#sidebar-panel'         class='panel-collapse collapse in'>     <div id='sb-nav' class='panel-body'>      <ul id='navlist' class='nav nav-list'>       <li class='inactive'>A list of navigation links will appear here</li>      </ul>     </div>    </div>   </div>   <div class='panel panel-danger'>    <div class='panel-heading'>     <div class='panel-title'>      <a class='accordion-toggle' data-toggle='collapse'         data-parent='#sidebar-panel' href='#sb-errors-collapse'>Errors</a>     </div>    </div>    <div id='sb-errors-collapse' data-parent='#sidebar-panel'         class='panel-collapse collapse'>     <div id='sb-errors' class='panel-body'>      <ul id='sb-errorlist' class='nav nav-list wed-errorlist'>       <li class='inactive'></li>      </ul>     </div>    </div>   </div>  </div> </div></div>",te=function(){function r(e,t){var r=this;this._firstValidationComplete=!1,this.modeData={},this.developmentMode=!1,this.textUndoMaxLength=10,this.taskRunners=[],this.taskSuspension=0,this.normalizeEnteredSpaces=!0,this.strippedSpaces=/\u200B/g,this.replacedSpaces=/\s+/g,this.destroying=!1,this.destroyed=!1,this.globalKeydownHandlers=[],this.updatingPlaceholder=0,this.composing=!1,this.name="",this.firstValidationComplete=new Promise(function(e){r.firstValidationCompleteResolve=e}),this.initialized=new Promise(function(e){r.initializedResolve=e}),D.editors.push(this),this.widget=e,this.$widget=i(this.widget),this.$frame=i(p.closest(this.widget,"html"));var o=this.doc=this.$frame[0].ownerDocument;this.window=o.defaultView,this.runtime=t instanceof j.Runtime?t:new j.Runtime(t),t=this.runtime.options,this.modals=new B.StockModals(this),t.ignore_module_config&&console.warn("the option ignore_module_config is no longer useful");var a=new n,s=a.compile(M);if(!s(t))throw new Error("the options passed to wed are not valid: "+a.errorsText(s.errors,{dataVar:"options"}));void 0!==t.ajaxlog&&(this.appender=R.addURL(t.ajaxlog.url,t.ajaxlog.headers)),this.name=void 0!==t.name?t.name:"",this.options=t,this.preferences=new L.Preferences({tooltips:!0});var l=p.htmlToElements(ee,o)[0],u=this.guiRoot=l.getElementsByClassName("wed-document")[0];this.$guiRoot=i(u),this.scroller=new N.Scroller(l.getElementsByClassName("wed-scroller")[0]),this.constrainer=l.getElementsByClassName("wed-document-constrainer")[0],this.inputField=l.getElementsByClassName("wed-comp-field")[0],this.$inputField=i(this.inputField),this.cutBuffer=l.getElementsByClassName("wed-cut-buffer")[0],this.caretLayer=new w.Layer(l.getElementsByClassName("wed-caret-layer")[0]),this.errorLayer=new g.ErrorLayer(l.getElementsByClassName("wed-error-layer")[0]),this.wedLocationBar=l.getElementsByClassName("wed-location-bar")[0],this.minibuffer=new _.Minibuffer(l.getElementsByClassName("wed-minibuffer")[0]);var c=this.sidebar=l.getElementsByClassName("wed-sidebar")[0];this.validationProgress=l.getElementsByClassName("wed-validation-progress")[0],this.validationMessage=this.validationProgress.previousElementSibling;var h=l.getElementsByClassName("root-here")[0];if(null!==this.widget.firstChild){if(!(this.widget.firstChild instanceof this.window.Element))throw new Error("the data is populated with DOM elements constructed from another window");h.parentNode.insertBefore(this.widget.firstChild,h)}h.parentNode.removeChild(h),this.widget.appendChild(l),this.caretOwners=u.getElementsByClassName("_owns_caret"),this.clickedLabels=u.getElementsByClassName("_label_clicked"),this.withCaret=u.getElementsByClassName("_with_caret"),this.$modificationStatus=i(c.getElementsByClassName("wed-modification-status")[0]),this.$saveStatus=i(c.getElementsByClassName("wed-save-status")[0]),this.$navigationPanel=i(c.getElementsByClassName("wed-navigation-panel")[0]),this.$navigationPanel.css("display","none"),this.$navigationList=i(o.getElementById("navlist")),this.$errorList=i(o.getElementById("sb-errorlist")),this.$excludedFromBlur=i(),this.errorItemHandlerBound=this.errorItemHandler.bind(this),this._undo=new $.UndoList,this.complexPatternAction=new J(this,"Complex name pattern",void 0,b.makeHTML("exclamation"),!0),this.pasteTr=new H.Transformation(this,"add","Paste",this.paste.bind(this)),this.cutTr=new H.Transformation(this,"delete","Cut",this.cut.bind(this)),this.replaceRangeTr=new H.Transformation(this,"transform","Replace Range",this.replaceRange.bind(this)),this.splitNodeTr=new H.Transformation(this,"split","Split <name>",function(e,t){H.splitNode(e,t.node)}),this.mergeWithPreviousHomogeneousSiblingTr=new H.Transformation(this,"merge-with-previous","Merge <name> with previous",function(e,t){H.mergeWithPreviousHomogeneousSibling(e,t.node)}),this.mergeWithNextHomogeneousSiblingTr=new H.Transformation(this,"merge-with-next","Merge <name> with next",function(e,t){H.mergeWithNextHomogeneousSibling(e,t.node)}),i(this.window).on("unload.wed",{editor:this},function(e){e.data.editor.destroy()}),i(this.window).on("popstate.wed",function(){""===document.location.hash&&(r.guiRoot.scrollTop=0)})}return r.prototype.fireTransformation=function(e,t){this.editingMenuManager.dismiss();var r=this._undo.getGroup();r instanceof Q.TextUndoGroup&&this._undo.endGroup();var n=new Q.UndoGroup("Undo "+e.getDescriptionFor(t),this);this._undo.startGroup(n),this.caretManager.mark.suspend(),this.enterTaskSuspension();try{try{this._fireTransformation(e,t)}catch(e){throw e instanceof f.AbortTransformationException||R.handle(e),e}finally{do r=this._undo.getGroup(),this._undo.endGroup();while(r!==n)}}catch(e){if(this.undo(),!(e instanceof f.AbortTransformationException))throw e}finally{this.caretManager.mark.resume(),this.exitTaskSuspension(),this.validationController.refreshErrors()}},r.prototype._fireTransformation=function(e,t){var r=t.node;if(void 0!==r)if(this.guiRoot.contains(r)){var n=this.toDataNode(r);t.node=null===n?void 0:n}else if(!d.contains(this.dataRoot,r))throw new Error("node is neither in the gui tree nor the data tree");var i=t.moveCaretTo;if(void 0!==i&&this.caretManager.setCaret(i),void 0===this.caretManager.caret)throw new Error("transformation applied with undefined caret.");e.handler(this,t)},r.prototype.enterTaskSuspension=function(){0===this.taskSuspension&&this.stopAllTasks(),this.taskSuspension++},r.prototype.exitTaskSuspension=function(){if(this.taskSuspension--,this.taskSuspension<0)throw new Error("exitTaskSuspension underflow");0===this.taskSuspension&&this.resumeAllTasks()},r.prototype.stopAllTasks=function(){for(var e=0,t=this.taskRunners;e<t.length;e++){var r=t[e];r.stop()}this.validationController.stop()},r.prototype.resumeAllTasks=function(){for(var e=0,t=this.taskRunners;e<t.length;e++){var r=t[e];r.resume()}this.validationController.resume()},r.prototype.resumeTaskWhenPossible=function(e){0===this.taskSuspension&&e.resume()},r.prototype.recordUndo=function(e){this._undo.record(e)},r.prototype.undoAll=function(){for(;this._undo.canUndo();)this.undo()},r.prototype.undo=function(){this.caretManager.mark.suspend(),this.enterTaskSuspension(),this.undoRecorder.suppressRecording(!0),this._undo.undo(),this.undoRecorder.suppressRecording(!1),this.caretManager.mark.resume(),this.exitTaskSuspension()},r.prototype.redo=function(){this.caretManager.mark.suspend(),this.enterTaskSuspension(),this.undoRecorder.suppressRecording(!0),this._undo.redo(),this.undoRecorder.suppressRecording(!1),this.caretManager.mark.resume(),this.exitTaskSuspension()},r.prototype.dumpUndo=function(){console.log(this._undo.toString())},r.prototype.undoMarker=function(e){this.recordUndo(new Q.MarkerUndo(e))},r.prototype.undoingOrRedoing=function(){return this._undo.undoingOrRedoing()},r.prototype.isAttrProtected=function(e,t){var r;if("string"==typeof e){if(r=e,void 0===t)throw new Error("must specify a parent")}else if(h.isAttr(e))r=e.name;else{if(!h.isElement(e))throw new Error("unexpected value for attr");r=d.siblingByClass(e,"_attribute_name").textContent}return"xmlns"===r||0===r.lastIndexOf("xmlns:",0)},r.prototype.save=function(){return this.saver.save()},r.prototype.initiateTextUndo=function(){var e=this._undo.getGroup();return void 0!==e&&e instanceof Q.TextUndoGroup||(e=new Q.TextUndoGroup("text",this,this._undo,this.textUndoMaxLength),this._undo.startGroup(e)),e},r.prototype.terminateTextUndo=function(){var e=this._undo.getGroup();e instanceof Q.TextUndoGroup&&this._undo.endGroup()},r.prototype.normalizeEnteredText=function(e){return this.normalizeEnteredSpaces?e.replace(this.strippedSpaces,"").replace(this.replacedSpaces," "):e},r.prototype.compensateForAdjacentSpaces=function(e,t){if(!this.normalizeEnteredSpaces)return e;var r=t.toArray();return" "===e[0]&&" "===d.getCharacterImmediatelyBefore(r)&&(e=e.slice(1)),e.length>0&&" "===e[e.length-1]&&" "===d.getCharacterImmediatelyAt(r)&&(e=e.slice(-1)),e},r.prototype.insertText=function(e){if(this.closeAllTooltips(),e=this.normalizeEnteredText(e),""!==e){var t=this.caretManager,r=t.caret;if(void 0!==r){var n=p.closestByClass(r.node,"_real",this.guiRoot);if(null!==n&&!n.classList.contains("_readonly")){this.enterTaskSuspension();try{var i=p.closestByClass(r.node,"_attribute_value",this.guiRoot);if(null===i){if(r=t.getDataCaret(),e=this.compensateForAdjacentSpaces(e,r),""===e)return;var o=this.initiateTextUndo(),a=this.dataUpdater.insertText(r,e).caret;t.setCaret(a,{textEdit:!0}),o.recordCaretAfter()}else this.spliceAttribute(i,r.offset,0,e)}finally{this.exitTaskSuspension(),this.validationController.refreshErrors()}}}}},r.prototype.spliceAttribute=function(e,t,r,n){if(!(t<0||this.isAttrProtected(e))){var o=this.toDataNode(e).value;if(!(t>o.length||t===o.length&&r>0)){this.normalizeEnteredSpaces&&(" "===n[0]&&" "===o[t-1]&&(n=n.slice(1))," "===n[n.length-1]&&" "===o[t+r]&&(n=n.slice(-1)));var a=this.initiateTextUndo();o=o.slice(0,t)+n+o.slice(t+r),t+=n.length;var s=i.data(p.closestByClass(e,"_real"),"wed_mirror_node"),l=this.nodeToPath(e),u=d.siblingByClass(e,"_attribute_name").textContent,c=this.modeTree.getMode(e),h=c.getAbsoluteResolver().resolveName(u,!0);if(void 0===h)throw new Error("cannot resolve "+u);this.dataUpdater.setAttributeNS(s,h.ns,h.name,o);var f;try{f=this.pathToNode(l),null!==f.firstChild&&(f=f.firstChild)}catch(e){if(!(e instanceof P.AttributeNotFound))throw e}null==f&&(f=s,t=0),this.caretManager.setCaret(f,t,{textEdit:!0}),a.recordCaretAfter()}}},r.prototype.insertTransientPlaceholderAt=function(e){var t=i("<span class='_placeholder _transient' contenteditable='false'> </span>",e.node.ownerDocument)[0];return this.guiUpdater.insertNodeAt(e,t),t},r.prototype.toDataNode=function(e){if(h.isElement(e)){var t=i.data(e,"wed_mirror_node");if(null!=t)return t}return this.dataUpdater.pathToNode(this.nodeToPath(e))},r.prototype.fromDataNode=function(e){if(h.isElement(e)){var t=i.data(e,"wed_mirror_node");if(null!=t)return t}return this.pathToNode(this.dataUpdater.nodeToPath(e))},r.prototype.onSaverSaved=function(){x.notify("Saved",{type:"success"}),this.refreshSaveStatus()},r.prototype.onSaverAutosaved=function(){x.notify("Autosaved",{type:"success"}),this.refreshSaveStatus()},r.prototype.onSaverChanged=function(){this.refreshSaveStatus()},r.prototype.onSaverFailed=function(e){var t=this;this.refreshSaveStatus();var r=e.error;"too_old"===r.type?this.modals.getModal("tooOld").modal(this.window.location.reload.bind(this.window.location)):"save_disconnected"===r.type?this.modals.getModal("disconnect").modal(function(){t.save()}):"save_edited"===r.type?this.modals.getModal("editedByOther").modal(function(){t.window.location.reload()}):x.notify("Failed to save!\n"+r.msg,{type:"danger"})},r.prototype.nodeToPath=function(e){return this.guiDLocRoot.nodeToPath(e)},r.prototype.pathToNode=function(e){return this.guiDLocRoot.pathToNode(e)},r.prototype.getModeData=function(e){return this.modeData[e]},r.prototype.setModeData=function(e,t){this.modeData[e]=t},r.prototype.destroy=function(){if(this.destroying=!0,!this.destroyed){var e=D.editors.indexOf(this);e>=0&&D.editors.splice(e,1),void 0!==this.saver&&this.saver.setAutosaveInterval(0),void 0!==this.saveStatusInterval&&clearInterval(this.saveStatusInterval);try{void 0!==this.validationController&&this.validationController.terminate()}catch(e){R.unhandled(e)}if(void 0!==this.taskRunners)for(var t=0,r=this.taskRunners;t<r.length;t++){var n=r[t];try{n.stop()}catch(e){R.unhandled(e)}}try{void 0!==this.domlistener&&(this.domlistener.stopListening(),this.domlistener.clearPending())}catch(e){R.unhandled(e)}void 0!==this.editingMenuManager&&this.editingMenuManager.dismiss();try{this.$widget.empty(),this.$frame.find("*").off(".wed"),i(this.window).off(".wed")}catch(e){R.unhandled(e)}for(var o=0,a=Object.keys(this);o<a.length;o++){var s=a[o];delete this[s]}void 0!==this.appender&&R.removeAppender(this.appender),this.destroyed=!0,this.destroy=function(){}}},r.prototype.init=function(t){return __awaiter(this,void 0,void 0,function(){var r,n,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=new this.window.DOMParser,void 0!==t&&""!==t?(this.dataRoot=r.parseFromString(t,"text/xml"),this._dataChild=this.dataRoot.firstChild):(this.dataRoot=r.parseFromString("<div></div>","text/xml"),this._dataChild=void 0),this.dataRoot.removeChild(this.dataRoot.firstChild),this.$dataRoot=i(this.dataRoot),this.guiDLocRoot=new P.GUIRoot(this.guiRoot),this.dataDLocRoot=new u.DLocRoot(this.dataRoot),this.dataUpdater=new W.TreeUpdater(this.dataRoot),this.guiUpdater=new m.GUIUpdater(this.guiRoot,this.dataUpdater),this.undoRecorder=new U.UndoRecorder(this,this.dataUpdater),this.guiUpdater.events.subscribe(function(e){switch(e.name){case"BeforeInsertNodeAt":h.isElement(e.node)&&o.initialContentEditableHandler(e);break;case"InsertNodeAt":h.isElement(e.node)&&o.finalContentEditableHandler(e)}}),n=document.getElementsByClassName("wed-has-tooltip"),this.guiUpdater.events.subscribe(function(e){if("BeforeDeleteNode"===e.name){var t=e.node;if(t.nodeType!==Node.TEXT_NODE)for(var r=0,o=Array.from(n);r<o.length;r++){var a=o[r];if(t.contains(a)){var s=i.data(a,"bs.tooltip");null!=s&&s.destroy()}}}}),this.docLink=e.toUrl("../../doc/index.html"),this.domlistener=new c.Listener(this.guiRoot,this.guiUpdater),this.modeTree=new O.ModeTree(this,this.options.mode),[4,this.modeTree.init()];case 1:return a.sent(),[2,this.onModeChange(this.modeTree.getMode(this.guiRoot))]}})})},r.prototype.onModeChange=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,i,a,s,u,c;return __generator(this,function(h){switch(h.label){case 0:if(this.destroyed)return[2,this];for(this.maxLabelLevel=this.modeTree.getMaxLabelLevel(),this.initialLabelLevel=this.modeTree.getInitialLabelLevel(),this.currentLabelLevel=this.initialLabelLevel,t=this.modeTree.getStylesheets(),r=this.$frame.children("head"),n=0,i=t;n<i.length;n++)a=i[n],r.append('<link rel="stylesheet" href="'+a+'" type="text/css" />');return this.guiRoot.setAttribute("tabindex","-1"),this.$guiRoot.focus(),this.caretManager=new l.CaretManager(this.guiDLocRoot,this.dataDLocRoot,this.inputField,this.guiUpdater,this.caretLayer,this.scroller,this.modeTree),this.editingMenuManager=new y.EditingMenuManager(this),this.caretManager.events.subscribe(this.caretChange.bind(this)),this.resizeHandler(),u=this.options.schema,u instanceof o.Grammar?(s=u,[3,4]):[3,1];case 1:return"string"!=typeof u?[3,3]:[4,this.runtime.resolveToString(u)];case 2:return c=h.sent(),s=o.constructTree(c),[3,4];case 3:throw new Error("unexpected value for schema");case 4:return this.validator=new K.Validator(s,this.dataRoot,this.modeTree.getValidators()),this.validator.events.addEventListener("state-update",this.onValidatorStateChange.bind(this)),this.validator.events.addEventListener("possible-due-to-wildcard-change",this.onPossibleDueToWildcardChange.bind(this)),this.validationController=new z.ValidationController(this,this.validator,e.getAbsoluteResolver(),this.scroller,this.guiRoot,this.validationProgress,this.validationMessage,this.errorLayer,this.$errorList[0],this.errorItemHandlerBound),[2,this.postInitialize()]}})})},r.prototype.postInitialize=function(){return __awaiter(this,void 0,void 0,function(){var e,r,n,o,a,s,l,u,c,f=this;return __generator(this,function(m){switch(m.label){case 0:return this.destroyed?[2,this]:(this.domlistener.addHandler("children-changed","._real, ._phantom_wrap, .wed-document",function(e,t,r,n,i,o){for(var a=0,s=t.concat(r);a<s.length;a++){var l=s[a];if(h.isText(l)||h.isElement(l)&&(l.classList.contains("_real")||l.classList.contains("_phantom_wrap"))){f.validator.resetTo(o);break}}}),this.domlistener.addHandler("attribute-changed","._real",function(e,t,r,n){""===r&&0===n.indexOf("data-wed",0)&&setTimeout(function(){f.destroyed||f.validator.resetTo(t)},0)}),this.modeTree.addDecoratorHandlers(),this.domlistener.addHandler("included-element","._label",function(e,t,r,n,i,o){for(var a,s=o.classList,l=0;l<s.length&&void 0===a;++l)0===s[l].lastIndexOf("_label_level_",0)&&(a=Number(s[l].slice(13)));if(void 0===a)throw new Error("unable to get level");a>f.currentLabelLevel&&s.add("_invisible")}),this.domlistener.addHandler("children-changed","._real, ._phantom_wrap, .wed-document",function(e,t,r,n,i,o){if(0===f.updatingPlaceholder){f.updatingPlaceholder++;for(var a,s=[],l=o.firstChild;null!==l;)(h.isText(l)||h.isElement(l)&&(l.classList.contains("_real")||l.classList.contains("_phantom_wrap")||l.classList.contains("_text")))&&s.push(l),h.isElement(l)&&l.classList.contains("_placeholder")&&(a=l),l=l.nextSibling;var u=f.caretManager;if(0===s.length||1===s.length&&r.indexOf(s[0])!==-1){if(void 0===a){var c=f.modeTree.getMode(o),d=c.nodesAroundEditableContents(o);if(o===f.guiRoot){var m=u.makeCaret(f.guiRoot,0);a=f.insertTransientPlaceholderAt(m),u.setCaret(m,{textEdit:!0})}else a=c.makePlaceholderFor(o),f.guiUpdater.insertBefore(o,a,d[1])}}else if(void 0!==a&&!a.classList.contains("_transient")){var v,y=void 0!==u.caret?u.caret.node:void 0,g=void 0!==y&&a.contains(y),b=void 0;g&&(v=a.parentNode,b=p.indexOf(v.childNodes,a)),f.guiUpdater.removeNode(a),g&&u.setCaret(v,b,{textEdit:!0})}f.updatingPlaceholder--}}),e=function(e){if(0===f.updatingPlaceholder){f.updatingPlaceholder++;var t=f.toDataNode(e),r=d.childByClass(e,"_placeholder");""!==t.value?null!==r&&e.removeChild(r):null===r&&f.guiUpdater.insertBefore(e,d.makePlaceholder(),null),f.updatingPlaceholder--}},this.domlistener.addHandler("children-changed","._attribute_value",function(t,r,n,i,o,a){e(a)}),this.domlistener.addHandler("included-element","._attribute_value",function(t,r,n,i,o,a){e(a)}),this.modeTree.startListening(),void 0!==this._dataChild&&this.dataUpdater.insertAt(this.dataRoot,0,this._dataChild),r=this.$guiRoot,r.on("dragenter","*",!1),r.on("dragstart","*",!1),r.on("dragover","*",!1),r.on("drop","*",!1),r.on("wed-global-keydown",this.globalKeydownHandler.bind(this)),r.on("wed-global-keypress",this.globalKeypressHandler.bind(this)),r.on("keydown",this.keydownHandler.bind(this)),r.on("keypress",this.keypressHandler.bind(this)),this.$inputField.on("keydown",this.keydownHandler.bind(this)),this.$inputField.on("keypress",this.keypressHandler.bind(this)),this.$inputField.on("compositionstart compositionupdate compositionend",this.compositionHandler.bind(this)),this.$inputField.on("input",this.inputHandler.bind(this)),r.on("mousedown",this.mousedownHandler.bind(this)),r.on("mouseover",this.mouseoverHandler.bind(this)),r.on("mouseout",this.mouseoutHandler.bind(this)),r.on("contextmenu",this.mouseupHandler.bind(this)),r.on("paste",R.wrap(this.pasteHandler.bind(this))),this.$inputField.on("paste",R.wrap(this.pasteHandler.bind(this))),r.on("cut",R.wrap(this.cutHandler.bind(this))),i(this.window).on("resize.wed",this.resizeHandler.bind(this)),r.on("click","a",function(e){return e.ctrlKey&&(window.location.href=e.currentTarget.href),!1}),n=i(this.doc.body),n.on("mouseup.wed",function(){f.$guiRoot.off("mousemove.wed mouseup")}),n.on("contextmenu.wed",function(e){return!f.guiRoot.contains(e.target)}),n.on("click.wed",function(e){if(!(void 0===e.pageX||e.pageX<0||void 0===e.pageY||e.pageY<0||e.screenX===e.screenY&&0===e.screenX||f.widget.contains(e.target))){var t=f.doc.elementFromPoint(e.clientX,e.clientY);if(0===i(t).closest(f.$excludedFromBlur).length){var r=f.$guiRoot.offset(),n=e.pageX-r.left,o=e.pageY-r.top;n>=0&&o>=0&&n<f.$guiRoot.outerWidth()&&o<f.$guiRoot.outerHeight()||f.caretManager.onBlur()}}}),this.$widget.removeClass("loading"),this.$widget.css("display","block"),o=this.initializeNamespaces(),void 0!==o?(a=this.modals.getModal("limitation"),a.setBody(o),a.modal(),this.destroy(),[2,this]):(this.domlistener.processImmediately(),this._undo=new $.UndoList,r.focus(),this.validator.start(),s=this.options.demo,void 0!==s&&("string"!=typeof s&&(s="Some functions may not be available."),l=this.makeModal(),l.setTitle("Demo"),l.setBody("<p>This is a demo of wed. "+s+"</p> <p>Click <a href='"+this.docLink+"' target='_blank'>this link</a> to see wed's generic help. The link by default will open in a new tab.</p>"),l.addButton("Ok",!0),l.modal()),u=this.options.save,c=void 0!==u?this.runtime.resolveModules(u.path).then(function(e){var r=e[0].Saver,n=void 0!==u.options?u.options:{},i=new r(f.runtime,t.version,f.dataUpdater,f.dataRoot,n);return f.saver=i,i.events.filter(X.bind(void 0,"Saved")).subscribe(f.onSaverSaved.bind(f)),i.events.filter(X.bind(void 0,"Autosaved")).subscribe(f.onSaverAutosaved.bind(f)),i.events.filter(X.bind(void 0,"Failed")).subscribe(f.onSaverFailed.bind(f)),i.events.filter(X.bind(void 0,"Changed")).subscribe(f.onSaverChanged.bind(f)),f.refreshSaveStatus(),f.saveStatusInterval=setInterval(f.refreshSaveStatus.bind(f),3e4),I.install(f.window,function(){return!f.destroyed&&f.saver.getModifiedWhen()!==!1},!0),i.init()}):Promise.resolve().then(function(){R.error("wed cannot save data due to the absence of a save option")}),[4,c]));case 1:return m.sent(),this.initializedResolve(this),[2,this]}})})},r.prototype.initialContentEditableHandler=function(e){var t=function(e){e.setAttribute("tabindex","-1"),e.setAttribute("contenteditable",String(e.classList.contains("_real")||e.classList.contains("_attribute_value")));for(var r=e.firstElementChild;null!==r;)t(r),r=r.nextElementSibling};t(e.node)},r.prototype.finalContentEditableHandler=function(e){for(var t=e.node,r=t.getElementsByClassName("_attribute_value"),n=0,i=Array.from(r);n<i.length;n++){var o=i[n];"edit"!==this.modeTree.getAttributeHandling(o)&&o.setAttribute("contenteditable","false")}},r.prototype.initializeNamespaces=function(){var e,t=this.modeTree.getMode(this.guiRoot),r=t.getAbsoluteResolver();if(null===this.dataRoot.firstChild){var n=Object.create(null);if(this.validator.getSchemaNamespaces().forEach(function(t){if("*"!==t&&"::except"!==t){var i=r.prefixFromURI(t);"xml"!==i&&(""===i?n.xmlns=t:(void 0===i&&(e="The mode does not allow determining the namespace prefix for "+t+". The most likely issue is that the mode is buggy or wed was started with incorrect options."),n["xmlns:"+i]=t))}}),void 0!==e)return e;var i=this.validator.possibleAt(this.dataRoot,0).toArray();if(1===i.length&&"enterStartTag"===i[0].params[0]){var o=i[0].params[1],a=o.toArray();if(null!==a&&1===a.length){var s=a[0];H.insertElement(this.dataUpdater,this.dataRoot,0,s.ns,r.unresolveName(s.ns,s.name),n),this.caretManager.setCaret(this.dataRoot.firstElementChild,0)}}if(null===this.dataRoot.firstChild){var l=this.insertTransientPlaceholderAt(this.caretManager.makeCaret(this.guiRoot,0));this.caretManager.setCaret(l,0)}}else{var u=this.validator.getDocumentNamespaces();Object.keys(u).forEach(function(t){var n=u[t];n.length>1&&(e="The document you are trying to edit uses namespaces in a way not supported by this version of wed."),r.definePrefix(t,n[0])})}return e},r.prototype.newTaskRunner=function(e){var t=new V.TaskRunner(e);return this.taskRunners.push(t),t},r.prototype.resize=function(){this.resizeHandler()},r.prototype.resizeHandler=function(){function e(e){t+=e.getBoundingClientRect().height}for(var t=0,r=this.constrainer.nextElementSibling;null!==r;)e(r),r=r.nextElementSibling;for(var n=this.widget;h.isElement(n);){for(var o=n.nextElementSibling;null!==o;)"script"!==o.tagName&&e(o),o=o.nextElementSibling;n=n.parentNode}var a=this.window.innerHeight-(this.scroller.getBoundingClientRect().top+this.window.pageYOffset)-t;a=Math.floor(a),this.scroller.coerceHeight(a);var s=this.sidebar,l=this.window.innerHeight-(s.getBoundingClientRect().top+this.window.pageYOffset)-t;s.style.maxHeight=l+"px",s.style.minHeight=l+"px";var u=s.getElementsByClassName("wed-sidebar-panel")[0];l=this.window.innerHeight-(u.getBoundingClientRect().top+this.window.pageYOffset)-t,u.style.maxHeight=l+"px",u.style.minHeight=l+"px";for(var c=u.getElementsByClassName("panel"),p=u.getElementsByClassName("panel-heading"),f=0,m=0;m<p.length;++m){var v=p[m],y=i(v.parentNode);f+=y.outerHeight(!0)-y.innerHeight(),f+=i(v).outerHeight(!0)}for(var g,b=l-f,m=0;m<c.length;++m){g=c[m],g.style.maxHeight=b+i(d.childByClass(g,"panel-heading")).outerHeight(!0)+"px";var w=g.getElementsByClassName("panel-body")[0];w.style.height=b+"px"}void 0!==this.validationController&&this.validationController.refreshErrors(),this.caretManager.mark.refresh()},r.prototype.openDocumentationLink=function(e){window.open(e)},r.prototype.getElementTransformationsAt=function(e,t){var r=this,n=this.modeTree.getMode(e.node),i=n.getAbsoluteResolver(),o=[];return this.validator.possibleAt(e).forEach(function(a){if("enterStartTag"===a.params[0]){var s=a.params[1],l=s.toArray();if(null!==l)for(var u=0,c=l;u<c.length;u++){var h=c[u],d=i.unresolveName(h.ns,h.name),p=n.getContextualActions(t,d,e.node,e.offset);if(void 0===p)return;for(var f=0,m=p;f<m.length;f++){var v=m[f];o.push({tr:v,name:d})}}else o.push({tr:r.complexPatternAction,name:void 0})}}),o},r.prototype.cutHandler=function(e){if(void 0===this.caretManager.getDataCaret())return!1;var t=this.caretManager.sel;if(t.wellFormed){var r=p.closestByClass(t.anchor.node,"_real",this.guiRoot);return null!==r&&!r.classList.contains("_readonly")&&(this.fireTransformation(this.cutTr,{e:e}),!0)}return this.modals.getModal("straddling").modal(),!1},r.prototype.pasteHandler=function(e){var t=this,r=this.caretManager.getDataCaret();if(void 0===r)return!1;var n=p.closestByClass(this.caretManager.anchor.node,"_real",this.guiRoot);if(null===n||n.classList.contains("_readonly"))return!1;var i=e.originalEvent.clipboardData||this.window.clipboardData,o=i.getData("text");if(null==o||""===o)return!1;if(o=this.normalizeEnteredText(o),""===o)return!1;var a=new this.window.DOMParser,s=a.parseFromString("<div>"+o+"</div>","text/xml"),l=!0;h.isElement(s.firstChild)&&"parsererror"===s.firstChild.tagName&&"http://www.mozilla.org/newlayout/xml/parsererror.xml"===s.firstChild.namespaceURI&&(l=!1);var u;if(l){u=s.firstChild;var c=this.validator.speculativelyValidate(r,Array.prototype.slice.call(u.childNodes));if(c){var d=this.modals.getModal("paste");return d.modal(function(){"Yes"===d.getClickedAsText()&&(u=t.doc.createElement("div"),u.textContent=o,t.fireTransformation(t.pasteTr,{node:r.node,to_paste:u,e:e}))}),!1}}else u=this.doc.createElement("div"),u.textContent=o;return this.fireTransformation(this.pasteTr,{node:r.node,to_paste:u,e:e}),!1},r.prototype.keydownHandler=function(e){var t=this.caretManager.getNormalizedCaret();void 0!==t&&this.$guiRoot.trigger("wed-input-trigger-keydown",[e]),e.isImmediatePropagationStopped()||e.isPropagationStopped()||this.$guiRoot.trigger("wed-global-keydown",[e])},r.prototype.pushGlobalKeydownHandler=function(e){this.globalKeydownHandlers.push(e)},r.prototype.popGlobalKeydownHandler=function(e){var t=this.globalKeydownHandlers.pop();if(t!==e)throw new Error("did not pop the expected handler")},r.prototype.globalKeydownHandler=function(e,t){function r(){return t.stopPropagation(),t.preventDefault(),!1}var n;if(17===t.which||16===t.which||18===t.which||0===t.which)return!0;if(this.minibuffer.enabled)return!0;for(var o=0,a=this.globalKeydownHandlers;o<a.length;o++){var s=a[o],l=s(e,t);if(l===!1)return r()}if(112===t.which)return this.modals.getModal("help").modal(),r();if(this.developmentMode){if(113===t.which)return this.caretManager.dumpCaretInfo(),r();if(114===t.which)return this.dumpUndo(),r();if(115===t.which)return console.log("manual focus"),console.log("document.activeElement before",document.activeElement),console.log('document.querySelector(":focus") before',document.querySelector(":focus")),this.caretManager.focusInputField(),console.log("document.activeElement after",document.activeElement),console.log('document.querySelector(":focus") after',document.querySelector(":focus")),r()}var u=this.caretManager.caret;if(t.which>=33&&t.which<=40){var c=void 0;return A.RIGHT_ARROW.matchesEvent(t)?c="right":A.LEFT_ARROW.matchesEvent(t)?c="left":A.DOWN_ARROW.matchesEvent(t)?c="down":A.UP_ARROW.matchesEvent(t)&&(c="up"),void 0===c||(this.caretManager.move(c,t.shiftKey),r())}if(A.ESCAPE.matchesEvent(t))return!this.closeAllTooltips()||r();if(A.CTRLEQ_S.matchesEvent(t))return this.save(),r();if(A.CTRLEQ_Z.matchesEvent(t))return this.undo(),r();if(A.CTRLEQ_Y.matchesEvent(t))return this.redo(),r();if(A.CTRLEQ_C.matchesEvent(t)||A.CTRLEQ_X.matchesEvent(t)||A.CTRLEQ_V.matchesEvent(t))return!0;if(A.CTRLEQ_BACKQUOTE.matchesEvent(t))return this.developmentMode=!this.developmentMode,x.notify(this.developmentMode?"Development mode on.":"Development mode off."),this.developmentMode&&R.showPopup(),r();if(A.CTRLEQ_OPEN_BRACKET.matchesEvent(t))return this.decreaseLabelVisiblityLevel(),
r();if(A.CTRLEQ_CLOSE_BRACKET.matchesEvent(t))return this.increaseLabelVisibilityLevel(),r();if(A.CTRLEQ_FORWARD_SLASH.matchesEvent(t)){if(void 0!==u){var f=u.node,m=p.closestByClass(f,"_gui",u.root);if(null!==m&&m.classList.contains("_label_clicked"))return h.isText(f)&&(f=f.parentNode),i(f).trigger("wed-context-menu",[t]),r()}if(this.editingMenuManager.contextMenuHandler(t)===!1)return r()}else{if(A.QUICKSEARCH_FORWARD.matchesEvent(t))return void 0!==this.caretManager.caret&&new S.QuickSearch(this,this.scroller,S.Direction.FORWARD),r();if(A.QUICKSEARCH_BACKWARDS.matchesEvent(t))return void 0!==this.caretManager.caret&&new S.QuickSearch(this,this.scroller,S.Direction.BACKWARDS),r();if(A.SEARCH_FORWARD.matchesEvent(t))return void 0!==this.caretManager.caret&&new v.DialogSearchReplace(this,this.scroller,S.Direction.FORWARD),r();if(A.SEARCH_BACKWARDS.matchesEvent(t))return void 0!==this.caretManager.caret&&new v.DialogSearchReplace(this,this.scroller,S.Direction.BACKWARDS),r()}if(void 0===u)return!0;var y=p.closestByClass(u.node,"_placeholder",u.root);if(null!==y){if(n=this.caretManager.getDataCaret(),!q.anySpecialKeyHeld(t)){var g=!1;if(y.parentNode.classList.contains("_attribute_value")?g=!0:this.validator.possibleAt(n).forEach(function(e){"text"===e.params[0]&&(g=!0)}),!g)return r()}if(A.BACKSPACE.matchesEvent(t)||A.DELETE.matchesEvent(t))return r()}var b=p.closestByClass(u.node,"_attribute_value",u.root),w=this.guiRoot.querySelector(".__start_label._label_clicked, .__end_label._label_clicked");if(null===b&&null!==w&&A.DELETE.matchesEvent(t)){var _=p.closestByClass(w,"_real",this.guiRoot),E=this.dataUpdater.pathToNode(this.nodeToPath(_)),N=this.modeTree.getMode(_),C=N.getContextualActions("delete-parent",E.tagName,E,0);return C[0].execute({node:E,name:E.tagName}),r()}if(h.isElement(u.node)&&(u.node.classList.contains("_phantom")||u.node.classList.contains("_phantom_wrap")))return r();var T,P,k;if(A.SPACE.matchesEvent(t))return n=this.caretManager.getNormalizedCaret(),void 0===n?r():(null===b&&null!==p.closestByClass(n.node,"_phantom",n.root)||this.handleKeyInsertingText(t),r());if(A.DELETE.matchesEvent(t)){if(null!==b){if(""===b.textContent)return r();this.spliceAttribute(b,this.caretManager.getNormalizedCaret().offset,1,"")}else{var O=d.nextCaretPosition(u.toArray(),this.guiRoot,!0)[0];if(!h.isElement(O)||!O.classList.contains("_phantom")&&!O.classList.contains("_phantom_wrap")){if(this.cutSelection())return this.validationController.refreshErrors(),r();n=this.caretManager.getDataCaret(),h.isText(n.node)||(n=n.make(n.node.childNodes[n.offset],0)),h.isText(n.node)&&(P=n.node.parentNode,k=p.indexOf(P.childNodes,n.node),T=this.initiateTextUndo(),this.dataUpdater.deleteText(n,1),null!==n.node.parentNode?this.caretManager.setCaret(n,{textEdit:!0}):this.caretManager.setCaret(P,k,{textEdit:!0}),T.recordCaretAfter())}}return this.validationController.refreshErrors(),r()}if(A.BACKSPACE.matchesEvent(t)){if(null!==b){if(""===b.textContent)return r();this.spliceAttribute(b,this.caretManager.getNormalizedCaret().offset-1,1,"")}else{var I=d.prevCaretPosition(u.toArray(),this.guiRoot,!0)[0];if(!h.isElement(I)||!I.classList.contains("_phantom")&&!I.classList.contains("_phantom_wrap")){if(this.cutSelection())return this.validationController.refreshErrors(),r();if(n=this.caretManager.getDataCaret(),!h.isText(n.node)){var D=n.node.childNodes[n.offset-1],M=D.length;n=n.make(D,M)}if(h.isText(n.node)){if(P=n.node.parentNode,k=p.indexOf(P.childNodes,n.node),0===n.offset)return r();T=this.initiateTextUndo(),this.dataUpdater.deleteText(n.node,n.offset-1,1),null!==n.node.parentNode?this.caretManager.setCaret(n.node,n.offset-1,{textEdit:!0}):this.caretManager.setCaret(P,k,{textEdit:!0}),T.recordCaretAfter()}}}return this.validationController.refreshErrors(),r()}return!0},r.prototype.keypressHandler=function(e){return!!Z.matchesEvent(e)||(this.$guiRoot.trigger("wed-input-trigger-keypress",[e]),!(!e.isImmediatePropagationStopped()&&!e.isPropagationStopped())||void this.$guiRoot.trigger("wed-global-keypress",[e]))},r.prototype.type=function(e,t){void 0===t&&(t=Y.DEFAULT),e instanceof k.Key&&(e=[e]);for(var r=0,n=e;r<n.length;r++){var o=n[r];"string"==typeof o&&(o=" "===o?A.SPACE:k.makeKey(o));var a=new i.Event("keydown");switch(o.setEventToMatch(a),t){case Y.MINIBUFFER:this.minibuffer.forwardEvent(a);break;case Y.DEFAULT:this.$inputField.trigger(a);break;default:var s=t;throw new Error("unhandled target: "+s)}}},r.prototype.globalKeypressHandler=function(e,t){function r(){return t.preventDefault(),t.stopPropagation(),!1}return void 0===this.caretManager.caret||(0===t.which||(8===t.which?r():!!(t.ctrlKey||t.altKey||t.metaKey)||(this.cutSelection(),this.handleKeyInsertingText(t),r())))},r.prototype.cutSelection=function(){var e=this.caretManager.sel;if(void 0!==e&&!e.collapsed){if(!e.wellFormed)return!0;var t=this.initiateTextUndo(),r=e.mustAsDataCarets(),n=r[0],i=r[1],o=this.dataUpdater.cut(n,i)[0];return this.caretManager.setCaret(o,{textEdit:!0}),t.recordCaretAfter(),!0}return!1},r.prototype.handleKeyInsertingText=function(e){var t=String.fromCharCode(e.which);return""!==t&&(this.insertText(t),e.preventDefault(),void e.stopPropagation())},r.prototype.compositionHandler=function(e){if("compositionstart"===e.type)this.composing=!0,this.compositionData={data:e.originalEvent.data,startCaret:this.caretManager.caret},this.inputField.style.zIndex="10",this.caretManager.mark.refresh();else if("compositionupdate"===e.type)this.compositionData.data=e.originalEvent.data;else{if("compositionend"!==e.type)throw new Error("unexpected event type: "+e.type);this.composing=!1,this.inputField.style.zIndex="",this.inputField.style.top="",this.inputField.style.left=""}},r.prototype.inputHandler=function(){this.composing||""!==this.$inputField.val()&&(this.insertText(this.$inputField.val()),this.$inputField.val(""),this.caretManager.focusInputField())},r.prototype.mousemoveHandler=function(e){var t=this,r=this.doc.elementFromPoint(e.clientX,e.clientY);if(this.guiRoot.contains(r)){var n,i=function(e){var r=e.classList;return r.contains("_real")||r.contains("_attribute_value")&&"edit"===t.modeTree.getAttributeHandling(e)};if(i(r)){if(n=this.pointToCharBoundary(e.clientX,e.clientY),void 0===n)return}else{for(var o=r;!i(r);)if(o=r,r=o.parentNode,!this.guiRoot.contains(r))return;var a=p.indexOf(r.childNodes,o),s=this.doc.createRange();s.setStart(r,a),s.setEnd(r,a+1);var l=s.getBoundingClientRect();Math.abs(l.left-e.clientX)>=Math.abs(l.right-e.clientX)&&a++,n=this.caretManager.makeCaret(r,a)}this.caretManager.setRange(this.caretManager.anchor,n)}},r.prototype.mousedownHandler=function(e){if(!this.scroller.isPointInside(e.pageX,e.pageY))return!1;var t=this.pointToCharBoundary(e.clientX,e.clientY);if(void 0===t)return!0;this.$guiRoot.one("mouseup",this.mouseupHandler.bind(this)),this.errorLayer.unselectAll(),this.$errorList.find(".selected").removeClass("selected");var r=this.guiRoot,n=e.target,i=p.closestByClass(n,"_placeholder",r),o=p.closestByClass(n,"_label",r),a=this.caretManager;switch(e.which){case 1:if(null!==p.closest(n,"._gui, ._phantom",r)&&null===p.closestByClass(n,"_attribute_value",r)||this.$guiRoot.on("mousemove.wed",this.mousemoveHandler.bind(this)),null!==i?a.setCaret(i,0):null!==o?a.setCaretToLabelPosition(n,o,t):a.setCaret(t),e.target.classList.contains("wed-validation-error"))return!0;break;case 3:var s=this.caretManager.range;(void 0===s||s.collapsed)&&(null!==i?a.setCaret(i,0):null!==o?a.setCaretToLabelPosition(n,o,t):a.setCaret(t))}return!1},r.prototype.mouseupHandler=function(e){if(!this.scroller.isPointInside(e.pageX,e.pageY))return!1;var t=this.pointToCharBoundary(e.clientX,e.clientY);if(void 0===t)return!0;"contextmenu"===e.type&&(e.which=3);var r=this.guiRoot,n=e.target,o=p.closestByClass(n,"_placeholder",r),a=p.closestByClass(n,"_label",r),s=this.caretManager;switch(e.which){case 3:null!==o&&s.setCaret(n,0),null!==a?(s.setCaretToLabelPosition(n,a,t),i(n).trigger("wed-context-menu",[e])):(void 0===s.caret&&s.setCaret(t),null!==p.closest(n,"*[data-wed--custom-context-menu]",r)?i(n).trigger("wed-context-menu",[e]):this.editingMenuManager.contextMenuHandler(e))}return this.$guiRoot.off("mousemove"),e.preventDefault(),!1},r.prototype.mouseoverHandler=function(e){var t=this,r=this.guiRoot,n=p.closestByClass(e.target,"_label",r);if(null!==n){var o=p.closestByClass(n,"_real",r),a=q.getOriginalName(o),s={title:function(){if(!t.destroyed&&t.preferences.get("tooltips")){var e=t.modeTree.getMode(n);return e.shortDescriptionFor(a)}},container:"body",delay:{show:1e3},placement:"auto top",trigger:"hover"};C.tooltip(i(n),s);var l=i.data(n,"bs.tooltip");l.enter(l)}},r.prototype.mouseoutHandler=function(e){var t=this.guiRoot,r=p.closestByClass(e.target,"_label",t);if(null!==r)return i(r).tooltip("destroy"),!1},r.prototype.displayTypeaheadPopup=function(e,t,r,n,i,o){var a=this;return this.editingMenuManager.dismiss(),this.caretManager.pushSelection(),this.currentTypeahead=new T.TypeaheadPopup(this.doc,e,t,r,n,i,function(e){a.currentTypeahead=void 0,a.caretManager.popSelection(),void 0!==o&&o(e)}),this.currentTypeahead},r.prototype.refreshSaveStatus=function(){if(void 0!==this.saver){var e=this.saver.getSavedWhen();if(this.$saveStatus.children("span").first().text(void 0!==e?e:""),void 0===e)this.$saveStatus.removeClass("label-success label-info").addClass("label-default");else{var t=this.saver.getLastSaveKind(),r=void 0,n=void 0;switch(t){case F.SaveKind.AUTO:r="label-info",n="The last save was an autosave.";break;case F.SaveKind.MANUAL:r="label-success",n="The last save was a manual save.";break;default:throw new Error("unexpected kind of save: "+t)}this.$saveStatus.removeClass("label-default label-info label-success").addClass(r),this.$saveStatus.tooltip("destroy"),this.$saveStatus.tooltip({title:n,container:"body",placement:"auto top",trigger:"hover"})}var i=this.saver.getModifiedWhen();i!==!1?(this.$modificationStatus.removeClass("label-success"),this.$modificationStatus.addClass("label-warning"),this.$modificationStatus.children("i").css("visibility","")):(this.$modificationStatus.removeClass("label-warning"),this.$modificationStatus.addClass("label-success"),this.$modificationStatus.children("i").css("visibility","hidden"))}},r.prototype.onValidatorStateChange=function(e){var t=e.state;t!==a.WorkingState.VALID&&t!==a.WorkingState.INVALID||this._firstValidationComplete||(this._firstValidationComplete=!0,this.firstValidationCompleteResolve(this))},r.prototype.onPossibleDueToWildcardChange=function(e){var t=G.getGUINodeIfExists(this,e);if(h.isText(t)&&(t=p.closestByClass(t,"_attribute",this.guiRoot)),null!=t){var r=this.modeTree.getDecorator(e);r.setReadOnly(t,this.validator.getNodeProperty(e,"PossibleDueToWildcard"))}},r.prototype.expandErrorPanelWhenNoNavigation=function(){"none"===this.$navigationPanel[0].style.display&&this.$errorList.parents(".panel-collapse").collapse("show")},r.prototype.errorItemHandler=function(e){var t=document.querySelector(e.target.getAttribute("href"));this.errorLayer.select(t);var r=i(e.target.parentNode);r.siblings().removeClass("selected"),r.addClass("selected")},r.prototype.setNavigationList=function(e){this.$navigationList.empty(),this.$navigationList.append(e),this.$navigationPanel.css("display","")},r.prototype.makeModal=function(e){var t=this,r=new E.Modal(e),n=r.getTopLevel();return n.on("show.bs.modal.modal",function(){t.caretManager.pushSelection()}),n.on("hidden.bs.modal.modal",function(){t.caretManager.popSelection()}),this.$widget.prepend(n),r},r.prototype.resetLabelVisibilityLevel=function(){this.setLabelVisibilityLevel(this.initialLabelLevel)},r.prototype.setLabelVisibilityLevel=function(e){if(!(e<0||e>this.maxLabelLevel)){for(;this.currentLabelLevel>e;)this.decreaseLabelVisiblityLevel();for(;this.currentLabelLevel<e;)this.increaseLabelVisibilityLevel()}},r.prototype.increaseLabelVisibilityLevel=function(){if(!(this.currentLabelLevel>=this.maxLabelLevel)){this.currentLabelLevel++;for(var e=this.guiRoot.getElementsByClassName("_label_level_"+this.currentLabelLevel),t=0,r=e.length;t<r;t++)e[t].classList.remove("_invisible");this.validationController.recreateErrors(),this.caretManager.mark.refresh()}},r.prototype.decreaseLabelVisiblityLevel=function(){if(0!==this.currentLabelLevel){var e=this.currentLabelLevel;this.currentLabelLevel--;for(var t=this.guiRoot.getElementsByClassName("_label_level_"+e),r=0,n=t.length;r<n;r++)t[r].classList.add("_invisible");this.validationController.recreateErrors(),this.caretManager.mark.refresh()}},r.prototype.closeAllTooltips=function(){for(var e=this.doc.querySelectorAll("div.tooltip"),t=!1,r=0;r<e.length;++r){var n=i.data(e[r],"wed-tooltip-for"),o=i(n).data("bs.tooltip");null!=o&&(o.leave(o),t=!0)}return t},r.prototype.excludeFromBlur=function(e){this.$excludedFromBlur.add(e)},r.prototype.findLocationAt=function(e,t){var r=this.doc.elementFromPoint(e,t);if(null!==r&&this.guiRoot.contains(r))return this.findLocationInElementAt(r,e,t)},r.prototype.findLocationInElementAt=function(e,t,r,n){function i(e,n){var i;h.isText(e)?(a.setStart(e,n),a.setEnd(e,n+1),i=a.getClientRects()):i=e.childNodes[n].getClientRects();for(var s=0;s<i.length;++s){var l=i[s];if(0!==l.height&&0!==l.width){var u=q.distsFromRect(t,r,l.left,l.top,l.right,l.bottom);if(void 0===o||o.dist.y>u.y||o.dist.y===u.y&&o.dist.x>u.x)return o={dist:u,node:e,start:n},0===u.y&&0===u.x}}return!1}void 0===n&&(n=!0);var o,a=this.doc.createRange(),s=e.firstChild,l=0;e:for(;null!==s;){if(n&&h.isText(s)){for(var u=0;u<s.length;++u)if(i(s,u))break e}else if(i(e,l))break;s=s.nextSibling,l++}return void 0===o?this.caretManager.makeCaret(e,0):this.caretManager.makeCaret(o.node,o.start)},r.prototype.pointToCharBoundary=function(e,t){var r=this.findLocationAt(e,t);if(void 0!==r){var n=r.node,i=r.offset,o=n.nodeType;if(h.isElement(n)&&i<n.childNodes.length||h.isText(n)&&i<n.length){var a=this.doc.createRange();a.setStart(n,i),a.setEnd(n,i+1);var s=a.getBoundingClientRect();switch(o){case Node.TEXT_NODE:var l=this.caretManager.newPosition(r,"right"),u=this.caretManager.newPosition(r.make(n,i+1),"left");void 0!==l&&void 0===u?r=l:void 0!==u&&void 0===l?r=u:void 0!==l&&void 0!==u&&(r=Math.abs(G.boundaryXY(l).left-e)>=Math.abs(G.boundaryXY(u).left-e)?u:l);break;case Node.ELEMENT_NODE:var c,d=n.childNodes[i];if(h.isElement(d)){var p=this.findLocationInElementAt(d,e,t),f=h.isElement(p.node)?p.node.childNodes.length-1:-1;switch(p.offset){case 0:c=!0;break;case f:c=!1}}void 0===c&&(c=Math.abs(s.left-e)<Math.abs(s.right-e)),c||(r=r.make(n,i+1));break;default:throw new Error("unexpected node type: "+o)}}}return r},r.prototype.caretChange=function(e){var t=e.options,r=e.caret,n=e.prevCaret,i=e.manager;if(void 0!==r){var o=t.textEdit===!0,a=t.gainingFocus===!0;a||this.editingMenuManager.setupCompletionMenu(),o||this.terminateTextUndo();for(var s;void 0!==(s=this.caretOwners[0]);)s.classList.remove("_owns_caret");for(;void 0!==(s=this.clickedLabels[0]);)s.classList.remove("_label_clicked");for(;void 0!==(s=this.withCaret[0]);)s.classList.remove("_with_caret");if(void 0!==n){var l=p.closest(n.node,"._placeholder._transient",n.root);null!==l&&r.root.contains(l)&&this.guiUpdater.removeNode(l)}var u=h.isElement(r.node)?r.node:r.node.parentNode,c=r.root;if(this.guiRoot.contains(u)){var f=p.closestByClass(u,"_real",c);null!==f&&f.classList.add("_owns_caret");var m=p.closestByClass(u,"_gui",c);if(null!==m){if(void 0===i.anchor||p.closestByClass(i.anchor.node,"_gui",c)===m){for(var v=0,y=d.childrenByClass(m.parentNode,"_gui");v<y.length;v++){var g=y[v];g.classList.add("_label_clicked")}m.classList.add("_with_caret")}}else u.classList.add("_owns_caret");a||i.mark.scrollIntoView(),this.caretManager.mark.refresh();for(var b=[];u!==this.guiRoot;){if(u.nodeType!==Node.ELEMENT_NODE)throw new Error("unexpected node type: "+u.nodeType);u.classList.contains("_placeholder")||null!==p.closestByClass(u,"_phantom",c)||b.unshift("<span class='_gui _label'><span>&nbsp;"+q.getOriginalName(u)+"&nbsp;</span></span>"),u=u.parentNode}var w=this.wedLocationBar.getElementsByTagName("span")[0];w.innerHTML=0!==b.length?b.join("/"):"<span>&nbsp;</span>"}}},r.prototype.cut=function(){var e=this.caretManager,t=e.sel;if(void 0===t)throw new Error("no selection");if(!t.wellFormed)throw new Error("malformed range");for(var r=t.mustAsDataCarets(),n=r[0],i=r[1],o=this.cutBuffer;null!==o.firstChild;)o.removeChild(o.firstChild);if(h.isAttr(n.node)){var a=n.node;if(a!==i.node)throw new Error("attribute selection that does not start and end in the same attribute");var s=a.value.slice(n.offset,i.offset);this.spliceAttribute(p.closestByClass(e.mustFromDataLocation(n).node,"_attribute_value"),n.offset,i.offset-n.offset,""),o.textContent=s}else{for(var l=this.dataUpdater.cut(n,i),u=l[1],c=new this.window.DOMParser,d=c.parseFromString("<div></div>","text/xml"),f=0,m=u;f<m.length;f++){var v=m[f];d.firstChild.appendChild(d.adoptNode(v))}o.textContent=d.firstChild.innerHTML,e.setCaret(l[0])}var y=this.doc.createRange(),g=o;y.setStart(g,0),y.setEnd(g,g.childNodes.length);var b=this.window.getSelection();b.removeAllRanges(),b.addRange(y),setTimeout(function(){e.focusInputField()},0)},r.prototype.paste=function(e,t){var r=t.to_paste,n=r.cloneNode(!0),i=this.caretManager.getDataCaret();if(void 0===i)throw new Error("trying to paste without a caret");var o;if(1===r.childNodes.length&&h.isText(r.firstChild))if(h.isAttr(i.node)){var a=this.caretManager.mustGetNormalizedCaret();this.spliceAttribute(p.closestByClass(a.node,"_attribute_value",a.node),a.offset,0,r.firstChild.data)}else o=this.dataUpdater.insertText(i,r.firstChild.data).caret;else{for(var s=document.createDocumentFragment();null!==r.firstChild;)s.appendChild(r.firstChild);switch(i.node.nodeType){case Node.TEXT_NODE:o=this.dataUpdater.insertIntoText(i,s)[1];break;case Node.ELEMENT_NODE:var l=i.node.childNodes[i.offset],u=null!=l?l.nextSibling:null;this.dataUpdater.insertBefore(i.node,s,l),o=i.makeWithOffset(null!==u?p.indexOf(i.node.childNodes,u):i.node.childNodes.length);break;default:throw new Error("unexpected node type: "+i.node.nodeType)}}null!=o&&(this.caretManager.setCaret(o),i=o),this.$guiRoot.trigger("wed-post-paste",[t.e,i,n])},r.prototype.replaceRange=function(e,t){var r,n=e.caretManager,i=t.range,o=t.newText,a=t.caretAtEnd,s=i.start,l=i.end,u=n.toDataLocation(s),c=n.toDataLocation(l);if(h.isAttr(u.node)){var d=u.node,p=d.value;p=p.slice(0,u.offset)+o+p.slice(c.offset),e.dataUpdater.setAttributeNS(d.ownerElement,null===d.namespaceURI?"":d.namespaceURI,d.name,p),r=a?u.makeWithOffset(u.offset+o.length):u}else{var f=e.dataUpdater.cut(u,c)[0];r=e.dataUpdater.insertText(f,o,a).caret}n.setCaret(r,{textEdit:!0})},r}();t.Editor=te}),define("wed/mode",["require","exports","module","./domtypeguards","./domutil"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){this.editor=e,this.options=t,this.wedOptions={metadata:{name:"Base Mode (you should not be using this)",description:"The base mode. You should not be using it directly.",authors:["Louis-Dominique Dubeau"],license:"MPL 2.0",copyright:"Mangalam Research Center for Buddhist Languages"},label_levels:{max:1,initial:1}}}return e.prototype.getModeOptions=function(){return this.options},e.prototype.getWedOptions=function(){return this.wedOptions},e.prototype.getStylesheets=function(){return[]},e.prototype.nodesAroundEditableContents=function(e){for(var t,r,i=null,o=null,a=e.firstChild,s=0;null!==a;){if(n.isElement(a)&&(a.classList.contains("_start_wrapper")&&(t=s,i=a),a.classList.contains("_end_wrapper"))){r=s,o=a;break}a=a.nextSibling,s++}if(void 0!==t&&void 0!==r&&r<=t)throw new Error("end wrapper element unexpectedly appears before start wrapper element, or is also a start wrapper element");return[i,o]},e.prototype.makePlaceholderFor=function(e){return i.makePlaceholder()},e.prototype.shortDescriptionFor=function(e){},e.prototype.documentationLinkFor=function(e){},e.prototype.getValidator=function(){},e.prototype.getAttributeCompletions=function(e){return[]},e}();t.BaseMode=o}),define("wed/decorator",["require","exports","module","jquery","./dloc","./domtypeguards","./domutil","./gui/action-context-menu","./util"],function(e,t,r,n,i,o,a,s,l){"use strict";function u(e,t){try{e.caretManager.setCaret(t,{textEdit:!0})}catch(e){}}function c(e,t){return"*"===e||e===t}Object.defineProperty(t,"__esModule",{value:!0});var h=a.indexOf,d=a.closestByClass,p=function(){function e(e,t){this.mode=e,this.editor=t,this.domlistener=t.domlistener,this.guiUpdater=t.guiUpdater,this.namespaces=e.getAbsoluteNamespaceMappings()}return e.prototype.startListening=function(){this.domlistener.startListening()},e.prototype.listDecorator=function(e,t){if(this.editor.modeTree.getMode(e)===this.mode){for(var r=Object.create(null),n=e.firstElementChild;null!==n;)n.classList.contains("_real")&&(r[l.getOriginalName(n)]=1),n=n.nextElementSibling;var i=Object.keys(r);if(i.length>1)throw new Error("calling listDecorator on a non-homogeneous list.");if(0!==i.length){for(n=e.firstElementChild;null!==n;){var o=n.nextElementSibling;n.hasAttribute("data-wed--separator-for")&&this.guiUpdater.removeNode(n),n=o}var a,s=i[0];"string"==typeof t?(a=e.ownerDocument.createElement("div"),a.textContent=t):a=t,a.classList.add("_text"),a.classList.add("_phantom"),a.setAttribute("data-wed--separator-for",s);var u=!0;for(n=e.firstElementChild;null!==n;)n.classList.contains("_real")&&(u?u=!1:this.guiUpdater.insertBefore(e,a.cloneNode(!0),n)),n=n.nextElementSibling}}},e.prototype.elementDecorator=function(e,t,r,i,s){if(this.editor.modeTree.getMode(t)===this.mode){if(r>this.editor.maxLabelLevel)throw new Error("level higher than the maximum set by the mode: "+r);var c=this.editor.caretManager.getDataCaret();null==c||o.isAttr(c.node)&&c.node.ownerElement===n.data(t,"wed_mirror_node")||(c=void 0);var h=n.data(t,"wed_mirror_node");this.setReadOnly(t,Boolean(this.editor.validator.getNodeProperty(h,"PossibleDueToWildcard")));for(var d=l.getOriginalName(t),p="_"+d+"_label",f=a.childrenByClass(t,p),m=0,v=f;m<v.length;m++){var y=v[m];t.removeChild(y)}var g="",b=!1,w=this.editor.modeTree.getAttributeHandling(t);if("show"===w||"edit"===w)for(var _=l.getOriginalAttributes(t),E=Object.keys(_).sort(),x=0,S=E;x<S.length;x++){var N=S[x],C=this.mustHideAttribute(t,N);C&&(b=!0);var T=C?" _shown_when_caret_in_label":"";g+=' <span class="_phantom _attribute'+T+'"><span class="_phantom _attribute_name">'+N+'</span>="<span class="_phantom _attribute_value">'+a.textToHTML(_[N])+'</span>"</span>'}var P=t.ownerDocument;p+=" _label_level_"+r;var k=p;b&&(p+=" _autohidden_attributes");var A=P.createElement("span");A.className="_gui _phantom __start_label _start_wrapper "+p+" _label";var R=P.createElement("span");R.className="_phantom",R.innerHTML="&nbsp;<span class='_phantom _element_name'>"+d+"</span>"+g+"<span class='_phantom _greater_than'> >&nbsp;</span>",A.appendChild(R),this.guiUpdater.insertNodeAt(t,0,A);var O=P.createElement("span");O.className="_gui _phantom __end_label _end_wrapper "+k+" _label";var I=P.createElement("span");I.className="_phantom",I.innerHTML="<span class='_phantom _less_than'>&nbsp;&lt; </span><span class='_phantom _element_name'>"+d+"</span>&nbsp;",O.appendChild(I),this.guiUpdater.insertBefore(t,O,null),n(A).on("wed-context-menu",void 0!==i&&i),n(O).on("wed-context-menu",void 0!==s&&s),null!=c&&u(this.editor,c)}},e.prototype.mustHideAttribute=function(e,t){var r=this.editor.modeTree.getAttributeHidingSpecs(e);if(null===r)return!1;for(var n=0,i=r.elements;n<i.length;n++){var o=i[n];if(e.matches(o.selector)){for(var a=!1,s=0,l=o.attributes;s<l.length;s++){var u=l[s];if("string"==typeof u)a||(a=c(u,t));else if(a)for(var h=0,d=u.except;h<d.length;h++){var p=d[h];if(a=!c(p,t),!a)break}}return a}}return!1},e.prototype.setReadOnly=function(e,t){var r=e.classList;(t?r.add:r.remove).call(r,"_readonly")},e.prototype.contextMenuHandler=function(e,t,r){function o(e,t,r){var n=c.editingMenuManager.makeMenuItemForAction(t,e,r);f.push({action:t,item:n,data:e})}function a(e,t,r){if(void 0!==t)for(var n=0,i=t;n<i.length;n++){var a=i[n];o(e,a,r)}}function u(e,t){var r=e.params[1];if(r.simple())for(var n=0,i=r.toArray();n<i.length;n++){var s=i[n],l=m.getAbsoluteResolver().unresolveName(s.ns,s.name);if(void 0===l)throw new Error("cannot unresolve attribute");if(c.isAttrProtected(l,t))return;a({name:l,node:t},m.getContextualActions("add-attribute",l,t))}else o(null,c.complexPatternAction)}var c=this.editor,p=t.target,f=[],m=c.modeTree.getMode(p),v=d(p,"_real",c.guiRoot),y=null!==v&&v.classList.contains("_readonly"),g=d(p,"_attribute_value",c.guiRoot);if(null!==g){var b=c.toDataNode(g),w=i.DLoc.mustMakeDLoc(c.dataRoot,b.ownerElement),_=w.node.childNodes[w.offset];c.validator.possibleAt(w,!0).forEach(function(e){"attributeName"===e.params[0]&&u(e,_)});var E=b.name;c.isAttrProtected(b)||a({name:E,node:b},m.getContextualActions("delete-attribute",E,b))}else{var x=d(p,"_real",c.guiRoot);if(null===x)throw new Error("cannot find real parent");p=x;var S=p.parentNode===c.guiRoot,N=l.getOriginalName(p),C=m.documentationLinkFor(N);if(null!=C){var T=this.editor.editingMenuManager.makeDocumentationMenuItem(C);f.push({action:null,item:T,data:null})}S||a({node:p,name:N},m.getContextualActions(["unwrap","delete-element"],N,n.data(p,"wed_mirror_node"),0));var P=p.parentNode,k=h(P.childNodes,p);e||k++;var w=c.caretManager.toDataLocation(P,k);if(void 0===w)throw new Error("cannot get caret");if(e){var A=w.node.childNodes[w.offset],R=c.modeTree.getAttributeHandling(A);"edit"===R&&c.validator.possibleAt(w,!0).forEach(function(e){"attributeName"===e.params[0]&&u(e,A)})}if(!S){for(var O=0,I=c.getElementTransformationsAt(w,"insert");O<I.length;O++){var D=I[O];void 0!==D.name?o({name:D.name,moveCaretTo:w},D.tr,e):o(null,D.tr)}if(e)for(var M=w.make(w.node.childNodes[w.offset],0),L=0,j=c.getElementTransformationsAt(M,"wrap-content");L<j.length;L++){var D=j[L];o(void 0!==D.name?{name:D.name,node:p}:null,D.tr)}}}if(0===f.length)return!0;var F=c.editingMenuManager.computeMenuPosition(r);return c.editingMenuManager.displayContextMenu(s.ActionContextMenu,F.left,F.top,f,y),!1},e}();t.Decorator=p});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/modes/generic/generic-decorator",["require","exports","module","wed/decorator","wed/domtypeguards","wed/util"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t,r,n,i){var o=e.call(this,t,r)||this;return o.metadata=n,o.options=i,o}return __extends(t,e),t.prototype.addHandlers=function(){var e=this;this.domlistener.addHandler("included-element",o.classFromOriginalName("*",{}),function(t,r,n,i,o,a){if(t.contains(a)){e.elementDecorator(t,a);var s=e.getAdditionalClasses(a);s.length>0&&(a.className+=" "+s)}}),this.domlistener.addHandler("children-changed",o.classFromOriginalName("*",{}),function(t,r,n,o,a,s){for(var l=0,u=r.concat(n);l<u.length;l++){var c=u[l];if(i.isText(c)||i.isElement(c)&&(c.classList.contains("_real")||c.classList.contains("_phantom_wrap"))){e.elementDecorator(t,s);break}}}),this.domlistener.addHandler("text-changed",o.classFromOriginalName("*",{}),function(t,r){e.elementDecorator(t,r.parentNode)}),this.domlistener.addHandler("attribute-changed",o.classFromOriginalName("*",{}),function(t,r){e.elementDecorator(t,r)})},t.prototype.elementDecorator=function(t,r){e.prototype.elementDecorator.call(this,t,r,1,this.contextMenuHandler.bind(this,!0),this.contextMenuHandler.bind(this,!1))},t.prototype.getAdditionalClasses=function(e){var t=[];return this.metadata.isInline(e)&&t.push("_inline"),t.join(" ")},t}(n.Decorator);t.GenericDecorator=a}),define("wed/modes/generic/generic-tr",["require","exports","module","salve","wed/domtypeguards","wed/domutil","wed/transformation"],function(e,t,r,n,i,o,a){"use strict";function s(e){var t=e.error.toString();return 0===t.lastIndexOf("tag required: ",0)}function l(e,t){for(;;){var r=t.validator.getErrorsFor(e);if(r=r.filter(s),0===r.length)break;var i=r[0].error.getNames()[0],o=i.toArray();if(null===o||o.length>1)break;var a=o[0],l=t.validator.possibleWhere(e,new n.Event("enterStartTag",a.ns,a.name));if(1!==l.length)break;var u=t.modeTree.getMode(e),c=u.getAbsoluteResolver().unresolveName(a.ns,a.name);if(void 0===c)throw new Error("cannot unresolve {"+a.ns+"}"+a.name);var h=u.getContextualActions("insert",c,e,l[0]);if(1!==h.length)break;if(h[0].needsInput)break;t.caretManager.setCaret(e,l[0]),h[0].execute({name:c})}}function u(e,t){var r=e.caretManager.getDataCaret();if(void 0===r)throw new Error("inserting without a defined caret!");var n=e.modeTree.getMode(r.node),i=n.getAbsoluteResolver(),o=i.resolveName(t.name);if(void 0===o)throw new Error("cannot resolve "+t.name);var s=e.validator.unresolveNameAt(r.node,r.offset,o.ns,o.name),u=a.insertElement(e.dataUpdater,r.node,r.offset,o.ns,t.name);if(void 0===s){var c=i.prefixFromURI(o.ns),h=""===c?"xmlns":"xmlns:"+c,d=i.resolveName("xmlns:q").ns;e.dataUpdater.setAttributeNS(u,d,h,o.ns)}var p=u;if(n.getModeOptions().autoinsert)for(l(u,e);null!==p;){var f=p.firstChild;if(null===f)break;p=f}e.caretManager.setCaret(p,0)}function c(e,t){var r=t.node;if(!i.isElement(r))throw new Error("node must be an element");var n=r.parentNode,s=o.indexOf(n.childNodes,r);a.unwrap(e.dataUpdater,r),e.caretManager.setCaret(n,s)}function h(e,t){var r=e.caretManager.sel;if(null==r)throw new Error("wrap transformation called with undefined range");if(r.collapsed)throw new Error("wrap transformation called with collapsed range");var n=r.mustAsDataCarets(),i=n[0],s=n[1],l=e.modeTree.getMode(i.node),u=l.getAbsoluteResolver().resolveName(t.name);if(void 0===u)throw new Error("cannot resolve "+t.name);var c=a.wrapInElement(e.dataUpdater,i.node,i.offset,s.node,s.offset,u.ns,t.name),h=c.parentNode;e.caretManager.setCaret(i.make(h,o.indexOf(h.childNodes,c)+1))}function d(e,t){var r=t.node;if(!i.isElement(r))throw new Error("node must be an element");var n=e.modeTree.getMode(r),o=n.getAbsoluteResolver().resolveName(t.name);if(void 0===o)throw new Error("cannot resolve "+t.name);a.wrapInElement(e.dataUpdater,r,0,r,r.childNodes.length,o.ns,t.name)}function p(e,t){var r=t.node;if(!i.isElement(r))throw new Error("node must be an element");var n=r.parentNode,a=o.indexOf(n.childNodes,r),s=e.caretManager.fromDataLocation(r,0);s.node.classList.contains("_readonly")||(e.dataUpdater.removeNode(r),e.caretManager.setCaret(n,a))}function f(e,t){var r=t.node;if(!i.isElement(r))throw new Error("node must be an element");var n=r.parentNode,a=o.indexOf(n.childNodes,r),s=e.caretManager.mustFromDataLocation(r,0);s.node.classList.contains("_readonly")||(e.dataUpdater.removeNode(r),e.caretManager.setCaret(n,a))}function m(e,t){var r=t.node;if(!i.isElement(r))throw new Error("node must be an element");var n=e.caretManager.mustFromDataLocation(r,0);if(!n.node.classList.contains("_readonly")){e.dataUpdater.setAttribute(r,t.name,"");var o=r.getAttributeNode(t.name);e.caretManager.setCaret(o,0)}}function v(e,t){var r=t.node;if(null==r||!i.isAttr(r))throw new Error("node must be an attribute");var n=r.ownerElement,a=e.caretManager,s=a.mustFromDataLocation(n,0),l=s.node;if(!l.classList.contains("_readonly")){var u=r.name,c=o.childByClass(l,"__start_label"),h=c.getElementsByClassName("_attribute_value"),d=a.mustFromDataLocation(r,0).node.parentNode,p=o.indexOf(h,d),f=h[p+1],m=null!=f?e.toDataNode(f):null;e.dataUpdater.setAttribute(n,u,null),null!==m?e.caretManager.setCaret(m,0):e.caretManager.setCaret(l.getElementsByClassName("_element_name")[0],0)}}function y(e){var t=Object.create(null);
return t.insert=new a.Transformation(e,"insert","Create new <name>","",u),t.unwrap=new a.Transformation(e,"unwrap","Unwrap the content of this element",void 0,c),t.wrap=new a.Transformation(e,"wrap","Wrap in <name>",void 0,h),t["wrap-content"]=new a.Transformation(e,"wrap-content","Wrap content in <name>",void 0,d),t["delete-element"]=new a.Transformation(e,"delete-element","Delete this element",void 0,p),t["delete-parent"]=new a.Transformation(e,"delete-parent","Delete <name>",void 0,f),t["add-attribute"]=new a.Transformation(e,"add-attribute","Add @<name>",void 0,m),t["delete-attribute"]=new a.Transformation(e,"delete-attribute","Delete this attribute",void 0,v),t["insert-text"]=new a.Transformation(e,"insert-text",'Insert "<name>"',void 0,function(e,t){e.type(t.name)}),t.split=e.splitNodeTr,t}Object.defineProperty(t,"__esModule",{value:!0}),t.makeTagTr=y}),define("wed/modes/generic/metadata-json-reader",["require","exports","module","ajv"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.schema=e}return Object.defineProperty(e.prototype,"validator",{get:function(){if(void 0===this._validator){var e=new n;this._validator=e.compile(this.schema)}return this._validator},enumerable:!0,configurable:!0}),e.prototype.read=function(e){return this.validate(e),this.convert(e)},e.prototype.validate=function(e){var t=this.validator,r=t(e);if(!r){if(void 0===t.errors)throw new Error("metadata JSON invalid but no errors!");var n=new Error("failed to validate");throw n.jsonErrors=t.errors,n}},e}();t.MetadataJSONReader=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/modes/generic/metadata-versioned-reader",["require","exports","module","./metadata-json-reader","./metadata-schema.json"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){if(this.metadata=t,this.reverseMappings=Object.create(null),this.descMap=Object.create(null),t.version!==e)throw new Error("incorrect version number: expected "+e+", got "+t.version);if(this.version=t.version,this.generator=t.generator,this.date=t.date,void 0!==t.namespaces?this.namespaceMappings=t.namespaces:this.namespaceMappings=Object.create(null),"xml"in this.namespaceMappings)throw new Error("xml mapping already defined");this.namespaceMappings.xml="http://www.w3.org/XML/1998/namespace";for(var r in this.namespaceMappings){var n=this.namespaceMappings[r];void 0===this.reverseMappings[n]&&(this.reverseMappings[n]=r)}this.reverseMappings[this.namespaceMappings[""]]="";var i=t.elements;if(void 0!==i)for(var o=this.descMap,a=0,s=i;a<s.length;a++){var l=s[a],u=void 0!==l.ns?l.ns:"http://www.tei-c.org/ns/1.0",c=this.reverseMappings[u];if(void 0===c)throw new Error("undefined namespace: "+u);var h=""===c?l.name:c+":"+l.name;o[h]=l.desc}}return e.prototype.getNamespaceMappings=function(){return this.namespaceMappings},e.prototype.shortDescriptionFor=function(e){var t=this.unresolveName(e);if(void 0!==t)return this.descMap[t]},e.prototype.unresolveName=function(e){var t=this.reverseMappings[e.ns];if(void 0!==t)return""===t?e.name:t+":"+e.name},e}();t.MetadataBase=o;var a=function(e){function t(t){var r=e.call(this,i)||this;return r.metadataClass=t,r}return __extends(t,e),t.prototype.convert=function(e){return new this.metadataClass(e)},t.version="1",t}(n.MetadataJSONReader);t.MetadataReaderBase=a});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/modes/generic/metadata-reader-v1",["require","exports","module","./metadata-versioned-reader"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,"1",t)||this}return __extends(t,e),t.prototype.isInline=function(e){return!1},t.prototype.documentationLinkFor=function(e){var t=this.metadata.dochtml;if(void 0!==t){var r=this.unresolveName(e);if(void 0!==r)return r=r.replace(":","_"),t+"ref-"+r+".html"}},t}(n.MetadataBase),o=function(e){function t(){return e.call(this,i)||this}return __extends(t,e),t.version="1",t}(n.MetadataReaderBase);t.MetadataReaderV1=o}),define("wed/modes/generic/doc-pattern",["require","exports","module"],function(e,t,r){"use strict";function n(e){for(var t=e.split(/(\$\{|\})/),r=[],n=!1,l=0,u=t;l<u.length;l++){var c=u[l];if("${"===c){if(n)throw new Error("nested interpolations are invalid");n=!0}else if("}"===c){if(!n)throw new Error("errant interpolation closure");n=!1}else if(n){var h=c.split(":",1),d=h[0],p=h[1];if(void 0===p)r.push(new a(d));else{if("s"!==p[0])throw new Error("unknown transform "+p);var f=p.slice(1);if("("!==f[0]||")"!==f[f.length-1])throw new Error("transform parameters must be in parentheses");var m=f.slice(1,-1).split(",").map(function(e){return e.trim()});if(2!==m.length)throw new Error("an s transform takes 2 parameters");for(var v=0,y=m;v<y.length;v++){var g=y[v];if('"'!==g[0]||'"'!==g[g.length-1])throw new Error("parameter must be a string wrapped in double quotes: "+g)}m=m.map(function(e){return e.slice(1,-1)}),r.push(new s(m[0],m[1],new a(d)))}}else r.push(new i(c))}if(n)throw new Error("an interpolation was not closed");return new o(r)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.value=e}return e.prototype.execute=function(){return this.value},e}(),o=function(){function e(e){this.values=e}return e.prototype.execute=function(e){return this.values.map(function(t){return t.execute(e)}).join("")},e}(),a=function(){function e(e){this.name=e}return e.prototype.execute=function(e){return e.resolveName(this.name)},e}(),s=function(){function e(e,t,r){this.pattern=e,this.substitution=t,this.child=r}return e.prototype.execute=function(e){var t=this.child.execute(e);return t.replace(this.pattern,this.substitution)},e}();t.compile=n});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define("wed/modes/generic/metadata-reader-v2",["require","exports","module","wed/util","./doc-pattern","./metadata-versioned-reader"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){this.name=e}return e.prototype.resolveName=function(e){if("name"===e)return this.name;throw new Error("cannot resolve: "+e)},e}(),s=function(e){function t(t){var r=e.call(this,"2",t)||this;if(void 0===t.namespaces)throw new Error("namespaces are not optional in version 2");if("2"!==t.version)throw new Error("need version 2");if(r.inline=t.inline,void 0!==r.inline&&"name"!==r.inline.method)throw new Error("only the 'name' method is supported for inlines");if(r.dochtml=t.dochtml,void 0!==r.dochtml){if("simple-pattern"!==r.dochtml.method)throw new Error("only the 'simple-pattern' method is supported for dochtml");r.docPattern=i.compile(r.dochtml.pattern)}return r}return __extends(t,e),t.prototype.isInline=function(e){if(void 0===this.inline)return!1;var t=n.getOriginalName(e),r=t.split(":");1===r.length&&(r[1]=r[0],r[0]="tei");var i=r.join(":"),o=this.inline.rules[i];return void 0!==o&&o},t.prototype.documentationLinkFor=function(e){var t=this.docPattern;if(void 0!==t){var r=this.unresolveName(e);if(void 0!==r)return t.execute(new a(r))}},t}(o.MetadataBase),l=function(e){function t(){return e.call(this,s)||this}return __extends(t,e),t.version="2",t}(o.MetadataReaderBase);t.MetadataReaderV2=l}),define("wed/modes/generic/metadata-multiversion-reader",["require","exports","module","./metadata-reader-v1","./metadata-reader-v2"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.init=function(){for(var t=[n.MetadataReaderV1,i.MetadataReaderV2],r=0,o=t;r<o.length;r++){var a=o[r];e.versionToConstructor[a.version]=a}},e.prototype.read=function(t){var r=t.version;if(void 0===r)throw new Error("no version field, cannot decode metadata");var n=e.versionToConstructor[r];if(void 0===n)throw new Error("cannot handle version "+r);return(new n).read(t)},e.versionToConstructor=Object.create(null),e}();t.MetadataMultiversionReader=o,o.init()});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__assign=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};define("wed/modes/generic/generic",["require","exports","module","merge-options","salve","wed/mode","wed/object-check","./generic-decorator","./generic-tr","./metadata-multiversion-reader"],function(e,t,r,n,i,o,a,s,l,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(r,i){var o=e.call(this,r,i)||this;return o.optionTemplate={metadata:!0,autoinsert:!1},o.constructor===t&&(o.wedOptions=n({},o.wedOptions),o.wedOptions.metadata={name:"Generic",authors:["Louis-Dominique Dubeau"],description:"This is a basic mode bundled with wed and which can, and probably should be used as the base for other modes.",license:"MPL 2.0",copyright:"Mangalam Research Center for Buddhist Languages"}),o.wedOptions.attributes="edit",o}return __extends(t,e),t.prototype.init=function(){var e=this;return this.checkOptions(this.options),void 0===this.options.autoinsert&&(this.options.autoinsert=!0),Promise.resolve().then(function(){return e.tagTr=l.makeTagTr(e.editor),e.makeMetadata().then(function(t){e.metadata=t})}).then(function(){e.resolver=new i.NameResolver;for(var t=e.metadata.getNamespaceMappings(),r=0,n=Object.keys(t);r<n.length;r++){var o=n[r];e.resolver.definePrefix(o,t[o])}})},t.prototype.checkOptions=function(e){var t=a.check(this.optionTemplate,e),r=[];if(void 0!==t.missing)for(var n=0,i=t.missing;n<i.length;n++){var o=i[n];r.push("missing option: "+o)}if(void 0!==t.extra)for(var s=0,l=t.extra;s<l.length;s++){var u=l[s];r.push("extra option: "+u)}if(0!==r.length)throw new Error("incorrect options: "+r.join(", "))},t.prototype.makeMetadata=function(){return this.editor.runtime.resolveToString(this.options.metadata).then(function(e){var t=JSON.parse(e);return(new u.MetadataMultiversionReader).read(t)})},t.prototype.getAbsoluteNamespaceMappings=function(){return __assign({},this.metadata.getNamespaceMappings())},t.prototype.unresolveName=function(e){return this.metadata.unresolveName(e)},t.prototype.getAbsoluteResolver=function(){return this.resolver},t.prototype.makeDecorator=function(){return new s.GenericDecorator(this,this.editor,this.metadata,this.options)},t.prototype.shortDescriptionFor=function(e){var t=this.resolver.resolveName(e);if(void 0!==t)return this.metadata.shortDescriptionFor(t)},t.prototype.documentationLinkFor=function(e){var t=this.resolver.resolveName(e);if(void 0!==t)return this.metadata.documentationLinkFor(t)},t.prototype.getContextualActions=function(e,t,r,n){e instanceof Array||(e=[e]);for(var i=[],o=0,a=e;o<a.length;o++){var s=a[o],l=this.tagTr[s];void 0!==l&&i.push(l)}return i},t}(o.BaseMode);t.Mode=c});